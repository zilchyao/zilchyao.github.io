<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能交易*姚 文档站</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mql5yao/favicon.ico">
    <meta name="description" content="这是智能交易的文档站点。">
    <meta name="keywords" content="MQL,EA,智能交易,自动交易,量化,编程,培训">
    
    <link rel="preload" href="/mql5yao/assets/css/0.styles.c167a2d0.css" as="style"><link rel="preload" href="/mql5yao/assets/js/app.33d9106b.js" as="script"><link rel="preload" href="/mql5yao/assets/js/3.64586e1a.js" as="script"><link rel="preload" href="/mql5yao/assets/js/4.21ff370e.js" as="script"><link rel="prefetch" href="/mql5yao/assets/js/10.f243be4a.js"><link rel="prefetch" href="/mql5yao/assets/js/11.e4fc3b61.js"><link rel="prefetch" href="/mql5yao/assets/js/12.d2b71f90.js"><link rel="prefetch" href="/mql5yao/assets/js/13.d47c9e61.js"><link rel="prefetch" href="/mql5yao/assets/js/14.59ded2e6.js"><link rel="prefetch" href="/mql5yao/assets/js/15.f2836d3d.js"><link rel="prefetch" href="/mql5yao/assets/js/16.fc4e3f11.js"><link rel="prefetch" href="/mql5yao/assets/js/17.069370d9.js"><link rel="prefetch" href="/mql5yao/assets/js/18.e47908ca.js"><link rel="prefetch" href="/mql5yao/assets/js/19.4e8a369f.js"><link rel="prefetch" href="/mql5yao/assets/js/2.7a050c47.js"><link rel="prefetch" href="/mql5yao/assets/js/20.37e31658.js"><link rel="prefetch" href="/mql5yao/assets/js/21.30dc9524.js"><link rel="prefetch" href="/mql5yao/assets/js/22.bb650486.js"><link rel="prefetch" href="/mql5yao/assets/js/23.84e246fd.js"><link rel="prefetch" href="/mql5yao/assets/js/24.3b441f03.js"><link rel="prefetch" href="/mql5yao/assets/js/25.3ceb7172.js"><link rel="prefetch" href="/mql5yao/assets/js/26.ba703a82.js"><link rel="prefetch" href="/mql5yao/assets/js/27.c0597566.js"><link rel="prefetch" href="/mql5yao/assets/js/28.50413136.js"><link rel="prefetch" href="/mql5yao/assets/js/29.04da6b07.js"><link rel="prefetch" href="/mql5yao/assets/js/30.c8071067.js"><link rel="prefetch" href="/mql5yao/assets/js/31.baace808.js"><link rel="prefetch" href="/mql5yao/assets/js/32.d399c058.js"><link rel="prefetch" href="/mql5yao/assets/js/33.9b2114b8.js"><link rel="prefetch" href="/mql5yao/assets/js/34.d6f49f42.js"><link rel="prefetch" href="/mql5yao/assets/js/35.3620d83f.js"><link rel="prefetch" href="/mql5yao/assets/js/36.e26f547b.js"><link rel="prefetch" href="/mql5yao/assets/js/37.c903bf3b.js"><link rel="prefetch" href="/mql5yao/assets/js/38.2f6e699d.js"><link rel="prefetch" href="/mql5yao/assets/js/39.aca9c106.js"><link rel="prefetch" href="/mql5yao/assets/js/40.3eb74932.js"><link rel="prefetch" href="/mql5yao/assets/js/41.4f244c9a.js"><link rel="prefetch" href="/mql5yao/assets/js/42.892231ce.js"><link rel="prefetch" href="/mql5yao/assets/js/43.3f173f86.js"><link rel="prefetch" href="/mql5yao/assets/js/44.4e79ffd4.js"><link rel="prefetch" href="/mql5yao/assets/js/45.9e7cd13e.js"><link rel="prefetch" href="/mql5yao/assets/js/46.240ea5cd.js"><link rel="prefetch" href="/mql5yao/assets/js/47.bc498cbd.js"><link rel="prefetch" href="/mql5yao/assets/js/48.752c3ae0.js"><link rel="prefetch" href="/mql5yao/assets/js/5.47d44717.js"><link rel="prefetch" href="/mql5yao/assets/js/6.ee422b91.js"><link rel="prefetch" href="/mql5yao/assets/js/7.b1ec5472.js"><link rel="prefetch" href="/mql5yao/assets/js/8.036d68c0.js"><link rel="prefetch" href="/mql5yao/assets/js/9.4c2d0d8b.js">
    <link rel="stylesheet" href="/mql5yao/assets/css/0.styles.c167a2d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mql5yao/" class="home-link router-link-active"><img src="/mql5yao/logo.png" alt="智能交易*姚 文档站" class="logo"> <span class="site-name can-hide">智能交易*姚 文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MQL5线上手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mql5yao/Chapter/start.html" class="sidebar-link">MQL5 参考</a></li><li><a href="/mql5yao/Chapter/one.html" class="sidebar-link">01 第一章 语言基础</a></li><li><a href="/mql5yao/Chapter/two.html" class="sidebar-link">02 第二章 标准常量，列举和架构</a></li><li><a href="/mql5yao/Chapter/three.html" aria-current="page" class="active sidebar-link">03 第三章 MQL5程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-1-程序运行" class="sidebar-link">3.1  程序运行</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-2-交易权限" class="sidebar-link">3.2 交易权限</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-3-客户端事件" class="sidebar-link">3.3 客户端事件</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-4-资源" class="sidebar-link">3.4 资源</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-5-调用导入函数" class="sidebar-link">3.5 调用导入函数</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-6-运行时间出错" class="sidebar-link">3.6 运行时间出错</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/three.html#_3-7-测试交易策略" class="sidebar-link">3.7 测试交易策略</a></li></ul></li><li><a href="/mql5yao/Chapter/four.html" class="sidebar-link">04 第四章 预定义变量</a></li><li><a href="/mql5yao/Chapter/five.html" class="sidebar-link">05 第五章 普通函数</a></li><li><a href="/mql5yao/Chapter/six.html" class="sidebar-link">06 第六章 数组函数</a></li><li><a href="/mql5yao/Chapter/add1.html" class="sidebar-link">07 第add1章 矩阵和向量方法</a></li><li><a href="/mql5yao/Chapter/seven.html" class="sidebar-link">07 第七章 函数转换</a></li><li><a href="/mql5yao/Chapter/eight.html" class="sidebar-link">08 第八章 数学函数</a></li><li><a href="/mql5yao/Chapter/nine.html" class="sidebar-link">09 第九章 字符串函数</a></li><li><a href="/mql5yao/Chapter/ten.html" class="sidebar-link">10 第十章 日期和时间</a></li><li><a href="/mql5yao/Chapter/eleven.html" class="sidebar-link">11 第十一章 账户信息</a></li><li><a href="/mql5yao/Chapter/twelve.html" class="sidebar-link">12 第十二章 检测</a></li><li><a href="/mql5yao/Chapter/thirteen.html" class="sidebar-link">13 第十三章 事件处理</a></li><li><a href="/mql5yao/Chapter/fourteen.html" class="sidebar-link">14 第十四章 市场信息</a></li><li><a href="/mql5yao/Chapter/fifteen.html" class="sidebar-link">15 第十五章 经济日历函数</a></li><li><a href="/mql5yao/Chapter/sixteen.html" class="sidebar-link">16 第十六章 时间序列和指标访问</a></li><li><a href="/mql5yao/Chapter/seventeen.html" class="sidebar-link">17 第十七章 自定义交易品种</a></li><li><a href="/mql5yao/Chapter/eighteen.html" class="sidebar-link">18 第十八章 图表操作</a></li><li><a href="/mql5yao/Chapter/ninteen.html" class="sidebar-link">19 第十九章 交易函数</a></li><li><a href="/mql5yao/Chapter/twenty.html" class="sidebar-link">20 第二十章 交易信号</a></li><li><a href="/mql5yao/Chapter/twentyone.html" class="sidebar-link">21 第二十一章 网络函数</a></li><li><a href="/mql5yao/Chapter/twentytwo.html" class="sidebar-link">22 第二十二章 程序端全局变量</a></li><li><a href="/mql5yao/Chapter/twentythree.html" class="sidebar-link">23 第二十三章 文件函数</a></li><li><a href="/mql5yao/Chapter/twentyfour.html" class="sidebar-link">24 第二十四章 自定义指标</a></li><li><a href="/mql5yao/Chapter/twentyfive.html" class="sidebar-link">25 第二十五章 物件函数</a></li><li><a href="/mql5yao/Chapter/twentysix.html" class="sidebar-link">26 第二十六章 技术指标</a></li><li><a href="/mql5yao/Chapter/twentyseven.html" class="sidebar-link">27 第二十七章 处理优化结果</a></li><li><a href="/mql5yao/Chapter/twentyeight.html" class="sidebar-link">28 第二十八章 工作事件</a></li><li><a href="/mql5yao/Chapter/twentynine.html" class="sidebar-link">29 第二十九章 使用OpenCL工作</a></li><li><a href="/mql5yao/Chapter/thirty.html" class="sidebar-link">30 第三十章 使用数据库</a></li><li><a href="/mql5yao/Chapter/thirtyone.html" class="sidebar-link">31 第三十一章 使用DirectX</a></li><li><a href="/mql5yao/Chapter/thirtytwo.html" class="sidebar-link">32 第三十二章 集成</a></li><li><a href="/mql5yao/Chapter/add2.html" class="sidebar-link">32 第add2章 ONNX模型</a></li><li><a href="/mql5yao/Chapter/thirtythree.html" class="sidebar-link">33 第三十三章 标准程序库</a></li><li><a href="/mql5yao/Chapter/AppendixI.html" class="sidebar-link">34 附录一 来自MQL4</a></li><li><a href="/mql5yao/Chapter/AppendixII.html" class="sidebar-link">35 附录二 MQL5 函数列表</a></li><li><a href="/mql5yao/Chapter/AppendixIII.html" class="sidebar-link">36 附录三 MQL5常量列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2>第三章 MQL5程序</h2> <p>要运行mql5程序，必须编译(点击编写(编译)按钮 或者 F7键)。编译过程应该没有错误(可能有一些 警告 错误，它们可供分析)。在这个过程中，会在相应的目录中创建一个具有相同文件名称，并以 EX5 作为扩展名的可执行文件。
终端安装目录下\MQL5\Experts,
终端安装目录下\MQL5\indicators 或
终端安装目录下\MQL5\scripts.
这个文件就是可以运行的MQL5程序。</p> <p>MQL5程序的操作特性将在以下部分中描述:<br>
• 程序运行 —— 调用预定义的事件处理程序的顺序。<br>
• 测试交易策略 —— 在策略(EA交易)测试中 MQL5 程序的操作特点。<br>
• 客户端事件 —— 事件描述，在程序中可以处理 ；<br>
• 调用导入函数 —— 描述导入函数的顺序，允许参数，搜索细节和调用协议等。<br>
• 运行时错误 —— 获得关于运行时和关键性错误的信息。<br></p> <p>EA程序、自定义指标和脚本可以通过从 导航 窗口中拖放的方式来附加到一个打开的图表中。</p> <p>要停止EA程序的操作，应该从图表中删除它。在图表上点击鼠标右键，在出关的上下文关联菜单中选择“EA交易系统”，然后从列表中选择EA并单击“删除”按钮。EA的操作也受到“自动交易”按钮状态的影响。</p> <p>要停止自定义指标，从图表中移除即可。</p> <p>直到从图表中移除才能运行自定义指标和EA交易；附加在EA交易和指标中的信息在客户端起始位置保存。</p> <p>直到被明确地从图表中删除之前，自定义指标和EA程序会一直保持工作状态;有关EA程序 和 指标 的附加信息保存在客户端会话之间。</p> <p>脚本只会执行一次，在操作完成 或 当前图表状态更改 或 客户端关闭时 自动删除。在重新启动客户终端脚本后，脚本不会启动，因为不会保存有关它们的信息。</p> <p>在一个图表上，最多只能附加一个EA程序，一个脚本；但 指标 的数量无限。</p> <h2 id="_3-1-程序运行"><a href="#_3-1-程序运行" class="header-anchor">#</a> 3.1  程序运行</h2> <p>每个 脚本 和 每个 EA交易程序 都在各自的线程中运行。所有在一个 交易品种 上计算的指标，即使它们被附加到不同的图表上，也会在同一个线程中工作。因此，一个 交易品种上 的所有 指标 共享一个线程的资源。</p> <p>与 交易品种 相关的所有其他操作，如 跳价处理 和 历史同步，也会与指标一起始终在同样的线程中执行。这意味着，如果在一个 指标 中执行了一个无限循环的动作，那么与其交易品种相关的所有其他事件将不会执行。</p> <p>当运行一个EA交易程序时，请确保它有 一个实际的交易环境，并且可以 访问所需交易品种的时间周期 以及 历史数据，并在 终端 和 服务器 之间同步数据。对于所有这些过程，终端的启动延迟不超过5秒，在此之后，EA程序将开始使用可用的数据。因此，如果没有连接到服务器，这可能导致EA程序的启动延迟。</p> <p>以下表格包含MQL5程序的简要概述：</p> <table><thead><tr><th>程序</th> <th style="text-align:center;">运行</th> <th style="text-align:right;">注意</th></tr></thead> <tbody><tr><td>脚本</td> <td style="text-align:center;">单独线程，脚本的线程数量等于脚本数</td> <td style="text-align:right;">循环脚本不能破坏其他程序的运行</td></tr> <tr><td>EA交易程序</td> <td style="text-align:center;">单独线程，EA交易程序的线程数量等于EA交易的数量。</td> <td style="text-align:right;">循环EA交易程序不能破坏其他程序的运行</td></tr> <tr><td>指标</td> <td style="text-align:center;">适用于一个交易品种上的所有指标共用一个线程。线程的数量等于指标交易品种的数量</td> <td style="text-align:right;">一个指标中的无限循环将停止该交易品种上的所有其他指标</td></tr></tbody></table> <p>当一个MQL程序附加到一个图表上之后，它首先被上传到客户端电脑的内存中，然后进行全局变量初始化。如果 类 中的某些全局变量有构造函数，在全局变量初始化时则会调用构造函数。</p> <p>之后，MQL程序开始等待客户端事件，每个MQL5程序应该至少有一个事件处理器，否则加载到内存的这个程序就不会执行任何操作。每一个事件处理程序有预定义名称，参数和返回类型。</p> <table><thead><tr><th>类型</th> <th style="text-align:center;">函数名称</th> <th style="text-align:right;">参数</th> <th>应用</th> <th>注释</th></tr></thead> <tbody><tr><td>int</td> <td style="text-align:center;">OnInit</td> <td style="text-align:right;">无</td> <td>EA交易和指标</td> <td>初始化事件处理函数，允许返回void类型</td></tr> <tr><td>void</td> <td style="text-align:center;">OnDeinit</td> <td style="text-align:right;">const int reason</td> <td>EA交易和指标</td> <td>无法初始化事件处理函数</td></tr> <tr><td>void</td> <td style="text-align:center;">OnStart</td> <td style="text-align:right;">无</td> <td>脚本</td> <td>启动事件处理函数</td></tr> <tr><td>int</td> <td style="text-align:center;">OnCalculate</td> <td style="text-align:right;">const int rates_total,<br>const int prev_calculated,<br>const datetime &amp;Time[],<br>const double &amp;Open[],<br>const double &amp;High[],<br>const double &amp;Low[],<br>const double &amp;Close[],<br>const long &amp;TickVolume[],<br>const long &amp;Volume[],<br>const int &amp;Spread[]</td> <td>指标</td> <td>计算所有价格的事件处理函数。</td></tr> <tr><td>int</td> <td style="text-align:center;">OnCalculate</td> <td style="text-align:right;">const int rates_total, const int prev_calculated, const int begin, const double &amp;price[]</td> <td>指标</td> <td>计算单个数据数组的事件处理函数指标不能同时有两个事件处理函数 只有一个事件处理函数处理数据数组</td></tr> <tr><td>void</td> <td style="text-align:center;">OnTick</td> <td style="text-align:right;">无</td> <td>EA交易</td> <td>新跳价事件处理函数。当正在处理一个新的跳价事件时，不会接收到这种类型的其他事件。</td></tr> <tr><td>void</td> <td style="text-align:center;">OnTimer</td> <td style="text-align:right;">无</td> <td>EA交易和指标</td> <td>定时器事件处理函数</td></tr> <tr><td>void</td> <td style="text-align:center;">OnTrade</td> <td style="text-align:right;">无</td> <td>EA交易</td> <td>交易事件处理函数</td></tr> <tr><td>double</td> <td style="text-align:center;">OnTester</td> <td style="text-align:right;">无</td> <td>EA交易</td> <td>测试事件处理函数</td></tr> <tr><td>void</td> <td style="text-align:center;">OnChartEvent</td> <td style="text-align:right;">const int id,<br>const long &amp;lparam,<br>const double &amp;dparam,<br>const string &amp;sparam</td> <td>EA交易和指标</td> <td>图表事件处理函数</td></tr> <tr><td>void</td> <td style="text-align:center;">OnBookEvent</td> <td style="text-align:right;">const string &amp;symbol_name</td> <td>EA交易和指标</td> <td>预定义事件处理函数</td></tr></tbody></table> <p>客户端给打开的对应图表发送新事件。事件也可以由图表(图表事件)或MQL5程序(自定义事件)生成。通过设置图表属性:
CHART_EVENT_OBJECT_CREATE 和
CHART_EVENT_OBJECT_DELETE，
可以 启用/禁用 图表上创建 或 删除图解对象的事件。
每个MQL5程序和每个图表都有自己的事件队列，在其中添加所有新的传入事件。</p> <p>一个MQL程序仅接收来自它所运行的图表上的事件。所有事件按照它们接收的顺序先后处理。如果队列中已有 新跳价(NewTick)事件，或者该事件当前正被处理，那么新的新跳价(NewTick)事件就不能加入到MQL5程序队列中。同样，如果图表事件(ChartEvent) 已经加入队列，或该事件正被处理，那么此类的新事件也不会加入队列。计时器(timer)事件也以同样的方式处理 - 如果计时器(Timer)事件已经加入队列 或 正在被处理中，新的计时器(timer)事件就不会加入队列。
事件队列的容量有限但足够大，因此不太可能出现编写良好的程序队列溢出。在队列溢出的情况下，会丢弃新的事件，不会加入事件队列。</p> <p>不建议使用无限循环来处理事件。此规则的例外可能是只处理单个启动(Start)事件的脚本。</p> <p>程序库 不能处理任何事件。</p> <p>在 指标 和 EA交易程序中 禁用的函数</p> <p>指标，脚本和EA交易程序都是用MQL5编写的可执行程序。它们是专为不同类型的任务而设计的。因此，根据程序类型 ，对于某些函数的使用会有一些限制。以下函数在指标中被禁用：<br>
• OrderCalcMargin();<br>
• OrderCalcProfit();<br>
• OrderCheck();<br>
• OrderSend();<br>
• SendFTP();<br>
• Sleep();<br>
• ExpertRemove();<br>
• MessageBox().<br></p> <p>专为指标设计的所有函数在EA交易程序 和 脚本中也被禁用：<br>
• SetIndexBuffer();<br>
• IndicatorSetDouble();<br>
• IndicatorSetInteger();<br>
• IndicatorSetString();<br>
• PlotIndexSetDouble();<br>
• PlotIndexSetInteger();<br>
• PlotIndexSetString();<br>
• PlotIndexGetInteger.<br></p> <p>库 不是一个独立的程序，当有脚本、指标 或 EA程序这样的MQL5程序调用它时，在相关联的上下文中执行。因此，上述限制也适用于调用 库。</p> <p>函数库 不处理任何事件。</p> <p>指标的加载和卸载</p> <p>在下列情况下，指标被加载：<br>
• 拖曳 指标 附加到图表上；<br>
• 客户端开启时（如果在上一次客户端关闭之前 指标 已附加到图表上）；<br>
• 装载模版时（如果在模板中指定了图表上的指标）；<br>
• 更改了图表配置文件(如果该指标附加在该图表配置中的某一个图表上)；<br>
• 改变图表的交易品种符号 和/或 时间框架，并之前已附加了 指标 时；<br>
• 一个 指标 重新编译后，指标 重新附加到图表上；<br>
• 改变了 指标 的 输入参量 。<br></p> <p>在下列情况下，指标被卸载：<br>
• 从图表中删除 指标；<br>
• 客户端关闭（图表上附加的指标随之卸载）；<br>
• 装载模版时（原图表上附加的指标被卸载）；<br>
• 关闭 指标 附加的那个图表；<br>
• 更改了图表配置文件(如果该指标附加在该图表配置中的某一个图表上)；<br>
• 图表中交易品种或者时间表改变，指标附加；<br>
• 改变了 指标 的输入参数。<br></p> <p>EA交易程序的加载和卸载</p> <p>在下列情况下，EA交易程序被加载：<br>
• 将一个EA交易程序附加到图表上；<br>
• 客户端启动（如果在上一次客户端关闭之前 EA交易程序 已附加到图表上）；<br>
• 装载模版时（如果在模板中已经指定了图表上的 EA交易程序）；<br>
• 更改了图表配置文件（如果 EA交易程序 已附加在该图表配置中的某一个图表上）；<br>
• 连接帐户，即使帐户号是相同的(如果在之前帐户连接服务器时，EA交易程序已被附加到图表上)。<br></p> <p>在下列情况下，EA交易程序被卸载：<br>
• 从图表中删除EA交易程序；<br>
• 如果把一个新的EA交易程序添加到图表中，而图表上已经附加了另一个EA交易程序，则原来的(旧的)EA交易程序就会被卸载；<br>
• 客户端关闭（EA交易程序 已附加到图表上）；<br>
• 装载模版时，（如果在模板中已经指定了图表上的 EA交易程序）；<br>
• 关闭附加了EA交易程序的图表；<br>
• 更改了图表配置文件（如果 EA交易程序 已附加在该图表配置中的某一个图表上）；<br>
• 改变客户端连接的账号（如果在之前帐户连接服务器时，EA交易程序已被附加到图表上）；<br>
• 调用了ExpertRemove()函数。<br></p> <p>如果一个附加了EA交易程序的图表，改变了 交易品种 或 时间框架，则 EA交易程序 不能 加载 或 卸载。在这种情况下，客户端随后会调用原 交易品种/时间框架上的函数OnDeinit() 和 新 交易品种/时间框架 上的函数OnInit()来处理程序 (如果它们是这样的话)，全局变量 和 静态变量的值不会被重置。在初始化完成之前，已经接收了 EA交易程序 的所有事件(OnInit()函数)被跳过。</p> <p>脚本的加载的卸载</p> <p>脚本在附加到图表过后就直接被加载，在完成操作之后会直接被卸载，脚本不会调用OnInit() 和 OnDeinit() 函数。
当一个程序被卸载(从图表中删除)时，客户端将执行全局变量的初始化并删除事件队列。在这种情况下，反初始化意味着重置所有字符串类型的变量、重新分配动态数组对象的存储单元以及调用它们的析构函数。</p> <p>当程序卸载后（从图表中删除），全局变量的客户端程序不能初始化并删除队列中的事件，这样所有的字符类型常量都会重设，动态数组对象 的存储单元会分配析构函数 也会调用。</p> <p>为了更好地理解EA交易程序的操作，我们推荐编译如下的EA交易代码，并执行加载/卸载、更改模板、更改交易品种、更改时间框架等操作:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                                   TestExpert.mq5 |</span>
<span class="token comment">//|                        Copyright 2009, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                              https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;2009, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>

<span class="token keyword">class</span> <span class="token class-name">CTestClass</span>
  <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">CTestClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;CTestClass constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token operator">~</span><span class="token function">CTestClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;CTestClass destructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
CTestClass global<span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA交易程序 初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Initialisation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA交易程序 反初始化函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Deinitialisation with reason&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA交易程序 跳价函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>

  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>相关参考
客户端事件 ， 事件处理程序</p> <h2 id="_3-2-交易权限"><a href="#_3-2-交易权限" class="header-anchor">#</a> 3.2 交易权限</h2> <p>自动交易</p> <p>MQL5语言提供了一组专门用于开发自动交易系统的交易函数。无人为干涉，为自动交易而开发的程序称为EA交易程序 或 自动交易。若要在MetaEditor中创建EA交易程序，请启动MQL5向导并在以下两个选项中选择其中一个：<br></p> <p>• EA交易(模板) —— 允许您创建一个具有现成的事件处理函数的模板，并通过编程的方式来补充所有必要的功能。<br>
• EA交易 (生成) —— 通过选择必要的模块:交易信号模块、资金管理模块和追踪止损模块，让您逐步的开发一个成熟的交易机器人。(参考文档: MQL5 WIZARD：新版本https://www.mql5.com/zh/articles/275)<br></p> <p><img src="/mql5yao/assets/img/thi1.54b72cee.png" alt="Alt text"></p> <p>（注意： MQL4 和 MQL5 的向导有差异，上图为 MQL4 向导）</p> <p><img src="/mql5yao/assets/img/thi2.cf6e2026.png" alt="Alt text"></p> <p>（注意： MQL4 和 MQL5 的向导有差异，上图为 MQL5 向导）</p> <p>交易函数只能在EA交易和脚本中工作。指标不允许交易。</p> <p>检查执行自动交易的权限</p> <p>若要开发一个可靠的EA交易程序，能够在没有人为干预的情况下工作，则需要安排一套重要的检查。首先，我们应该以编程方式检查是否允许进行交易。这是开发任何自动化系统时必不可少的基本检查。</p> <p>在客户端检查执行自动交易的权限</p> <p>客户端设置为您提供了 允许 或 禁止 所有自动交易程序的权限。</p> <p><img src="/mql5yao/assets/img/thi3.bf9b66ab.png" alt="Alt text"></p> <p>您可以在程序端标准面板直接切换自动交易选项：<br>
•AutoTrading_enabled —— 启用自动交易，允许使用应用程序中的交易函数。</p> <p><img src="data:image/png;base64,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" alt="Alt text"></p> <p>•AutoTrading_disabled —— 禁用自动交易，运行中的应用程序不能执行交易函数。</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAAA6CAIAAAHW8NkqAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAABbWSURBVFhH5ZkHnFT1tccngErTmETFqM+OGjWa4NMgSoQoaAABu2BUikpdwMoDDCotFDUSBVGQKtI0ojQpUqW4oMCKlGVZYHf6zO33zuzO7O593ztnGFlxE/Ievqfv/T7w5/zP//R/vYNv+vTpU6aPnz11NsR3wqfrelgLPbHSjMfjmqaZpunz+WihIRj1/h74bNiuWbftX70UIcMwFEVhmJauJyHi4XCYMehj4WPYspxOnTqhJNqO46gZ2Lbt2UDVr+vrFxU54UM4BpFIxLIsRBn2JBQzVj+vasANpxc19GI6Fp6NfwyvHjOmzZw15V3J/lvwzHZ6fd7qPbsgCBAN3AOiIWpv2NjWZunlFwV1LRgMwhUJCfaflMFHrmTu2cgo0aXFLJxEIuGLx9Xbb7993vB+5XoEg4z95Cc/QQjag6IGbxtaEHXtUDqFxrfwT1LPDpu2lVaieihqG940Hj+y9b5x1ML75u66ZfzWP68LFhYWMiBzSduwYUOCLCsrk2iZ1AYNGtStW5fMvPBEP6ga6xYN2/mX1oeur7926jQlpqNJnWUZISrmqCDdaDQKnwJAZ+OnA6Scnr1MKY8HPmyjWVx8aPHipQsXLrzvvvvo4hlXhIo5kRP/uCURrH/jP65GTC3xy4HOkIF357eq77q22eTcmO6tTnDyySd7Qj5f7dq10YHAIm0ymaT1hhQ77uiKGQ0dilVW+d0KLaG4hplMM3Y88NYtmPbu1DlT35o/fcG0GcI4XmTrl7YMFpetxai8cI4T2flLGxXdPy25d8wC00jEYjEGYJK/bFNabx1nli51hahVq5ZMbVZ/9Nfuta+uuOO9fV1emo4+EkxyIBCAAAiINGBShIkY3ay+uvP28O52m89r8MX59fy6v7avDq5kqE4dj/Z2YcY/aswu1kUgqx8LRsv0PkUXnRO84ZRYKBgKhUiBsDM5epPPtKEparS5HL35BHABuQHREf4/xX97/SKa0bQXLVqyY8eOI10vIiFyHGJm2dGSFxll648NlnTXrt23b9/Zp0+fnj17Uh6OMPiyBTEkbSrlHS/oV1ZWQmPU07eSCUePrp334puvf9Ki80P7P35/j2FahjfbQPxIi1uJi/rBAZ6+bRlBK31xz/w5T53h9r7bTSU2tWhZptnIASYCK3hDky0kNwJ8ycvT10Lmnrjb6GnzkT6vbL/pArfM9Y8cXh71bB8PfLparscCipIstasiVcmoZjlBxYkft35mFv7rqKZva3GDzK2KoJ0MGeGAHo7Yevxf25D/GrLLXxDXNSUeTqYrCrTkvpRrVblKoETTvGX+PaGa+11K6N9fmTZ958Gpn4U7r9XbvVf4uwkFozYdLioqIlIOEDlMWUayyVhS7GrWIyuEoVNOOYWFlVl11YA8RwCLh0uTrljIOKzufvPWue/Ne+y5ucN6/23AhBn9C/NvzR/c2L+l5YEDB1BgzaGMCU6ujFnPLq2EAsGW4bxiUbMv2GaIsVjRosso7mkJEUfIi8dq7p1Q2dJZPVPBR93oiIkX+LZeeo2bdPU/tJ81ZJBpKWYiWafWSeRKxgCjWCFd2dmoUwDxBM2QBCddQqGFlkuXiOl6HPlHYJeVa3q4TC3/bOnrC6e2W/dcp8Wtmnw56i+l+/dFLDNhlycTXjbkRBA4lp2IJzIWf0CiYbfCYXZoEZP40MU3RGlpqecP9zOOwsyjkL2ZjkFW9AShWvZEmkOW9T3Dc0/FKCarpkuXbm3b3jlx4qT5899/6aWX+vXr98YbbzDNspooIGJERkkhhEkXdapaXl4OhyOcLgRmmR1GaTm2xYUwgQgA72DmHznYOcjbt+/YrdtjM2e+m5eXN3r06OLiYobwJwJsAVlNsoUAwQmBdWiZbAwiDBMtaIaQF4IoWfyyaAC3pq5oqqE7lmMXRNI3d3xr23uNVr173rihZx4acE1V16ban26ac+OVbmERt5elZh9hAvF60kkn4ZWcZNljGmeSItsdJqMSpZSBIfENfKoVt3XNUJOFetU5g91Lni+5sd/iZwc/d/C6U/W211PMCjexsZFv+2WXGInyZNh7b+fAVmZH0RIEzgA+aPEBwWTR4gN/EMhA0wpT4IvaESOWtNSo6rh/Xume0+vgaV0PN8lb+auHRw698OyVp/rWNfJ9dW973Y2zIcPW8d5Fxwk+N3RNtxVTNSymIZxIUKjD6QS3TsBUlWhKCxilXt7lZZGA39G9XXsCkX2xCmbMmTzlnWlzZsyY/86EmZNmzJs2f9aMd6fMmJwd/h5Q7cK1FN6m6aiVCnIumtGgEeMxr6jf441bzX3CsdK6WqlHHTVox+KOGeMGjkWrrfYTi2qnHhvANLTDVnKf636t8I6zeIBoZjI7/D2gmnszHi+KVbWfva7fmninKTsWFwX3HTwY1xKEyV5iQ8vOZmtxqgB2EXsaRQToQvA6RAZJOHSR5I7hYGBzAnTZrp6nI6jmvvfsBU1GvrmuWB+5yuy2MnDxyE0jv7BajJ3DRY4nTOcOVKxzvXIqsLk5TDjIMM0hQws4DKDlWSAbnQiED1CXWEE1972WhJ5an7x5wqeXjl5x65TiV0vdPz6/ZOXOVbl0Af7kqCeP+vXri1F0GYJmSO5WYqIrp6HI0AqkYIJq7l8ed9+4WY/f/cqT46YOWLC8ze4Jv90/97o5Y36GafxRUrFCrpKoVIKq0uK1Xr16CBABudKVgKiQlD0XAaZAxmF19x9N+q1b3DF14FEt0HHahb73fnvBskvOfO0qnxE6EK1ydM3mzAc8pEiO7LFFTDmjtMy0ZI8zOCSKpNwCjBIKcROWHMCgmvvyUOmKOde46osVsWdXXXW2WelUVbmF5/viewr8SjRQGo4pnjlABOQEIYsRl14ImQcnjjFFYWTWCUhkpGDMBTERgXis5t4qs1MxddbbjV33rRUXnlx84enBpietvtqn7CtUNaPMTGiO995FEhO817ALQQtYlVymxIFXwiJ12SzQyMAnILKnCwHEYzX3JcFAeUJTi6Iz32r2QV7z5Xc0W3TbjQe37CjxH1acpBaM6Y5XNzLANBkADOEJ6zBp4dP1+/1sk6xRXSdQkUQGdWQIQoayX8kCsShAJwcs5pAVPUH4335qZpPKQGZRkA0vAymUICt6glBt7rO8DLKs7xnZt5FsBr7XWBa7du0eMuTPPXr0IIijVwolQYzFTAuTIVklUh4IMQKNTC4BCGECfEHLF5JwvN98RHTTpk28svPy+i9Y8MGUKVNHjBjRokWLyspKCY5NhT8kWdL4Y/uJFi0gPu4FkZS9gLBsUbow8QcTI8gcPZvZU1p25zPPPDd37vwtW/JXrVr98ssv9+zZ8+abbyYV5FAjatnZ7B+YKIoPhqD5TCATBNh18OEggzDhwoeDFsThw4fZ/fjKuoeFPqFl3Ji/+U0TUu/atfuwYcM6d+6MGiZQwAqeOO0517zjLXOKocUZB4ieLi2m5GLEvThAHTF2Ly4RIDg437hXEzFdKVNt043vd+2Strc2HT5oxNvLPn5n4iedOzTfMOql0tLPk2UVRpLCRn21v7m4AFaIngOYCnPN4FUg55KUHWdAKoF7IXLB+RQtqqkJVYsYutvr5eLxw5utm3rFB2PrT3q8oTuwVSLv1qJmF+UPelZVwixRX63qb8OMDyLAHNHQxZ9EhifCgsAfQJghWokVIuve0e244SR0/8SV7uWD9WseePOTseeOzjvD6dnE1fdUuXaZ6y45q3baiQRVw1fbm6wcsELlmRSWBRkThPwoByGTggxll2gyUXnqeGWJZN3bPGltp8o4dMN/mI2eSrR4JXDbw08PfPKF6KOXum5Ud814lbucS0/dq2uO7+STuDpzIA8sYotWEpJi0JUyiDOWBSHWrVuXMiAgyHj3fhmzkoalplIDx+f/4hn3grzC/n/Nv/KK5uubnO2G15W7ruGam8870wn5Vb42ogFRO1HwmRwqMUvTo6VRt+Wo0jN7KWc+svmOIYtb3nD7wjN82y6uu7uxz92xKmBrZtgIVHzzdXhC4ItpuqU6ST1sKlEeM/5IRYnmBpNV7O2AGSkPWYVVtqMrlsE5YyXUb55pJwQ+00gohqniwHISFseTn289S0katqI7Ront15LxYChiOWZC0WNq9gexE4VqG+l/Hj63RiRcN1VZ5ZZXuOVVbsp1065b4bpVrguTNvcHZqqqMqv0o4J343wn2AtGTLEUw1ZNPeb96qMYeoy7U+eU0FQ7qjhRxVbifBdy/TnprNqPCjUuPPI0LHZk1In602o4qUYM/rAxbZcPblvVnVjEigbKDY1tYuhlWbUfFao99I5G5jLjztYjhl0Q1MZ+tLbdqLf/MHbmrcPGd58wdW3xobjj/RBUnjDiqkJVsmo/KtSYvO2kDNPeEwhMWLu5w1sfD91d9Xx+2bB1yvOr93ZZ9nWLdzY1Hjjv+uGLb3n9k5bjJr22fg3XG1pcqtxw0LnbFXDr8uErhHC4KZHh8oMj330AjtyUXJ/ybGNyKioqoLkseXPR5ZpEBUfQuMg8Y0yuenlXiAXWM8LIyJsGefjQ8mrzcjuCGpN/4LW/9/pwZ7/Vpc1HzRm9vnDi9pI3i83HP/3qoQ82tn7nk+tHz205dsEzy3fPM9xHp63vOHLZ3r17eWygiAOIdDqdycj73KWVp4HQ8isImfMIIStUkCc+AoUgVhJj0SEjsSJJV1peMkgigDCtCJA5LUWU17skSZmQ5IGKHRSldogdjRqT7/Pe/FZjpjz0fn73VUX9NhwasjnW98Ngj9l6i3mft3p12cPjl7Z6ZvCL7zz5/vyHJ41rvunTETxeiQxneMUZjomGeRDAJDHmCj4JE5AkgCMJWpwSNF0kIeTHEeSlWNQOIzKlMOnCFC3swwHQMOU1JTFggVE40Lli5VBj8gXL2u9cfpO2t425p41e0DH+RfuyQ+38X13lFLTYOe66N67xzbzaN/sy3/QLfO/f3HB9j7N27dpFZHjFB/7wLXFA4xImo5I8qRK6RCapyqJFklYqIjMm60LUMQUnB9RRxAsCELKm0IVP1fBFl1E4+KIrYXiJHYUak3fjoUVT7l8xu7G+6073UI908RPq/ocM/2Pr7r/6/ctO/eiyS5Ju2C1Pu8m4fsct+Vf65o8Zppfs4/4rjJQk3CrLTNb21apTy/shMROthwYNGmSpI09gnr205IZHCFpCJGJ2xOmnny6LnG3PFxM5ABFAUnY+1aFL8uKFIuaSl5mXgqZSKSpOQak+WjnUmDy3d/RwRSIU/2zZ04vn/iYR6O8mx5VHBi9q9tMll9Zbcvm5rnvYLYu6FX7jtuah82vNGDQ4tP0LLRY2HFt+eeMVwfuAIGQ5sC+YPWIlMtrcoqBlFDHAUG7tEDqxyo5AWGjk6SJDntQIQCMMkxKQpBiHiTX4QmAK5rcyBzUmz12uJAKWEzYiCcsf2rBs+JypN9qx58zoCx92PGver+rol59aerUv+mvfB01PnfLYHw/lbzu8Z7dm6HGdB7JTbiWVWFxPeoESOvkAzErctIAuMZEAcUNLaaQEgNDJFi04tIihCBNwmpIP0y58tFgaUg6MiLyXQ+ZSwBRpoyWjwhfUmLwaT/Hct2zvFrfj6VSMT+7ieNGKg9vXBHZuOVRQ8Pmevfv2lGwpLCrau+/L4N5wOBh1jFDSDhmWodlJPgPiMc32zmSQCwsiFxy5SapEzyhDMCVKkSRDCJk32eGyHFDPpQSoIzTytIjBEReUQ36LgMMoRiAyyWVR4/O2JmT1joFM5rHIqv0gUeOHTVUNyA7/n0CNb/vshB6DbNGOQXb4GGTN/SDxLyfvbbLvQnb4GGTN/SDhJU/oHAYAmkMCcJxwEodCkeXLV44ZM65Pn7x7772/d+++AwcOeuGFF5544ol77rln6dKlkhsb27OUOZYzit7qoJUDCbOcUpzPMMWFVAovKHI+CRMZUeSIgiMnFkzEvNJqGtboynFNV3xBeI6PTBXqiEFgmVG6nHZoiSkuQvGSg3faI4RROW9pCWjr1q133XVP27Z3Pv/80BkzZs2bt2DVqtXLli3/9NM1kydPHjp06IABA7p169a6deunnnqKB4kkIBaInpj4OJHciJJRSRJfMGkRQFJahuRKQ52IscarhiECBRCA9wlaWGAUSWyKZQRoJWFGcQqHIXKGj1m6WEMFv/iCj2QO3o+b4oAOEgBRDDlO8vDh0g4d7ure/fE1a9Z9+eWODRs25udvmzlzZvfu3Tt06NCsWbNBgwZ9/PHHX3/9teSGdYzQ4hiDnCh8kGEfmzxjMSuzwQxkXGeLLk4RkxDlYUuLTZgkgIz85MooMoxiH1OSOYTkD8E7j+cdArgDEIBnJUyeWCwiiTAH70WNdSgJGusYpbVtFoz6yCNdWre+45577rv//gfz8vqzCjZs2LBy5UpK0LFjx23bthEl8ZE5dghOAoLAoHzYeXXN/MKOGIXHF8Ke4yP/cwtEnQAy0XrIhY4pWnnbQgifty3whjOARh3JnBbZijwQJhXnsSyuc/A+G+NGVGHXKAmeparlPdLS8ZCWNkJxd+niOVPfuGn0M+d2aX9+twd+16/HnX/qdEOb5uf0aHX2+gd+HX206f4OV331x8Zf/v6Xn08YqxcUVFRURbWIpUZVbGmOr473Av9OEBC1yITnIZcbZYKgghSL7zmZWHJDhQ8BCDjUK6PkPebhw2SZUFZ54ctvB0cD4zK1305e1RXT8I4lRXd0zdEVv16W3hVwO48vvbznjis6rek/sNuKt3+2c3qjNa82+mjYaZP7/nxHn0vcLk3toQ8e6tdOefZupcsfCu9uuvHin86/8t+Co8eU2THFMMO6ldBtX7X/Zvk2SIMJYd7I0wsl8xUoy570GOVbTfjMKqGTAGmwwjlWIBBgFBkI+c2DYsHHYG4J5EChZWF6SR+BL6ZHnJjFt0jEsGwjlTZLC+OJe8eqp73gXvGie/XQkmufDfy+09RenRoP633GXe1P0W853+nbVH/oVtf1uykjmTrgpvyuY5VcWn/9+bXXXnyRpR+M24mYajlRvVbdbz7pvwUCIh/mipiIni5rVZYrgUpiIiP7AoLQZWvIOkeAIdSZf4YoHDKMYkF0RQAVvNDSFbM5+HRHtYNWkkpz90StKq2oNOXeONy9pJfb6MnKnz/hNv2Pks4TC5o9ufjqNn379+qz/He/2NPmPPvaX7mu5v2anY64esBw3S2//tmHF/gOXXetYuzlU1NTzErV8dX+R8tezhrSkAmBQ6wkQKoydQSNDMkAunIo5pauDMnmh8YIhUAFplRTtCgowugiICXLwRezwqblZH6PpkjBuGP6Lffva9XznnV/3tdt2Luq3uPqL3sV3ja84MERH7V8bPANja96/fzLNtatU3TVuX8/q97KRmdtqH/K56f5tv203hed2lUc2JqoTAQDSlorZzfFy07w//GcWPhiTjSuG2osYcXtMl219ZCmxi0zFa50Nxx0XlsS6frXot/nbbyy04Jr7p980yOTeg9f/uDTo0ePGLKw76ObO3TceHvbzzs9kPzbqMSXn7lWyCw3QjEOu6RuJyNaTDXCWT8/SHgHnqoZZGvojpe2HrGNuK3FXSdhhAJWtLQyGUklw5bhV/XSuBZU1OK0HU1Yqj8cUhUzGdZc3TKU6AFTqUim9VJO3UR5edoqiVYpfNtm3fww4TP4WDYSkWg8oilq0o5aeky34lpCj2mm7nBuxXSO7UpDL9MjRiJmlccqeKeE446qWYZJ9kYkrKQUl0Jo5WUhPWZqbCG92IiVmGbCqsj6+UHCN/3/LaZP/0+ngcyNgRHSEgAAAABJRU5ErkJggg==" alt="Alt text"></p> <p>示例检查：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_TRADE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Check if automated trading is allowed in the terminal settings!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>检查某个运行中的EA/脚本 是否允许进行交易</p> <p>您可以在启动时 允许 或 禁止 某个程序的自动交易。为此，请在程序属性中勾选特定的勾选框</p> <p><img src="/mql5yao/assets/img/thi6.2bc42a99.png" alt="Alt text"></p> <p>（注意： MT4 和 MT5 客户端上的设置有所不同，上图为 MT4 中选项面板）</p> <p><img src="/mql5yao/assets/img/thi7.90089b82.png" alt="Alt text"></p> <p>（注意： MT4 和 MT5 客户端上的设置有所不同，上图为 MT5 中选项面板）</p> <p>示例检查：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_TRADE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Alert</span><span class="token punctuation">(</span>&quot;Check <span class="token keyword">if</span> automated trading is allowed in the terminal settings<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 检查终端设置是否允许自动交易!</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">MQLInfoInteger</span><span class="token punctuation">(</span>MQL_TRADE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Automated trading is forbidden in the program settings for &quot;</span><span class="token punctuation">,</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在程序设置中，自动交易是被禁止的</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>检查是否允许当前账户的任何EA/脚本进行交易</p> <p>在交易服务器端可以禁止自动交易。示例检查：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_TRADE_EXPERT<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Automated trading is forbidden for the account &quot;</span><span class="token punctuation">,</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_LOGIN<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">&quot; at the trade server side&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 在交易服务器端自动交易是禁止的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果一个交易账户被禁止自动交易，EA交易/脚本的交易操作则不会执行。</p> <p>检查当前账户是否允许进行交易</p> <p>在某些情况下，交易账户可能被禁止任何交易操作 - 既不可以手动执行也不可以自动交易。投资者密码用于连接交易账户时的示例检查：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_TRADE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Comment</span><span class="token punctuation">(</span><span class="token string">&quot;Trading is forbidden for the account &quot;</span><span class="token punctuation">,</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_LOGIN<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;.\n Perhaps an investor password has been used to connect to the trading account.&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;\n Check the terminal journal for the following entry:&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;\n\'&quot;</span><span class="token punctuation">,</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_LOGIN<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;\': trading has been disabled - investor mode.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>AccountInfoInteger(ACCOUNT_TRADE_ALLOWED) 在以下情况下可能返回false：<br>
• 没有连接到交易服务器。可以使用TerminalInfoInteger(TERMINAL_CONNECTED)检查；<br>
• 交易账户切换到只读模式 (发送至存档)；<br>
• 在交易服务器上禁止账户交易；<br>
• 交易账户的连接在投资者(观察)模式。<br></p> <p>相关参考
客户端属性， 账户属性， 运行MQL5程序的属性</p> <h2 id="_3-3-客户端事件"><a href="#_3-3-客户端事件" class="header-anchor">#</a> 3.3 客户端事件</h2> <p>初始化(OnInit))</p> <p>在客户端装载了程序后（EA交易 或者 自定义指标）就会直接开始全局变量初始化进程，发送 初始化 事件，如果有OnInit()函数的话，将通过OnInit()函数处理初始化事件。这个事件也会在以下情况发生时产生：金融工具 和/或 图表的时间框架被改变后；该程序源码在MetaEditor编辑器中重新编译之后；EA交易 或者 自定义指标设置窗口中的输入参数改变后。在登录账户改变之后，EA交易也可以初始化，脚本没有初始化事件。</p> <p>无法(反)初始化 (OnDeinit)</p> <p>在全局变量初始化 和 程序（EA交易和自定义指标）加载之前，客户端向程序发送Deinit事件。有以下几种情况发生时，即会生成反初始化事件，当客户端关闭时，当图表关闭时，金融工具 和/或 图表的时间框架被改变后，程序重新编译成功时，当输入参数改变时，账户改变时。</p> <p>无法初始化的原因可以从参数中获得，传递给OnDeinit()函数。运行的OnDeinit()函数被限制为2.5秒。如果在此期间函数尚未完成，则强制终止。脚本没有无法(反)初始化事件。</p> <p>启动 (OnStart)</p> <p>启动事件是加载脚本后激活的特殊事件。这个事件由OnStart函数处理。启动事件不适用于EA交易程序 或 自定义指标。</p> <p>跳价 (OnNewTick)</p> <p>如果客户端打开的图表上有到一个新报价，就会生成NewTick事件，它由附加在图表上的EA交易程序中的OnTick()函数处理。如果在收到新报价时正在处理前一个跳价的OnTick函数，那么新的报价将会被EA交易程序忽略，因为相应的事件不会进入队列。</p> <p>当程序运行时接收到的所有新引号都将被忽略，直到OnTick()完成。在此之后，函数将仅在收到新报价后运行。无论是否允许自动交易(“自动交易”按钮 允许/禁止)，都将生成NewTick事件。禁止自动交易只表示不允许从EA交易程序中发送交易请求，而EA交易程序是继续工作的。</p> <p>通过按下对应的按钮来禁止自动交易不会阻止当前正在执行OnTick()函数。</p> <p>计算 (OnCalculate)</p> <p>计算事件只在指标完成初始化事件 并且 价格数据发生改变后开始生成，由 OnCalculate 函数处理。</p> <p>计时器 (OnTimer)</p> <p>定时器 事件通过EA交易客户端定期执行，并通过EventSetTimer 函数被定时器激活。通常情况下，该函数通过OnInit调用。定时器事件过程通过OnTimer函数执行。在EA交易操作完成之后，有必要通过EventKillTimer函数删除定时器，通常叫做OnDeinit函数。</p> <p>计时器事件是由客户端定期生成的，它是由EA交易程序中的EventSetTimer函数激活的。通常，这个函数由OnInit调用。计时器事件由OnTimer函数处理。在完成EA交易程序的操作之后，有必要使用EventKillTimer函数来销毁计时器，该函数通常在OnDeinit函数中调用。</p> <p>交易 (OnTrade)</p> <p>当交易服务器完成一个交易操作即会生成一个交易事件，交易事件通过 OnTrade() 函数处理，通常有如下一些操作：<br>
• 发送、修改或者删除挂单；<br>
• 因为资金不足 或者 过期 而取消挂单；<br>
• 激活挂单；<br>
• 打开，添加 或者 关闭 一个仓位头寸（或者部分仓位头寸）；<br>
• 修改打开的仓位头寸（改变 止损 和/或 止盈）。<br></p> <p>交易事务(OnTradeTransaction)</p> <p>当在交易账户上执行某些明确的操作时，其状态会发生变化。这样的行为包括:<br>
• 在客户端中从任何MQL5应用使用 OrderSend 和 OrderSendAsync 函数发送交易请求及其后续的执行操作：<br>
• 通过程序端图形界面发送交易请求及其后续的执行操作；<br>
• 在服务器上激活挂单和止损订单；<br>
• 在交易服务器上执行操作。<br></p> <p>这些操作的结果会执行以下交易事务：<br>
• 处理交易请求；<br>
• 改变持仓订单；<br>
• 改变订单历史记录；<br>
• 改变交易历史记录；<br>
• 改变持仓。<br></p> <p>例如，当发送一个做多(buy)的市场订单时，它会被处理，账户中会创建一个对应的做多(buy)订单，然后该订单被执行 并 从打开持仓列表中移除，添加到历史订单，而对应的交易也会添加到历史记录中 并 创建一个新的仓位头寸。所有这些操作都是交易事务。在程序端收到这种事务就是交易事务事件。该事件通过 OnTradeTransaction 函数处理。</p> <p>测试 (OnTester)</p> <p>测试事件在EA交易测试历史数据完毕后产生，该事件通过 OnTester() 函数处理。</p> <p>测试初始化 (OnTesterInit)</p> <p>TesterInit事件是在策略测试器中第一次优化通过之前时生成的。TesterInit事件由OnTesterInit()函数处理。</p> <p>测试通过(TesterPass)</p> <p>当接收到新的数据帧时，将生成TesterPass事件。TesterPass事件由OnTesterPass()函数处理。</p> <p>测试反初始化(TesterDeinit)</p> <p>TesterDeinit 事件在EA交易优化结束后，在策略测试中生成。TesterDeinit事件通过OnTesterDeinit()函数处理。</p> <p>图表事件(ChartEvent)</p> <p>当用户在客户端使用图表时，即产生ChartEvent 事件，即以下情形发生时：<br>
• 在图表中点击时，图表窗口处于焦点位置(最前面);<br>
• 创建图解对象 ；<br>
• 删除图解对象 ；<br>
• 鼠标点击图表中的图解对象；<br>
• 使用鼠标移动图解对象；<br>
• 在LabelEdit中结束文本编辑；<br></p> <p>还有一个是自定义的ChartEvent事件，可以由任何mql5程序通过EventChartCustom函数，发送给 EA程序。图表事件由OnChartEvent函数处理。</p> <p>市场深度事件(BookEvent)</p> <p>BookEvent 事件在市场深度改变后通过客户端产生；由 OnBookEvent函数处理。要为指定的交易品种生成BookEvent事件，需要使用MarketBookAdd函数将交易品种订阅到此事件。</p> <p>要取消指定交易品种的BookEvent事件，必须调用MarketBookRelease函数。BookEvent事件是一个广播类型事件——它意味着仅为该事件订阅一个EA交易程序，以及拥有OnBookEvent事件处理程序的所有其他EA交易程序都将接受它。这就是为什么需要分析交易品种代码符号，它被传递给处理程序作为参数。</p> <p>相关参考</p> <p>事件处理程序 ， 程序运行</p> <h2 id="_3-4-资源"><a href="#_3-4-资源" class="header-anchor">#</a> 3.4 资源</h2> <p>在MQL5程序中使用图形和声音
MQL5程序允许使用声音和图形文件：<br>
• PlaySound() 可以播放一个声音文件；<br>
• ObjectCreate() 允许使用图形对象 OBJ_BITMAP 和 OBJ_BITMAP_LABEL创建用户界面。
PlaySound()<br>
调用 PlaySound() 函数的示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 调用 标准的OrderSend()函数播放一个音频文件                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OrderSendWithAudio</span><span class="token punctuation">(</span>MqlTradeRequest  <span class="token operator">&amp;</span>request<span class="token punctuation">,</span> MqlTradeResult <span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
  <span class="token comment">//--- 发送一个请求到服务器</span>
   <span class="token function">OrderSend</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//--- 如果请求被采纳，播放音频文件 Ok.wav</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>retcode<span class="token operator">==</span>TRADE_RETCODE_PLACED<span class="token punctuation">)</span> <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">&quot;Ok.wav&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//--- 如果失败，播放音频文件timeout.wav</span>
   <span class="token keyword">else</span> <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">&quot;timeout.wav&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>该示例显示了如何播放来自音频文件 'Ok.wav' 和 'timeout.wav'的声音，这些文件包含在标准的客户端安装程序包中。这些文件位于 terminal_directory\Sounds文件夹中。 在这里 terminal_directory 是指 客户端安装 的文件夹，MetaTrader 5 客户端在这里启动。客户端目录的位置可以通过以下方式，从mql5程序中找到：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 文件夹，客户端存储数据的地方</span>
   string terminal_path<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>您不仅可以使用来自terminal_directory\Sounds文件夹的音频文件，还可以使用位于子文件夹terminal_data_directory\MQL5中的任何音频文件。 您可以通过点击 客户端 菜单“文件”----&gt;&quot;打开数据文件夹”或 使用编程方式找到客户端数据目录的位置：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 文件夹，客户端存储数据的地方</span>
   string terminal_data_path<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例，如果音频文件Demo.wav位于terminal_data_directory\MQL5\Files，那么调用PlaySound() 应该按以下方式编写：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 播放来自terminal_directory_data\MQL5\Files\Demo.wav文件夹的Demo.wav</span>
   <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">&quot;\\Files\\Demo.wav&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>请注意在代码注释中，文件路径使用“\”反斜杠，而在函数中使用“\&quot;。
当指定路径时，通常使用 双反斜杠 作为分隔符，因为 单反斜杠 是编译器处理程序源代码中的字符串常数和字符常量时，使用的控制符号。
调用 PlaySound() 函数时，使用NULL参数，表示停止播放：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 调用 PlaySound() 函数时，使用NULL参数，停止播放音频</span>
   <span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ObjectCreate()
EA交易程序的示例，使用ObjectCreate()函数创建一个图形标签 (OBJ_BITMAP_LABEL)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string label_name<span class="token operator">=</span><span class="token string">&quot;currency_label&quot;</span><span class="token punctuation">;</span>        <span class="token comment">// OBJ_BITMAP_LABEL 对象的名称</span>
string euro      <span class="token operator">=</span><span class="token string">&quot;\\Images\\euro.bmp&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件terminal_data_directory\MQL5\Images\euro.bmp的路径</span>
string dollar    <span class="token operator">=</span><span class="token string">&quot;\\Images\\dollar.bmp&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 文件terminal_data_directory\MQL5\Images\dollar.bmp的路径</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 如果还未创建按钮OBJ_BITMAP_LABEL，请创建</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ObjectFind</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 尝试创建对象OBJ_BITMAP_LABEL</span>
      <span class="token keyword">bool</span> created<span class="token operator">=</span><span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">,</span>OBJ_BITMAP_LABEL<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>created<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 连接图表左上角的按钮</span>
         <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">,</span>OBJPROP_CORNER<span class="token punctuation">,</span>CORNER_RIGHT_UPPER<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 现在设置对象属性</span>
         <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">,</span>OBJPROP_XDISTANCE<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">,</span>OBJPROP_YDISTANCE<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 重置上一个错误的代码为0</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 下载图片显示按钮的”按下“状态</span>
         <span class="token keyword">bool</span> set<span class="token operator">=</span><span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>euro<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 测试结果</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to download image from file %s. Error code %d&quot;</span><span class="token punctuation">,</span>euro<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 下载图片显示按钮的”未按下“状态</span>
         set<span class="token operator">=</span><span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>dollar<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to download image from file %s. Error code %d&quot;</span><span class="token punctuation">,</span>dollar<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 发送一个命令来刷新图表，这样按钮就会立即出现，而不需等到下一个跳价事件</span>
         <span class="token function">ChartRedraw</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 创建对象失败，公告</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create object OBJ_BITMAP_LABEL. Error code %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家去初始化函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 删除图表对象</span>
   <span class="token function">ObjectDelete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>label_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>在OnInit()函数中,创建和设置了名为currency_label的图形对象。图形文件的路径设置在全局变量euro和dollar中，用双反斜杠作为分隔符:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string euro      <span class="token operator">=</span><span class="token string">&quot;\\Images\\euro.bmp&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件terminal_data_directory\MQL5\Images\euro.bmp的路径</span>
string dollar    <span class="token operator">=</span><span class="token string">&quot;\\Images\\dollar.bmp&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 文件terminal_data_directory\MQL5\Images\dollar.bmp的路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>图象文件位于文件夹 terminal_data_directory\MQL5\Images。</p> <p>对象 OBJ_BITMAP_LABEL 实际上是一个按钮，根据按钮的状态（按下 或 未按下）展示两个图像中的一个：euro.bmp 或 dollar.bmp。</p> <p><img src="/mql5yao/assets/img/thi8.b82ab87c.png" alt="Alt text"></p> <p><img src="/mql5yao/assets/img/thi9.fefc1d50.png" alt="Alt text"></p> <p>（注意： 上图为 MT5 客户端中的对象编辑窗口 参数 标签页）</p> <p><img src="data:image/png;base64,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" alt="Alt text"></p> <p>（注意： 上图为 MT4 客户端中的对象编辑窗口 常用 标签页，与MT5中的窗口存在差异）</p> <p>图形界面的按钮大小会根据图像的大小自动调整。在OBJ_BITMAP_LABEL对象上点击鼠标左键可以看到图像改变( 属性中必须设置&quot;禁用选择&quot;)。OBJ_BITMAP对象以相同方式创建 - 它用于创建必要的背景图像。</p> <p><img src="data:image/png;base64,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" alt="Alt text"></p> <p>（注意： 上图为 MT5 客户端中的对象编辑窗口 普通 标签页）</p> <p>OBJPROP_BMPFILE属性的值可以动态更改，该属性负责对象OBJ_BITMAP和OBJ_BITMAP_LABEL的外观。这允许为mql5程序创建各种交互式用户界面。</p> <p>在mql5程序编译时将资源包含到可执行文件中</p> <p>mql5程序可能需要许多不同的可下载资源，如不同格式的图像和声音文件的形式。为了避免在迁移MQL5可执行文件时，同时转移所有这些文件的需要，应该使用编译器的指令#resource指令:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token expression">path_to_resource_file</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>#resource 指令告诉编译器保存在指定路径path_to_resource_file中的资源应该被包括到可执行EX5 文件。因此，所有这些必要的图像和音频文件可以直接放在EX5文件中，以便在您想要在不同程序端运行程序时，无需分别转移其中使用的文件。任何EX5文件都可以包含资源，而任何EX5程序都可以使用来自其他EX5程序的资源。</p> <p>BMP 和 WAV 格式的文件在包含到EX5文件之前会自动压缩。这表示除了在MQL5中创建完整的程序之外，使用资源还可以在使用图形和声音时减少必要文件的总大小，这与MQL5程序编写的通常方式相比。</p> <p>资源文件大小一定不要超过128Mb。</p> <p>通过编译器搜索指定的资源</p> <p>插入资源使用命令 <code>#resource &quot;&lt;path to the resource file&gt;&quot;</code></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;&lt;path_to_resource_file&gt;&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>字符串常量 &lt;path_to_resource_file&gt; 的长度不得超过63个字符。</p> <p>编译器根据以下顺序在指定路径搜索资源：<br></p> <p>• 如果单反斜杠&quot;&quot;分隔符（写成&quot;\&quot;）放在路径前面，它搜索目录terminal_data_directory\MQL5\涉及的资源。<br>
• 如果没有反斜杠，则搜索资源编写所在的源文件的位置涉及的资源。<br></p> <p>资源路径不能包括子字符串&quot;..\&quot; 和 &quot;:\&quot;。</p> <p>资源包含的示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 正确的资源规范</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Images\\euro.bmp&quot;</span> <span class="token comment">// euro.bmp 位于 terminal_data_directory\MQL5\Images\
#resource &quot;picture.bmp&quot;        // picture.bmp 位于与源文件相同的目录</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;Resource\\map.bmp&quot;</span>  <span class="token comment">// 资源位于source_file_directory\Resource\map.bmp</span></span>

<span class="token comment">//--- 错误的资源规范</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;:picture_2.bmp&quot;</span>     <span class="token comment">// 不能包括 &quot;:&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;..\\picture_3.bmp&quot;</span>  <span class="token comment">// 不能包括 &quot;..&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Files\\Images\\Folder_First\\My_panel\\Labels\\too_long_path.bmp&quot;</span></span>
<span class="token comment">//超过 63 个字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用资源</p> <p>资源名称</p> <p>当资源使用#resource指令声明后，它可以用于程序的任何部分。资源的名称是：从行开头开始，不包含反斜杠的路径+文件名称，单反斜杠用于设置资源的路径。若要在代码中使用您自己的资源， 应该在资源名称的前面添加特殊符号 &quot;::&quot;。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 注释中显示了资源规范和其名称的示例</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Images\\euro.bmp&quot;</span>          <span class="token comment">// 资源名称 - Images\euro.bmp</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;picture.bmp&quot;</span>                 <span class="token comment">// 资源名称 - picture.bmp</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;Resource\\map.bmp&quot;</span>           <span class="token comment">// 资源名称 - Resource\map.bmp</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Files\\Pictures\\good.bmp&quot;</span> <span class="token comment">// 资源名称 - Files\Pictures\good.bmp</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Files\\Demo.wav&quot;</span><span class="token expression"><span class="token punctuation">;</span>          </span><span class="token comment">// 资源名称 - Files\Demo.wav&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Sounds\\thrill.wav&quot;</span><span class="token expression"><span class="token punctuation">;</span>       </span><span class="token comment">// 资源名称 - Sounds\thrill.wav&quot;</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">//--- 使用资源文件</span>
<span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>bitmap_name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;::Images\\euro.bmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>my_bitmap<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;::picture.bmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
set<span class="token operator">=</span><span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>bitmap_label<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;::Files\\Pictures\\good.bmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">&quot;::Files\\Demo.wav&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">PlaySound</span><span class="token punctuation">(</span><span class="token string">&quot;::Sounds\\thrill.wav&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>应该注意的是，当将图像从资源设置到OBJ_BITMAP和OBJ_BITMAP_LABEL对象时，OBJPROP_BMPFILE属性的值不能手动修改。例如，为了创建OBJ_BITMAP_LABEL，我们使用资源euro.bmp 和 dollar.bmp。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Images\\euro.bmp&quot;</span><span class="token expression"><span class="token punctuation">;</span>    </span><span class="token comment">// euro.bmp位于terminal_data_directory\MQL5\Images\
#resource &quot;\\Images\\dollar.bmp&quot;;  // dollar.bmp位于terminal_data_directory\MQL5\Images\
</span></span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当查看该对象属性时，我们将看到属性位图文件 (On) 和 位图文件 (Off) 无效，不能手动更改：</p> <p><img src="/mql5yao/assets/img/thi12.fefc1d50.png" alt="Alt text"></p> <p>使用其他mql5程序的资源</p> <p>资源使用方面还有另一个优势 - 在任何mql5程序中，也可以使用另一个EX5文件的资源。因此，来自一个EX5文件的资源可以用在许多其他mql5程序。</p> <p>若要使用来自另一个文件的资源名称，它应该被指定为 &lt;path_EX5_file_name&gt;::&lt;resource_name&gt;
例如，假设Draw_Triangles_Script.mq5 脚本在文件triangle.bmp中包含一个图像资源：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Files\\triangle.bmp&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，如果脚本自身使用该资源，则资源的名称将类似&quot;Files\triangle.bmp&quot;，并且若要使用它，资源名称前应该添加&quot;::&quot;符号。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 脚本 自身使用资源</span>
<span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>my_bitmap_name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;::Files\\triangle.bmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>若要使用另一个程序的相同资源，例如EA交易，我们需要添加资源名称路径到terminal_data_directory\MQL5\相对的EX5文件和脚本EX5文件的名称 - Draw_Triangles_Script.ex5。假设脚本位于标准文件夹 terminal_data_directory\MQL5\Scripts, 那么应该按照以下方式调用：
为了从另一个程序中使用相同的资源，例如，从一个EA交易程序中，我们需要向资源名称中添加一个到EX5文件的路径，该路径相对于terminal_data_directory\MQL5\以及脚本的EX5文件- Draw_Triangles_Script.ex5的名称。假设该脚本位于标准的文件夹terminal_data_directory\MQL5\Scripts\中，那么该调用应该写成以下方式:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 在EA程序中使用脚本Draw_Triangles_Script.ex5中的资源</span>
<span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>my_bitmap_name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;\\Scripts\\Draw_Triangles_Script.ex5::Files\\triangle.bmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果从另一个EX5程序中调用资源时没有指定可执行文件的路径，那么编译器会在包含调用资源程序的相同文件夹中搜索可执行文件。这意味着如果EA交易程序调用来自Draw_Triangles_Script.ex5的资源时，没有指定路径，就像这样：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 在EA程序中调用脚本Draw_Triangles_Script.ex5中的资源时未指定路径</span>
<span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>my_bitmap_name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Draw_Triangles_Script.ex5::Files\\triangle.bmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>那么如果EA程序位于terminal_data_directory\MQL5\Experts\中，则编译器将在文件夹terminal_data_directory\MQL5\Experts\中搜索Draw_Triangles_Script.ex5文件。
使用包含资源的自定义指标
对于MQL5应用程序的操作，可能需要一个或多个自定义指标。它们都可以包含在可执行MQL5程序的代码中。将指标纳入资源可以简化应用程序的分布。
下面就是包含和使用位于terminal_data_folder\MQL5\Indicators\目录的SampleIndicator.ex5自定义指标的示例：
下面的示例，是一个包含和使用自定义指标 SampleIndicator.ex5的例子。自定义指标位于terminal_data_folder\MQL5\Indicators\ 文件夹中:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                                     SampleEA.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                              https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Indicators\SampleIndicator.ex5&quot;</span></span>
<span class="token keyword">int</span> handle_ind<span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
   handle_ind<span class="token operator">=</span><span class="token function">iCustom</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token string">&quot;::Indicators\\SampleIndicator.ex5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>handle_ind<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Expert: iCustom call: Error code=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- ...</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>当OnInit() 函数中的自定义指标创建一个或多个副本时，这种情况需要特别考虑。请谨记资源应该按照以下方式指明：&lt;path_EX5_file_name&gt;::&lt;resource_name&gt;。
例，如果SampleIndicator.ex5指标被包含在EA交易程序SampleEA.ex5 中，作为一个资源，在自定义指标初始化函数中调用iCustom()指定的路径如下： &quot;\Experts\SampleEA.ex5::Indicators\SampleIndicator.ex5&quot;。 当该路径明确设置时，SampleIndicator.ex5自定义指标被严格连接到EA交易程序SampleEA.ex5 ，失去独立工作的能力。
路径本身可以使用GetRelativeProgramPath() 函数接收。用法示例如下：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                              SampleIndicator.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                              https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots <span class="token number">0</span></span></span>
<span class="token keyword">int</span> handle<span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 提供自身链接的错误方式</span>
<span class="token comment">//--- 字符串路径=&quot;\\Experts\\SampleEA.ex5::Indicators\\SampleIndicator.ex5&quot;;</span>
<span class="token comment">//--- 接收自身链接的正确方式</span>
  string path<span class="token operator">=</span><span class="token function">GetRelativeProgramPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲映射</span>
   handle<span class="token operator">=</span><span class="token function">iCustom</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>handle<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Indicator: iCustom call: Error code=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Indicator handle=&quot;</span><span class="token punctuation">,</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">///....</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| GetRelativeProgramPath                                           |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
string <span class="token function">GetRelativeProgramPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">int</span> pos2<span class="token punctuation">;</span>
<span class="token comment">//--- 接收应用程序的绝对路径</span>
   string path<span class="token operator">=</span><span class="token function">MQLInfoString</span><span class="token punctuation">(</span>MQL_PROGRAM_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 找出 &quot;\MQL5\&quot; 字符串的位置</span>
   <span class="token keyword">int</span>    pos <span class="token operator">=</span><span class="token function">StringFind</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">&quot;\\MQL5\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 子字符串未找到 - 错误</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 跳过 &quot;\MQL5&quot; 目录</span>
   pos<span class="token operator">+=</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">//--- 跳过多余的 '\' 交易品种</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">StringGetCharacter</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>pos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token char">'\\'</span><span class="token punctuation">)</span>
      pos<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果这是一个资源，返回MQL5目录的相对路径</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">StringFind</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">&quot;::&quot;</span><span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">StringSubstr</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为第一个MQL5子目录找到一个分隔符 (例如，MQL5\Indicators)</span>
<span class="token comment">//--- 如果没找到，返回MQL5目录相对的路径</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pos2<span class="token operator">=</span><span class="token function">StringFind</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">&quot;\\&quot;</span><span class="token punctuation">,</span>pos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">StringSubstr</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 返回子目录相对的路径(例如， MQL5\Indicators)</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">StringSubstr</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>pos2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标重复函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> begin<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> price<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 返回prev_calculated值用于下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>资源变量
资源可以使用资源变量来声明并被当做适当类型的变量。声明格式：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token expression">path_to_the_resource_file as resource_variable_type resource_variable_name</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>声明示例:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;data.bin&quot;</span> <span class="token expression">as <span class="token keyword">int</span> ExtData<span class="token punctuation">[</span><span class="token punctuation">]</span>           </span><span class="token comment">// 声明包含data.bin 文件数据的数字数组</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;data.bin&quot;</span> <span class="token expression">as MqlRates ExtData<span class="token punctuation">[</span><span class="token punctuation">]</span>      </span><span class="token comment">// 声明包含data.bin文件数据的 简单结构 数组</span></span>
<span class="token comment">//--- 字符串</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;data.txt&quot;</span> <span class="token expression">as string ExtCode          </span><span class="token comment">// 声明包含data.txt文件数据的字符串（支持ANSI，UTF-8 和 UTF-16 编码）</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;data.txt&quot;</span> <span class="token expression">as string ExtCode<span class="token punctuation">[</span><span class="token punctuation">]</span>        </span><span class="token comment">// 声明包含data.txt文件字符串的数组（支持ANSI，UTF-8 和 UTF-16 编码）</span></span>
<span class="token comment">//--- 图形资源</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;image.bmp&quot;</span> <span class="token expression">as bitmap ExtBitmap<span class="token punctuation">[</span><span class="token punctuation">]</span>    </span><span class="token comment">// 声明包含BMP位图文件的一维数组，数组大小 = 高 * 宽</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;image.bmp&quot;</span> <span class="token expression">as bitmap ExtBitmap2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> </span><span class="token comment">// 声明包含BMP位图文件的二维数组，数组大小 [高][宽]</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在这样的声明中，资源数据只能通过变量来处理，通过<code>&quot;::&lt;rsource name&gt;&quot;</code>的自动寻址方式不起作用。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Images\\euro.bmp&quot;</span> <span class="token expression">as bitmap euro<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;\\Images\\dollar.bmp&quot;</span></span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|  OBJ_BITMAP_LABEL 对象使用资源创建函数   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">Image</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span>string rc<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJ_BITMAP_LABEL<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_XDISTANCE<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_YDISTANCE<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_BMPFILE<span class="token punctuation">,</span>rc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序起始函数                                    |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 输出存储在欧元资源变量的图像大小[宽，高]</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 改变欧元图像 - 在中间绘制红色横纹</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">&lt;</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
      euro<span class="token punctuation">[</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0xFFFF0000</span><span class="token punctuation">;</span>
<span class="token comment">//--- 使用资源变量创建图形资源</span>
   <span class="token function">ResourceCreate</span><span class="token punctuation">(</span><span class="token string">&quot;euro_icon&quot;</span><span class="token punctuation">,</span>euro<span class="token punctuation">,</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>COLOR_FORMAT_ARGB_NORMALIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 创建欧元图形标签对象，并在此设置euro_icon资源图像</span>
   <span class="token function">Image</span><span class="token punctuation">(</span><span class="token string">&quot;Euro&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;::euro_icon&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 应用资源的另一个方法，我们不能绘制</span>
   <span class="token function">Image</span><span class="token punctuation">(</span><span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;::Images\\dollar.bmp&quot;</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token operator">+</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 不提供解决euro.bmp资源的直接方法，因为它已经通过欧元资源变量进行声明</span>
   <span class="token function">Image</span><span class="token punctuation">(</span><span class="token string">&quot;E2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;::Images\\euro.bmp&quot;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token operator">+</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>euro<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将会发生执行时间错误</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>脚本执行结果 —— 三个对象中只能创建两个OBJ_BITMAP_LABEL对象。第一个对象的图像在中间有红色条纹。</p> <p><img src="/mql5yao/assets/img/thi13.1c81b342.png" alt="Alt text"></p> <p>应用资源的重要优势就是资源文件在编译成EX5可执行文件之前自动解压。因此，使用资源变量可以使您将全部必要数据直接放入可执行文件EX5，以及，相较于MQL5程序传统编写方式而言，减少文件的数量和总大小。</p> <p>使用资源变量可以非常方便的在 市场 中发布产品。</p> <p>特点<br>
• 特殊的位图资源变量类型告诉编译器，这个资源是一个图像。这种变量接收为uint类型。<br>
• 位图类型数组资源变量可以有两种维度。在这种情况下，数组大小定义为[图片高][图版片宽]。如果指定了一维数组，那么元素数量则等于 图片高*图片宽。<br>
• 下载24-位图像时，阿尔法通道组件的全部图像像素设置为255.<br>
• 下载没有阿尔法通道的32-位图时，阿尔法通道组件的全部图像像素设置为255。<br>
• 下载有阿尔法通道的32-位图时，不以任何方式处理像素。<br>
• 资源文件大小不能超过128 Mb。<br>
• 通过存在的BOM（标题）自动编码检测执行字符串文件。如果没有BOM，则通过文件内容定义编码。支持ANSI，UTF-8和UTF-16编码文件。当阅读文件数据时，全部字符串转换为Unicode。<br></p> <p>OpenCL程序</p> <p>使用资源字符串变量可以极大的促进一些程序的开发。例如，您可以在独立的CL文件内编写一个OpenCL 程序的编码，然后将其包含为一个字符串放入您的MQL5程序资源。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">resource</span> <span class="token string">&quot;seascape.cl&quot;</span> <span class="token expression">as string cl_program</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">int</span> context<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_program<span class="token operator">=</span><span class="token function">CLProgramCreate</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>cl_program<span class="token punctuation">)</span><span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token comment">//--- 通过OpenCL程序执行进一步操作</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在这个示例中，如果没有使用cl_program资源变量，那么您需要编写整个代码作为一个大的字符串。
相关参考
ResourceCreate()， ResourceSave()， PlaySound()， ObjectSetInteger()， ChartApplyTemplate()， 文件函数</p> <h2 id="_3-5-调用导入函数"><a href="#_3-5-调用导入函数" class="header-anchor">#</a> 3.5 调用导入函数</h2> <p>在执行mql5程序时导入函数，客户端使用提前绑定。这意味着如果一个程序调用了一个导入的函数，那么对应的模块(ex5或dll)在程序加载时，同时被加载。MQL5和DLL库在调用模块的线程中执行。</p> <p>不建议使用要加载的模块的完整路径名称，如：Drive:\Directory\FileName.Ext。MQL5库文件是从客户端目录下的\MQL5\ libraries文件夹中加载的。如果未找到 库 文件，则客户端将尝试从terminal_dir\experts 文件夹中加载。</p> <p>系统 库(DLL) 文件是由操作系统规则加载的。如果库已经加载(例如，另一个EA交易，甚至来自另一个客户端，并行运行)，那么它就会请求使用已经加载的 库 。否则，它将按以下顺序执行搜索:<br></p> <p>1.从导入dll的那个模块所在的目录开始,模块可以是一个EA交易，脚本，指标或者EX5库；<br></p> <p>2.从 客户端数据文件夹\MQL5\Libraries (TERMINAL_DATA_PATH\MQL5\Libraries)开始；<br>3.从MT5客户端启动的目录开始；<br>
4.系统目录；<br>
5.Windows 目录；<br>
6.当前目录；<br>
7.系统变量PATH指定的目录列表<br></p> <p>如果DLL库中还使用另外的DLL工作，当没有找到第二个DLL时，第一个 库 不能装载。</p> <p>在加载EA交易(脚本、指标)之前，会生成一个所有EX5库模块的公共列表。它将被加载的EA交易(脚本、指标)和 所有库 共同使用。因此，EX5库模块可以一次加载,多次使用。库使用EA交易的预定义变量(脚本、指标)。</p> <p>导入 EX5库,按以下顺序执行搜索:：<br></p> <p>1.与导入EX5的EA交易(脚本、指标)的目录相对路径。<br>
2.客户端数据文件夹\MQL5\Libraries；<br></p> <p>3.在所有MT5客户端的共同目录中的MQL5\Libraries (Common\MQL5\Libraries)。<br></p> <p>在MQL5程序中导入 DLL函数一定要确保定Windows API调用协议允许使用。为了确认这一点，在C或者C++程序源码文本中请添加关键字 __stdcall, 它是专门针对Microsoft(r)编译器的，该协议具有如下特性：<br></p> <p>• 调用者(在我们的例子中是指一个mq5程序)应该“看到”一个函数的原型(从DLL中导入)，以便正确地将参数组合到堆栈中;<br>
• 调用者(在我们的例子中是mql5程序)将参数以相反的顺序放置到堆栈中，从右到左——按这个顺序，导入函数读取参数并传递给它的;<br></p> <p>• 访客（在我们系统中是MQL5程序）以倒序方式将参量进行堆积，从右至左-在此命令中，输入函数从参量中传递；<br>
• 参数是通过值传递的，除了通过引用显式传递的参数(在我们例子中，是字符串)<br>
• 导入的函数通过读取传递给它的参数来独立清理堆栈。<br></p> <p>在描述导入函数的原型时，可以使用默认参数。</p> <p>如果相应的库无法加载，或者DLL禁止使用，或者没有找到导入的函数，那么EA交易就会在日志文件中使用消息“EA交易停止”来停止操作。在这种情况下，EA交易在重新初始化之前不会运行。一个EA交易被重新初始化，可能会因为以下2个原因： 重新编译 或 在其属性对话框中点击了OK(确认)按钮。</p> <p>传递参量</p> <p>所有 简单类型 的参数都是通过 值 传递的，除非明确表明通过 引用 传递。当传递一个字符串时，将传递复制的字符串的缓冲区地址;如果一个字符串是通过引用传递的，那么这个字符串的缓冲区的地址就不会被从DLL导入的函数复制。</p> <p>结构 包括 动态数组，字符串，类 和其他复杂结构，如 枚举对象的静态或动态数组，不能被作为参数传递给导入函数。</p> <p>当将数组传递给DLL时，数据缓冲区开始的地址总是能传递(不管AS_SERIES标帜是什么)。在DLL中的函数与AS_SERIES标帜无关，传递的数组是一个未定义长度的静态数组;另一个参数应该用于指定数组大小。</p> <h2 id="_3-6-运行时间出错"><a href="#_3-6-运行时间出错" class="header-anchor">#</a> 3.6 运行时间出错</h2> <p>客户端的执行子系统有机会保存错误代码，以防在MQL5程序运行期间发生。对于每个可执行的MQL5程序，都有一个预定义的变量_LastError。</p> <p>在启动OnInit函数之前，_LastError变量将被重置。如果在计算过程中或内部函数调用过程中出现错误，_LastError变量将接受相应的错误代码。使用GetLastError()函数可以获得存储在该变量中的值。</p> <p>有几个严重的错误，一旦发生，程序立即终止:<br></p> <p>• 除以0；<br>
• 超出数组范围；<br>
• 使用错误 对象指针；<br></p> <h2 id="_3-7-测试交易策略"><a href="#_3-7-测试交易策略" class="header-anchor">#</a> 3.7 测试交易策略</h2> <p>自动交易的理念是每周7天，全天候24小时的无间断自动交易。自动交易不会疲惫，质疑自己 或 产生恐惧，它完全脱离了任何心理问题。它足够清晰地将交易规则形式化，并在算法中实现，机器人可以不知疲倦地工作。但首先，你必须确保满足以下两个重要条件:<br>
• EA交易程序按照交易系统的规则执行交易操作；<br>
• EA实施的交易策略，在历史数据记录上显示利润。<br></p> <p>为了得到这些问题的答案，我们转到策略测试器，它包括在MetaTrader 4/5客户端中。</p> <p>本节涵盖的内容是策略测试器中的程序测试和参数优化功能：<br></p> <p>• 策略测试器中受限制的函数<br>
• 报价跳动生成模式<br>
• 模拟点差<br>
• 测试期间使用真实报价跳动<br>
• 客户端全局变量<br>
• 测试期间的指标计算<br>
• 测试期间加载历史记录<br>
• 多币种测试<br>
• 策略测试的模拟时间<br>
• 测试中的图解对象<br>
• 策略测试器中的 OnTimer() 函数<br>
• 策略测试器中的 Sleep() 函数<br>
• 策略测试器中的 Print() 函数<br>
• 在数学计算中使用策略测试器进行优化问题<br>
• 在“仅使用开(盘)价”模式中同步K线柱<br>
• 策略测试器中的IndicatorRelease() 函数<br>
• 策略测试器中的事件处理<br>
• 测试代理<br>
• 客户端和代理之间的数据交换<br>
• 使用所有客户端的共享文件夹<br>
• 使用 DLLs<br></p> <p>策略测试中的函数限制</p> <p>在客户端的策略测试器中，对一些函数有操作限制。</p> <p>Print() 和 PrintFormat() 函数</p> <p>为了提高性能，EA交易优化参数时不执行 Print() 和 PrintFormat() 函数。除非在OnInit()处理程序内部使用这些函数。这可以使您在错误发生时，轻松找到错误的原因。</p> <p>Alert()，MessageBox()，PlaySound()，SendFTP，SendMail()，SendNotification()，WebRequest() 函数</p> <p>专为与“外部世界”互动而设计的 Alert()， MessageBox()， PlaySound()， SendFTP()， SendMail()， SendNotification() 和 WebRequest() 函数不在策略测试中执行。</p> <p>订单号生成模式</p> <p>EA交易是一个用MQL5编写的程序，每次运行都会反映一些外部事件 。EA有一个对应的函数(事件处理)，用于每次预定义事件。</p> <p>NewTick(每次报价) 事件（价格变化）是EA的主要事件，因此，我们需要生成一个订单号序列来测试EA。MetaTrader 5客户端的策略测试器中共实施三种订单号生成模式：<br>
• 每次报价<br>
• 1 分钟 OHLC (分钟K线柱的OHLC 价)<br>
• 仅使用开盘价<br></p> <p>最基本最详细的就是“每个跳价”模式，其他两种模式是该基本模式的简化版，并且将被对应的“每个跳价”模式进行描述。考虑这三种模式，以便于了解其中的不同。</p> <p>&quot;每次报价&quot;(Every Tick)</p> <p>金融工具的历史报价数据从交易服务器转移到MetaTrader 5客户端，其形式是打包的分钟K线柱。有关请求时发生的详细信息 和 构建请求的时间框架 的详细信息，请参考 MQL5参考 的 组织数据存储 章节。</p> <p>价格历史的最小元素就是分钟K线柱，从这里您可以获得四个价格值的信息：<br></p> <p>• Open - 分钟K线柱的开盘价；<br>
• High - 该分钟K线柱期间的最高价；<br>
• Low - 该分钟K线柱期间的最低价；<br>
• Close - 分钟K线柱的收盘价。<br></p> <p>当新的分钟开始(秒数等于0)时，新的分钟K线柱并没有打开，但是当收到一个新的报价时——一个价格变化至少一个点。这个数字显示了新的交易周期的第一个分时，它的开盘时间是2011.01.10 00:00。我们在图表上看到的周五和周一之间的价格差距是很普遍的，因为即使是在周末，汇率也会随着收到的新闻消息而波动。</p> <p><img src="/mql5yao/assets/img/thi14.218eed31.png" alt="Alt text"></p> <p>The price gap between Friday and Monday
周五和周一之间的价格缺口</p> <p>对于这个K线柱，我们只知道在2011年1月10日零点零分打开，但是我们不知道秒数。它可能是在00:00:12或00:00:36(新一天后的12或36秒)或在那一分钟内的任何其它时间内打开。但我们知道，在新的一分钟的开盘时，欧元的公开价格为1.28940。</p> <p>我们也不知道(准确地说，在一秒内)对应这一分钟的K线柱的收盘价，是何时接收到的最后一次跳价的时间。我们只知道一件事——一分钟K线柱的最后收盘价。这一分钟的价格是1.28958。最高、最低的价格出现的时间也不清楚，但我们知道，最高和最低的价格分别是1.28958和1.28940。</p> <p>要测试交易策略，我们需要一个报(跳)价序列，将在这里模拟EA交易。因此，对于每个分钟K线柱，我们都知道 4 个控制点，在这里，价格十分清楚并肯定。如果一个K线柱只有4个报价，那么就足够执行一个测试，但是通常报(跳)价的数量会大于4个。</p> <p>因此，在开盘价，最高价，最低价和收盘价之间，需要生成额外的报(跳)价控制点。在MetaTrader 5终端的策略测试器中，“每次报价”的报(跳)价的生成模式的原理请参考 《METATRADER 5终端策略测试器中的订单生成算法》(https://www.mql5.com/zh/articles/75)，如下图所示：</p> <p><img src="/mql5yao/assets/img/thi15.2b29b6c8.png" alt="Alt text"></p> <p>跳价生成算法</p> <p>在“每次报价”模式中测试时，EA的 OnTick() 函数在每个控制点都将会被调用。每个控制点都是来自报价序列生成的跳价。 EA将收到模拟时间的和价格，就像在线工作时一样。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>重要提示： “每个报价”测试模式是最精确的，但同时也是最耗时的。对于大多数交易策略的初始测试，通常使用其他两种测试模式中的一种就足够了。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>&quot;1 分钟 OHLC&quot;</p> <p>“每次报价”模式是三种模式中最准确的模式，但同时也是最慢的模式。 OnTick()处理程序在每次价格跳动时都会运行，价格跳动的数量可能非常巨大。对于一个策略而言，在整个K线柱时间周期内，价格跳动的序列并不重要，有一个更快并更粗糙的模拟模式 - “1分钟OHLC”。</p> <p>在 &quot;1 分钟 OHLC&quot; 模式，报价序列仅通过一分钟K线柱的OHLC价格搭建，生成的控制点数量也会大量减少 - 因此，测试时间也是如此。OnTick()函数的启动在所有控制点上执行，这些控制点由一分钟K线柱的OHLC的价格构成。</p> <p>拒绝在开盘价，最高价，最低价和收盘价之间生成额外的中间报价，从开盘价格确定的那一刻起，它就会导致价格发展中出现刚性决定论。这使得创建一个“测试圣杯”成为可能，该测试圣杯显示了测试余额的上升图。</p> <p>在代码库中介绍了这种“测试圣杯”的一个示例 - Grr-al.
(https://www.mql5.com/zh/code/244)</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtcAAADzCAMAAAEN9frwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5UExURf///wAAAMzMzP+2yzqQ8rZmZrb////b2DoAsAAAsAA62Nv/////tmY6kP/ykDqwAACwAADLttvYOjrY2zo62LZmsGa2//+2ZjqQ2zq9kP/lZrZmvZDb/wAAyzo6vf//5WYAsNv/8pA6sNuQZmawAGbl/zrYtpC9AACwOjq9OpDy/9uQvQBm5f//25BmkLbLADrLtv/bkDpmtrbLOtvYZgA6kJA6ALZmOgAAOmYAAAAAZgCwZrZmAABmtjoAOtuQOpA6OjoAADoAZmYAOjo6ZpDb25A6Zjo6kABmkAA6ZmY6AGYAZjqQtrb/2zo6Orb/ttv/ttu2ZgAAALVU3A0AAABTdFJOU/////////////////////////////////////////////////////////////////////////////////////////////////////////////8AZol+WQAAAAlwSFlzAAAOwwAADsMBx2+oZAAAGnxJREFUeF7tnQ2f28Zxh3cthc6FkHK1bJCRkaaNo77Ypm0qvTtRJU3KL1Laq930+3+ZzswO3oElQO6CC3CenwRgMdjFYO6P4QJcgGr0/JXnbtjx3DU3PHfHDTR5c3Nzy0VnuPcU/WxzM5mveKknHo4cwaj6wI+3vVnN1JoXL4e3UHj6253h8Uod9rzYiDePRxhkFw2/nvFCAU+nnpdm/enBE69pqn1ALSvIV9vdkpdP5ZaAGRfUh6VafEGmXph27PCmR+HNe8FVG+FNToabObudJtTjjP6cq8V+q77nOfxRC/NEbSrrQVqFeUL1ou1WRaV5gtuPGK2e8pJ7KOZzWnTIPrlLuG23ZMnPZdvQRS4lVSdtt6Tpc9q2dDwXB/hUO6Vt+IjqlI56tt3rk6972zfdcyfTte2en6p7zCid2u7ZcMrxtk9sGDjS9lm9Flvbp3usKIO3t32Ox4aWts9xOaOx7fNdJmptO+lzrg53MC217fiqN2vbQx9Zu3W1RItOziRS8HHptYusH+JYxa/P6whxV42SsJktlvG8T0zMH5vaOAJt2CHevHkvuGpj27zJyThqppH0WmoXqzd4Twzm6g3P0zKCdp6n65N0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" alt="Alt text"></p> <p>EA交易程序Grr-al ，它使用了OHLC价格的特殊性。</p> <p>这个图显示了一个非常吸引人的EA测试图。它是如何获得的呢？我们知道一个分钟K线柱有4个价格，并且我们也知道第一个是开盘价，最后的是收盘价。两个价格中间，我们有最高价和最低价，而发生的顺序我们不得而知，但是我们知道，最高价大于或等于开盘价（而最低价小于或等于开盘价）。</p> <p>这已足以确定收到的开盘价的时间，然后分析下一个时间点的报价以确定我们此刻的价格 ---- 是最高价还是最低价。如果价格低于开盘价，那么这是一个最低价，应该即时在此价格上买入，下一个报价将会是最高价，在这里我们关闭平仓或卖出。下一个报价应该是最后一个，也就是收盘价，我们此时应该关闭交易。</p> <p>如果在此价格之后，我们收到一个价格高于开盘价格的勾号，那么交易顺序是相反的。 在一分钟的K线柱内完成这个“作弊”模式的全部处理动作，然后等待下一个K线柱。</p> <p>当在历史上测试这样的EA时，一切都会顺利进行，但一旦我们在线启动它，真相就会开始显现 - 余额曲线保持稳定，但方向是向下的。 为了揭示这个技巧，我们只需要在“每次报价”模式下运行EA。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>注意<span class="token operator">:</span> 如果EA测试结果在粗略测试模式下的（“<span class="token number">1</span>分钟OHLC”和“只有开盘价”）似乎很好，一定要在“每次报价”模式中再测试一次。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>&quot;仅使用开(盘)价&quot;</p> <p>在该模式下，根据选定的时间框架的OHLC价格生成报(跳)价。EA交易的OnTick() 函数只在K线柱开始的开盘价运行。鉴于这个特点，止损价位 和 挂单 可能会在不同于指定价格的价格点触发（尤其在较高的时间框架上测试时）。相对而言，我们有机会快速的运行EA评估测试。</p> <p>W1(月)和MN1(月)周期在“仅使用开(盘)价”报(跳)价生成模式是个例外：对于这些时间框架，是为每一天的OHLC价格而产生的，而不是一周 或 一个月的OHLC价格。</p> <p>假设我们在“仅使用开(盘)价”模式下测试一个关于EURUSD H1的EA交易。在这种情况下，跳价的总数(控制点)在测试的间隔内不会超过4*小时数。但是OnTick()处理程序只在一个小时K线柱开盘时调用。正确测试所需的检查发生在其余的跳价上(即“隐藏”在EA中)。<br></p> <p>• 计算所需预付款；<br>
• 启动止损和止盈价位；<br>
• 启动挂单；<br>
• 移除过期的挂单。<br></p> <p>如果没有打开的头寸 或 挂，我们不需要对隐藏的跳价进行这些检查，并且速度的提升可能是相当大的。这种“仅使用开(盘)价”模式非常适合于测试策略，该策略只在K线开盘时进行处理，不使用挂单，以及止损和止盈订单。对于此类策略，测试的必要准确性被保留下来。。</p> <p>让我们使用来自标准客户端安装包中的 移动平均线EA交易程序作为示例，它可以在任何模式下被测试。这个EA交易程序的逻辑是:所有的决策都是在K线的开盘时做出的，而且交易是立即进行的，不需要使用挂单。</p> <p>在2010.09.01到2010.12.31期间运行EURUSD H1的EA测试，并比较图形。数字显示了所有三种模式测试报告的结余图。</p> <p><img src="/mql5yao/assets/img/thi17.3283dcf6.png" alt="Alt text"></p> <p>移动平均线EA的测试图。来自标准客户端安装包的mq5 EA不依赖于测试模式。</p> <p>如您所见，来自标准客户端安装包的移动平均线EA在不同测试模式下的图形完全相同。</p> <p>在“仅使用开(盘)价”模式下有一些限制：<br></p> <p>• 您不能使用 随机延迟执行模式。 (请参考 https://www.metatrader5.com/en/terminal/help/testing#trade_mode)<br></p> <p>• 在测试的EA交易中，您不能访问低于用于测试/优化的时间框架的数据。例如，如果您在H1周期运行测试/优化，您可以访问H2，H3，H4等等的数据，但不可以访问M30，M20，M10数据。另外，访问的较高时间框架也必须是测试时间框架的整数倍。例如，如果您在M20运行测试，您不能访问M30的数据，但是可以访问H1。这些限制是因为不可能从测试/优化过程中生成的跳价中中获得较低的或非整数倍时间框架的数据有关。<br></p> <p>• 访问其它时间框架数据的限制也适用于其它EA交易使用的交易品种。在这种情况下，每个交易品种的限制取决于测试/优化期间访问的第一个时间框架。假如，EURUSD H1测试期间，EA交易访问GBPUSD M20数据。这种情况下，EA交易将能够进一步使用EURUSD H1，H2，以及GBPUSD M20，H1，H2等等。<br></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>注意<span class="token operator">:</span> &quot;仅使用开<span class="token punctuation">(</span>盘<span class="token punctuation">)</span>价”模式是最快的测试方式，但是不适合所有的策略测试。在交易系统的特点上选择所需的测试模式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>作为“跳价”生成模式的小节，让我们来考虑一下对EURUSD的不同的“跳价”生成模式的一个可视化比较，从2011.01.11 21:00 -- 2011.01.11 21:30:00的区间上看两个M15框架的K线柱。</p> <p>使用EA交易程序WriteTicksFromTester.mq5 将报价保存在不同的文件里并且在输入参数中指定了这些文件名的结尾包含了filenameEveryTick， filenameOHLC 和 filenameOpenPrice。</p> <p><img src="/mql5yao/assets/img/thi18.a97db61a.png" alt="Alt text"></p> <p>我们可以为EA程序WriteTicksFromTester指定开始和结束日期(变量开始和结束)。</p> <p>为了获得带有三个跳价序列的文件(对应于每一个模式“每次报价”、“1分钟OHLC”和“仅使用开(盘)价”)三个不同的文件，EA在相应模式下启动了三次，每次运行一次。然后，使用TicksFromTester.mq5 指标在图表上显示来自这三个文件的数据。指标的源代码附在本文中。</p> <p><img src="data:image/png;base64,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" alt="Alt text"></p> <p>在三种不同的测试模式下，MetaTrader 5终端策略测试器的跳价序列。</p> <p>默认情况下，MQL5语言中的所有文件操作都是在“文件沙箱”中进行的，在测试期间，EA只能访问自己的“文件沙箱”。为了让指标和EA交易程序在测试过程中处理来自一个文件夹的文件，我们使用了标记FILE_COMMON。来自EA的代码示例:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 打开文件</span>
   file<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">,</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查文件句柄</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error in opening of file %s for writing. Error code=%d&quot;</span><span class="token punctuation">,</span>filename<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;The file will be created in %s folder&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>若要读取指标中的数据，我们也使用flag FILE_COMMON。这使得我们可以避免从一个文件夹手动转移必要的文件到另一个文件夹。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 打开文件</span>
   <span class="token keyword">int</span> file<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">,</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查文件句柄</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error in open of file %s for reading. Error code=%d&quot;</span><span class="token punctuation">,</span>fname<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File will be opened from %s&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>模拟点差</p> <p>Bid 与 Ask 之间的差价称为点差。在测试期间，点差不能模仿但可以从历史数据获得。如果在历史数据中点差小于或等于零，那么最后一个已知的(在生成的时刻)点差被测试代理使用。
在策略测试中，点差通常被认为都是浮动的。所以 SymbolInfoInteger(交易品种，SYMBOL_SPREAD_FLOAT) 总是返回TRUE。</p> <p>此外，历史数据还包含了 跳价的数量 和 交易量。对于数据的存储和检索，我们使用一个特殊的mqlrate结构:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">MqlRates</span>
  <span class="token punctuation">{</span>
   datetime time<span class="token punctuation">;</span>         <span class="token comment">// 周期开始时间</span>
   <span class="token keyword">double</span>   open<span class="token punctuation">;</span>         <span class="token comment">// 开盘价</span>
   <span class="token keyword">double</span>   high<span class="token punctuation">;</span>         <span class="token comment">// 周期的最高价</span>
   <span class="token keyword">double</span>   low<span class="token punctuation">;</span>          <span class="token comment">// 周期的最低价</span>
   <span class="token keyword">double</span>   close<span class="token punctuation">;</span>        <span class="token comment">// 收盘价</span>
   <span class="token keyword">long</span>     tick_volume<span class="token punctuation">;</span>  <span class="token comment">// 跳动量</span>
   <span class="token keyword">int</span>      spread<span class="token punctuation">;</span>       <span class="token comment">// 点差</span>
   <span class="token keyword">long</span>     real_volume<span class="token punctuation">;</span>  <span class="token comment">// 交易量</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>测试期间使用真实报价</p> <p>使用真实报价进行测试和优化能够尽可能的贴近真实条件。除了基于分钟数据生成报价以外，还可以使用交易商累积的真实报价。也就是来自交易所和流动商的报价。</p> <p>为了确保测试的最大精确性，1分钟k线柱也用于真实报价模式。这些k线柱可以检查和纠正报价数据。也可以使您避免策略测试器 和 客户端图表 之间的差异。</p> <p>策略测试器会对比报价数据和1分钟K线柱：报价不应超过K线柱的最高价/最低价，同时初始价 和 最终价 应该符合1分钟K线柱的开盘价/收盘价。交易量也会进行比对。如果检测到任何不匹配，该1分钟K线柱上的所有报价都将被放弃。用生成的报价来替代（类似“每次报价”模式）。</p> <p>如果 交易品种 的历史数据记录中有1分钟K柱，但没有跳价(tick)数据，测试器会以“每个报价”模式生成报价。这可以在交易商报价数据不足的情况下，在策略测试器中绘制正确的图表。</p> <p>如果 交易品种 的历史数据记录中没有的1分钟K柱，但是存在跳价(tick)数据，那么该数据会被用于策略测试器。例如，外汇品种的交易货币对使用的最后一次报价。如果从服务器只收到 Bid/Ask，而没有(时间框架内的)最后报价，则不会生成K线柱(没有收盘价)。策略测试器会使用这些报价数据，因为它们与1分钟K线柱并不抵触。</p> <p>报(跳)价数据可能因为种种原因与1分钟K线柱不相符，当将数据从一个源传输到客户端时，由于连接丢失或其他故障。1分钟K线柱的数据在测试中被认为更加可靠。</p> <p>真实报价测试时请牢记以下特性：<br>
• 启动测试时，交易品种的1分钟K线柱数据与报价数据同步。<br>
• 报价存储在策略测试器的交易品种缓存中。缓存大小不可超过128 000个报价。收到新报价时，旧数据会从缓存删除。但是，CopyTicks函数允许接收缓存外的报价（仅适用于真实报价测试的情况下）。在这种情况下，需要从策略测试器的报价数据库中请求数据，该数据库与相应的客户端数据库完全相似。该数据不执行1分钟K线柱更正。因此，这里的报价可能不同于缓存中存储的报价。</p> <p>客户端全局变量</p> <p>在测试期间，客户端的全局变量也被模拟，但是它们与终端的当前全局变量没有关系，在终端中可以使用F3按钮来查看。这意味着在测试期间，所有与终端的全局变量的操作都发生在客户机终端(在测试代理中)之外。</p> <p>测试期间的指标计算</p> <p>在实时模式，每次跳价都会计算指标值。策略测试器采用采用了一种成本效益的模型来计算指标 —— 这些指标只在EA运行之前重新计算。这意味着在OnTick()、OnTrade()和OnTimer()函数调用之前，就会对指标进行重新计算。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>在特定的事件处理程序中是否有对指标的调用并不重要。在调用事件处理程序之前，由<span class="token function">iCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>或<span class="token function">IndicatorCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>函数创建的所有指标都将重新计算。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此，当在“每次报价”模式下测试时，将在调用OnTick()函数之前计算指标。</p> <p>如果计时器在EA中，使用EventSetTimer()函数，那么将在OnTimer()处理程序的每个调用之前重新计算指标。因此，使用一个非最优的指标，可以大大提高测试时间。</p> <p>测试期间加载历史记录</p> <p>将要测试的交易品种的历史记录在开始测试进程之前会通过交易服务器的程序端进行同步和加载。在第一次的时候，程序端会加载所有可用的交易品种历史记录，以避免随后的请求。之后只需加载新数据即可。</p> <p>测试开始以后，测试代理直接从客户端接收要被测试的交易品种历史记录。如果在测试过程中使用了其他金融工具的数据（例如，多货币的EA交易），测试代理则在第一次调用该数据时从客户端请求所需的历史记录。如果程序端提供历史数据，它们会立刻传到测试代理。如果不提供数据，程序端会从服务器请求和下载数据，然后传到测试代理。</p> <p>其他金融工具的数据也被需要用于计算交易操作的交叉汇率。例如，用存款货币USD测试EURCHF策略时，处理第一笔交易操作之前，测试代理要求来自客户端的EURUSD和USDCHF历史数据，虽然策略不包含直接使用调用这些交易品种。</p> <p>测试多货币策略之前，建议下载所有必要的历史数据到客户端。这将有助于避免与下载这些所需数据有关的测试/优化延迟。您可以下载历史记录，例如，通过打开相应的图表并滚动到最开始的历史记录。请参考MQL5参考的组织访问数据部分，会提供强制加载历史记录到程序端的示例。</p> <p>测试代理，反过来，会通过打包的形式接收来自程序端的历史记录。下一次测试期间，测试器就不会加载程序端的历史记录，因为所需数据已经从之前运行测试器的时候获得。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>• 程序端仅从交易服务器加载一次历史数据，首次时候，代理从程序端请求要被测试的交易品种的历史记录。历史记录以打包的形式加载以减少流量。
• 报<span class="token punctuation">(</span>跳<span class="token punctuation">)</span>价不会发送至网络，它们会在测试代理中生成。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>多货币测试</p> <p>策略测试器允许我们执行多交易品种交易策略的测试。这种EA通常被称为多货币EA交易，因为最初在早先的平台中，只能为一个单一的交易品种执行测试。在MetaTrader 5终端的策略测试器中，我们可以模拟所有可用的交易品种进行交易。</p> <p>第一次调用交易品种数据时，测试器会自动加载来自客户端（而非交易服务器！）的所用交易品种的历史记录。</p> <p>测试代理只下载缺失的历史记录，并提供少量的空白以提供历史上必要的数据，以便在测试开始时计算指标。对于时间框架D1和更小的框架，下载历史的最小容量是一年。</p> <p>因此，如果我们在2010.11.01-2010.12.01期间以M15（每根K线柱等于15分钟）为周期运行测试（测试间隔一个月），那么程序端将会请求金融工具2010一整年的历史记录。对于周时间框架，我们将要求100根K线柱的历史记录，这将是两年的时间（一年52周）。对于月时间框架的测试，代理将请求8年的历史记录（12月x 8年 = 96月）。</p> <p>如果不是必要的K线柱，在测试之前，测试开始日期将会自动从过去转换到现在，以提供必要的K线柱储备。</p> <p>测试期间，也模拟&quot;市场报价&quot;窗口 ，以获得交易品种信息.</p> <p>默认情况下，测试开始时，策略测试器的“市场报价”中只有一个交易品种 —— 当运行测试的交易品种被提及时，所有必要的交易品种都会自动的连接到 策略测试器 的“市场报价”窗口中（不是客户端的“市场报价”窗口 ）。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>在开始测试多货币EA之前，有必要在终端的“市场报价”中选择测试所需的交易品种，并加载所需的数据。首次调用“外汇”交易品种时，历史记录会在测试代理和客户端之间自动同步。“外汇”交易品种是指测试运行的交易品种。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在下列情况下，请参考“其他”交易品种的资料:<br></p> <p>• 当在交易品种/时间帧上使用技术指标函数 和 IndicatorCreate() 时；<br>
• 请求其他交易品种的“市场报价”数据：<br>
1.SeriesInfoInteger<br>2.Bars<br>
3.SymbolSelect<br>
4.SymbolIsSynchronized<br>
5.SymbolInfoDouble<br>6.SymbolInfoInteger<br>7.SymbolInfoString<br>
8.SymbolInfoTick<br>
9.SymbolInfoSessionQuote<br>10.SymbolInfoSessionTradeM<br>11. MarketBookAdd<br>12.MarketBookGet<br>
• 通过使用以下函数为交易品种/时间帧请求时间序列：<br>
1.CopyBuffer<br>
2.CopyRates<br>3.CopyTime<br>
4.CopyOpen<br>5.CopyHigh<br>6.CopyLowM<br>
7.CopyClose<br>
8.CopyTickVolume<br>
9.CopyRealVolume<br>
10.CopySpread<br>
在第一次调用“其他”交易品种时，测试进程停止，并将历史记录从终端下载到测试代理。与此同时，生成该交易品种的报价序列。</p> <p>根据所选的报价生成模式，为每个交易品种生成一个独立的报价序列。您也可以通过调用OnInit()处理程序的SymbolSelect()明确请求期待的交易品种的历史记录 —— 下载历史记录会在测试EA交易之前立即完成。</p> <p>因此，在MetaTrader 5客户端上执行多货币测试并不需要额外的努力。只需打开客户端中相应的交易品种的图表。如果包括该数据，那么所有所需交易品种的历史记录将会从交易服务器自动上传。</p> <p>策略测试的模拟时间</p> <p>在测试过程中，本地时间TimeLocal()总是等于服务器时间TimeTradeServer()。反过来，服务器的时间总是等于格林尼治时间(GMT)的时间。这样，所有这些函数在测试期间都显示相同的时间。</p> <p>如果没有连接到服务器，那么在策略测试器中，GMT和服务器时间之间的差异就会被刻意地消除。无论是否有连接，测试结果都应该是相同的。有关服务器时间的信息不是本地存储的，而是从服务器获取的。</p> <p>测试的图形对象</p> <p>在测试/优化过程中，图形对象没有被绘制出来。因此，当在测试/优化过程中引用创建对象的属性时，EA交易程序将得到零值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>该限制不会应用于可视化模式的测试。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>策略测试器中的OnTimer() 函数</p> <p>MQL5提供了处理计时器事件的机会。无论测试模式如何，都可以完成调用OnTimer() 处理程序。这意味着,如果一个测试运行在“仅使用开(盘)价”模式，H4时间框架,并且EA有一个每秒都调用的Timer设置,那么每个H4时间框架上的K线柱开始的时候，都将会调用一次OnTick()处理程序,并且OnTimer()处理程序将被调用(3600秒* 4小时)14400次。EA的总测试时间将会根据EA的逻辑进行增加。</p> <p>为了从定时器的给定频率中检查测试时间的依赖性，我们创建了一个简单的EA，没有任何交易操作。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 输入参数</span>
input <span class="token keyword">int</span>      timer<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">// Timer 值, 单位为秒</span>
input <span class="token keyword">bool</span>     timer_switch_on<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 定时开关</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 如果timer_switch_on==true则运行 Timer</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>timer_switch_on<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">EventSetTimer</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA反初始化函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 停止 Timer</span>
   <span class="token function">EventKillTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| Timer 函数                                                       |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
<span class="token comment">// 无操作，处理程序主体为空</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>测试时间测量是在计时器参数的不同值(计时器事件的周期性)中进行的。在获得的数据中，我们将测试时间作为定时器函数的周期。</p> <p><img src="/mql5yao/assets/img/thi20.dc676795.png" alt="Alt text"></p> <p>测试时间作为定时器函数的周期。</p> <p>可以清楚地看到，在EventSetTimer(timer)函数的初始化过程中，在其它条件相同的情况下，计时器参数越小，较小的是OnTimer()处理程序的调用之间的周期(期间)，而较大的是测试时间T。</p> <p>策略测试器中的Sleep() 函数</p> <p>在使用图形工作时，Sleep() 函数允许EA或脚本暂停执行mql5-程序。这在请求数据时是有用的，在请求时还没有准备好，您需要等到它准备好。在 组织数据存储 部分可以找到使用Sleep()函数的详细示例。</p> <p>Sleep()调用不会停滞测试过程。当您调用Sleep()时，生成的报价会在指定延迟内“播放”，这可能会导致触发挂单，止损等等。Sleep()调用以后，策略测试器的模拟时间会增加间隔，这由Sleep函数的参数中指明。</p> <p>如果作为Sleep()函数执行的结果，策略测试器的当前时间超过了选定的测试周期，那么您将会收到一个错误“在测试时检测到的无限睡眠循环”。如果您收到这个错误，测试结果不会被拒绝，所有的计算指令都是在他们的全部数量(交易数量，价格平静，等等)中执行，并且测试的结果被传递到终端。</p> <p>Sleep()函数在OnDeinit()中不能工作，因为它被调用后，测试时间将必然超出测试间隔的范围。</p> <p><img src="/mql5yao/assets/img/thi21.9cfc3a42.png" alt="Alt text"></p> <p>在MetaTrader 5终端的策略测试器中使用Sleep()函数的方案</p> <p>使用策略测试器优化数学计算问题(MT4中无此功能)</p> <p>使用MetaTrader 5 程序端的测试器中，不仅能够测试交易策略，还能够用于数学运算。若要使用，必须选择“数学运算”模式：</p> <p><img src="/mql5yao/assets/img/thi22.65571e06.png" alt="Alt text"></p> <p>数学计算</p> <p>在这种情况下，将只有三种函数能被调用：OnInit()，OnTester()，OnDeinit()。在“数学计算”模式，策略测试器不能生成任何跳价序列和下载历史记录。</p> <p>如果您指定的开始日期大于结束日期，那么策略测试器也会以“数学计算”的模式工作。</p> <p>当使用测试器解决数学问题时，上传历史记录和生成跳价序列都不会发生。</p> <p>在MetaTrader 5策略测试器中解决一个典型的数学问题 - 搜索具有多个变量的函数的极值。</p> <p>要解决这个问题，我们需要：<br>
• 函数值的计算应该位于OnTester() 函数；<br>
• 函数参数必须被定义为EA交易的 输入变量 ；<br>
编译EA，打开“策略测试器”的窗口。在“输入(参数)”标签，选择所需的输入变量，通过为每个变量输入开始，停止和阶段值来定义参数值的设置。</p> <p>选择优化类型 - “(慢速)完整算法”（全面搜索参数空间）或“基于快速遗传算法”。为了简单搜索函数极值，最好选择快速优化，但是如果您想要计算整个变量设置的值，那么最好使用慢速优化。</p> <p>选择“数学运算”模式并点击“开始”按钮，运行优化程序。请注意，在优化期间，策略测试器将搜索OnTester函数的最大值。要查找局部最小值，请从OnTester函数返回计算得到的函数值的倒数：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>function_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>需要检查函数值不能等于零，否则的话，我们可能获得 除数为零 的严重错误 。</p> <p>还有另一种方式，它更方便并且不会曲解优化结果，来自这篇文章读者的建议：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">return</span><span class="token punctuation">(</span><span class="token operator">-</span>function_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该选项不需要检查函数值是否等于零，3D表现法的优化结果表面会有同样的形状，但是一个普通的镜像。</p> <p>作为示例，我们提供了sink() 函数：</p> <p><img src="http://mql5.digityao.online/pic/thi23.png" alt="img"></p> <p>用于找到该函数极值的EA代码置于OnTester()：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                                         Sink.mq5 |</span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 输入参数</span>
input <span class="token keyword">double</span>   x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">3.0</span><span class="token punctuation">;</span> <span class="token comment">// start=-3, step=0.05, stop=3</span>
input <span class="token keyword">double</span>   y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">3.0</span><span class="token punctuation">;</span> <span class="token comment">// start=-3, step=0.05, stop=3</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| Tester函数                                                        |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">double</span> <span class="token function">OnTester</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
   <span class="token keyword">double</span> sink<span class="token operator">=</span><span class="token function">MathSin</span><span class="token punctuation">(</span>x<span class="token operator">*</span>x<span class="token operator">+</span>y<span class="token operator">*</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>sink<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>执行优化并以2D图形的形式查看 优化结果 。</p> <p><img src="/mql5yao/assets/img/thi24.7c436a7b.png" alt="Alt text"></p> <p>sink函数（x * x + y * y）的全面优化结果如二维图所示</p> <p>给定参数组(x, y)的值越好，颜色饱和度越高。正如从查看sink()公式形式所期待的，它的值以中心为(0,0)形成同心圆。人们可以通过3D图形查看，sink()函数没有单独的全局极值：</p> <p>给定的一对参数(x，y)的值越好，颜色饱和度越高。 从sink()公式的形式来看，它的值形成了以(0,0)为中心的同心圆。人们可以在3D图中看到，sink()函数没有单个全局极值：</p> <p><img src="/mql5yao/assets/img/thi25.cd80e45a.png" alt="Alt text"></p> <p>Sink函数的三维图形 在“仅使用开(盘)价”模式下同步K线柱</p> <p>MetaTrader 5 客户端的测试器允许我们检查所谓的“多货币”EA。多货币EA —— 是交易两个或两个以上交易品种的EA。</p> <p>在多交易品种上进行交易的策略测试，在测试器上强加了一些额外的技术要求：<br>
• 为这些交易品种生成每次跳价；<br>
• 为这些交易品种计算指标的值；<br>
• 为这些交易品种计算需要的保证金预付款；<br>
• 为所有交易品种同步生成报价序列。<br></p> <p>按照所选的交易模式，策略测试器为每个金融工具(交易品种)生成和处理一个报价序列。每个交易品种的新的K线柱会在同一时刻打开(开盘) ，即使在另一个交易品种上K线柱(可能)已经打开(开盘)了。这意味着当多货币EA测试时，这种情况可能会产生(并经常产生)，当一个金融工具有一个新K线柱已经打开(开盘)，而其他交易品种还没有打开(开盘)。因此，在测试时，这一切都可能变为现实。</p> <p>只要使用“每次报价”和“1分钟OHLC”测试模式，测试器中历史数据的真实模拟就不会引起任何问题。对于这些模式来说，一个蜡烛图已生成足够的报价信息，能够同步来自不同交易品种的K线柱。但是如果同步交易品种的K线柱是强制的，我们如何在“仅使用开(盘)价”模式测试多货币策略？在该模式下，只在对应K线柱的开盘时间的一个报价上调用EA。</p> <p>我们将在一个示例上进行说明：如果我们在EA测试EURUSD，新的小时蜡烛图在EURUSD打开，那么我们可以很容易地辨认出这个事实 - “仅使用开(盘)价”模式测试，事件NewTick 对应于测试周期的K线柱打开(开盘)那一刻。但是不保证EA中使用的交易品种USDJPY也在同一时刻打开了一个新的蜡烛K线柱。</p> <p>正常情况下，它足以完成OnTick() 函数的工作和检查在下一个跳价出现时的USDJPY的新K线柱。但是当在“仅使用开(盘)价”模式测试时，将不会有其他跳价，所以可能看起来这种模式不适合测试多货币EA。但是事实并非如此 —— 不要忘了 MetaTrader 5 测试器的行为就如在现实生活一样。您可以使用Sleep()函数等候，直到另一个交易品种打开一个新的K线柱！</p> <p>EA Synchronize_Bars_Use_Sleep.mq5的代码，显示“仅使用开(盘)价”模式的K线柱形同步示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                   Synchronize_Bars_Use_Sleep.mq5 |</span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 输入参数</span>
input string   other_symbol<span class="token operator">=</span><span class="token string">&quot;USDJPY&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA初始化函数                                                      |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 检查交易品种</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>_Symbol<span class="token operator">==</span>other_symbol<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;You have to specify the other symbol in input parameters or select other symbol in Strategy Tester!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 被迫停止测试</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA订单号函数                                                      |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 静态变量，用于存储最近的柱形时间</span>
   <span class="token keyword">static</span> datetime last_bar_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- sync 标识</span>
   <span class="token keyword">static</span> <span class="token keyword">bool</span> synchonized<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果静态变量未初始化</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>last_bar_time<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 这是第一次调用，节省柱形时间并退出</span>
      last_bar_time<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">SeriesInfoInteger</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span><span class="token function">Period</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SERIES_LASTBAR_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;The last_bar_time variable is initialized with value %s&quot;</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>last_bar_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 获得图表交易品种最近柱的开盘时间</span>
   datetime curr_time<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">SeriesInfoInteger</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Period</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SERIES_LASTBAR_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果时间不平等</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>curr_time<span class="token operator">!=</span>last_bar_time<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 保存柱形开盘时间到静态变量</span>
      last_bar_time<span class="token operator">=</span>curr_time<span class="token punctuation">;</span>
      <span class="token comment">//--- 不同步</span>
      synchonized<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 打印消息</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;A new bar has appeared on symbol %s at %s&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 另一个交易品种柱形的开盘时间</span>
   datetime other_time<span class="token punctuation">;</span>
<span class="token comment">//--- 循环，直至另一个交易品种开盘时间等于curr_time</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>curr_time<span class="token operator">==</span><span class="token punctuation">(</span>other_time<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">SeriesInfoInteger</span><span class="token punctuation">(</span>other_symbol<span class="token punctuation">,</span><span class="token function">Period</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SERIES_LASTBAR_DATE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>synchonized<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Waiting 5 seconds..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 等待 5 秒，调用SeriesInfoInteger(other_symbol,Period(),SERIES_LASTBAR_DATE)</span>
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 同步柱</span>
   synchonized<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Open bar time of the chart symbol %s: is %s&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>last_bar_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Open bar time of the symbol %s: is %s&quot;</span><span class="token punctuation">,</span>other_symbol<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>other_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- TimeCurrent()无用，使用TimeTradeServer()</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;The bars are synchronized at &quot;</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span><span class="token function">TimeTradeServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>请注意EA中的最后一行，它显示了同步的事实建立时的当前时间:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;The bars are synchronized at &quot;</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span><span class="token function">TimeTradeServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>要显示当前时间，我们使用 TimeTradeServer() 函数而非 TimeCurrent()。 TimeCurrent()函数返回最近的跳价时间，该时间在使用Sleep()后不能改变。在“仅使用开(盘)价”模式运行EA，您将看到同步K线柱的信息。</p> <p><img src="/mql5yao/assets/img/thi26.494ef793.png" alt="Alt text"></p> <p>Synchronize_Bars_Use_Sleep_EA 的输出信息</p> <p>如果您需要获得当前服务器的时间，而不是最新的一次报价到达的时间，请使用TimeTradeServer() 函数替代TimeCurrent()。</p> <p>还有另一个同步K线柱的方式 —— 使用计时器事件 timer。这种EA的示例是Synchronize_Bars_Use_OnTimer.mq5，请参考本文附件。</p> <p>测试器中的IndicatorRelease() 函数</p> <p>策略测试器完成一次测试后，自动打开交易品种的图表，显示完成的交易和EA中使用的指标，这有助于直观地检查进出场的点位，并将其与指标的值进行比较。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>    注意： 在测试完成后自动打开的图表上显示的指标，会在测试完成后重新计算。即使这些指标在测试的EA中已用过。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但在某些情况下，程序员可能希望隐藏在交易算法中涉及到的那些指标的信息。例如，EA的代码以可执行文件的形式出租或出售，而不提供源代码。为此，IndicatorRelease()函数是合适的。</p> <p>如果在客户终端的目录/profiles/templates中设置了一个名为 tester.tpl 的模板，那么它将被应用于打开的图表。如果没有，则会使用默认模板(default.tpl)。</p> <p>如果不再需要，IndicatorRelease() 函数最初是用来释放指标的计算部分。这可以使您节省内存和CPU两方面的资源，因为每次跳价都要调用指标计算。另一个目的 —— 就是单项测试运行后，禁止在测试图表显示指标。</p> <p>若要在测试后，禁止在图表上显示指标，通过OnDeinit()处理程序调用IndicatorRelease() 来处理指标。在 完成测试后 和 显示测试图表前，会始终调用OnDeinit()函数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| EA反初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
   <span class="token keyword">bool</span> hidden<span class="token operator">=</span><span class="token function">IndicatorRelease</span><span class="token punctuation">(</span>handle_ind<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>hidden<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;IndicatorRelease() successfully completed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;IndicatorRelease() returned false. Error code &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>若要在单项测试完成后禁止在图表上显示指标，请通过OnDeinit()处理程序使用函数IndicatorRelease()。</p> <p>测试器中的事件处理</p> <p>要在MetaTrader 5测试器测试历史数据，在EA中，OnTick()处理程序不是强制的。EA中至少包括以下函数中一个的就已经足够：<br>
•OnTick() —— 收到一个新跳价的事件处理程序；<br>
•OnTrade() —— 交易事件处理程序；<br>
•OnTimer() —— 收到一个计时器信号的事件处理程序；<br>
•OnChartEvent() —— 客户事件处理程序。<br>
在EA测试时，我们可以使用OnChartEvent()函数处理自定义事件，但是在指标中，该函数不能在测试器中调用。即使指标拥有OnChartEvent()事件处理程序，并且该指标用在测试的EA中，指标本身仍然不能接收任何自定义事件。</p> <p>测试期间，指标可以使用EventChartCustom()函数生成自定义事件，并且EA可以用OnChartEvent()处理该事件。</p> <p>除了这些事件之外，策略测试器还生成与测试和优化过程相关的特殊事件:<br></p> <p>• Tester —— 该事件在完成EA历史数据测试后生成。Tester 事件使用OnTester()函数处理。这个函数只能在测试EA时使用，主要用于计算一个极值，该值被用作输入参数的遗传优化的自定义最大标准。<br>
• TesterInit —— 该事件在第一次通过之前在策略测试器优化开始时生成。TesterInit事件使用 OnTesterInit() 函数处理。优化开始期间，该处理程序的EA交易自动加载于测试器指定交易品种和周期的独立程序端图表上，接收 TesterInit事件。该函数用于在优化开始之前启动EA交易，以便进一步处理优化结果。<br>
• TesterPass —— 该事件在接收到新的 数据帧 时生成。TesterPass事件使用<br>OnTesterPass() 函数处理。优化期间，该处理程序的EA交易自动加载于测试器指定的交易品种和周期的独立程序端图表上，并在收到 数据帖 时接收TesterPass事件。 该函数用于&quot;立即&quot;动态处理 优化结果 无需等候完成。使用FrameAdd()函数添加 数据帧，该函数可以在单次通过结束后用OnTester() 处理程序调用。<br>
• TesterDeinit —— 该事件在结束策略测试器的EA交易优化后生成。TesterDeinit 事件使用OnTesterDeinit() 函数处理。该处理程序的EA交易在优化开始时自动加载于图表，而在完成后接收TesterDeinit。该函数用于最后处理 所有 优化结果。<br>
测试代理</p> <p>MetaTrader 5 客户端测试使用测试代理实施。自动创建和启用本地代理。默认的本地对象数量等于计算机的内核数量。</p> <p>每个测试代理都有其自己的全局变量副本，它与客户端无关。程序端本身是调度员，将任务分配给本地和远程代理。执行一个测试EA任务以后，使用给定的参数，代理返回结果到程序端。对于单项测试，只使用一个代理。 代理存储从程序端接收的历史记录，根据交易品种名称，存储在独立的文件夹中，所以EURUSD历史记录存储在名为EURUSD的文件夹。另外，交易品种的历史记录也根据其来源分别处理。存储历史记录的结构看起来像以下方式：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>tester_catalog\Agent<span class="token operator">-</span>IPaddress<span class="token operator">-</span>Port\bases\name_source\history\symbol_name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>例如，服务器MetaQuotes-Demo的EURUSD历史记录可以被存在文件夹tester_catalog\Agent-127.0.0.1-3000\bases\MetaQuotes-Demo\EURUSD。</p> <p>完成测试后，本地代理，进入待机模式，等候5分钟，等待下一个任务，以便不在启动下次调用上浪费时间。只有等候期结束后，本地代理才会关闭，释放所占用的CPU内存。</p> <p>如果提前完成测试，从用户方面（”取消“按钮），以及关闭客户端，所有本地代理会立即停止工作，释放所占用的内存。</p> <p>程序端和代理之间的数据交换</p> <p>当您运行测试时，客户端已准备向代理发送一些的参数模块：<br>
• 用于测试的输入参数（模拟模式，测试时间段区间，交易品种，优化规则，等等）<br>
• 选定的”市场报价“交易品种列表<br>
• 交易品种测试规则（合约大小，获准的市场预付款用于设置止损和获利，等等）<br>
• 要被测试的EA交易和输入参数的值<br>
• 附加文件信息（程序库，指标，数据文件 - # property tester_ ...)<br></p> <table border="1"><tr><td>tester_indicator</td> <td>string</td> <td>indicator_name.ex5&quot;格式的自定义指标名称。如果对应的参数通过常量字符串设置，那么需要测试的指标通过调用iCustom()函数自动定义。针对所有其他情况（使用IndicatorCreate() 函数或使用设置指标名称的参数中的非常量字符串）需要该属性</td></tr> <tr><td>tester_file</td> <td>string</td> <td>带有扩展指证的测试器文件名，双引号（常量字符串）。指定文件将被传到测试器。如果有必要，要被测试的导入文件，必须始终指明。</td></tr> <tr><td>tester_library</td> <td>string</td> <td>带有扩展名的程序库名称，双引号。程序库可以有dll或ex5扩展名。需要测试的程序库被自动定义。然而，如果用自定义指标使用任何程序库，则需要该属性。</td></tr></table> <p>对于每一个参数块，都创建了一个md5-hash哈希散列形式的数字指纹，并将其发送给代理。md5哈希对于每一组来说都是唯一的，它的体积比计算它的信息量要小很多倍。</p> <p>代理接收散列模块，将其与现有的进行比较。如果代理中没有给定的参数模块指纹，或接收的散列模块不同于现有的，那么代理请求该模块参数。这会减少程序端和代理之间的流量。</p> <p>测试之后，代理返回程序端，运行的所有结果显示在“测试结果”和“优化结果”标签：所获利润，成交量，夏普系数，OnTester() 函数的结果，等等。</p> <p>优化期间，程序端以小包形式分发测试任务给代理，每包都包含几个任务（每个任务意味着一系列输入参数的单独测试）。这减少了程序端和代理之间的交换时间。</p> <p>由于安全原因，代理从终端(EA、指示器、库等)中获取的ex5文件从来没有记录到硬盘上，因此有运行代理的计算机不能使用发送的数据。所有其他文件，包括DLL，都被记录在沙箱中。在远程代理中，不能使用DLL测试EAs。</p> <p>测试结果被终端添加到一个特殊的结果缓存中(结果缓存)，以便在需要时快速访问它们。对于每一组参数，终端会搜索结果缓存，以避免重复运行。如果没有找到这样一组参数的结果，那么代理就会被赋予进行测试的任务。</p> <p>程序端和代理之间的所有流量都是经过加密的。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>每次跳价并不是通过网络发送，它们是代理在测试中生成的。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用所有客户端的共享文件夹</p> <p>所有测试代理都来自客户端，相互独立：每个代理都有其自己的日志记录文件夹。另外，代理测试期间的所有操作都发生在agent_name/MQL5/Files文件夹。然而，如果打开文件期间您指定标识FILE_COMMON ，那么我们可以通过客户端的共享文件夹实施本地代理和客户端的互动：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 所有客户端的共享文件夹</span>
   common_folder<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 拟定该文件夹的名称</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Open the file in the shared folder of the client terminals %s&quot;</span><span class="token punctuation">,</span> common_folder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开共享文件夹的文件（指定 FILE_COMMON 标帜）</span>
   handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>FILE_WRITE<span class="token operator">|</span>FILE_READ<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> further actions
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>使用DLLs</p> <p>为了加快优化，我们不仅可以使用本地，还可以使用远程代理。在这种情况下，远程代理有一些限制。首先，远程代理不显示在日志中执行Print()函数的结果，关于头寸的打开和关闭的消息。在日志中显示了最少的信息，以防止错误地写入EAs，从而使远程代理工作的计算机与消息一起工作。</p> <p>另一个限制 —— 测试EA时禁止使用DLL。出于安全考虑，远程代理完全禁止调用DLL。在本地代理，也只在相应的“允许导入DLL”权限下，允许在测试EA中调用DLL。</p> <p><img src="/mql5yao/assets/img/thi27.2ee3a257.png" alt="Alt text"></p> <p>勾选 “允许DLL导入”选项</p> <p>注意： 当使用从EA（脚本，指标）接收的需要允许DLL调用时，您应该意识到在程序端设置中允许该选项时您要承担的风险。无论EA如何使用 - 是用于测试还是运行图表。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>注意<span class="token operator">:</span>当使用第三方<span class="token function">EA</span><span class="token punctuation">(</span>脚本、指标<span class="token punctuation">)</span>时，如果需要允许DLL调用，您应该意识到，当您在终端设置中勾选允许该选项时所承担的风险。与如何使用EA无关 —— 意即，用于测试 或 在图表上运行，都存在风险。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mql5yao/Chapter/two.html" class="prev">
        02 第二章 标准常量，列举和架构
      </a></span> <span class="next"><a href="/mql5yao/Chapter/four.html">
        04 第四章 预定义变量
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mql5yao/assets/js/app.33d9106b.js" defer></script><script src="/mql5yao/assets/js/3.64586e1a.js" defer></script><script src="/mql5yao/assets/js/4.21ff370e.js" defer></script>
  </body>
</html>
