<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能交易*姚 文档站</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mql5yao/favicon.ico">
    <meta name="description" content="这是智能交易的文档站点。">
    <meta name="keywords" content="MQL,EA,智能交易,自动交易,量化,编程,培训">
    
    <link rel="preload" href="/mql5yao/assets/css/0.styles.c167a2d0.css" as="style"><link rel="preload" href="/mql5yao/assets/js/app.f23448f4.js" as="script"><link rel="preload" href="/mql5yao/assets/js/3.a8269cb7.js" as="script"><link rel="preload" href="/mql5yao/assets/js/5.47d44717.js" as="script"><link rel="prefetch" href="/mql5yao/assets/js/10.a59489eb.js"><link rel="prefetch" href="/mql5yao/assets/js/11.1fde020f.js"><link rel="prefetch" href="/mql5yao/assets/js/12.a5634cbb.js"><link rel="prefetch" href="/mql5yao/assets/js/13.1e1b93d8.js"><link rel="prefetch" href="/mql5yao/assets/js/14.17d955a5.js"><link rel="prefetch" href="/mql5yao/assets/js/15.429599a3.js"><link rel="prefetch" href="/mql5yao/assets/js/16.bcf982ab.js"><link rel="prefetch" href="/mql5yao/assets/js/17.76fde0dd.js"><link rel="prefetch" href="/mql5yao/assets/js/18.49626d28.js"><link rel="prefetch" href="/mql5yao/assets/js/19.0f21f003.js"><link rel="prefetch" href="/mql5yao/assets/js/2.45a03fa6.js"><link rel="prefetch" href="/mql5yao/assets/js/20.18311061.js"><link rel="prefetch" href="/mql5yao/assets/js/21.63b34e06.js"><link rel="prefetch" href="/mql5yao/assets/js/22.a49527a7.js"><link rel="prefetch" href="/mql5yao/assets/js/23.2584759c.js"><link rel="prefetch" href="/mql5yao/assets/js/24.05b32517.js"><link rel="prefetch" href="/mql5yao/assets/js/25.991ff096.js"><link rel="prefetch" href="/mql5yao/assets/js/26.07e08c10.js"><link rel="prefetch" href="/mql5yao/assets/js/27.11150f9e.js"><link rel="prefetch" href="/mql5yao/assets/js/28.b5c9f3ea.js"><link rel="prefetch" href="/mql5yao/assets/js/29.a1ad142f.js"><link rel="prefetch" href="/mql5yao/assets/js/30.6da01d3d.js"><link rel="prefetch" href="/mql5yao/assets/js/31.28fa5dac.js"><link rel="prefetch" href="/mql5yao/assets/js/32.46aab1c1.js"><link rel="prefetch" href="/mql5yao/assets/js/33.f178c7a3.js"><link rel="prefetch" href="/mql5yao/assets/js/34.cd1eae3b.js"><link rel="prefetch" href="/mql5yao/assets/js/35.ee55e50b.js"><link rel="prefetch" href="/mql5yao/assets/js/36.56370362.js"><link rel="prefetch" href="/mql5yao/assets/js/37.2cc5b283.js"><link rel="prefetch" href="/mql5yao/assets/js/38.c3bba64a.js"><link rel="prefetch" href="/mql5yao/assets/js/39.86103eac.js"><link rel="prefetch" href="/mql5yao/assets/js/4.ffd96de7.js"><link rel="prefetch" href="/mql5yao/assets/js/40.0e36f079.js"><link rel="prefetch" href="/mql5yao/assets/js/41.17bccbf6.js"><link rel="prefetch" href="/mql5yao/assets/js/42.a40ca8ac.js"><link rel="prefetch" href="/mql5yao/assets/js/43.5a883397.js"><link rel="prefetch" href="/mql5yao/assets/js/44.19bdddfe.js"><link rel="prefetch" href="/mql5yao/assets/js/45.dec8257c.js"><link rel="prefetch" href="/mql5yao/assets/js/46.ed29615c.js"><link rel="prefetch" href="/mql5yao/assets/js/47.b6d07db1.js"><link rel="prefetch" href="/mql5yao/assets/js/48.d7ca24ca.js"><link rel="prefetch" href="/mql5yao/assets/js/6.1f5c1ae1.js"><link rel="prefetch" href="/mql5yao/assets/js/7.1a679445.js"><link rel="prefetch" href="/mql5yao/assets/js/8.e80e8a9d.js"><link rel="prefetch" href="/mql5yao/assets/js/9.261aef18.js">
    <link rel="stylesheet" href="/mql5yao/assets/css/0.styles.c167a2d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mql5yao/" class="home-link router-link-active"><img src="/mql5yao/logo.png" alt="智能交易*姚 文档站" class="logo"> <span class="site-name can-hide">智能交易*姚 文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MQL5线上手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mql5yao/Chapter/start.html" class="sidebar-link">MQL5 参考</a></li><li><a href="/mql5yao/Chapter/one.html" class="sidebar-link">01 第一章 语言基础</a></li><li><a href="/mql5yao/Chapter/two.html" class="sidebar-link">02 第二章 标准常量，列举和架构</a></li><li><a href="/mql5yao/Chapter/three.html" class="sidebar-link">03 第三章 MQL5程序</a></li><li><a href="/mql5yao/Chapter/four.html" class="sidebar-link">04 第四章 预定义变量</a></li><li><a href="/mql5yao/Chapter/five.html" class="sidebar-link">05 第五章 普通函数</a></li><li><a href="/mql5yao/Chapter/six.html" class="sidebar-link">06 第六章 数组函数</a></li><li><a href="/mql5yao/Chapter/add1.html" class="sidebar-link">07 第add1章 矩阵和向量方法</a></li><li><a href="/mql5yao/Chapter/seven.html" class="sidebar-link">07 第七章 函数转换</a></li><li><a href="/mql5yao/Chapter/eight.html" class="sidebar-link">08 第八章 数学函数</a></li><li><a href="/mql5yao/Chapter/nine.html" class="sidebar-link">09 第九章 字符串函数</a></li><li><a href="/mql5yao/Chapter/ten.html" class="sidebar-link">10 第十章 日期和时间</a></li><li><a href="/mql5yao/Chapter/eleven.html" class="sidebar-link">11 第十一章 账户信息</a></li><li><a href="/mql5yao/Chapter/twelve.html" class="sidebar-link">12 第十二章 检测</a></li><li><a href="/mql5yao/Chapter/thirteen.html" class="sidebar-link">13 第十三章 事件处理</a></li><li><a href="/mql5yao/Chapter/fourteen.html" class="sidebar-link">14 第十四章 市场信息</a></li><li><a href="/mql5yao/Chapter/fifteen.html" class="sidebar-link">15 第十五章 经济日历函数</a></li><li><a href="/mql5yao/Chapter/sixteen.html" class="sidebar-link">16 第十六章 时间序列和指标访问</a></li><li><a href="/mql5yao/Chapter/seventeen.html" class="sidebar-link">17 第十七章 自定义交易品种</a></li><li><a href="/mql5yao/Chapter/eighteen.html" class="sidebar-link">18 第十八章 图表操作</a></li><li><a href="/mql5yao/Chapter/ninteen.html" class="sidebar-link">19 第十九章 交易函数</a></li><li><a href="/mql5yao/Chapter/twenty.html" class="sidebar-link">20 第二十章 交易信号</a></li><li><a href="/mql5yao/Chapter/twentyone.html" class="sidebar-link">21 第二十一章 网络函数</a></li><li><a href="/mql5yao/Chapter/twentytwo.html" class="sidebar-link">22 第二十二章 程序端全局变量</a></li><li><a href="/mql5yao/Chapter/twentythree.html" class="sidebar-link">23 第二十三章 文件函数</a></li><li><a href="/mql5yao/Chapter/twentyfour.html" aria-current="page" class="active sidebar-link">24 第二十四章 自定义指标</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-指标的-绘制类型-示例" class="sidebar-link">24.1 指标的 绘制类型 示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-1-draw-none" class="sidebar-link">24.1.1 DRAW_NONE</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-2-draw-line" class="sidebar-link">24.1.2 DRAW_LINE</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-3-draw-section" class="sidebar-link">24.1.3 DRAW_SECTION</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-4-draw-histogram" class="sidebar-link">24.1.4 DRAW_HISTOGRAM</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-5-draw-histogram2" class="sidebar-link">24.1.5 DRAW_HISTOGRAM2</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-6-draw-arrow" class="sidebar-link">24.1.6 DRAW_ARROW</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-7-draw-zigzag" class="sidebar-link">24.1.7 DRAW_ZIGZAG</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-8-draw-filling" class="sidebar-link">24.1.8 DRAW_FILLING</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-9-draw-bars" class="sidebar-link">24.1.9 DRAW_BARS</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-10-draw-candles" class="sidebar-link">24.1.10 DRAW_CANDLES</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-11-draw-color-line" class="sidebar-link">24.1.11 DRAWCOLORLINE</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-12-draw-color-section" class="sidebar-link">24.1.12 DRAWCOLORSECTION</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-13-draw-color-histogram" class="sidebar-link">24.1.13 DRAWCOLORHISTOGRAM</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-14-draw-color-histogram2" class="sidebar-link">24.1.14 DRAWCOLORHISTOGRAM2</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-15-draw-color-arrow" class="sidebar-link">24.1.15 DRAWCOLORARROW</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-16-draw-color-zigzag" class="sidebar-link">24.1.16 DRAWCOLORZIGZAG</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-17-draw-color-bars" class="sidebar-link">24.1.17 DRAWCOLORBARS</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-1-18-draw-color-candles" class="sidebar-link">24.1.18 DRAWCOLORCANDLES</a></li></ul></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-2-指标属性和函数间的连接" class="sidebar-link">24.2 指标属性和函数间的连接</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-3-setindexbuffer" class="sidebar-link">24.3 SetIndexBuffer</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-4-indicatorsetdouble" class="sidebar-link">24.4 IndicatorSetDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-5-indicatorsetinteger" class="sidebar-link">24.5 IndicatorSetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-6-indicatorsetstring" class="sidebar-link">24.6 IndicatorSetString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-7-plotindexsetdouble" class="sidebar-link">24.7 PlotIndexSetDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-8-plotindexsetinteger" class="sidebar-link">24.8 PlotIndexSetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-9-plotindexsetstring" class="sidebar-link">24.9 PlotIndexSetString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentyfour.html#_24-10-plotindexgetinteger" class="sidebar-link">24.10 PlotIndexGetInteger</a></li></ul></li><li><a href="/mql5yao/Chapter/twentyfive.html" class="sidebar-link">25 第二十五章 物件函数</a></li><li><a href="/mql5yao/Chapter/twentysix.html" class="sidebar-link">26 第二十六章 技术指标</a></li><li><a href="/mql5yao/Chapter/twentyseven.html" class="sidebar-link">27 第二十七章 处理优化结果</a></li><li><a href="/mql5yao/Chapter/twentyeight.html" class="sidebar-link">28 第二十八章 工作事件</a></li><li><a href="/mql5yao/Chapter/twentynine.html" class="sidebar-link">29 第二十九章 使用OpenCL工作</a></li><li><a href="/mql5yao/Chapter/thirty.html" class="sidebar-link">30 第三十章 使用数据库</a></li><li><a href="/mql5yao/Chapter/thirtyone.html" class="sidebar-link">31 第三十一章 使用DirectX</a></li><li><a href="/mql5yao/Chapter/thirtytwo.html" class="sidebar-link">32 第三十二章 集成</a></li><li><a href="/mql5yao/Chapter/add2.html" class="sidebar-link">32 第add2章 ONNX模型</a></li><li><a href="/mql5yao/Chapter/thirtythree.html" class="sidebar-link">33 第三十三章 标准程序库</a></li><li><a href="/mql5yao/Chapter/AppendixI.html" class="sidebar-link">34 附录一 来自MQL4</a></li><li><a href="/mql5yao/Chapter/AppendixII.html" class="sidebar-link">35 附录二 MQL5 函数列表</a></li><li><a href="/mql5yao/Chapter/AppendixIII.html" class="sidebar-link">36 附录三 MQL5常量列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2> 第二十四章  自定义指标</h2> <p>这是一组用来创建自定义指标的函数，这些函数不能用于编写EA交易程序 和 脚本。</p> <table><thead><tr><th>函数</th> <th>功能</th></tr></thead> <tbody><tr><td>SetIndexBuffer</td> <td>将 指标缓冲区 和 一维双精度动态数组 绑定</td></tr> <tr><td>IndicatorSetDouble</td> <td>设置指标属性的 双精度型 值</td></tr> <tr><td>IndicatorSetInteger</td> <td>设置指标属性的 整型 值</td></tr> <tr><td>IndicatorSetString</td> <td>设置指标属性的 字符串 值</td></tr> <tr><td>PlotIndexSetDouble</td> <td>设置指标绘画线型属性的 双精度型 值</td></tr> <tr><td>PlotIndexSetInteger</td> <td>设置 指标绘画线型属性的 整型 值</td></tr> <tr><td>PlotIndexSetString</td> <td>设置指标绘画线型属性的 字符串 值</td></tr> <tr><td>PlotIndexGetInteger</td> <td>获取 指标绘画线型属性的 整型 值</td></tr></tbody></table> <p>指标属性可以使用 编译器指令 或使用函数来设置。为了更好地理解这一点，建议您学习指标样式示例。</p> <p>自定义指标中所有必要的运算都在预定义的OnCalculate()函数中，如果您使用短格式调用OnCalculate()函数，(OnCalculate有2个版本，此处指第1个版本)如</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">OnCalculate</span> <span class="token punctuation">(</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
<span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
<span class="token keyword">const</span> <span class="token keyword">int</span> begin<span class="token punctuation">,</span> 
<span class="token keyword">const</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> price<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>那么 rates_total 参数包括price[]数组中的全部元素的数量，以输入参数传递到计算指标值中。</p> <p>参数 prev_calculated 是上次调用OnCalculate() 的计算结果，它允许组织用于计算指标值的节约算法。例如，如果当前值是rates_total = 1000, 而前值是prev_calculated = 999, 那么可能仅对每个指标缓冲区的一个值进行计算就足够了。</p> <p>如果关于报价信息的输入数组price[]的大小信息不可用，那么将导致必须计算每个指标缓冲区的1000个值。在第一次调用OnCalculate()函数时，prev_calculated = 0。如果price []数组以某种方式改变，那么在这种情况下，prev_calculated也等于0。</p> <p>begin参数表示价格数组原始值的数量，不包括计算数据。例如，如果Accelerator Oscillator 值（开头37个值没有计算）以输入参量使用，那么begin = 37。例如，列举一个简单指标：</p> <p>begin参数显示价格数组初始值的数量，其中不包含用于计算的数据。 例如，如果指标Accelerator Oscillator 的值(前37个值未计算)用作输入参数，则begin = 37。示例，让我们考虑一个简单的指标：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//---- 绘图标签1 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Label1&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         Label1Buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区绘图 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Label1Buffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标重复函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> begin<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>price<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  
  <span class="token punctuation">{</span> 
<span class="token comment">//--- </span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;begin = &quot;</span><span class="token punctuation">,</span>begin<span class="token punctuation">,</span><span class="token string">&quot;  prev_calculated = &quot;</span><span class="token punctuation">,</span>prev_calculated<span class="token punctuation">,</span><span class="token string">&quot;  rates_total = &quot;</span><span class="token punctuation">,</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 为下一次调用返回prev_calculated值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>将其从“导航”窗口拖到 加速器振荡器(AC)指标的窗口中，并指出将根据前一个指标的值进行计算：(仅适用于 MT5 客户端 —— 智能交易*姚 提示)</p> <p><img src="/mql5yao/assets/img/e1.a1da58ef.png" alt="计算前一个指标"></p> <p><img src="/mql5yao/assets/img/e2.b1b28491.png" alt="begin参数"></p> <p>begin参数的值将精确地等于初始的K线柱的数量，此例中的 加速器振荡器(AC)指标 的值不是严格根据begin的值进行计算。如果我们查看自定义指标Accelerator.mq5的源代码，我们将在OnInit()函数中看到如下几行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 设置指标开始画线的第一个K线柱  
   PlotIndexSetInteger(0,PLOT_DRAW_BEGIN,37);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用函数PlotIndexSetInteger(0，PLOT_DRAW_BEGIN，empty_first_values)，我们可以设置自定义指标中第一个指标数组中的不需要计算的零值的数量，我们不需要接受计算(empty_first_values)。 因此，我们有以下机制：</p> <ol><li>设置一个指标的初始值的数量，不应该用于另一个自定义指标的计算;</li> <li>调用另一个自定义指标时，获取有关要忽略的第一个值的数量的信息，而不必考虑其计算逻辑。</li></ol> <h2 id="_24-1-指标的-绘制类型-示例"><a href="#_24-1-指标的-绘制类型-示例" class="header-anchor">#</a> 24.1 指标的 绘制类型 示例</h2> <p>MetaTrader 5客户端包括38个技术指标，可以在MQL5程序中调用相对应的函数。但是，MQL5语言的主要优势在于能够创建自定义指标，然后可以在EA交易程序中使用这些指标，或者将其用于技术分析的价格图表。</p> <p>指标的整个设定可以源自于几种基本的 绘制类型，即画线的样式。绘制画线表示一种显示数据的方式，可以用于指标计算，存储和提供数据。共有七种这样的基本 绘制类型：</p> <ol><li>直线</li> <li>线段(直线的一节)</li> <li>柱状图</li> <li>箭头(符号)</li> <li>填充区(填充的通道)</li> <li>美式棒线图</li> <li>日式蜡烛图</li></ol> <p>每个绘制画线都需要 一至五 个双精度类型的数组，指标值可以保存在其中。为方便起见，这些数组与指标缓冲区绑定关联。一个自定义指标的缓冲区数量必须使用编译程序指令提前声明，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#property indicator_buffers 3 // 缓冲区数量 
#property indicator_plots   2 // 绘制数量
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>指标缓冲区的数量通常大于或等于指标绘制画线的数量。</p> <p>由于每种基本绘制类型都可以具有颜色变化或构造细节，因此MQL5中绘制类型的实际数量为18：</p> <table><thead><tr><th>绘制类型</th> <th>描述</th> <th>价格缓冲区</th> <th>颜色缓冲区</th></tr></thead> <tbody><tr><td>DRAW_NONE</td> <td>不显示在图表中，但在数据窗口可以看到相应缓冲区的值</td> <td>1</td> <td>-</td></tr> <tr><td>DRAW_LINE</td> <td>根据相应的缓冲区中的值绘画直线(缓冲区不适合空值，因此直线是连续的)</td> <td>1</td> <td>-</td></tr> <tr><td>DRAW_SECTION</td> <td>根据相应的缓冲区中的值绘画线段(通常有很多空值，线段是一节一节。)</td> <td>1</td> <td>-</td></tr> <tr><td>DRAW_HISTOGRAM</td> <td>从 零 到 相应的缓冲区的值，绘制一个柱状线(可能有很多空值)</td> <td>1</td> <td>-</td></tr> <tr><td>DRAW_HISTOGRAM2</td> <td>绘制基于两个指标缓冲区之间的柱状线(可能有空值)</td> <td>2</td> <td>-</td></tr> <tr><td>DRAW_ARROW</td> <td>绘制一个箭头符号(可能有空值)</td> <td>1</td> <td>-</td></tr> <tr><td>DRAW_ZIGZAG</td> <td>类似于绘制线段(DRAW_SECTION)样式，但与其不同，可以在一根K线柱上绘制垂直线段</td> <td>2</td> <td>-</td></tr> <tr><td>DRAW_FILLING</td> <td>在两条线之间填充颜色。相应缓冲区的2个值显示在数据窗口</td> <td>2</td> <td>-</td></tr> <tr><td>DRAW_BARS</td> <td>绘制美式棒线。相应缓冲区的4个值显示在数据窗口</td> <td>4</td> <td>-</td></tr> <tr><td>DRAW_CANDLES</td> <td>绘制日式蜡烛线。相应缓冲区的4个值显示在数据窗口</td> <td>4</td> <td>-</td></tr> <tr><td>DRAW_COLOR_LINE</td> <td>您可以在不同K线柱上替换颜色或随时改变线的颜色</td> <td>1</td> <td>1</td></tr> <tr><td>DRAW_COLOR_SECTION</td> <td>类似 DRAW_SECTION 样式，但每段线段的颜色可以单独设置；颜色也可以动态设置</td> <td>1</td> <td>1</td></tr> <tr><td>DRAW_COLOR_HISTOGRAM</td> <td>类似 DRAW_HISTOGRAM 样式，但每一根柱状线都可能有不同的颜色，您可以设置动态颜色</td> <td>1</td> <td>1</td></tr> <tr><td>DRAW_COLOR_HISTOGRAM2</td> <td>类似 DRAW_HISTOGRAM2 样式，但每一根柱状线都可能有不同的颜色，您可以设置动态颜色</td> <td>2</td> <td>1</td></tr> <tr><td>DRAW_COLOR_ARROW</td> <td>类似 DRAW_ARROW 样式，但每个符号都可能有它的颜色。颜色可以动态改变</td> <td>1</td> <td>1</td></tr> <tr><td>DRAW_COLOR_ZIGZAG</td> <td>DRAW_ZIGZAG 样式具有线段单独颜色和动态颜色改变的选项</td> <td>2</td> <td>1</td></tr> <tr><td>DRAW_COLOR_BARS</td> <td>DRAW_BARS 样式具有美式棒线单独颜色和动态颜色改变的选项</td> <td>4</td> <td>1</td></tr> <tr><td>DRAW_COLOR_CANDLES</td> <td>DRAW_CANDLES 样式具有日式蜡烛图单独颜色和动态颜色改变的选项</td> <td>4</td> <td>1</td></tr></tbody></table> <p>指标缓冲区 和 数组 之间的不同</p> <p>在每个自定义指标中，在全局范围上，您都应该声明一个或多个双精度类型的数组，然后必须使用SetIndexBuffer()函数将其绑定到指标缓冲区。若指标要绘制画线，只可使用指标缓冲区中的值，其它任何数组都不能用于此目的。另外，缓冲区的值会显示在数据窗口。</p> <p>指标缓冲区应该是动态的，不需要指定大小 —— 用作指标缓冲区的数组的大小由客户终端执行子系统自动设置。</p> <p>数组绑定指标缓冲区以后，索引的方向像普通数组一样默认设置，但是您可以使用ArraySetAsSeries()函数更改访问数组元素的方式。默认情况下，指标缓冲区用于存储绘制画线的数据(INDICATOR_DATA)。</p> <p>如果指标值的计算需要保持中间计算并存储每根K线柱的额外值，然后这个数组可以被声明为绑定期间的计算缓冲区(INDICATOR_CALCULATIONS)。对于中间值，您也可以使用常规数组，但是在这种情况下，程序员必须管理数组大小。</p> <p>一些绘制类型允许为每根K线柱设置颜色。若要存储颜色信息，需要使用颜色缓冲区(INDICATOR_COLOR_INDEX)。颜色值的类型是 整数型(color) ，但是所有 指标缓冲区 都必须是 双精度类型。颜色的值和辅助 (INDICATOR_CALCULATIONS) 缓冲区的值不能通过使用CopyBuffer()来获得。</p> <p>指标缓冲区的数量必须使用预编译程序指令#property indicator_buffers number_of_buffers来指定：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">3</span>  </span><span class="token comment">//  指标有3个缓冲区</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>一个指标允许的最大缓冲区数量是512。</p> <p>指标缓冲区 和 绘制画线的关联绑定</p> <p>每个绘制画线都是基于一个或多个指标缓冲区。所以，若要显示简单的蜡烛图，则需要四个值 - 开盘价，最高价，最低价和收盘价。相应地，若要以蜡烛图的形式显示一个指标，必须为它们声明4个指标缓冲区和4个双精度类型的数组。例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 指标有4个指标缓冲区 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">4</span> </span></span>
<span class="token comment">//--- 指标有一个 绘制类型 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 绘制类型1将显示为蜡烛图 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_CANDLES </span></span>
<span class="token comment">//--- 蜡烛图的颜色为clrDodgerBlue </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrDodgerBlue </span></span>
<span class="token comment">//--- 指标缓冲区的4个数组 </span>
<span class="token keyword">double</span> OBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> HBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> LBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> CBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>绘制类型根据编号自动使用指标缓冲区。绘制编号从1开始，缓冲区数从0开始。如果第一个绘制类型需要4个指标缓冲区，那么开始的4个指标缓冲区将被用于1号绘制类型。这四个缓冲区应该使用SetIndexBuffer() 函数，以正确的索引编号绑定连接到相应的数组。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 绑定数组和指标缓冲区 
   SetIndexBuffer(0,OBuffer,INDICATOR_DATA);  // 第一个指标缓冲区 对应 索引编号0 
   SetIndexBuffer(1,HBuffer,INDICATOR_DATA);  // 第二个指标缓冲区 对应 索引编号1 
   SetIndexBuffer(2,LBuffer,INDICATOR_DATA);  // 第三个指标缓冲区 对应 索引编号2 
   SetIndexBuffer(3,CBuffer,INDICATOR_DATA);  // 第四个指标缓冲区 对应 索引编号3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>绘制蜡烛图，指标将只使用前面这四个缓冲区，因为“蜡烛图”的绘制类型的索引编号是在第一个数字下用预编译指令声明的。</p> <p>现在我们来更改示例，并添加一条简单的绘制线 —— DRAW_LINE。现在假设这条线的编号为1，蜡烛图的编号为2。缓冲区的数量和绘制类型的数量都会增加。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 指标有5个指标缓冲区 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span> </span></span>
<span class="token comment">//--- 指标有2个 绘制类型 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">2</span> </span></span>
<span class="token comment">//--- 绘制类型 1 是 直线 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE </span></span>
<span class="token comment">//--- 直线的颜色是 clrDodgerRed </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrDodgerRed </span></span>
<span class="token comment">//--- 绘制类型 2 是日式蜡烛图 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type2   DRAW_CANDLES </span></span>
<span class="token comment">//--- 蜡烛图的颜色是clrDodgerBlue </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color2  clrDodgerBlue </span></span>
<span class="token comment">//--- 指标缓冲区的5个数组 </span>
<span class="token keyword">double</span> LineBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> OBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> HBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> LBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> CBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>绘制类型的顺序也已经改变，现在 直线 是第一位，紧跟着是日式蜡烛图。因此，缓冲区的顺序也相应的发生了改变 —— 首先我们声明的是索引为0的 直线型的缓冲区，然后是四个用于绘制蜡烛图的缓冲区。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>LineBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第一个缓冲区对应0号绘制类型的索引，即画直线 </span>
<span class="token comment">//--- 绑定数组 和 蜡烛图指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>OBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第二个缓冲区对应1号绘制类型的索引 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>HBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第三个缓冲区对应2号绘制类型的索引 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>LBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第四个缓冲区对应3号绘制类型的索引 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>CBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第五个缓冲区对应4号绘制类型的索引 二-五用于画蜡烛图 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>缓冲区 和 绘图类型 的数量仅可以通过使用预编译程序指令(#property)来设置，不可以使用函数动态改变这些属性。</p> <p>颜色版本样式</p> <p>正如表格中所见，基本绘制样式 被分成两组。第一组包括名字中无COLOR的样式，我们调用这些基本样式：
• DRAW_LINE
• DRAW_SECTION
• DRAW_HISTOGRAM
• DRAW_HISTOGRAM2
• DRAW_ARROW
• DRAW_ZIGZAG
• DRAW_FILLING
• DRAW_BARS
• DRAW_CANDLES</p> <p>在第二组，样式名称包括 COLOR，我们称它们颜色版本：
• DRAW_COLOR_LINE
• DRAW_COLOR_SECTION
• DRAW_COLOR_HISTOGRAM
• DRAW_COLOR_HISTOGRAM2
• DRAW_COLOR_ARROW
• DRAW_COLOR_ZIGZAG
• DRAW_COLOR_BARS
• DRAW_COLOR_CANDLES</p> <p>所有颜色版本的样式不同于基本版，因为他们允许为绘制画图的每个部分指定颜色。绘制样式的最小部分是K线柱，所以我们可以说颜色版本允许在每个K线柱上设置颜色。</p> <p>除了 DRAW_NONE 和 DRAW_FILLING样式，它们没有颜色版本。</p> <p>若要在每个K线柱上设置绘制颜色，存储颜色索引的额外缓冲区已被添加到颜色版本中。这些索引在特定数组中指出颜色数量，包括预定颜色组。颜色数组大小是64。这意味着每个绘制样式的颜色版本都允许用64种不同的颜色来表现。</p> <p>在指定颜色数组中，颜色的设置和数量可以通过预编译程序指令#property indicator_color来设置，在这里您可以通过逗号分隔指定所有必需的颜色。例如，指标中的这种输入：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 定义8种颜色用于蜡烛图的显示颜色（它们存储在指定数组中） 
#property indicator_color1  clrRed,clrBlue,clrGreen,clrYellow,clrMagenta,clrCyan,clrLime,clrOrange
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上例中的预编译指令表示，对于绘制类型1，设置了8种颜色，这些颜色将放置在一个特殊的数组中。然后在程序中，我们不需要指定绘制类型的颜色，而只需指定它的索引编号即可。 如果我们要为K线设置红色，应该在指标的颜色缓冲区中设置数组中的颜色索引值。红色在预编译指令中是第一个，它对应的索引号是0。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  //--- 设置蜡烛图颜色clrRed 
  col_buffer[buffer_index]=0;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这组颜色不是一劳永逸的，它可以使用PlotIndexSetInteger()动态改变。例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 为每个 绘制类型 设置颜色，像属性PLOT_LINE_COLOR 
      PlotIndexSetInteger(0,                    //  绘制类型样式的索引编号 
                          PLOT_LINE_COLOR,      //  属性标识符 
                          plot_color_ind,       //  颜色标引，在这里我们编写颜色 
                          color_array[i]);      //  新颜色
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>指标 和 绘制类型的属性</p> <p>对于指标中的绘制类型，属性可以借助预编译程序指令和使用相应的函数进行设置。在指标属性 和 函数之间的绑定连接文章中阅读关于它的更多信息。使用指定函数动态改变指标属性允许创建更灵活的自定义指标。</p> <p>图表上指标绘制的起点</p> <p>在许多情况下，根据算法的条件，不可能在当前K线柱立即应用计算指标值，因为在历史记录中必须提供之前K线柱的最小数量。例如，许多平滑类型(如，平均线，加权等)意味着在之前的N根K线柱上使用价格数组，并且在这些值的基础上，计算当前K线柱的指标值。</p> <p>在这种情况下，既无法为开始的N号K线柱计算指标值，也不能将这些值显示在图表上，而只是用于辅助计算进一步的值。为避免在历史记录的开始的N根K线柱上绘制指标，请在PLOT_DRAW_BEGIN属性中设置相应的N值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 绑定数组和蜡烛图的指标缓冲区 
PlotIndexSetInteger(number_of_plot,PLOT_DRAW_BEGIN,N);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在这里：
• number_of_plot —— 从0到indicator_plots - 1的值 (从0开始的绘制类型的编号数)。
• N —— 历史记录中开始K线柱的数量，在这里指标不显示在图表上。</p> <h3 id="_24-1-1-draw-none"><a href="#_24-1-1-draw-none" class="header-anchor">#</a> 24.1.1 DRAW_NONE</h3> <p>DRAW_NONE样式是专为需要计算缓冲区值 并且 只需要将其显示在数据窗口的情况下使用而设计的，但图表上的并不需要绘制画线。若要建立精度(即小数点后显示几位)，请在OnInit()函数使用IndicatorSetInteger(INDICATOR_DIGITS,num_chars)表达式：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>InvisibleBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置显示在数据窗口的精度，即小数点后显示几位 </span>
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_DIGITS<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>DRAW_NONE绘制样式所需的缓冲区的数量是1。</p> <p>一个示例指标，在数据窗口显示鼠标当前悬停的K线柱对应的索引编号。该编号对应于时间序列，这意味着当前未完成的K线柱的索引编号为 零，并且最早的K线柱的索引编号最大。</p> <p><img src="/mql5yao/assets/img/e3.fa5b3b6c.png" alt="Bar 的序列号"></p> <p>请注意，在示例的源码中，尽管事实上，设置了 绘制类型1的颜色为红色，但该指标不会在图表上绘制任何内容(因为 绘制样式 为 DRAW_NONE)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                    DRAW_NONE.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 绘制类型不可见 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Bar Index&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_NONE </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         InvisibleBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 绑定数组和指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>InvisibleBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置展示在数据窗口的精确值 </span>
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_DIGITS<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> datetime lastbar<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果这是指标的第一次计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 第一次重新编号柱形 </span>
      <span class="token function">CalcValues</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">,</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在lastbar记下当前柱的开盘时间 </span>
      lastbar<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">SeriesInfoInteger</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span>SERIES_LASTBAR_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 如果新柱出现，其开盘时间不同于lastbar </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lastbar<span class="token operator">!=</span><span class="token function">SeriesInfoInteger</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span>SERIES_LASTBAR_DATE<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 再次重新编号柱形 </span>
         <span class="token function">CalcValues</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">,</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 在lastbar更新当前柱的开盘时间  </span>
         lastbar<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">SeriesInfoInteger</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span>SERIES_LASTBAR_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 编制类似时间帧的柱形编号                                            | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">CalcValues</span><span class="token punctuation">(</span><span class="token keyword">int</span> total<span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token keyword">const</span>  <span class="token operator">&amp;</span>array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 设置时间帧的指标缓冲区标引 </span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>InvisibleBuffer<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 用其编号填写每个柱形 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> InvisibleBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h3 id="_24-1-2-draw-line"><a href="#_24-1-2-draw-line" class="header-anchor">#</a> 24.1.2 DRAW_LINE</h3> <p>DRAW_LINE样式 根据 指标缓冲区的值 和 指定的颜色 画一条线。线的宽度，样式和颜色可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便它们的外观根据当前情况而改变。</p> <p>DRAW_LINE样式 所需的缓冲区数量是1个。</p> <p>使用K线柱收盘价绘制线型的指标的示例。线型颜色，宽度和线型每N=5 个跳价都会随机变化一次。</p> <p><img src="data:image/png;base64,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" alt="DRAW_LINE"></p> <p>请注意，在示例的源码中，最初DRAW_LINE的属性是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对另三种属性(颜色，线型和宽度)随机设置。N参数设置为指标的外部参数，即表示可以手动配置(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                    DRAW_LINE.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_LINE&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a line of a specified color at Close prices&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Color, width and style of lines is changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 线型属性使用预编译程序指令设置 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Line&quot;</span>      <span class="token comment">// 数据窗口的标图名称 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE   </span><span class="token comment">// 绘制类型是线型 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed      </span><span class="token comment">// 线型颜色 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span><span class="token comment">// 线型样式 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span>           </span><span class="token comment">// 线型宽度 </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>         <span class="token comment">// 改变的订单号数量  </span>
<span class="token comment">//--- 绘制类型的指标缓冲区 </span>
<span class="token keyword">double</span>         LineBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 绑定数组和指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>LineBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 初始化随机数字生成器 </span>
   <span class="token function">MathSrand</span><span class="token punctuation">(</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值的模块 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      LineBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标中绘制的线型外观                                            | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型颜色的模块 </span>
<span class="token comment">//--- 获得随机数 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为PLOT_LINE_COLOR属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型宽度的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为 PLOT_LINE_WIDTH 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;, Width=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的索引编号 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, &quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><h3 id="_24-1-3-draw-section"><a href="#_24-1-3-draw-section" class="header-anchor">#</a> 24.1.3 DRAW_SECTION</h3> <p>DRAW_SECTION样式 根据指标缓冲区的值和指定的颜色绘制一条线段。线段的宽度，样式和颜色设置类似DRAW_LINE，可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便它们的外观根据当前情况而改变。</p> <p>从一个非空值到指标缓冲区的另一个非空值绘制节段，空值将被忽略。若要指定哪个值应被视为“空”，请在PLOT_EMPTY_VALUE属性设定该值：例如，如果指标应该被绘制为非零值的系列节段，然后您需要设置零值为空值：</p> <p>画出线段是从指标缓冲区一个非空值开始画线，直到另一个非空值，指标缓冲区中的空值被忽略(即不画线段)。如果想要指定哪些值应该被视为“空”值，请在PLOT_EMPTY_VALUE属性中设置此值：例如，如果想要指标为非零值绘制一系列的线段，则需要将 零 值设置为 “空”值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//---  0 (空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_SECTION,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终需要明确填写指标缓冲区的值，在缓冲区中设置一个“空”值用于不绘制画线的元素。</p> <p>DRAW_SECTION样式所需的缓冲区的数量是 1个。</p> <p>绘制最高价和最低价之间节段的指标示例。所有 节段的颜色，宽度和线型每N个订单号都会随机变化一次。</p> <p>以下是一个指标示例，在 高价格 和 低价格 之间绘制线段。所有部分的颜色，宽度和线型每N个跳价会随机更改一次。</p> <p><img src="data:image/png;base64,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" alt="DRAW_SECTION示例"></p> <p>请注意，在示例的源码中，最初DRAW_SECTION的 属性 是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对另三种属性(颜色，线型和宽度)随机设置。N参数设置为指标的外部参数，即表示可以手动配置(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                 DRAW_SECTION.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_SECTION&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Draws straight sections every bars bars&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, width and style of sections are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图节段 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Section&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_SECTION </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>           <span class="token comment">// 柱形节段长度 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变节段样式的订单号数量 </span>
<span class="token comment">//--- 标图的指标缓冲区 </span>
<span class="token keyword">double</span>         SectionBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算阶段终点的辅助变量 </span>
<span class="token keyword">int</span>            divider<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 绑定数组和指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>SectionBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 0 (空) 值将不参与绘制 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 检查指标参数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid value of parameter bar=%d&quot;</span><span class="token punctuation">,</span>bars<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> divider<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>bars<span class="token punctuation">;</span> 
<span class="token comment">//---+ </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 指标值计算开始的柱数 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果之前计算了指标，那么在前一柱开始设置 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 这是指标值的全部计算 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得柱数除以2*bars的余数 </span>
      <span class="token keyword">int</span> rest<span class="token operator">=</span>i<span class="token operator">%</span>divider<span class="token punctuation">;</span> 
      <span class="token comment">//--- 如果柱数可被2*bars除尽 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>rest<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 在该柱最高价设置节段终点 </span>
         SectionBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//---如果除法的余数等于柱数，  </span>
      <span class="token keyword">else</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 在该柱最高价设置节段终点 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>rest<span class="token operator">==</span>bars<span class="token punctuation">)</span> SectionBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 如果什么也没发生，忽略柱形 - 设置0 </span>
         <span class="token keyword">else</span> SectionBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的节段外观                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为PLOT_LINE_COLOR属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型宽度的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置宽度 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置线型样式 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br></div></div><h3 id="_24-1-4-draw-histogram"><a href="#_24-1-4-draw-histogram" class="header-anchor">#</a> 24.1.4 DRAW_HISTOGRAM</h3> <p>DRAW_HISTOGRAM样式 根据 从0到指定值 和 指定颜色 绘制一个柱状线。指定值从指标缓冲区获得。柱状线的宽度，样式和颜色设置类似DRAW_LINE，可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便柱状线的外观根据当前情况而改变。</p> <p>因为每个柱状线都是从 0 开始画线，因此DRAW_HISTOGRAM应该更好地在 单独的图表窗口 中使用。大多数情况下，这种 绘制样式 用于创建 振荡器类型 的指标，例如Bears Power或OsMA。对于不可显示的空值，应指定 零 值。</p> <p>DRAW_HISTOGRAM样式 所需的缓冲区的数量是 1个。</p> <p>基于MathSin() 函数绘制指定颜色的正弦曲线的指标示例。所有柱状线的颜色，宽度和线型每N个跳价都会随机变化一次。柱状线的参数指定为正弦曲线周期，指定柱形数量之后，正弦曲线将重复这个循环。</p> <p><img src="data:image/png;base64,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" alt="DRAW_HISTOGRAM示例"></p> <p>请注意，在示例的源码中，最初DRAW_HISTOGRAM的 属性 是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对另三种属性(颜色，线型和宽度)随机设置。N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                               DRAW_HISTOGRAM.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_HISTOGRAM&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a sinusoid as a histogram in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color and width of columns are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The bars parameter sets the number of bars in the cycle of the sinusoid&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图直方图 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Histogram&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_HISTOGRAM </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrBlue </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>          <span class="token comment">// 柱形的正弦曲线周期 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变直方图的订单号数量 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         HistogramBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得2Pi角弧度的因素，当乘以柱的参数时 </span>
<span class="token keyword">double</span>    multiplier<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>HistogramBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算乘数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>multiplier<span class="token operator">=</span><span class="token number">2.</span><span class="token operator">*</span>M_PI<span class="token operator">/</span>bars<span class="token punctuation">;</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Set the value of bars=%d greater than 1&quot;</span><span class="token punctuation">,</span>bars<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 提前终止指标 </span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果之前OnCalculate开始期间已经计算  </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 设置倒数第二柱为计算起点 </span>
<span class="token comment">//--- 填写指标缓冲区的值 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      HistogramBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span>i<span class="token operator">*</span>multiplier<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型外观                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为PLOT_LINE_COLOR属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型宽度的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置宽度 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置线型样式 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br></div></div><h3 id="_24-1-5-draw-histogram2"><a href="#_24-1-5-draw-histogram2" class="header-anchor">#</a> 24.1.5 DRAW_HISTOGRAM2</h3> <p>DRAW_HISTOGRAM2 样式根据 两个指标缓冲区的值 和 指定颜色 绘制一个垂直的柱状图。柱状线的宽度，样式和颜色设置类似DRAW_LINE，可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便柱状线的外观根据当前情况而改变。</p> <p>DRAW_HISTOGRAM2样式可以在图表的单独子窗口和主窗口中使用。对于空值，不绘制任何内容，需要明确的设置指标缓冲区中的所有值。缓冲区未初始化为零值。</p> <p>绘制类型DRAW_HISTOGRAM2所需的缓冲区的数量是2。</p> <p>指标示例：在每根K线柱的 开盘价 和 收盘价 之间绘制指定颜色和宽度的垂直柱状图。所有柱状图的颜色，宽度和样式每N个跳价都会随机变化一次。指标启动期间，在OnInit() 函数，一周中的第X天的柱状图不会绘制 —— invisible_day —— 随机设置。为此，空值设置 PLOT_EMPTY_VALUE=0：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 设置空值 
   PlotIndexSetDouble(index_of_plot_DRAW_SECTION,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtoAAAGpAgMAAADO3nlSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAMUExURf///wAAAAAA/wAAACaJBLwAAAAEdFJOU////wBAKqn0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAMJklEQVR42u2d25KrKBRAN1Wbed5W6f9AlXk3Vdp/2H7ngHiPMXgJlz6smdNplNgrBBF2kEAi8ZfhTSRUS2+ESKBlMnl/meTtluT9dRZuyfvrJG+3JG+3rLwJMOcgqtd9IyWEwMq7glySlGYrMhCvz6iHX5pHVTeQo5e35aW8S0li13tEIJIQOSP4Cmi/t6iI6XoyeUtRNQ+JeV4g1pxJRhlCnZOuLJ03yQC8VXmzZl7eTZkhYpYLSSVKKLMHZbl+S7R3wyvtvfueXAB302tvwkU9eTy1dylkwVV5P55ZnpVQNsVDqLMXBYmsESF416TqCav69oRByXpvKnUpsyzT3oJK0vWE1EuEILyX+1T9rirkXf3W5S2fLM9U7SnoIbr6XTfMm/csvX3dWR+AMXDBjiec8nbEvvev+JkSQV3nl6a4Srfqv5GAvbmou/Swbd+7KZ6MigrU5ZzV4ksXmDdsl7eVNwPVEpJu8kSOEKM3ySC80bKe1ExdQQuhvVm1Dh9+mffe+ue+N9PeurzV5Ry9lDfOUie8JcTkzXQ9KVT9UJfzR+Xce2r78GB5+2Nwu+LNGnCOKe1P3r1hUOXd9v+mGjN51x+8mcde1dwbO/fB+1e0o3ent+FdB+OtS9l4tvDZWwbkPbQvbV/3x97si/czkyg5eMA4bp+XbX9mjlf7l/ab5Y0eJ4N72rGEt71h35tEKQt/3jjW4nm5W3q7vUz2tDPHoYe19sZ33vCkBgvuq7zN2Tmcjcb7p38P9r39YdyMmanlMJa12cdVWxK297xPOHnj2Ir38W/G5fD6/DG4TbVk11vHvzlkQz4A16OzgcFtPjYzLePPdnmXko3eDDPj7f7MfOc978GO3ib+raOCJh9D9TqUNwvc28S/1eBsiCNnGX8U6pfwvQklw5k3lfRoyKf3fIyp+7Kb3l38+/Ec6knnLVT9AddsecP78l6AoOP1qrwhjPI+4s277qBf7zl23v5I3i7BP+g99A5j8562mT4uRudt+oo/0XmPI9DIvCF538S+9zIVhzck7y+A4zUxLu/f8Zr4Ssje7c4+XKWS93WOeHMRh/eSrsWJ0huS92WSt1vaY9m7+HcDgvbmf7vgsHcFOWPiOXye4osT5V0iyiwy7y7+jVRm8ZU3a6hoGr/eeMKbkEBk0XnXhMJ7e3LCe/V8PyRvt8TqvTe63CQQ7/boX07el0jebknebpg+t0neLkjebknebknebhk+hWqPPjF5n2Kal36QILwxeTsiXm89E4YfHRUP87+Lx9PP/O9fYe7fOvx3u/i3gLK/sd+193DHwglvglIwjM27i3/XjEs/cc0r5c0aiUB+4shXvAn9es/vw7DGzP8mn/VkOe/LEs/td/J2y/zev0Mk71PE6D2NF5L3t0EYZwKe+7tf8EbLPHF6mzsU67N/9yveaJUHYX5f60GS94jNaHE9Gg7Bu7UYncfsPX9fYvKej3KS93nOeB8meY+8957Xi5i9L+DJ+7dfrec0nrxbq7Ngh9u9MXnv0a//zau74lV7NXfufSJWP8fEv+m++bHtTkuBi1yX/paJf0/rOsNVHHmb+Hd83v3633olkeWRz7LtvT76Hd56/W8X3vMzsb36l/r1TxDuak/ee89bvhu8X45/jb/ufZEvea+PE4M37HjjLNclknfP0nv+2MK0smDY3hip9zLeqvuAzbg+6UVu9sbd8p5Gw3F560fzHoTsjZveQ46LOPPG5K35uvdU01uY6kto3r/9WffqzUXI3tO6unNvU9o1xOmNELK3+TnYDqtL19F446y8uWij9J5ib6F76zV25+6xeA991mn191i8l9/YEY/3fKX6eraed/jew7Vy+vaIW731+icFu7z+t3nmlvfyer8f+bRmmP89X//7FPNx43RWTse83VvHv2/21tcZnO1Z/rzF28S/Obs8r3fubb5XZNqzPPK0fvoFuvi3/gqv9dGPsowv4I733idX1nTx7yi9a8K6uLeebB1p7n3xszTNbe33pzgULnJeji8lb9if4xC2d22d8yK3eeuR/K+weX5Y3kOf+zMIkLxnx4QTx8XkbcemNybvzbzf8j68mtRh78tsek/ffGj7N4Zv4bLLewM3etvWLlfedu99zN52fN8brfsSR+5ZDcn7yHypWL1v4U96T/MAPhGS9+/4Tbyfad1a73q3B+uJU3a9zRY7b8fE602ArJDCxKv+635G4V1BzmFYjzoib1LSDHe9P5s79+7i3zI+7y7+3ZTvve16TD68CRlGWN618ia2254E6b3g1Rui8cY/4m1zZvr3xs3yTt43kbzd8ke8zVyR+LwRmv479TEy7yki3C627psnb0veei9Xy4jHu11s/RSTD9U7hvLm/Rqj6617hwnBe2rBl1v3SN6WbHrDH/HmfWT2PeGWN0Tr/bNzmFC8l9eZ4bVss7fva2zEkc0/XGyNxRvC99bxbw6z+d+ReOv4N0lpkpPtEW8ET/FvErF5m/i38l7P6116a0Irb9Y0lRDrWh2+t44jR+it49+cPc/Xk9875v0f5e18TXvv9o556Ee5xdvxnAKNlbfh3WfwrXvrf8Z7yzB5H+AWbw8kb7cc8t6epxy+9/Z9ZaF78zcrOYbu/a7fF743ROD9SvK+geTtln/WGyPxxpetoXtrkvdFLnpj8j5GF/+uCy7s1itYe19ep/4sXfybge3632vvy+umn6WLf0fo3cW/c87keW/nsUFNv/7J+fLmwkP0ZFz/xNZbrxUzx0tMU9Ovf2LbnqxbPS91W3Ow/U7eF0nebrnkjcn7KMnbLcnbLZe8PXxOPHDJu/XTp9IcXk8peV/iorc3Lnhj8j5O8nZL8nbLBe9ff1f5S94erzqnvPHlNw/E663j3xwy2/W/p76rZ28d/yZ4muRnk6kV8V7eJSNmvf53IN5d/BsLzGzXdZ57e6SLfxM9ars4ckjehILEgfW/A/GuCRvVntiv/x2I94Lk/WWSt1tOeWP/6JGT3u/mLDkjebslebvlhPdwV3ps3sMazsn7BKe8zbe6xedtSjx5n+CUt6d7Luec9vY6mk/erjnpfWQ9+69w0tt2fe2vcdIbkvc5Tnt7pot/I2fCPl4ViHcFeU4ls48PBlPeJcbnbeLf/CHjK2/W4LhOfEzehFF614RFjO3JguT9ZZK3W5K3W5K3W5K3W5K3W5K3W/4h7yBI3m5J3m5J3m5J3m6J11vHvwv+tJ3/HQgm/g3Ceh51IJj4N7yu/x04Jv7NQNrHNYPAxL+VuH0cOQhM/Jsi9Nbx76Jk0dWTBcn7yyRvtyRvtyRvtyRvtyRvtyRvt/w5b2bzbA6+WHvnWoXXxrtR40/BRZUzKJi+JbbK1dZ+iAGsHp9dgGs2vFWZC+OtHgRBhlK9mJKUtPpfh1vMXvVA/ZeQCgGOWXtnGeccRFkVHJUN46i9mfZW5V2WeZ4TI6moEPLiiVSVFQMmC7fqr95UquKrUNIDamBKVmpvhsZbKmtGZYaZqi+SJBI+dTQgKwlcsvYmWZRcCFGrR1UblDdjyptj5y2xoaLz5pUA9dpkRrWstTf69iYkIVQZK02GWlh7A/XeQhUx6vLWFV2SeKqcqn6rDeS0orx4My678i54CTWq85JXVc5FIdUmEFhgwSouhXxWvMpJvcRa1Kq10U8Ch+xfdwi2TrfNGuH4inXmerl5tYnAOwT+iDdvIqFaeq/LO/R0KB7JO+x09MgK9NjADBN0uu7SnAkzJV9Um2nWp7nqr8/3c1mt0vUy/+r4fHV8/nJ8tUel1TDB/NLDBHb5zDBBpVWnST9SSahvgdDfO7CVVt30Lg1ULfar/tgyncEq/3r/dnrKb3RVj44WPWflLbkkM0zQGaBLq0zm1g2Jm2k23NpBtNxPq/wZ7OfPcDM95cdSqu6p6kGvvCulkgkzTDD1RqfH4/T7SYo+XZv8fEjTKj8t8/fHe59///iqPpQq84Y3sqbMAAfvPj2+b3KV7ver12nqjf44dLafgVil1/lX+xnu5tfjAFmVW/WEgX7ezBvMcYZ6sUz3+5kZS6h2ihb71d5lGtb5xSo/7ubXYuVGebOnGuQ+JJhhwpRWZ4PU5zOr3qSlSfOqXuznz3V6lf8Jy/2r4/P18fX5V6k2i7NFe9IR/MXmzVA2eG/n0ZpEIvGvAPA/uFQV15A4pC8AAAAASUVORK5CYII=" alt="DRAW_HISTOGRAM2示例"></p> <p>请注意，在示例的源码中，最初DRAW_HISTOGRAM2的 属性 是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对另三种属性(颜色，线型和宽度)随机设置。N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                              DRAW_HISTOGRAM2.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_HISTOGRAM2&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a segment between Open and Close on each bar&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, width and style are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图Histogram_2 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Histogram_2&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_HISTOGRAM2 </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变直方图的订单号数量 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         Histogram_2Buffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         Histogram_2Buffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 没有标图指标的工作日 </span>
<span class="token keyword">int</span> invisible_day<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组0到5的 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Histogram_2Buffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Histogram_2Buffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置空值 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得从0到5的随机数 </span>
   invisible_day<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">6</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 通过每柱的开盘价获得工作日 </span>
   MqlDateTime dt<span class="token punctuation">;</span> 
<span class="token comment">//---如果之前OnCalculate开始期间已经计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 在倒数第二柱设置计算起点 </span>
<span class="token comment">//--- 填写指标缓冲区的值 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">TimeToStruct</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span>day_of_week<span class="token operator">==</span>invisible_day<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         Histogram_2Buffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
         Histogram_2Buffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token keyword">else</span> 
        <span class="token punctuation">{</span> 
         Histogram_2Buffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         Histogram_2Buffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型外观                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 线型颜色变化模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型宽度的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置线型宽度 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置线型样式 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 添加计算中省略的工作日的信息 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\nNot plotted day - &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ENUM_DAY_OF_WEEK<span class="token punctuation">)</span>invisible_day<span class="token punctuation">)</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br></div></div><h3 id="_24-1-6-draw-arrow"><a href="#_24-1-6-draw-arrow" class="header-anchor">#</a> 24.1.6 DRAW_ARROW</h3> <p>DRAW_ARROW样式根据 指标缓冲区的值 和 指定颜色 绘制箭头( Wingdings的设置符号) 。符号的宽度，样式和颜色设置类似DRAW_LINE，可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便柱状线的外观根据当前情况而改变。</p> <p>符号代码使用PLOT_ARROW 属性进行设置。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 定义PLOT_ARROW绘制的来自Wingdings字体的符号代码到 
   PlotIndexSetInteger(0,PLOT_ARROW,code);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>PLOT_ARROW的默认值 = 159（一个圆圈）。</p> <p>每个箭头实际上都是有 高度 和 定位点(锚点) 的符号，可以覆盖图表上的一些重要信息(例如，K线柱的收盘价)。因此，我们还可以指定垂直方向上的偏移距离，以像素为单位，这并不依赖图表的比例。虽然指标的值将会保持不变，但画出来的箭头会按指定的像素数量向下移动一段距离：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 设置箭头的像素垂直移动 
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,shift);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>PLOT_ARROW_SHIFT的负值表示画箭头时向上偏移，正值表示画箭头时向下偏移。</p> <p>DRAW_ARROW 样式可以用在 单独的图表子窗口 和 主窗口。由于不绘制空值并且也不会出现在&quot;数据窗口&quot;，指标缓冲区的所有值都应该明确设定。缓冲区不用零值初始化。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 设置空值 
   PlotIndexSetDouble(index_of_plot_DRAW_ARROW,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>DRAW_ARROW样式所需的缓冲区的数量是 1。</p> <p>一个指标示例，该指标在K线柱上绘制一个箭头，条件是这个K线柱的 收盘价 高于前一根K线柱的 收盘价。每N个跳价之后随机更改所有箭头的颜色，宽度，偏移距离和符号代码。</p> <p><img src="/mql5yao/assets/img/e8.a7b1c729.png" alt="DRAW_ARROW示例"></p> <p>请注意，在示例的源码中，最初DRAW_ARROW的 属性 是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对另三种属性(颜色，线型和宽度)随机设置。N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                   DRAW_ARROW.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_ARROW&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Draws arrows set by Unicode characters, on a chart&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, size, shift and symbol code of the arrow are changed in a random way&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The code parameter sets the base value: code=159 (a circle)&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图箭头 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Arrows&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_ARROW </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrGreen </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>         <span class="token comment">// 改变订单号数量 </span>
input ushort   code<span class="token operator">=</span><span class="token number">159</span><span class="token punctuation">;</span>    <span class="token comment">// 在DRAW_ARROW绘制的符号代码 </span>
<span class="token comment">//--- 标图的指标缓冲区 </span>
<span class="token keyword">double</span>         ArrowsBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组0到5的 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ArrowsBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 定义PLOT_ARROW绘制的符号代码 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置箭头的像素垂直移动 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW_SHIFT<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置空值为 0 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变颜色，大小，移动和箭头的代码 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值的模块 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算循环 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 如果当前收盘价高于之前的价格，请绘制一个箭头 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>close<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
         ArrowsBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 否则指定零值 </span>
      <span class="token keyword">else</span> 
         ArrowsBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的交易品种外观                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成指标属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变箭头颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变大小箭头的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 大小设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下箭头大小 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变箭头代码 (PLOT_ARROW)的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法的余数来计算新的箭头代码（从0到19） </span>
   <span class="token keyword">int</span> code_add<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置新的符号代码作为ode+code_add的结果 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span>code<span class="token operator">+</span>code_add<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下符号代码 PLOT_ARROW </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token string">&quot;PLOT_ARROW=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>code<span class="token operator">+</span>code_add<span class="token punctuation">)</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变箭头的像素垂直移动的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的移动 </span>
   <span class="token keyword">int</span> shift<span class="token operator">=</span><span class="token number">20</span><span class="token operator">-</span>number<span class="token operator">%</span><span class="token number">41</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置新移动从 -20 到 20 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW_SHIFT<span class="token punctuation">,</span>shift<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下PLOT_ARROW_SHIFT移动 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token string">&quot;PLOT_ARROW_SHIFT=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>shift<span class="token punctuation">)</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
  
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br></div></div><h3 id="_24-1-7-draw-zigzag"><a href="#_24-1-7-draw-zigzag" class="header-anchor">#</a> 24.1.7 DRAW_ZIGZAG</h3> <p>DRAW_ZIGZAG 样式根据 两个指标缓冲区的值 和 指定的颜色 绘制线段。此样式与DRAW_SECTION非常相似，但与后者不太相同(DRAW_SECTION的 指标缓冲区 是1个)，DRAW_ZIGZAG允许在一根K线柱内绘制垂直线段，两个指标缓冲区的值均设置在一根K线柱上的话。线段从第一个缓冲区的值 绘制 到第二个指标缓冲区的值。缓冲区不会只包含空值，因为在这种情况下，不会画出线段。</p> <p>线的宽度，样式和颜色设置类似DRAW_SECTION，可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便柱状线的外观根据当前情况而改变。</p> <p>从一个缓冲区的非空值到另一个指标缓冲区的非空值画出线段。若要指定哪个值应被视为“空”，请在 PLOT_EMPTY_VALUE 属性中设定该值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_ZIGZAG,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终需要明确的填写指标缓冲区的值，在缓冲区中设置空值以跳过相对应的K线柱。</p> <p>DRAW_ZIGZAG样式所需的缓冲区的数量是2个。</p> <p>一个指标示例，基于 最高价 和 最低价 绘制线段。ZIGZAG 线段的颜色，宽度和线型每N 个跳价之后都会随机变化一次。</p> <p><img src="data:image/png;base64,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" alt="DRAW_ZIGZAG示例"></p> <p>请注意，最初DRAW_ZIGZAG样式的 属性 是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对另三种属性(颜色，线型和宽度)随机设置。N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                  DRAW_ZIGZAG.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_ZIGZAG&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a \&quot;saw\&quot; as straight segments, skipping the bars of one day&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The day to skip is selected randomly during indicator start&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, width and style of segments are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot; every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图ZigZag </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ZigZag&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_ZIGZAG </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrBlue </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变订单号数量  </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         ZigZagBuffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ZigZagBuffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 没有标图指标的工作日 </span>
<span class="token keyword">int</span> invisible_day<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组0到5的 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 绑定数组和指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ZigZagBuffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ZigZagBuffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得从0到6的随机值，在这一天不标图指标 </span>
   invisible_day<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">6</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 0(空)值将不参与绘制 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 0(空)值将不参与绘制 </span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span><span class="token string">&quot;ZigZag1;ZigZag2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 获得每个柱形工作日所需的时间结构 </span>
   MqlDateTime dt<span class="token punctuation">;</span> 
  
<span class="token comment">//--- 计算的初始位置 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果在前一个订单号计算指标，那么在倒数第二个开始计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算循环 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 在结构中写下柱形的开盘时间 </span>
      <span class="token function">TimeToStruct</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 如果该柱的工作日等于invisible_day </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span>day_of_week<span class="token operator">==</span>invisible_day<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 写下该柱形的缓冲区空值 </span>
         ZigZagBuffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
         ZigZagBuffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 如果工作日没问题，填写缓冲区 </span>
      <span class="token keyword">else</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 如果柱形数量 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
           <span class="token punctuation">{</span> 
            <span class="token comment">//---  在第一个缓冲区写下最高价，在第二个缓冲区写下最低价 </span>
            ZigZagBuffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
            ZigZagBuffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
         <span class="token comment">//--- 柱形数量是奇数 </span>
         <span class="token keyword">else</span> 
           <span class="token punctuation">{</span> 
            <span class="token comment">//--- 按相反顺序填写柱形 </span>
            ZigZagBuffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
            ZigZagBuffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变zigzag节段的外观                                               | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成ZigZag属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变ZigZag颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型宽度的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 添加计算中省略的工作日的信息 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\nNot plotted day - &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ENUM_DAY_OF_WEEK<span class="token punctuation">)</span>invisible_day<span class="token punctuation">)</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br></div></div><h3 id="_24-1-8-draw-filling"><a href="#_24-1-8-draw-filling" class="header-anchor">#</a> 24.1.8 DRAW_FILLING</h3> <p>DRAW_FILLING 样式在两个指标缓冲区之间绘制填充颜色区域。实际上，该样式绘制两条线，并用指定的两种颜色中的一种填充两条线之间的空间。它用于创建绘制通道的指标。缓冲区不会只包含空值，因为在这种情况下，不会绘制任何颜色区域。</p> <p>您可以设置两种填充颜色：
• 第一个颜色用于 第一个缓冲区的值 大于 第二个指标缓冲区的值 的区域；
• 第二个颜色用于 相反的情况。</p> <p>填充颜色可以使用预编译器指令进行设置 或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>该指标计算所有K线柱的指标，两个指标缓冲区的值既不等于0也不等于空值。若要指定应将哪个值视为“空”，请在PLOT_EMPTY_VALUE属性中设置此值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#define INDICATOR_EMPTY_VALUE -1.0

//--- INDICATOR_EMPTY_VALUE (空值) 将不参与计算 
   PlotIndexSetDouble (DRAW_FILLING_creation_index,PLOT_EMPTY_VALUE,INDICATOR_EMPTY_VALUE)；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>不参与指标计算的K线柱的绘制将取决于指标缓冲区的值： • 两个指标缓冲区的值都等于0的柱形，不参与绘制指标。这意味着零值的区域不填充。</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdMAAADDBAMAAAArceaxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAASUExURf///8DAwAAAAMCaP/+lAAAAADtiIhMAAAAGdFJOU///////ALO/pL8AAAAJcEhZcwAADsMAAA7DAcdvqGQAAATcSURBVHja7Z0BcqMwDEU9nMDN7AFoJkfICTLc/0y7SRcaZORvg7BlR3+YUrsK8WvQxxOZxD3l3VqgPYx58era6Rqu16tz/36MrndR1KFf5GHc3regnbnKoirOVUPl2i2jZqrlXAWiKIbahO7TWqT9uG23l31DuWqoPaJOcWWjKtaHoHr35aevP7Htclv3XG7r/sf38yDat5+z2GzJUM2B25BS1DMmnNpRp4N6OyRB0ZKrCyrwEtj2hvpZqNMxVCk7KZGrhtoj6l0YtV9bMlSVqJMw6k6ZLbWIiuI6cmBU8+nIlgy1RwdGNZ8ObclQS6A+bjKoy1D15qqhGmoCqov/vViuXq9XQz0NNXHhXgcODFH7saXUJV4UdRnHTlTvltLwvD2+j5WSL+PPL8Pc79dV3bn/Mq7jl83T/vXzBts9Xgp/KyW34sAPMKvjxlsyV9tDZfdjHoqh/uqgLQWoXh0qdWxDlUClCNVQSdwJuQpR/01wPgr1d86chhrej4NQA/QKqK99Bipz6xH3dxZVS64ilMgJ3BDqfEIL52ouKhrvAdSlf7aps1EZpGRUdxxVyoHJiS6N+jY+Hah8ztZEvQujkouSdK6eiQreUIE5Si9ShloCdQKoyhxYESp8XPuoVEO/DrzIg8cptqW9qJydGWoJ1EkYFT2OQWLR2kEN2vpQ4fVxJ+pwq4d6B6iJx1tEc9ED1Ht8fIaadMLROSm4DvaE6oRRab8DqNN5qLnTdqWoGyXdAZWGmf7lOEzpmStVB/3B8eOl5LC0TfrH31Jy7quamKvcq6g5V1tFDd+8NVQe1Qmj0n56fFIr4h5X0YENtanrKlpy1Z8DS6MuMtQaqE4YlcoB1Amg0oUMvaO+VfcFUWnRsDbqay+Ditb33lKG8qbWbKkN1MzKGbzDoiNURrtRqRxAnfajHrQlQz0N9XETQsVvl1XLVW7hn6HGUNFCuSqoO9AEURmJ5+p8ZTgBVZstzf/681HRvyAbFbxxEqACBy6BujdXOdTM2VILqEcduAFUZs1/C6iM4qihk7Jy5VDRotVc1Fe7ACq+jaIM6iQ+B5ZAFc7VYEFBv7Z0GFVoHyklsyVmv/0h0lwpeb5rmJZ62S3xLua8fr/rVWXEvqoTeFWpuOMe3G8gdIf6stnRUOOohWxJDPXACWyoHaEiFc/VxDslDbUpVDBOCVTluRr5lK4PRk397LIeUB1AdSAe5GLFXIVDN1Q2XjHqzs8ZZONBLlbM1VZQadtQ8fhD5X4n8tm5GjyPoC2dhArFHJdDUOzANVEL52rGp0kmISi2JUNlUZ2XQ2WkJVe3nwfXlHagpqoYamb5rHlU7MBbHCD3cr9/Rkuu0viEoRsqG68ZlZHaXE2cLWVwNIMK5upzXOT7hedSbOrGlpJzN/BEQcn4ifr1Qo3E+/+4azWaqyg+YejJqGSlp6FWRWXUmgMf4DBUPATFqObAhorj73pRGe3NVcHvn4k+T+67I8dCtuMNVQNq47nqEuNThm6obLxiVEZmSzjeUDWgmi0ZqjnwZ9rSyVKAWkoKHLhUW4EtlWobKoyPqMdc3R9SRYYK458yW+oNNeEu42DzeSVm6fjUu6S3SsmMzJaqy1Bh/FPmwB+EqrV9whxYq06wJa0yVBj/1AflqqFqbZsDw/iGlYXq3F8R9y+2JomW4gAAAABJRU5ErkJggg==" alt="DRAW_FILLING示例"></p> <p>• 指标缓冲区的值等于&quot;空值&quot;的K线柱，参与绘制指标。空值区域将被填充，以便连接有重要值的区域。</p> <p><img src="data:image/png;base64,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" alt="DRAW_FILLING示例"></p> <p>应该注意，如果&quot;空值&quot;等于零，不参与指标计算的K线柱也会被填充。</p> <p>DRAW_FILLING样式所需的缓冲区的数量是 2。</p> <p>指标示例：在独立(副图)窗口中以不同周期参数的两个均线之间绘制通道。在移动平均线视觉交叉的颜色变化显示了向上向下趋势的变化。每N 个跳价之后都会随机变化一次颜色。 N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <p><img src="data:image/png;base64,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" alt="DRAW_FILLING示例"></p> <p>请注意，最初DRAW_FILLING样式的 属性 是使用预编译程序指令#property设置的，然后在OnCalculate()函数中对颜色随机设置。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                 DRAW_FILLING.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_FILLING&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a channel between two MAs in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The fill color is changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图交集 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Intersection&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_FILLING </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      Fast<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">;</span>          <span class="token comment">// 快速MA的周期 </span>
input <span class="token keyword">int</span>      Slow<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">;</span>          <span class="token comment">// 慢速MA的周期 </span>
input <span class="token keyword">int</span>      shift<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>          <span class="token comment">// 向未来的MAs转移（正值） </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变订单号数量  </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         IntersectionBuffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         IntersectionBuffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">int</span> fast_handle<span class="token punctuation">;</span> 
<span class="token keyword">int</span> slow_handle<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组0到5的 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrAquamarine<span class="token punctuation">,</span>clrBlanchedAlmond<span class="token punctuation">,</span>clrBrown<span class="token punctuation">,</span>clrCoral<span class="token punctuation">,</span>clrDarkSlateGray<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>IntersectionBuffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>IntersectionBuffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_SHIFT<span class="token punctuation">,</span>shift<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   fast_handle<span class="token operator">=</span><span class="token function">iMA</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span>Fast<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>MODE_SMA<span class="token punctuation">,</span>PRICE_CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   slow_handle<span class="token operator">=</span><span class="token function">iMA</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span>Slow<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>MODE_SMA<span class="token punctuation">,</span>PRICE_CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 指标的第一次计算，或数据变化，需要一次完全重新计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 复制所有指标值至相应的缓冲区 </span>
      <span class="token keyword">int</span> copied1<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>fast_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span>IntersectionBuffer1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">int</span> copied2<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>slow_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span>IntersectionBuffer2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> <span class="token comment">// 仅填充那些更新的数据 </span>
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得OnCalculate()当前和之前启动之间的柱形不同 </span>
      <span class="token keyword">int</span> to_copy<span class="token operator">=</span>rates_total<span class="token operator">-</span>prev_calculated<span class="token punctuation">;</span> 
      <span class="token comment">//--- 如果没有不同，我们仍然会复制一个值 - 在零柱 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>to_copy<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> to_copy<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 复制_copy 值到指标缓冲区的最末端 </span>
      <span class="token keyword">int</span> copied1<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>fast_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>to_copy<span class="token punctuation">,</span>IntersectionBuffer1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">int</span> copied2<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>slow_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>to_copy<span class="token punctuation">,</span>IntersectionBuffer2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变通道填充颜色                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index1<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置第一个颜色为PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下第一个颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nColor1 &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index1<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
   <span class="token keyword">int</span> color_index2<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置第二个颜色为PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---写下第二个颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nColor2 &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index2<span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br></div></div><h3 id="_24-1-9-draw-bars"><a href="#_24-1-9-draw-bars" class="header-anchor">#</a> 24.1.9 DRAW_BARS</h3> <p>DRAW_BARS 样式根据四个指标缓冲区的值来绘制美式棒线图，包括开盘价，最高价，最低价和收盘价。它用于创建自定义指标的美式棒线图，可以应用在单独的图表(副图)子窗口中 或/和 其它 金融工具(交易品种) 的主图表上(即叠加K线图表)。</p> <p>美式棒线图的颜色设置可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便美式棒线图的外观根据当前情况而改变。</p> <p>该指标仅绘制那些设置了所有四个指标缓冲区的非空值的K线柱(意即 开盘价，最高价，最低价和收盘价都要有确定的值)。要指定应将哪个值视为“空”，请在PLOT_EMPTY_VALUE属性中设置此值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_BARS,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终需要明确的填写指标缓冲区的值，在缓冲区中设置空值以跳过相对应的K线柱。</p> <p>DRAW_BARS样式所需的缓冲区的数量是4。该样式的所有缓冲区都应该按照给定的顺序一个接一个地进行：即开盘价，最高价，最低价和收盘价。缓冲区不会只包含空值，因为在这种情况下，不会绘制任何图形。</p> <p>指标示例：在单独(副图)窗口中的为选定的金融工具(交易品种)绘制美式棒线图。美式棒线图的颜色每 N个跳价之后都会随机变化一次。N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <p><img src="data:image/png;base64,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" alt="DRAW_BARS示例"></p> <p>请注意，最初DRAW_BARS样式的 属性 是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中对颜色随机设置。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                    DRAW_BARS.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_BARS&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws bars of a selected symbol in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color and width of bars, as well as the symbol are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">4</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图柱形 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Bars&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_BARS </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrGreen </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变类型的订单号数量 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span>         <span class="token comment">// 显示的柱形数量 </span>
input <span class="token keyword">bool</span>     messages<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// 在&quot;EA交易&quot;日志显示信息 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         BarsBuffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         BarsBuffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         BarsBuffer3<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         BarsBuffer4<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 交易品种名称 </span>
string symbol<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组0到5的 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrPurple<span class="token punctuation">,</span>clrBrown<span class="token punctuation">,</span>clrIndianRed<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 如果柱形非常小 - 提前完成工作 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars<span class="token operator">&lt;</span><span class="token number">50</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Comment</span><span class="token punctuation">(</span><span class="token string">&quot;Please specify a larger number of bars! The operation of the indicator has been terminated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>BarsBuffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>BarsBuffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>BarsBuffer3<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>BarsBuffer4<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 绘制柱形的交易品种名称 </span>
   symbol<span class="token operator">=</span>_Symbol<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置交易品种的展示 </span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>symbol<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;DRAW_BARS(&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 空值 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 选择来自市场报价窗口的新交易品种 </span>
      symbol<span class="token operator">=</span><span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
      <span class="token keyword">int</span> tries<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 试图5 次填充缓冲区的交易品种价格 </span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>symbol<span class="token punctuation">,</span>rates_total<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> tries<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- CopyFromSymbolToBuffers() 函数调用的计数器 </span>
         tries<span class="token operator">++</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填充指标缓冲区的价格                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span><span class="token keyword">int</span> total<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在rates[] 数组中，我们将复制开盘价，最高价，最低价和收盘价 </span>
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 尝试计数器 </span>
   <span class="token keyword">int</span> attempts<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 已复制多少 </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 试图25次获得所需交易品种的时间帧 </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>attempts<span class="token operator">&lt;</span><span class="token number">25</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>copied<span class="token operator">=</span><span class="token function">CopyRates</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bars<span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      attempts<span class="token operator">++</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s CopyRates(%s) attempts=%d&quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span>name<span class="token punctuation">,</span>attempts<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果复制足够数量的柱形失败 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">!=</span>bars<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 形成信息字符串 </span>
      string comm<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;For the symbol %s, managed to receive only %d bars of %d requested ones&quot;</span><span class="token punctuation">,</span> 
                               name<span class="token punctuation">,</span> 
                               copied<span class="token punctuation">,</span> 
                               bars 
                               <span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在主图表窗口的注释中显示信息 </span>
      <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 显示信息 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 设置交易品种的展示 </span>
      <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>name<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;DRAW_BARS(&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 初始化空值缓冲区 </span>
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>BarsBuffer1<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>BarsBuffer2<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>BarsBuffer3<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>BarsBuffer4<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token comment">//--- 复制缓冲区的价格 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>copied<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算缓冲区相应的标引 </span>
      <span class="token keyword">int</span> buffer_index<span class="token operator">=</span>total<span class="token operator">-</span>copied<span class="token operator">+</span>i<span class="token punctuation">;</span> 
      <span class="token comment">//--- 写下缓冲区的价格 </span>
      BarsBuffer1<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">;</span> 
      BarsBuffer2<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">;</span> 
      BarsBuffer3<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">;</span> 
      BarsBuffer4<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 随机返回来自市场报价的交易品种                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
string <span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 市场报价窗口中显示的交易品种数量 </span>
   <span class="token keyword">int</span> symbols<span class="token operator">=</span><span class="token function">SymbolsTotal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 列表中的交易品种位置 - 从0到交易品种的随机号 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>symbols<span class="token punctuation">;</span> 
<span class="token comment">//--- 返回指定位置的交易品种名称 </span>
   <span class="token keyword">return</span> <span class="token function">SymbolName</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变柱形的外观                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成柱形属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//---改变柱形颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变柱形宽度的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 写下交易品种名称 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span>comm<span class="token punctuation">;</span> 
  
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br></div></div><h3 id="_24-1-10-draw-candles"><a href="#_24-1-10-draw-candles" class="header-anchor">#</a> 24.1.10 DRAW_CANDLES</h3> <p>DRAW_CANDLES 样式根据四个指标缓冲区的值来绘制日式K线图，包括开盘价，最高价，最低价和收盘价。它用于创建自定义指标的日式K线图，可以应用在单独的图表(副图)子窗口中 或/和 其它 金融工具(交易品种) 的主图表上(即叠加K线图表)。</p> <p>日式K线图的颜色设置可以使用预编译器指令进行设置，并使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便日式K线图的外观根据当前情况而改变。</p> <p>该指标仅绘制那些设置了所有四个指标缓冲区的非空值的K线柱(意即 开盘价，最高价，最低价和收盘价都要有确定的值)。要指定应将哪个值视为“空”，请在PLOT_EMPTY_VALUE属性中设置此值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_CANDLES,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终需要明确的填写指标缓冲区的值，在缓冲区中设置空值以跳过相对应的K线柱。</p> <p>DRAW_CANDLES样式所需的缓冲区的数量是4。该样式的所有缓冲区都应该按照给定的顺序一个接一个地进行：即开盘价，最高价，最低价和收盘价。缓冲区不会只包含空值，因为在这种情况下，不会绘制任何图形。</p> <p>您可以为DRAW_CANDLES 样式设置三种颜色来影响蜡烛图的视觉效果。如果只设置一种颜色，那么它将会应用于图表上的所有蜡烛图。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 将单一颜色的相同蜡烛图应用于它们 
#property indicator_label1  &quot;One color candles&quot; 
#property indicator_type1   DRAW_CANDLES 
//--- 仅指定一种颜色，因此所有蜡烛图都是相同颜色 
#property indicator_color1  clrGreen  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果用逗号分隔指定两种颜色，那么第一种颜色会被应用于蜡烛图外框，而第二种颜色则应用于蜡烛实体。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 不同颜色的蜡烛图和烛芯 
#property indicator_label1  &quot;Two color candles&quot; 
#property indicator_type1   DRAW_CANDLES 
//--- 绿色应用于烛芯和外框，而白色应用于主体 
#property indicator_color1  clrGreen,clrWhite 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果用逗号分隔指定三种颜色，那么 上升 和 下降 的蜡烛图可以显示不同的颜色。在这种情况下，第一种颜色应用于蜡烛图的外框，而第二种和第三种颜色 —— 应用于牛市蜡烛(阳烛)图 和 熊市蜡烛(阴烛)图。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 不同颜色的蜡烛图和烛芯 
#property indicator_label1  &quot;One color candles&quot; 
#property indicator_type1   DRAW_CANDLES 
//--- 烛芯和外框是绿色，牛市蜡烛图的主体是白色，而熊市蜡烛图的主体是红色 
#property indicator_color1  clrGreen,clrWhite,clrRed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>因此，DRAW_CANDLES 样式允许您创建定制的颜色选项的蜡烛图。除此之外，在使用PlotIndexSetInteger函数进行指标操作期间还可以更改所有颜色(composition_index_DRAW_CANDLES, PLOT_LINE_COLOR, modifier_index, color)，在这里 modifier_index 可能是以下的值：
• 0 —— 外框和实体的颜色
• 1 —— 牛市蜡烛图实体颜色
• 2 —— 熊市蜡烛图实体颜色</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 设置外框和烛芯的颜色 
PlotIndexSetInteger(0,PLOT_LINE_COLOR,0,clrBlue); 
//--- 设置牛市蜡烛图主体颜色 
PlotIndexSetInteger(0,PLOT_LINE_COLOR,1,clrGreen); 
//--- 设置熊市蜡烛图主体颜色 
PlotIndexSetInteger(0,PLOT_LINE_COLOR,2,clrRed);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>指标示例：在单独(副图)窗口中，为选定的 金融工具(交易品种) 绘制日式蜡烛图。蜡烛图颜色每N 个跳价之后都会随机变化一次。N参数设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <p><img src="data:image/png;base64,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" alt="DRAW_CANDLES示例"></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                 DRAW_CANDLES.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_CANDLES.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws candlesticks of a selected symbol in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot; &quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color and width of candlesticks, as well as the symbol are changed&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;randomly every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">4</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图柱形 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;DRAW_CANDLES1&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_CANDLES </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrGreen </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
  
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变类型的订单号数量 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span>         <span class="token comment">// 显示的柱形数量 </span>
input <span class="token keyword">bool</span>     messages<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// 在&quot;EA交易&quot;日志显示信息 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         Candle1Buffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         Candle1Buffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         Candle1Buffer3<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         Candle1Buffer4<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 交易品种名称 </span>
string symbol<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组0到5的 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrPurple<span class="token punctuation">,</span>clrBrown<span class="token punctuation">,</span>clrIndianRed<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 如果柱形非常小 - 提前完成工作 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars<span class="token operator">&lt;</span><span class="token number">50</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Comment</span><span class="token punctuation">(</span><span class="token string">&quot;Please specify a larger number of bars! The operation of the indicator has been terminated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Candle1Buffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Candle1Buffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>Candle1Buffer3<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>Candle1Buffer4<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 空值 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 绘制柱形的交易品种名称 </span>
   symbol<span class="token operator">=</span>_Symbol<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置交易品种的展示 </span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>symbol<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;DRAW_CANDLES(&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span>INT_MAX<span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 选择来自市场报价窗口的新交易品种 </span>
      symbol<span class="token operator">=</span><span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变格式 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 选择来自市场报价窗口的新交易品种 </span>
      <span class="token keyword">int</span> tries<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 试图5 次填充缓冲区plot1的交易品种价格 </span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>symbol<span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> 
            Candle1Buffer1<span class="token punctuation">,</span>Candle1Buffer2<span class="token punctuation">,</span>Candle1Buffer3<span class="token punctuation">,</span>Candle1Buffer4<span class="token punctuation">)</span> 
            <span class="token operator">&amp;&amp;</span> tries<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- CopyFromSymbolToBuffers() 函数调用的计数器 </span>
         tries<span class="token operator">++</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填充指定蜡烛图                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> 
                             <span class="token keyword">int</span> total<span class="token punctuation">,</span> 
                             <span class="token keyword">int</span> plot_index<span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff3<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff4<span class="token punctuation">[</span><span class="token punctuation">]</span> 
                             <span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在rates[] 数组中，我们将复制开盘价，最高价，最低价和收盘价 </span>
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 尝试计数器 </span>
   <span class="token keyword">int</span> attempts<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 已复制多少 </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 试图25次获得所需交易品种的时间帧 </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>attempts<span class="token operator">&lt;</span><span class="token number">25</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>copied<span class="token operator">=</span><span class="token function">CopyRates</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bars<span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      attempts<span class="token operator">++</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s CopyRates(%s) attempts=%d&quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span>name<span class="token punctuation">,</span>attempts<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果复制足够数量的柱形失败 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">!=</span>bars<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 形成信息字符串 </span>
      string comm<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;For the symbol %s, managed to receive only %d bars of %d requested ones&quot;</span><span class="token punctuation">,</span> 
                               name<span class="token punctuation">,</span> 
                               copied<span class="token punctuation">,</span> 
                               bars 
                               <span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在主图表窗口的注释中显示信息 </span>
      <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 显示信息 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 设置交易品种的展示 </span>
      <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span>plot_index<span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>name<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 初始化空值缓冲区 </span>
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff1<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff2<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff3<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff4<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 在每个订单号上复制缓冲区价格 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>copied<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算缓冲区相应的标引 </span>
      <span class="token keyword">int</span> buffer_index<span class="token operator">=</span>total<span class="token operator">-</span>copied<span class="token operator">+</span>i<span class="token punctuation">;</span> 
      <span class="token comment">//--- 写下缓冲区的价格 </span>
      buff1<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">;</span> 
      buff2<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">;</span> 
      buff3<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">;</span> 
      buff4<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 随机返回来自市场报价的交易品种                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
string <span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 市场报价窗口中显示的交易品种数量 </span>
   <span class="token keyword">int</span> symbols<span class="token operator">=</span><span class="token function">SymbolsTotal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 列表中的交易品种位置 - 从0到交易品种的随机号 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>symbols<span class="token punctuation">;</span> 
<span class="token comment">//--- 返回指定位置的交易品种名称 </span>
   <span class="token keyword">return</span> <span class="token function">SymbolName</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变柱形的外观                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成柱形属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//---改变柱形颜色的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得随机数 </span>
<span class="token comment">//--- 除数等于colors[]数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新颜色作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> color_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下颜色 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>colors<span class="token punctuation">[</span>color_index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下交易品种名称 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br></div></div><h3 id="_24-1-11-draw-color-line"><a href="#_24-1-11-draw-color-line" class="header-anchor">#</a> 24.1.11 DRAW_COLOR_LINE</h3> <p>样式DRAW_COLOR_LINE 其实是DRAW_LINE 样式的彩色变体；它也使用指标缓冲区的值绘制直线。但是该样式，如标识符中带有COLOR单词的所有彩色样式一样，还有一个额外的特殊的指标缓冲区，用于存储来自特定颜色数组的颜色索引编号(数字)。因此，在K线图表上绘制直线时，可以通过指定颜色索引号来定义每个线段的颜色。</p> <p>直线的宽度，线型和颜色可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>标图DRAW_COLOR_LINE 所需的缓冲区数量是 2。
• 一个缓冲区用于存储绘制直线的指标值；
• 一个缓冲区用于存储对应每根K线柱的直线的颜色索引编号。</p> <p>颜色可以通过预编译程序指令 #property indicator_color1指定，以逗号分隔。颜色数量不能超过64种。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 定义5种用于填充每个柱形的颜色(它们存储在指定数组) 
#property indicator_color1  clrRed,clrBlue,clrGreen,clrOrange,clrDeepPink // (最多64种颜色)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>指标示例：使用K线柱收盘价绘制直线。直线的 宽度 和 线型 每N=5跳价之后都会随机变化一次。</p> <p><img src="data:image/png;base64,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" alt="DRAW_COLOR_LINE示例"></p> <p>线段颜色在自定义函数ChangeColors()也会随机变化。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变线段颜色                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色索引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;LineColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>该示例显示了指标&quot;彩色(color)&quot;版的特点 —— 想要改变线段的颜色，您无需改变ColorLineColors[]缓冲区的值(其中包含颜色索引)。您所需要做的只是在一个特定的数组中设置新的颜色。这使您可以快速的更改整个样式的颜色，使用PlotIndexSetInteger()函数只能更改一小段颜色。</p> <p>请注意，最初DRAW_COLOR_LIN样式的 属性 是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中对这三种属性随机设置。</p> <p>参数 N 和 Length (Length表示线段的长度对应几根K线柱，N 表示几次跳价之后改变一次颜色)设置为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                              DRAW_COLOR_LINE.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_LINE&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a line on Close price in colored pieces of 20 bars each&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The width, style and color of the line parts are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图 ColorLine </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorLine&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_LINE </span></span>
<span class="token comment">//--- 定义5种用于填充每个柱形的颜色（它们存储在指定数组） </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrOrange<span class="token punctuation">,</span>clrDeepPink </span><span class="token comment">// (Up to 64 colors can be specified) </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>           <span class="token comment">// 改变订单号数量  </span>
input <span class="token keyword">int</span>      Length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>     <span class="token comment">// 柱形每个颜色部分的长度 </span>
<span class="token keyword">int</span>            line_colors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 设置颜色数量是 5 - 见 #property indicator_color1 </span>
<span class="token comment">//--- 标图缓冲区 </span>
<span class="token keyword">double</span>         ColorLineBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储每柱线型颜色的缓冲区 </span>
<span class="token keyword">double</span>         ColorLineColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 存储颜色的数组包含7种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 绑定数组和指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorLineBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorLineColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 初始化随机数生成器 </span>
   <span class="token function">MathSrand</span><span class="token punctuation">(</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变线型部分的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值的模块 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 指标值写入缓冲区 </span>
      ColorLineBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 现在，为该柱随机设置颜色标引 </span>
      <span class="token keyword">int</span> color_index<span class="token operator">=</span>i<span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      color_index<span class="token operator">=</span>color_index<span class="token operator">/</span>Length<span class="token punctuation">;</span> 
      <span class="token comment">//--- 对于该柱，线型将具有color_index标引的颜色 </span>
      ColorLineColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>color_index<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变线段颜色                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;LineColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型显示外观                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot; Width=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, &quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br></div></div><h3 id="_24-1-12-draw-color-section"><a href="#_24-1-12-draw-color-section" class="header-anchor">#</a> 24.1.12 DRAW_COLOR_SECTION</h3> <p>样式DRAW_COLOR_SECTION是 DRAW_SECTION样式的彩色版，但与后者又不太相同，它允许绘制不同颜色的线段。DRAW_COLOR_SECTION样式， 如标识符中带有COLOR单词的所有彩色样式一样，还有一个额外的特殊的指标缓冲区，用于存储来自特定颜色数组的颜色索引编号(数字)。因此，可以通过指定对应于 线段结尾 的K线柱的索引号，和 颜色索引号 来定义每个线段的颜色。</p> <p>线段的宽度，颜色和线型的指定类似 DRAW_SECTION 样式 —— 可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>绘制线段是从一个缓冲区的非空值 到 另一个指标缓冲区的非空值 ，忽略空值。若要指定哪个值应被视为“空”，请在 PLOT_EMPTY_VALUE 属性设定该值。例：如果指标应该为非零值绘制一系列的线段，那么您需要设置 零 值为 “空” 值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_SECTION,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终需要明确的填写指标缓冲区的值，在缓冲区中给不应绘制的元素设置一个 空 值。</p> <p>样式 DRAW_COLOR_SECTION 所需的缓冲区的数量是2。
• 一个缓冲区用于存储绘制线段的指标值；
• 一个缓冲区用于存储颜色索引，它被用于绘制线段(它使得仅设置非空值有意义)。</p> <p>颜色可以通过预编译程序指令 #property indicator_color1指定，以逗号分隔。颜色数量不能超过64种。</p> <p>指标示例：取 最高价 的值，每5根K线柱绘制一根字段。线段的颜色，宽度和样式每N 次跳价之后都会随机变化一次。</p> <p><img src="data:image/png;base64,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" alt=" DRAW_COLOR_SECTION 示例"></p> <p>请注意，最初DRAW_COLOR_SECTION样式的 属性 中，定义了8种颜色，这时是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中，颜色 是从数组colors[] 中随机设置的。</p> <p>参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                           DRAW_COLOR_SECTION.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_SECTION&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws colored sections with the length equal to the specified number of bars&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, width and style of sections are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图ColorSection </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorSection&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_SECTION </span></span>
<span class="token comment">//--- 定义8 种用于填充节段的颜色(它们存储在指定数组) </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrGold<span class="token punctuation">,</span>clrMediumBlue<span class="token punctuation">,</span>clrLime<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrBrown<span class="token punctuation">,</span>clrTan<span class="token punctuation">,</span>clrMediumVioletRed </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>                      <span class="token comment">// 改变订单号数量  </span>
input <span class="token keyword">int</span>      bars_in_section<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>        <span class="token comment">// 柱形节段的长度 </span>
<span class="token comment">//--- 计算节段终端的辅助变量 </span>
<span class="token keyword">int</span>            divider<span class="token punctuation">;</span> 
<span class="token keyword">int</span>            color_sections<span class="token punctuation">;</span> 
<span class="token comment">//--- 标图缓冲区 </span>
<span class="token keyword">double</span>         ColorSectionBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储每柱线型颜色的缓冲区 </span>
<span class="token keyword">double</span>         ColorSectionColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrWhiteSmoke<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorSectionBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorSectionColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 0(空)值将不参与绘制 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---- 为节段填充颜色的颜色数量 </span>
   <span class="token keyword">int</span> color_sections<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">// 请见注释#property indicator_color1 </span>
<span class="token comment">//--- 检查指标参数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars_in_section<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid section length=%d&quot;</span><span class="token punctuation">,</span>bars_in_section<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> divider<span class="token operator">=</span>color_sections<span class="token operator">*</span>bars_in_section<span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变用于标图节段的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>color_sections<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 指标值计算开始的柱形数 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果之前计算了指标，那么在前一柱开始设置 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 这是指标值的全部计算 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 如果柱数可被section_length整除，它意味着这是节段的终点 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span>bars_in_section<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 在该柱最高价设置节段终点 </span>
         ColorSectionBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 柱数除以 section_length*number_of_colors的余数 </span>
         <span class="token keyword">int</span> rest<span class="token operator">=</span>i<span class="token operator">%</span>divider<span class="token punctuation">;</span> 
         <span class="token comment">//获得颜色数 =  从 0 到 number_of_colors-1 </span>
         <span class="token keyword">int</span> color_indext<span class="token operator">=</span>rest<span class="token operator">/</span>bars_in_section<span class="token punctuation">;</span> 
         ColorSectionColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>color_indext<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//---如果除法的余数等于柱数， </span>
      <span class="token keyword">else</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 如果什么也没发生，忽略柱形 - 设置0 </span>
         <span class="token keyword">else</span> ColorSectionBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变线段颜色                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;SectionColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型显示外观                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot; Width=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, &quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br></div></div><h3 id="_24-1-13-draw-color-histogram"><a href="#_24-1-13-draw-color-histogram" class="header-anchor">#</a> 24.1.13 DRAW_COLOR_HISTOGRAM</h3> <p>DRAW_COLOR_HISTOGRAM样式 根据 从0 到 指定值 绘制一个彩色的柱状线。指定值 来自 指标缓冲区。每根柱状线都有其来自预设定颜色的自己的颜色。</p> <p>柱状线的宽度，颜色和线型的设置类似 DRAW_HISTOGRAM 样式 —— 可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>由于每根柱状线都是从0开始水平绘制，因此DRAW_COLOR_HISTOGRAM 应该更好的应用在单独的图表(副图)窗口中。大多数情况下，这种 绘制样式 用于创建oscillator类型的指标，例如，Awesome Oscillator 或 Market Facilitation Index。对于不需要显示的空值，应指定 零 值。</p> <p>样式DRAW_COLOR_HISTOGRAM 所需的缓冲区的数量是2。
• 一个缓冲区用于存储对应每根柱状线垂直方向上的长度，应该为非0值。柱状线的另一端应该始终为 0；
• 一个缓冲区存储颜色索引，它被用于绘制线段(它使得仅设置非空值有意义)。</p> <p>颜色可以通过预编译程序指令 #property indicator_color1指定，以逗号分隔。颜色数量不能超过64种。</p> <p>指标示例：基于MathSin()绘制指定颜色的正弦曲线。所有柱状线的颜色，宽度和线型在每 N个跳价之后都会随机变化一次。参数bar指定正弦曲线的周期，经过了bar指定的K线柱数量之后，正弦曲线将重复这个循环。</p> <p><img src="data:image/png;base64,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" alt="DRAW_COLOR_HISTOGRAM示例"></p> <p>请注意，最初DRAW_COLOR_HISTOGRAM样式的 属性 中，定义了8种颜色，这时是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中，颜色 是从数组colors[] 中的14种颜色中随机设置的。参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                         DRAW_COLOR_HISTOGRAM.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_HISTOGRAM&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a sinusoid as a histogram in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color and width of columns are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The bars parameter sets the number of bars to repeat the sinusoid&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>          <span class="token comment">// 柱形的正弦曲线周期 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变直方图的订单号数量 </span>
<span class="token comment">//--- 标图 Color_Histogram </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Color_Histogram&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_HISTOGRAM </span></span>
<span class="token comment">//--- 定义8 种用于填充节段的颜色(它们存储在指定数组) </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrYellow<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumSeaGreen<span class="token punctuation">,</span>clrGold </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 缓冲区的值 </span>
<span class="token keyword">double</span>         Color_HistogramBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 颜色标引缓冲区 </span>
<span class="token keyword">double</span>         Color_HistogramColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得2Pi角弧度的因素，当乘以柱的参数时 </span>
<span class="token keyword">double</span>         multiplier<span class="token punctuation">;</span> 
<span class="token keyword">int</span>            color_sections<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrWhiteSmoke<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Color_HistogramBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Color_HistogramColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---- 为正弦曲线填充颜色的颜色数量 </span>
   color_sections<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">//  请见注释#property indicator_color1    </span>
<span class="token comment">//--- 计算乘数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>multiplier<span class="token operator">=</span><span class="token number">2.</span><span class="token operator">*</span>M_PI<span class="token operator">/</span>bars<span class="token punctuation">;</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Set the value of bars=%d greater than 1&quot;</span><span class="token punctuation">,</span>bars<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 提前终止指标 </span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span>    
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变直方图的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>color_sections<span class="token punctuation">)</span><span class="token punctuation">;</span>       
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//---如果之前OnCalculate开始期间已经计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 在倒数第二柱设置计算起点 </span>
<span class="token comment">//--- 填写指标缓冲区的值 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 价值 </span>
      Color_HistogramBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span>i<span class="token operator">*</span>multiplier<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 颜色 </span>
      <span class="token keyword">int</span> color_index<span class="token operator">=</span>i<span class="token operator">%</span><span class="token punctuation">(</span>bars<span class="token operator">*</span>color_sections<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      color_index<span class="token operator">/=</span>bars<span class="token punctuation">;</span> 
      Color_HistogramColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>color_index<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变线段颜色                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistogramColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型显示外观                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot; Width=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, &quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br></div></div><h3 id="_24-1-14-draw-color-histogram2"><a href="#_24-1-14-draw-color-histogram2" class="header-anchor">#</a> 24.1.14 DRAW_COLOR_HISTOGRAM2</h3> <p>DRAW_HISTOGRAM2 样式根据 两个指标缓冲区的值绘制一根彩色的垂直的柱状线。但与单色DRAW_HISTOGRAM2不同，在该样式中每一根柱状线都有其来自预定义设置的颜色。所有线段值都从指标缓冲区获得。</p> <p>柱状线的宽度，线型和颜色的指定类似 DRAW_HISTOGRAM2 样式 —— 可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>DRAW_COLOR_HISTOGRAM2 样式可以被用在单独的图表子窗口(副图窗口) 和 主窗口中。由于不绘制 空 值，因此指标缓冲区的所有值都需要明确的设定。缓冲区不通过空值初始化。</p> <p>样式DRAW_COLOR_HISTOGRAM2 所需的缓冲区的数量是 3个：
• 对应每根K线柱，存储垂直柱状线段的上下端，需要两个缓冲区；
• 一个缓冲区用于存储颜色索引，它被用于绘制线段(它使得仅设置非空值有意义)。</p> <p>指标示例：在 最高价 和 最低价 之间绘制指定颜色的柱状线。对于每个交易日，柱状线都有不同的颜色。柱状线每日颜色，宽度和线型每 N 个跳价之后都会随机变化一次。</p> <p><img src="data:image/png;base64,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" alt="DRAW_COLOR_HISTOGRAM2示例"></p> <p>请注意，最初DRAW_COLOR_HISTOGRAM2样式的 属性 中，定义了5种颜色，这时是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中，颜色 是从数组colors[] 中的14种颜色中随机设置的。</p> <p>参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                        DRAW_COLOR_HISTOGRAM2.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_HISTOGRAM2&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a segment between Open and Close on each bar&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, width and style are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;after every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">3</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图ColorHistogram_2 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorHistogram_2&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_HISTOGRAM2 </span></span>
<span class="token comment">//--- 定义 5 种颜色用于为基于工作日的直方图填充颜色（它们存储在指定数组） </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrYellow<span class="token punctuation">,</span>clrMagenta </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
  
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变直方图的订单号数量 </span>
<span class="token keyword">int</span>            color_sections<span class="token punctuation">;</span> 
<span class="token comment">//--- 缓冲区值 </span>
<span class="token keyword">double</span>         ColorHistogram_2Buffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorHistogram_2Buffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 颜色标引缓冲区 </span>
<span class="token keyword">double</span>         ColorHistogram_2Colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrWhiteSmoke<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorHistogram_2Buffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorHistogram_2Buffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ColorHistogram_2Colors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置空值 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---- 为正弦曲线填充颜色的颜色数量 </span>
   color_sections<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">// 请见注释#property indicator_color1 </span>
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变用于绘制直方图的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>color_sections<span class="token punctuation">)</span><span class="token punctuation">;</span>       
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 通过每柱的开盘价获得工作日 </span>
   MqlDateTime dt<span class="token punctuation">;</span> 
<span class="token comment">//---如果之前OnCalculate开始期间已经计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 在倒数第二柱设置计算起点 </span>
<span class="token comment">//--- 填写指标缓冲区的值 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">TimeToStruct</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 价值 </span>
      ColorHistogram_2Buffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      ColorHistogram_2Buffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 根据工作日设置颜色标引 </span>
      <span class="token keyword">int</span> day<span class="token operator">=</span>dt<span class="token punctuation">.</span>day_of_week<span class="token punctuation">;</span> 
      ColorHistogram_2Colors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>day<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变线段颜色                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistogramColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型显示外观                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot; Width=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, &quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br></div></div><h3 id="_24-1-15-draw-color-arrow"><a href="#_24-1-15-draw-color-arrow" class="header-anchor">#</a> 24.1.15 DRAW_COLOR_ARROW</h3> <p>DRAW_COLOR_ARROW 样式根据指标缓冲区的值绘制彩色箭头( Wingdings字库中的符号)。 与DRAW_ARROW不同的是，在此样式中，可以通过indicator_color1属性为每个符号指定的预定义颜色集来设置颜色。</p> <p>符号的宽度和颜色的设置类似 DRAW_ARROW 样式 —— 可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>符号使用PLOT_ARROW 属性进行设置。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 定义PLOT_ARROW绘制的来自Wingdings字体的符号代码到 
   PlotIndexSetInteger(0,PLOT_ARROW,code);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>PLOT_ARROW的默认值=159 (一个圆圈)。</p> <p>每个箭头实际上都是一个有 高度 和 定位锚点 的符号，可以包含图表上的一些重要信息(例如，柱形的收盘价)。因此，我们可以额外指定像素的垂直偏移距离，这并不依赖图表的比例。箭头沿着指定的像素数量将向下移动一段距离，同时指标的值会保持不变：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 设置箭头的像素垂直移动 
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,shift);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>PLOT_ARROW_SHIFT的负值意味着箭头向上楄移距离，正值表示箭头向下偏移距离。</p> <p>DRAW_COLOR_ARROW 样式可以被用在单独的图表子窗口(副图) 和 主窗口 中。由于不绘制空值并且也不会出现在&quot;数据窗口&quot;，指标缓冲区的所有值都应该明确设定。缓冲区不通过零值初始化。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- Set an empty value 
   PlotIndexSetDouble(DRAW_COLOR_ARROW_plot_index,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>样式DRAW_COLOR_ARROW所需的缓冲区的数量是2。
• 一个缓冲区存储价格值，它被用于绘制符号(PLOT_ARROW_SHIFT属性表示偏移距离，单位:像素)；
• 一个缓冲区存储颜色索引，它被用于绘制箭头(它使得仅设置非空值有意义)。</p> <p>指标示例：如果当前K线柱的收盘价 大于 前一根K线柱的收盘价，则在当前K线 收盘价 的位置绘制一个箭头。所有箭头的宽度，偏移距离 和 符号代码在每 N 个跳价之后都会随机变化一次。符号的颜色取决于绘制它的K线柱数。</p> <p><img src="/mql5yao/assets/img/e19.381bf9b2.png" alt="DRAW_COLOR_ARROW示例"></p> <p>在示例中，对于DRAW_COLOR_ARROW的样式属性，颜色和大小是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数随机设置属性。参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <p>请注意，最初DRAW_COLOR_ARROW样式的 属性 中，定义了8种颜色，这时是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中，颜色 是从数组colors[] 中的14种颜色中随机设置的。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                             DRAW_COLOR_ARROW.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_ARROW&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Draws different-color arrows set by Unicode characters, on a chart&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, size, shift and symbol code of the arrow are changed&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot; randomly every N ticks&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The code parameter sets the base value: code=159 (a circle)&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图ColorArrow </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorArrow&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_ARROW </span></span>
<span class="token comment">//--- 定义 8 种颜色用于为基于工作日的直方图填充颜色（它们存储在指定数组） </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrSeaGreen<span class="token punctuation">,</span>clrGold<span class="token punctuation">,</span>clrDarkOrange<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrYellowGreen<span class="token punctuation">,</span>clrChocolate </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
  
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>         <span class="token comment">// 改变订单号数量 </span>
input ushort   code<span class="token operator">=</span><span class="token number">159</span><span class="token punctuation">;</span>    <span class="token comment">// 在DRAW_ARROW绘制的符号代码 </span>
<span class="token keyword">int</span>            color_sections<span class="token punctuation">;</span> 
<span class="token comment">//--- 标图的指标缓冲区 </span>
<span class="token keyword">double</span>         ColorArrowBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色标引的缓冲区 </span>
<span class="token keyword">double</span>         ColorArrowColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrWhiteSmoke<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorArrowBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorArrowColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 定义PLOT_ARROW绘制的符号代码 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置箭头的像素垂直移动 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW_SHIFT<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置空值为 0 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token comment">//---- 为正弦曲线填充颜色的颜色数量 </span>
   color_sections<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">//  请见注释#property indicator_color1  </span>
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变颜色，大小，移动和箭头的代码 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果订单号的临界值被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变箭头属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变用于绘制直方图的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>color_sections<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 计算指标值的模块 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算循环 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 如果当前收盘价高于之前的价格，请绘制一个箭头 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>close<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
         ColorArrowBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 否则指定null 值 </span>
      <span class="token keyword">else</span> 
         ColorArrowBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 箭头颜色 </span>
      <span class="token keyword">int</span> index<span class="token operator">=</span>i<span class="token operator">%</span>color_sections<span class="token punctuation">;</span> 
      ColorArrowColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>index<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变线段颜色                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;ArrowColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变指标的线型显示外观                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成线型属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot; Width=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
<span class="token comment">//--- 改变箭头代码 (PLOT_ARROW)的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法的余数来计算新的箭头代码（从0到19） </span>
   <span class="token keyword">int</span> code_add<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置新的符号代码作为ode+code_add的结果 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span>code<span class="token operator">+</span>code_add<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下符号代码 PLOT_ARROW </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token string">&quot;PLOT_ARROW=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>code<span class="token operator">+</span>code_add<span class="token punctuation">)</span><span class="token operator">+</span>comm<span class="token punctuation">;</span>    
  
<span class="token comment">//--- 改变箭头的像素垂直移动的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的移动 </span>
   <span class="token keyword">int</span> shift<span class="token operator">=</span><span class="token number">20</span><span class="token operator">-</span>number<span class="token operator">%</span><span class="token number">41</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置新移动自 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW_SHIFT<span class="token punctuation">,</span>shift<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下PLOT_ARROW_SHIFT移动 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token string">&quot;PLOT_ARROW_SHIFT=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>shift<span class="token punctuation">)</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
  
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br></div></div><h3 id="_24-1-16-draw-color-zigzag"><a href="#_24-1-16-draw-color-zigzag" class="header-anchor">#</a> 24.1.16 DRAW_COLOR_ZIGZAG</h3> <p>DRAW_COLOR_ZIGZAG 样式使用两个指标缓冲区的值绘制不同颜色的线段。该样式是 DRAW_ZIGZAG的彩色版，例如，允许为每节线段指定来自预定义颜色的独立颜色。线段从第一个缓冲区的值 绘制 到第二个指标缓冲区的值。缓冲区不会只包含空值，因为在这种情况下，不会绘制任何线段。</p> <p>线段的宽度，颜色和线型的指定类似 DRAW_ZIGZAG 样式 —— 可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>从一个缓冲区的非空值 到 另一个指标缓冲区的非空值 绘制线段部分。若要指定哪个值应被视为“空”，请在 PLOT_EMPTY_VALUE 属性设定该值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_ZIGZAG,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终明确填写指标缓冲区的值，在缓冲区中设置 空 值以跳过对应的K线柱。</p> <p>样式DRAW_COLOR_ZIGZAG 所需的缓冲区的数量是3个：
• 两个缓冲区用于存储zigzag线段的终端值；
• 一个缓冲区存储颜色索引，它被用于绘制线段(它使得仅设置非空值有意义)。</p> <p>指标示例：基于 最高价 和 最低价 绘制zigzag 线段的颜色，宽度和样式每N个跳价都会随机变化一次。</p> <p><img src="data:image/png;base64,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" alt=" DRAW_ZIGZAG示例"></p> <p>请注意，最初DRAW_COLOR_ZIGZAG样式的 属性 中，定义了8种颜色，这时是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中，颜色 是从数组colors[] 中的14种颜色中随机设置的。</p> <p>参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                            DRAW_COLOR_ZIGZAG.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_ZIGZAG&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws a broken line as a sequence of colored sections, the color depends on the number of the day of the week&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color, width and style of segments are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot; every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">3</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图Color_Zigzag </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Color_Zigzag&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_ZIGZAG </span></span>
<span class="token comment">//--- 定义8 种用于填充节段的颜色(它们存储在指定数组) </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrYellow<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrLime<span class="token punctuation">,</span>clrOrange </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变订单号数量  </span>
<span class="token keyword">int</span>            color_sections<span class="token punctuation">;</span> 
<span class="token comment">//--- 节段终端缓冲区的值 </span>
<span class="token keyword">double</span>         Color_ZigzagBuffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         Color_ZigzagBuffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 节段终端缓冲区的颜色标引 </span>
<span class="token keyword">double</span>         Color_ZigzagColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrWhiteSmoke<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储线型样式的数组 </span>
ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Color_ZigzagBuffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Color_ZigzagBuffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>Color_ZigzagColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//----为zigzag填充颜色的颜色数量 </span>
   color_sections<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">//  请见注释 #property indicator_color1 属性 </span>
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和线型宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变用于标图节段的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>color_sections<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  
<span class="token comment">//--- 获得每个柱形工作日所需的时间结构 </span>
   MqlDateTime dt<span class="token punctuation">;</span> 
       
<span class="token comment">//--- 计算的初始位置 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果在前一个订单号计算指标，那么在倒数第二个开始计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> start<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算循环 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 在结构中写下柱形的开盘时间 </span>
      <span class="token function">TimeToStruct</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
      <span class="token comment">//--- 如果柱形数量 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//---  在第一个缓冲区写下最高价，在第二个缓冲区写下最低价 </span>
         Color_ZigzagBuffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         Color_ZigzagBuffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 节段的颜色 </span>
         Color_ZigzagColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>dt<span class="token punctuation">.</span>day_of_year<span class="token operator">%</span>color_sections<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 柱形数量是奇数 </span>
      <span class="token keyword">else</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 按相反顺序填写柱形 </span>
         Color_ZigzagBuffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         Color_ZigzagBuffer2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 节段的颜色 </span>
         Color_ZigzagColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>dt<span class="token punctuation">.</span>day_of_year<span class="token operator">%</span>color_sections<span class="token punctuation">;</span>          
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变zigzag节段的颜色                                               | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;ZigzagColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变zigzag节段的外观                                               | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成Color_ZigZag属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 改变线型宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变线型样式的模块 </span>
   number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 除数等于样式数组的大小 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得选择新样式作为整数除法余数的标引 </span>
   <span class="token keyword">int</span> style_index<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置颜色为 PLOT_LINE_COLOR 属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型样式 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>styles<span class="token punctuation">[</span>style_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br></div></div><h3 id="_24-1-17-draw-color-bars"><a href="#_24-1-17-draw-color-bars" class="header-anchor">#</a> 24.1.17 DRAW_COLOR_BARS</h3> <p>DRAW_COLOR_BARS 样式根据四个指标缓冲区的值，包括开盘价，最高价，最低价和收盘价绘制美式棒线图。该样式是DRAW_BARS 的高级版，允许为每根棒线单独指定来自预定义颜色中的颜色。它用于创建自定义指标为美式棒线，包括单独的图表子窗口(副图)中 和 其他金融工具(交易品种)上的指标(叠加报价图表)。</p> <p>美式棒线图颜色的设置可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>指标仅绘制有具体报价美式棒线图，为此，所有四个指标缓冲区的设置，都必须为非空值。 若要指定哪个值应被视为“空”，请在 PLOT_EMPTY_VALUE 属性设定该值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_BARS,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终明确填写指标缓冲区的值，在缓冲区设置空值跳过对应的K线柱。</p> <p>样式DRAW_COLOR_BARS 所需的缓冲区的数量是5个：
• 四个缓冲区用于存储开盘价，最高价，最低价和收盘价值；
• 一个缓冲区用于存储颜色索引，它被用于绘制柱形 (它使得仅设置将被绘制的美式棒线有意义)。</p> <p>样式的所有缓冲区都应该按照给定的顺序一个接一个地进行：开盘价，最高价，最低价，收盘价和颜色缓冲区。价格缓冲区不能只包含null值，因为在这种情况下，不会绘制任何棒线。</p> <p>指标示例：在单独窗口(副图窗口)中的绘制选定金融工具(交易品种)的美式棒线图。美式棒线的颜色每 N个跳价之后都会随机变化一次。参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <p><img src="data:image/png;base64,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" alt="DRAW_COLOR_BARS 示例"></p> <p>DRAW_COLOR_BARS样式的示例</p> <p>请注意，最初DRAW_COLOR_BARS样式的 属性 中，定义了8种颜色，这时是使用编译程序指令 #property设置的，然后在 OnCalculate() 函数中，颜色 是从数组colors[] 中的14种颜色中随机设置的。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                              DRAW_COLOR_BARS.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_BARS&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws different-color bars of a selected symbol in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color and width of bars, as well as the symbol are changed randomly&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图 ColorBars </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorBars&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_BARS </span></span>
<span class="token comment">//--- 定义8种用于填充柱形的颜色（它们存储在指定数组） </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrYellow<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrLime<span class="token punctuation">,</span>clrOrange </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变类型的订单号数量 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span>         <span class="token comment">// 显示的柱形数量 </span>
input <span class="token keyword">bool</span>     messages<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// 在&quot;EA交易&quot;日志显示信息 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         ColorBarsBuffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorBarsBuffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorBarsBuffer3<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorBarsBuffer4<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorBarsColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 交易品种名称 </span>
string symbol<span class="token punctuation">;</span> 
<span class="token keyword">int</span>    bars_colors<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorBarsBuffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorBarsBuffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ColorBarsBuffer3<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ColorBarsBuffer4<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>ColorBarsColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---- 为柱形填充颜色的颜色数量 </span>
   bars_colors<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">// 请见注释#property indicator_color1 属性 </span>
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色和柱形宽度 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 选择来自市场报价窗口的新交易品种 </span>
      symbol<span class="token operator">=</span><span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变线型属性 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变用于绘制蜡烛图的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>bars_colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">int</span> tries<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 试图5 次填充缓冲区的交易品种价格 </span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>symbol<span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span>bars_colors<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> tries<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- CopyFromSymbolToBuffers() 函数调用的计数器 </span>
         tries<span class="token operator">++</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填充指标缓冲区的价格                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span><span class="token keyword">int</span> total<span class="token punctuation">,</span><span class="token keyword">int</span> bar_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在rates[] 数组中，我们将复制开盘价，最高价，最低价和收盘价 </span>
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 尝试计数器 </span>
   <span class="token keyword">int</span> attempts<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 已复制多少 </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 试图25次获得所需交易品种的时间帧 </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>attempts<span class="token operator">&lt;</span><span class="token number">25</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>copied<span class="token operator">=</span><span class="token function">CopyRates</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bars<span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      attempts<span class="token operator">++</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s CopyRates(%s) attempts=%d&quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span>name<span class="token punctuation">,</span>attempts<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果复制足够数量的柱形失败 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">!=</span>bars<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 形成信息字符串 </span>
      string comm<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;For the symbol %s, managed to receive only %d bars of %d requested ones&quot;</span><span class="token punctuation">,</span> 
                               name<span class="token punctuation">,</span> 
                               copied<span class="token punctuation">,</span> 
                               bars 
                               <span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在主图表窗口的注释中显示信息 </span>
      <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 显示信息 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 设置交易品种的展示 </span>
      <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>name<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;DRAW_COLOR_BARS(&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 初始化空值缓冲区 </span>
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>ColorBarsBuffer1<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>ColorBarsBuffer2<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>ColorBarsBuffer3<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>ColorBarsBuffer4<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 复制缓冲区的价格 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>copied<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算缓冲区相应的标引 </span>
      <span class="token keyword">int</span> buffer_index<span class="token operator">=</span>total<span class="token operator">-</span>copied<span class="token operator">+</span>i<span class="token punctuation">;</span> 
      <span class="token comment">//--- 写下缓冲区的价格 </span>
      ColorBarsBuffer1<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">;</span> 
      ColorBarsBuffer2<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">;</span> 
      ColorBarsBuffer3<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">;</span> 
      ColorBarsBuffer4<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">;</span> 
      <span class="token comment">//--- </span>
      ColorBarsColors<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token operator">%</span>bar_colors<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 随机返回来自市场报价的交易品种                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
string <span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 市场报价窗口中显示的交易品种数量 </span>
   <span class="token keyword">int</span> symbols<span class="token operator">=</span><span class="token function">SymbolsTotal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 列表中的交易品种位置 - 从0到交易品种的随机号 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>symbols<span class="token punctuation">;</span> 
<span class="token comment">//--- 返回指定位置的交易品种名称 </span>
   <span class="token keyword">return</span> <span class="token function">SymbolName</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变zigzag节段的颜色                                               | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;BarColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变柱形的外观                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成柱形属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 改变柱形宽度的模块 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得整数除法余数的宽度 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>number<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 宽度设置从 0 到 4 </span>
<span class="token comment">//--- 设置颜色为PLOT_LINE_WIDTH属性 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下线型宽度 </span>
   comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token string">&quot;\r\nWidth=&quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 写下交易品种名称 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span>comm<span class="token punctuation">;</span> 
  
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br></div></div><h3 id="_24-1-18-draw-color-candles"><a href="#_24-1-18-draw-color-candles" class="header-anchor">#</a> 24.1.18 DRAW_COLOR_CANDLES</h3> <p>DRAW_COLOR_CANDLES 样式类似 DRAW_CANDLES根据四个指标缓冲区的值，包括开盘价，最高价，最低价和收盘价绘制日式蜡烛图。另外，它还允许为每根蜡烛图单独指定来自预定义颜色中的颜色。为此，该样式为每根蜡烛，都有一个特定的颜色缓冲区。它用于创建日式蜡烛图指标，包括单独的图表子窗口(副图)中 和 其他金融工具(交易品种)上的指标(叠加报价图表)。</p> <p>日式蜡烛图颜色的设置可以使用预编译器指令进行设置 和/或 使用PlotIndexSetInteger()函数进行动态设置。绘图属性的动态变化允许“激活”指标，以便于可以根据当前状况改变其外观。</p> <p>指标仅绘制有具体报价日式蜡烛图，为此，所有四个指标缓冲区的设置，都必须为非空值。 若要指定哪个值应被视为“空”，请在 PLOT_EMPTY_VALUE 属性设定该值：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//--- 0(空)值将不参与绘制 
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_CANDLES,PLOT_EMPTY_VALUE,0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>始终明确填写指标缓冲区的值，在缓冲区设置空值跳过对应的K线柱。</p> <p>样式DRAW_COLOR_CANDLES 所需的缓冲区的数量是5个：
• 四个缓冲区用于存储开盘价，最高价，最低价和收盘价值；
• 一个缓冲区用于存储颜色索引，它被用于绘制柱形 (它使得仅设置将被绘制的美式棒线有意义)。</p> <p>样式的所有缓冲区都应该按照给定的顺序一个接一个地进行：开盘价，最高价，最低价，收盘价和颜色缓冲区。价格缓冲区不能只包含null值，因为在这种情况下，不会绘制任何棒线。</p> <p>指标示例：在单独窗口(副图窗口)中的绘制选定金融工具(交易品种)的日式蜡烛图。日式蜡烛的颜色每 N个跳价之后都会随机变化一次。参数 N 为指标的外部参数，即表示手动配置成为可能(在指标属性窗口--&gt;参数 标签中)。</p> <p><img src="data:image/png;base64,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" alt="DRAW_COLOR_CANDLES示例"></p> <p>请注意，样式的属性最新是使用编译程序指令#property设置颜色，然后在OnCalculate() 函数，从之前准备的颜色列表中随机设置颜色。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                           DRAW_COLOR_CANDLES.mq5 | </span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An indicator to demonstrate DRAW_COLOR_CANDLES.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;It draws candlesticks of a selected symbol in a separate window&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot; &quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The color and width of candlesticks, as well as the symbol are changed&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;randomly every N ticks&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//--- 标图 ColorCandles </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorCandles&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_CANDLES </span></span>
<span class="token comment">//--- 定义8种用于填充蜡烛图的颜色（它们存储在指定数组） </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrYellow<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrLime<span class="token punctuation">,</span>clrOrange </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
  
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      N<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>              <span class="token comment">// 改变类型的订单号数量 </span>
input <span class="token keyword">int</span>      bars<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span>         <span class="token comment">// 显示的蜡烛图数量 </span>
input <span class="token keyword">bool</span>     messages<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// 在&quot;EA交易&quot;日志显示信息 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         ColorCandlesBuffer1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorCandlesBuffer2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorCandlesBuffer3<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorCandlesBuffer4<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorCandlesColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">int</span>            candles_colors<span class="token punctuation">;</span> 
<span class="token comment">//--- 交易品种名称 </span>
string symbol<span class="token punctuation">;</span> 
<span class="token comment">//--- 存储颜色的数组包含14种元素 </span>
color colors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 
  <span class="token punctuation">{</span> 
   clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrChocolate<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">,</span>clrGoldenrod<span class="token punctuation">,</span> 
   clrIndigo<span class="token punctuation">,</span>clrLightBlue<span class="token punctuation">,</span>clrAliceBlue<span class="token punctuation">,</span>clrMoccasin<span class="token punctuation">,</span>clrMagenta<span class="token punctuation">,</span>clrCyan<span class="token punctuation">,</span>clrMediumPurple 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 如果柱形非常小 - 提前完成工作 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bars<span class="token operator">&lt;</span><span class="token number">50</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Comment</span><span class="token punctuation">(</span><span class="token string">&quot;Please specify a larger number of bars! The operation of the indicator has been terminated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 指标缓冲区映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorCandlesBuffer1<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorCandlesBuffer2<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ColorCandlesBuffer3<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ColorCandlesBuffer4<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>ColorCandlesColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 空值 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 绘制柱形的交易品种名称 </span>
   symbol<span class="token operator">=</span>_Symbol<span class="token punctuation">;</span> 
<span class="token comment">//--- 设置交易品种的展示 </span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>symbol<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;DRAW_COLOR_CANDLES(&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---- 为蜡烛图填充颜色的颜色数量 </span>
   candles_colors<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>     <span class="token comment">//  请见注释#property indicator_color1 属性 </span>
<span class="token comment">//---  </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span>INT_MAX<span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号改变样式，颜色 </span>
   ticks<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果足够数量的订单号被积累 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span>N<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 选择来自市场报价窗口的新交易品种 </span>
      symbol<span class="token operator">=</span><span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变格式 </span>
      <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变用于绘制蜡烛图的颜色 </span>
      <span class="token function">ChangeColors</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span>candles_colors<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
      <span class="token keyword">int</span> tries<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 试图5 次填充缓冲区plot1的交易品种价格 </span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>symbol<span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> 
            ColorCandlesBuffer1<span class="token punctuation">,</span>ColorCandlesBuffer2<span class="token punctuation">,</span>ColorCandlesBuffer3<span class="token punctuation">,</span> 
            ColorCandlesBuffer4<span class="token punctuation">,</span>ColorCandlesColors<span class="token punctuation">,</span>candles_colors<span class="token punctuation">)</span> 
            <span class="token operator">&amp;&amp;</span> tries<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- CopyFromSymbolToBuffers() 函数调用的计数器 </span>
         tries<span class="token operator">++</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 重置0计数器 </span>
      ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回 prev_calculated值以便下次调用函数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填充指定蜡烛图                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">CopyFromSymbolToBuffers</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> 
                             <span class="token keyword">int</span> total<span class="token punctuation">,</span> 
                             <span class="token keyword">int</span> plot_index<span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff3<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>buff4<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">double</span> <span class="token operator">&amp;</span>col_buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                             <span class="token keyword">int</span>    cndl_colors 
                             <span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在rates[] 数组中，我们将复制开盘价，最高价，最低价和收盘价 </span>
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 尝试计数器 </span>
   <span class="token keyword">int</span> attempts<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 已复制多少 </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 试图25次获得所需交易品种的时间帧 </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>attempts<span class="token operator">&lt;</span><span class="token number">25</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>copied<span class="token operator">=</span><span class="token function">CopyRates</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bars<span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      attempts<span class="token operator">++</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s CopyRates(%s) attempts=%d&quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span>name<span class="token punctuation">,</span>attempts<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果复制足够数量的柱形失败 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">!=</span>bars<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 形成信息字符串 </span>
      string comm<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;For the symbol %s, managed to receive only %d bars of %d requested ones&quot;</span><span class="token punctuation">,</span> 
                               name<span class="token punctuation">,</span> 
                               copied<span class="token punctuation">,</span> 
                               bars 
                               <span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在主图表窗口的注释中显示信息 </span>
      <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 显示信息 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 设置交易品种的展示 </span>
      <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span>plot_index<span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span>name<span class="token operator">+</span><span class="token string">&quot; Open;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; High;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Low;&quot;</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">&quot; Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;DRAW_COLOR_CANDLES(&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 初始化空值缓冲区 </span>
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff1<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff2<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff3<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>buff4<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 在每个订单号上复制缓冲区价格 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>copied<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算缓冲区相应的标引 </span>
      <span class="token keyword">int</span> buffer_index<span class="token operator">=</span>total<span class="token operator">-</span>copied<span class="token operator">+</span>i<span class="token punctuation">;</span> 
      <span class="token comment">//--- 写下缓冲区的价格 </span>
      buff1<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">;</span> 
      buff2<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">;</span> 
      buff3<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">;</span> 
      buff4<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置蜡烛图颜色 </span>
      <span class="token keyword">int</span> color_index<span class="token operator">=</span>i<span class="token operator">%</span>cndl_colors<span class="token punctuation">;</span> 
      col_buffer<span class="token punctuation">[</span>buffer_index<span class="token punctuation">]</span><span class="token operator">=</span>color_index<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 随机返回来自市场报价的交易品种                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
string <span class="token function">GetRandomSymbolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 市场报价窗口中显示的交易品种数量 </span>
   <span class="token keyword">int</span> symbols<span class="token operator">=</span><span class="token function">SymbolsTotal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 列表中的交易品种位置 - 从0到交易品种的随机号 </span>
   <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>symbols<span class="token punctuation">;</span> 
<span class="token comment">//--- 返回指定位置的交易品种名称 </span>
   <span class="token keyword">return</span> <span class="token function">SymbolName</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变蜡烛图节段的颜色                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span>  <span class="token function">ChangeColors</span><span class="token punctuation">(</span>color  <span class="token operator">&amp;</span>cols<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> plot_colors<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 颜色数 </span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
   string comm<span class="token operator">=</span><span class="token function">ChartGetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n\r\n&quot;</span><span class="token punctuation">;</span> 
  
<span class="token comment">//--- 为每个颜色标引随机定义一个新的颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> plot_color_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>plot_color_ind<span class="token operator">&lt;</span>plot_colors<span class="token punctuation">;</span>plot_color_ind<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 获得随机数 </span>
      <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 获得col[]数组的标引作为整数除法的余数 </span>
      <span class="token keyword">int</span> i<span class="token operator">=</span>number<span class="token operator">%</span>size<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置每个标引的颜色为 PLOT_LINE_COLOR属性 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">//  图形样式数量 </span>
                          PLOT_LINE_COLOR<span class="token punctuation">,</span>      <span class="token comment">//  属性标识符 </span>
                          plot_color_ind<span class="token punctuation">,</span>       <span class="token comment">//  颜色标引，我们在这里编写颜色 </span>
                          cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//  新颜色 </span>
      <span class="token comment">//--- 编写颜色 </span>
      comm<span class="token operator">=</span>comm<span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;CandleColorIndex[%d]=%s \r\n&quot;</span><span class="token punctuation">,</span>plot_color_ind<span class="token punctuation">,</span><span class="token function">ColorToString</span><span class="token punctuation">(</span>cols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ChartSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_COMMENT<span class="token punctuation">,</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 改变蜡烛图的外观                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLineAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 形成蜡烛图属性信息的字符串 </span>
   string comm<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 写下交易品种名称 </span>
   comm<span class="token operator">=</span><span class="token string">&quot;\r\n&quot;</span><span class="token operator">+</span>symbol<span class="token operator">+</span>comm<span class="token punctuation">;</span> 
<span class="token comment">//--- 使用注释在图表上显示信息 </span>
   <span class="token function">Comment</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br></div></div><h2 id="_24-2-指标属性和函数间的连接"><a href="#_24-2-指标属性和函数间的连接" class="header-anchor">#</a> 24.2 指标属性和函数间的连接</h2> <p>每个自定义指标都有很多属性，有些是强制的并且始终在描述的开始位置，它们通常具有如下属性：
• 绘制指标的窗口 —— 单独的指标窗口，即副图窗口 (indicator_separate_window) 或者 主图窗口(indicator_chart_window)；
• 指标缓冲区数量 —— indicator_buffers；
• 指标绘制类型的数量 —— indicator_plots。</p> <p>也可以通过 预处理器 指令或者建立自定义指标的函数建立其它属性。这些属性和类似函数在如下表格中描述。</p> <table><thead><tr><th>指标子窗口属性指令</th> <th>IndicatorSet...()型函数</th> <th>调整过的子窗口属性指令</th></tr></thead> <tbody><tr><td>indicator_height</td> <td>IndicatorSetInteger(INDICATOR_INDICATOR_HEIGHT, nHeight)</td> <td>子窗口高度的修正值</td></tr> <tr><td>indicator_minimum</td> <td>IndicatorSetDouble(INDICATOR_MINIMUM, dMaxValue)</td> <td>纵轴最小值</td></tr> <tr><td>indicator_maximum</td> <td>IndicatorSetDouble(INDICATOR_MAXIMUM, dMinValue)</td> <td>纵轴最大值</td></tr> <tr><td>indicator_levelN</td> <td>IndicatorSetDouble(INDICATOR_LEVELVALUE, N-1, nLevelValue)</td> <td>N水平面纵轴值</td></tr> <tr><td>无预处理器指令</td> <td>IndicatorSetString(INDICATOR_LEVELTEXT, N-1, sLevelName)</td> <td>显示的水平面名称</td></tr> <tr><td>indicator_levelcolor</td> <td>IndicatorSetInteger(INDICATOR_LEVELCOLOR, N-1, nLevelColor)</td> <td>N水平面颜色</td></tr> <tr><td>indicator_levelwidth</td> <td>IndicatorSetInteger(INDICATOR_LEVELWIDTH, N-1, nLevelWidth)</td> <td>N平面的线宽</td></tr> <tr><td>indicator_levelstyle</td> <td>IndicatorSetInteger(INDICATOR_LEVELSTYLE, N-1, nLevelStyle)</td> <td>N平面的线型</td></tr> <tr><td>indicator_labelN</td> <td>PlotIndexSetString(N-1,PLOT_LABEL,sLabel)</td> <td>图N缩略名。当鼠标光标放在上面时显示在数据窗口和弹出提示框中</td></tr> <tr><td>indicator_styleN</td> <td>PlotIndexSetInteger(N-1, PLOT_LINE_STYLE, nType)</td> <td>图N的线型</td></tr> <tr><td>indicator_typeN</td> <td>PlotIndexSetInteger(N-1, PLOT_DRAW_TYPE, nType)</td> <td>图N的线种</td></tr> <tr><td>indicator_widthN</td> <td>PlotIndexSetInteger(N-1, PLOT_LINE_WIDTH, nWidth)</td> <td>图N的线宽</td></tr></tbody></table> <table><thead><tr><th>常用指标属性</th> <th>IndicatorSet...()型函数</th> <th>描述</th></tr></thead> <tbody><tr><td>无预处理器指令</td> <td>IndicatorSetString(INDICATOR_SHORTNAME, sShortName)</td> <td>设置显示在指标列表(在客户端中按Ctrl+I打开)中的指标的便捷短名称。</td></tr> <tr><td>无预处理器指令</td> <td>IndicatorSetInteger(INDICATOR_DIGITS, nDigits)</td> <td>设置指标值显示所需的精度----小数点后保留几位数。</td></tr> <tr><td>无预处理器指令</td> <td>IndicatorSetInteger(INDICATOR_LEVELS, nLevels)</td> <td>设置指标窗口水平线的数量</td></tr> <tr><td>indicator_applied_price</td> <td>无函数，属性仅可以通过预处理器指令设置。</td> <td>用于指标计算的默认价格类型。只有使用OnCalculate()时被指定。</td></tr></tbody></table> <p>应当注意，预处理器指令中的 级别 和 绘图类型 的索引编号从 1 开始，而使用函数时相同属性的索引编号从 零 开始，即指标内的索引编号数值必须比#property指示的值小1。(这一点应该特别注意。—— 智能交易*姚 提示)</p> <p>有几个指令，没有相应的函数：</p> <table><thead><tr><th>指令</th> <th>描述</th></tr></thead> <tbody><tr><td>indicator_chart_window</td> <td>指标显示在主窗口中</td></tr> <tr><td>indicator_separate_window</td> <td>指标显示在独立子窗口(副图窗口)中</td></tr> <tr><td>indicator_buffers</td> <td>所需 指标缓冲区 的数量</td></tr> <tr><td>indicator_plots</td> <td>指标中的 绘图类型 的数量</td></tr></tbody></table> <h2 id="_24-3-setindexbuffer"><a href="#_24-3-setindexbuffer" class="header-anchor">#</a> 24.3 SetIndexBuffer</h2> <p>该函数将指定的 指标缓冲区 与 双精度(double)类型的一维动态数组绑定。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>                    index<span class="token punctuation">,</span>         <span class="token comment">// 缓冲指数 </span>
   <span class="token keyword">double</span>                 buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment">// 数组 </span>
   ENUM_INDEXBUFFER_TYPE  data_type      <span class="token comment">// 要存储的东西 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>index</p> <p>[in] 指标缓冲区的索引数字，编号从0开始，该数字必须小于 #property indicator_buffers中声明的值。</p> <p>buffer[]</p> <p>[in] 在自定义指标程序中声明一个数组。</p> <p>data_type</p> <p>[in] 存储在指标数组中的数据类型。默认情况下，它是INDICATOR_DATA(计算指标的值)。它也可能需要INDICATOR_COLOR_INDEX的值; 在这种情况下，此缓冲区用于存储前一个指标缓冲区的颜色索引。您可以在 #property indicator_colorN 命令行中指定最多64种颜色。 INDICATOR_CALCULATIONS值表示缓冲区用于指标的中间计算，不用于绘图。</p> <p>返回值</p> <p>如果成功，返回 true， 否则返回 false。</p> <p>注意</p> <p>绑定后，动态数组buffer []将被重新编入索引号，就像在公共数组中一样，即使之前为绑定数组预先设置了 时间序列 的索引。如果要更改对指标数组元素的访问顺序，请在使用SetIndexBuffer()函数绑定数组后使用ArraySetAsSeries()函数。请注意，您无法通过函数SetIndexBuffer()更改设置为指标缓冲区的动态数组的大小。对于指标缓冲区，所有大小改变操作都由客户端的执行子系统执行。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                              TestCopyBuffer1.mq5 | </span>
<span class="token comment">//|                        Copyright 2009, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;2009, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
  
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//---- 图 MA </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;MA&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 输入参量 </span>
input <span class="token keyword">bool</span>               AsSeries<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> 
input <span class="token keyword">int</span>                period<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">;</span> 
input ENUM_MA_METHOD     smootMode<span class="token operator">=</span>MODE_EMA<span class="token punctuation">;</span> 
input ENUM_APPLIED_PRICE price<span class="token operator">=</span>PRICE_CLOSE<span class="token punctuation">;</span> 
input <span class="token keyword">int</span>                shift<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 指标缓冲 </span>
<span class="token keyword">double</span>                   MABuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">int</span>                      ma_handle<span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲绘图 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>AsSeries<span class="token punctuation">)</span> <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>MABuffer<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Indicator buffer is timeseries = &quot;</span><span class="token punctuation">,</span><span class="token function">ArrayGetAsSeries</span><span class="token punctuation">(</span>MABuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>MABuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Indicator buffer after SetIndexBuffer() is timeseries = &quot;</span><span class="token punctuation">,</span> 
         <span class="token function">ArrayGetAsSeries</span><span class="token punctuation">(</span>MABuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
<span class="token comment">//--- 更待指标缓冲访问单元命令 </span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>MABuffer<span class="token punctuation">,</span>AsSeries<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;MA(&quot;</span><span class="token operator">+</span>period<span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token operator">+</span>AsSeries<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   ma_handle<span class="token operator">=</span><span class="token function">iMA</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>period<span class="token punctuation">,</span>shift<span class="token punctuation">,</span>smootMode<span class="token punctuation">,</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标重复函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 复制缓冲区MABuffer中的移动平均值 </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>ma_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span>MABuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;MABuffer[0] = &quot;</span><span class="token punctuation">,</span>MABuffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 取决于AsSeries值 </span>
                                      <span class="token comment">// 将收到旧值 </span>
                                      <span class="token comment">// 或者为当前未完成的字节 </span>
  
<span class="token comment">//--- 为下一次调用返回prev_calculated值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>相关参考</p> <p>自定义指标属性， 访问时间序列和指标</p> <h2 id="_24-4-indicatorsetdouble"><a href="#_24-4-indicatorsetdouble" class="header-anchor">#</a> 24.4 IndicatorSetDouble</h2> <p>该函数设置相应指标属性的值。指标属性必须是 双精度(double)类型。该函数有两种变体。</p> <ol><li>通过指定的属性标识符进行调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  IndicatorSetDouble( 
   int     prop_id,           // 标识符 
   double  prop_value         // 将被设置的值 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>通过指定的属性标识符和属性修饰语调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  IndicatorSetDouble( 
   int     prop_id,           // 标识符 
   int     prop_modifier,     // 修饰语  
   double  prop_value         // 将被设置的值 
   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>prop_id</p> <p>[in] 取值范围是 ENUM_CUSTOMIND_PROPERTY_DOUBLE 枚举值之一。</p> <p>prop_modifier</p> <p>[in] 指定属性的修饰符。只有水平属性需要修饰符。水平级别的编号从0开始。这意味着为了设置第二级的属性，您需要指定1(比使用预编译指令时少1)。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true，否则返回 false。</p> <p>注意</p> <p>使用 #property指令时属性(修饰符)的索引编号从1开始，而函数使用的索引编号是从 0开始的。如果水平级别的索引编号设置错误，那么指标显示的效果可能与预期的不同。
例如，在单独子窗口的指标第一水平值可以通过两种方式设置：
• property indicator_level1 50 —— 值1用于指定水平级别的索引编号，
• IndicatorSetDouble(INDICATOR_LEVELVALUE, 0, 50) —— 此处0 表示第一个水平级别的索引编号。</p> <p>示例：指标颠倒指标窗口的最大值和最小值以及放置水平线的级别值。</p> <p><img src="data:image/png;base64,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" alt="指标颠倒窗口"></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token comment">//--- 设置指标窗口的最大最小值 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_minimum  <span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_maximum  <span class="token number">100</span> </span></span>
<span class="token comment">//--- 在单独指标窗口展示三条水平线 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level1 <span class="token number">25</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level2 <span class="token number">50</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level3 <span class="token number">75</span> </span></span>
<span class="token comment">//--- 设置水平线的粗细 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelwidth <span class="token number">1</span> </span></span>
<span class="token comment">//--- 设置水平线的样式 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelstyle STYLE_DOT </span></span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 设置水平线的描述 </span>
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;First Level (index 0)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Second Level (index 1)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;Third Level (index 2)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置指标缩略名 </span>
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;IndicatorSetDouble() Demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置每个水平的颜色 </span>
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_LEVELCOLOR<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>clrBlue<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_LEVELCOLOR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>clrGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_LEVELCOLOR<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>clrRed<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> tick_counter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
   <span class="token keyword">static</span> <span class="token keyword">double</span> level1<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span>level2<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>level3<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">;</span> 
   <span class="token keyword">static</span> <span class="token keyword">double</span> max<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> shift<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号 </span>
   tick_counter<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 每10个订单号颠倒一次水平 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_counter<span class="token operator">%</span><span class="token number">10</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 水平值的颠倒符号 </span>
      level1<span class="token operator">=</span><span class="token operator">-</span>level1<span class="token punctuation">;</span> 
      level2<span class="token operator">=</span><span class="token operator">-</span>level2<span class="token punctuation">;</span> 
      level3<span class="token operator">=</span><span class="token operator">-</span>level3<span class="token punctuation">;</span> 
      <span class="token comment">//--- 最大最小值的颠倒符号 </span>
      max<span class="token operator">-=</span>shift<span class="token punctuation">;</span> 
      min<span class="token operator">-=</span>shift<span class="token punctuation">;</span> 
      <span class="token comment">//--- 颠倒替换值 </span>
      shift<span class="token operator">=</span><span class="token operator">-</span>shift<span class="token punctuation">;</span> 
      <span class="token comment">//--- 设置新的水平值 </span>
      <span class="token function">IndicatorSetDouble</span><span class="token punctuation">(</span>INDICATOR_LEVELVALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>level1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetDouble</span><span class="token punctuation">(</span>INDICATOR_LEVELVALUE<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>level2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetDouble</span><span class="token punctuation">(</span>INDICATOR_LEVELVALUE<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>level3<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在指标窗口设置新的最大最小值 </span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Set up max = &quot;</span><span class="token punctuation">,</span>max<span class="token punctuation">,</span><span class="token string">&quot;,   min = &quot;</span><span class="token punctuation">,</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetDouble</span><span class="token punctuation">(</span>INDICATOR_MAXIMUM<span class="token punctuation">,</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">IndicatorSetDouble</span><span class="token punctuation">(</span>INDICATOR_MINIMUM<span class="token punctuation">,</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>相关参考</p> <p>指标类型示例, 指标属性和函数间的连接, 绘画风格</p> <h2 id="_24-5-indicatorsetinteger"><a href="#_24-5-indicatorsetinteger" class="header-anchor">#</a> 24.5 IndicatorSetInteger</h2> <p>该函数设置相应指标属性的值。指标属性必须是 整数 或 颜色类型。该函数有两种变体。</p> <ol><li>通过指定的属性标识符进行调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  IndicatorSetInteger( 
   int  prop_id,           // 标识符 
   int  prop_value         // 将被设置的值 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>通过指定的属性标识符和属性修饰语调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  IndicatorSetInteger( 
   int  prop_id,           // 标识符 
   int  prop_modifier,     // 修饰符  
   int  prop_value         // 将被设置的值 
   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>prop_id</p> <p>[in] 取值范围是ENUM_CUSTOMIND_PROPERTY_INTEGER 枚举值之一。</p> <p>prop_modifier</p> <p>[in] 指定属性的修饰符。只有水平属性需要修饰符。水平级别的编号从0开始。这意味着为了设置第二个水平级别的属性，您需要指定1(比使用预编译指令时少1)。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true，否则返回 false。</p> <p>注意</p> <p>使用 #property指令时属性(修饰符)的索引编号从1开始，而函数使用的索引编号是从 0开始的。如果水平级别的索引编号设置错误，那么指标显示的效果可能与预期的不同。
例如，若要设置第一水平线的粗细，请使用索引编号 0：
• IndicatorSetInteger(INDICATOR_LEVELWIDTH, 0, 5) -标引 0 用于设定第一水平的粗细。</p> <p>示例：设置指标水平线的颜色，线型和粗细的指标。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_minimum <span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_maximum <span class="token number">100</span> </span></span>
<span class="token comment">//--- 在单独指标窗口展示三条水平线 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level1 <span class="token number">20</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level2 <span class="token number">50</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level3 <span class="token number">80</span> </span></span>
<span class="token comment">//--- 设置水平线的粗细 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelwidth <span class="token number">5</span> </span></span>
<span class="token comment">//--- 设置水平线的颜色 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelcolor clrAliceBlue </span></span>
<span class="token comment">//--- 设置水平线的样式 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelstyle STYLE_DOT </span></span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 设置水平线的描述 </span>
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;First Level (index 0)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Second Level (index 1)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;Third Level (index 2)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置指标缩略名 </span>
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;IndicatorSetInteger() Demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> <span class="token keyword">int</span> tick_counter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算订单号 </span>
   tick_counter<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 根据订单号计数器计算水平线的颜色 </span>
   <span class="token function">ChangeLevelColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>tick_counter<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 三个最后的参数切换颜色 </span>
   <span class="token function">ChangeLevelColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>tick_counter<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ChangeLevelColor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>tick_counter<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 更改水平线的样式 </span>
   <span class="token function">ChangeLevelStyle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>tick_counter<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ChangeLevelStyle</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>tick_counter<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ChangeLevelStyle</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>tick_counter<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得宽度为订单号整数除法除以5的余数 </span>
   <span class="token keyword">int</span> width<span class="token operator">=</span>tick_counter<span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 迭代所有水平线并设置粗细 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>l<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>l<span class="token operator">++</span><span class="token punctuation">)</span> 
      <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_LEVELWIDTH<span class="token punctuation">,</span>l<span class="token punctuation">,</span>width<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 在单独指标窗口设置水平线颜色                                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLevelColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> level<span class="token punctuation">,</span>      <span class="token comment">// 水平线数 </span>
                      <span class="token keyword">int</span> tick_number<span class="token punctuation">,</span><span class="token comment">// 被除数，获得除法余数的数 </span>
                      <span class="token keyword">int</span> f_trigger<span class="token punctuation">,</span>  <span class="token comment">// 第一个颜色切换除数 </span>
                      <span class="token keyword">int</span> s_trigger<span class="token punctuation">,</span>  <span class="token comment">// 第二个颜色切换除数 </span>
                      <span class="token keyword">int</span> t_trigger<span class="token punctuation">)</span>  <span class="token comment">// 第三个颜色切换除数 </span>
  <span class="token punctuation">{</span> 
   <span class="token keyword">static</span> color colors<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>clrRed<span class="token punctuation">,</span>clrBlue<span class="token punctuation">,</span>clrGreen<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- colors[]数组的颜色标引 </span>
   <span class="token keyword">int</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算来自colors[]数组的颜色数为水平线涂色 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span>f_trigger<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">// 如果tick_number被f_trigger除，没有余数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span>s_trigger<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// 如果tick_number被s_trigger除，没有余数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span>t_trigger<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// 如果tick_number被t_trigger除，没有余数 </span>
<span class="token comment">//--- 如果定义颜色，设置它      </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>index<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_LEVELCOLOR<span class="token punctuation">,</span>level<span class="token punctuation">,</span>colors<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 在单独指标窗口设置水平线的样式                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ChangeLevelStyle</span><span class="token punctuation">(</span><span class="token keyword">int</span> level<span class="token punctuation">,</span>     <span class="token comment">// 水平线数 </span>
                      <span class="token keyword">int</span> tick_number<span class="token comment">// 获得除法余数的数 </span>
                      <span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 存储样式的数组 </span>
   <span class="token keyword">static</span> ENUM_LINE_STYLE styles<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span> 
     <span class="token punctuation">{</span>STYLE_SOLID<span class="token punctuation">,</span>STYLE_DASH<span class="token punctuation">,</span>STYLE_DOT<span class="token punctuation">,</span>STYLE_DASHDOT<span class="token punctuation">,</span>STYLE_DASHDOTDOT<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- styles[]数组的样式标引 </span>
   <span class="token keyword">int</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 计算styles[]数组的数字来设置水平线的样式 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span><span class="token number">50</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 如果tick_number 被50除没有余数，那么样式是STYLE_DASHDOTDOT </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span><span class="token number">40</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// ... 样式是 STYLE_DASHDOT </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span><span class="token number">30</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>   <span class="token comment">// ... STYLE_DOT </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span><span class="token number">20</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// ... STYLE_DASH </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>tick_number<span class="token operator">%</span><span class="token number">10</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      index<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// ... STYLE_SOLID </span>
<span class="token comment">//--- 如果定义样式，设置它       </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>index<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_LEVELSTYLE<span class="token punctuation">,</span>level<span class="token punctuation">,</span>styles<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br></div></div><p>相关参考</p> <p>自定义指标属性，程序属性(#property)，绘画风格</p> <h2 id="_24-6-indicatorsetstring"><a href="#_24-6-indicatorsetstring" class="header-anchor">#</a> 24.6 IndicatorSetString</h2> <p>该函数设置相应指标属性的值。指标属性必须是 字符串型。该函数有两种变体。</p> <ol><li>通过指定的属性标识符进行调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  IndicatorSetString( 
   int     prop_id,           // 标识符 
   string  prop_value         // 将被设置的值 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>通过指定的属性标识符和属性修饰语调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  IndicatorSetString( 
   int     prop_id,           // 标识符 
   int     prop_modifier,     // 修饰符  
   string  prop_value         // 将被设置的值 
   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>prop_id</p> <p>[in] 取值范围是ENUM_CUSTOMIND_PROPERTY_STRING 枚举值之一。</p> <p>prop_modifier</p> <p>[in] 指定属性的修饰符。只有水平属性需要修饰符。水平级别的编号从0开始。这意味着为了设置第二个水平级别的属性，您需要指定1(比使用预编译指令时少1)。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true，否则返回 false。</p> <p>注意</p> <p>使用 #property指令时属性(修饰符)的索引编号从1开始，而函数使用的索引编号是从 0开始的。如果水平级别的索引编号设置错误，那么指标显示的效果可能与预期的不同。
例如，若要设置第一水平线的粗细，请使用索引编号 0：
• IndicatorSetString(INDICATOR_LEVELTEXT, 0, &quot;First Level&quot;) —— 索引编号 0 用于设定第一水平级别的文本描述。</p> <p>示例：设置指标水平线的文本标签的指标。</p> <p><img src="data:image/png;base64,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" alt="设置指标水平线"></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_minimum <span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_maximum <span class="token number">100</span> </span></span>
<span class="token comment">//--- 在单独指标窗口展示三条水平线 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level1 <span class="token number">30</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level2 <span class="token number">50</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_level3 <span class="token number">70</span> </span></span>
<span class="token comment">//--- 设置水平线的颜色 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelcolor clrRed </span></span>
<span class="token comment">//--- 设置水平线的样式 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_levelstyle STYLE_SOLID </span></span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 设置水平线的描述 </span>
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;First Level (index 0)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Second Level (index 1)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_LEVELTEXT<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;Third Level (index 2)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置指标缩略名 </span>
   <span class="token function">IndicatorSetString</span><span class="token punctuation">(</span>INDICATOR_SHORTNAME<span class="token punctuation">,</span><span class="token string">&quot;IndicatorSetString() Demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- </span>
    
<span class="token comment">//--- 返回prev_calculated值以便下次调用 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>相关参考</p> <p>自定义指标属性， 程序属性 (#property)</p> <h2 id="_24-7-plotindexsetdouble"><a href="#_24-7-plotindexsetdouble" class="header-anchor">#</a> 24.7 PlotIndexSetDouble</h2> <p>该函数设置指定指标的相应属性的值。指标属性必须是 双精度(double)类型。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  PlotIndexSetDouble( 
   int     plot_index,     // 图样式指数 
   int     prop_id,        // 属性标识符 
   double  prop_value      // 将被设置的值 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>plot_index</p> <p>[in] 绘制风格的索引编号</p> <p>prop_id</p> <p>[in] 取值范围是 ENUM_PLOT_PROPERTY_DOUBLE 枚举值之一。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true， 否则 false。</p> <h2 id="_24-8-plotindexsetinteger"><a href="#_24-8-plotindexsetinteger" class="header-anchor">#</a> 24.8 PlotIndexSetInteger</h2> <p>该函数设置指标的相应属性值，指标属性必须是整型，短整型，布尔型或者颜色型。此函数有两种变体。</p> <ol><li>通过指定的属性标识符进行调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  PlotIndexSetInteger( 
   int  plot_index,        // 图样式指数 
   int  prop_id,           // 属性标识符 
   int  prop_value         // 将被设置的值 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>通过指定的属性标识符和属性修饰语调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  PlotIndexSetInteger( 
   int  plot_index,        // 图样式指数 
   int  prop_id,           // 属性标识符 
   int  prop_modifier,     // 属性修饰符 
   int  prop_value         // 将被设置的值 
   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>plot_index</p> <p>[in] 绘制风格的索引编号</p> <p>prop_id</p> <p>[in] 取值范围是ENUM_PLOT_PROPERTY_INTEGER 枚举值之一。</p> <p>prop_modifier</p> <p>[in] 指定属性的修饰符。只有颜色索引属性需要修饰符。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true，否则 false。</p> <p>示例：一个绘制三色线的指标。配色方案每5次跳价之后改变一次。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//---- 图线颜色 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorLine&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_LINE </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrGreen<span class="token punctuation">,</span>clrBlue </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">3</span> </span></span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         ColorLineBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">int</span>            MA_handle<span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲绘图 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ColorLineBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ColorBuffer<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得MA处理器 </span>
   MA_handle<span class="token operator">=</span><span class="token function">iMA</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>MODE_EMA<span class="token punctuation">,</span>PRICE_CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 获得颜色指数                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">getIndexOfColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">int</span> j<span class="token operator">=</span>i<span class="token operator">%</span><span class="token number">300</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 第一指数 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">&lt;</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 第二指数 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第三指数 </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标反复函数                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">static</span> <span class="token keyword">int</span> ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>modified<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
   <span class="token keyword">int</span> limit<span class="token punctuation">;</span> 
<span class="token comment">//--- 第一计算或者柱数被改变 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 复制MA值到指标缓冲区ColorLineBuffer </span>
      <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>MA_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span>ColorLineBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 复制失败-丢弃 </span>
      <span class="token comment">//--- 现在为每个柱设置线的颜色 </span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
         ColorBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getIndexOfColor</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 复制MA值到指标缓冲区ColorLineBuffer </span>
      <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>MA_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rates_total<span class="token punctuation">,</span>ColorLineBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
      ticks<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">// 数订单号 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ticks<span class="token operator">&gt;=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">//改变配色方案的时候 </span>
        <span class="token punctuation">{</span> 
         ticks<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 复位计数器 </span>
         modified<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 颜色更改的计数器 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>modified<span class="token operator">&gt;=</span><span class="token number">3</span><span class="token punctuation">)</span>modified<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 复位计数器  </span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token keyword">switch</span><span class="token punctuation">(</span>modified<span class="token punctuation">)</span> 
           <span class="token punctuation">{</span> 
            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token comment">// 第一配色方案 </span>
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>clrRed<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>clrBlue<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>clrGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Color scheme &quot;</span><span class="token operator">+</span>modified<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token keyword">break</span><span class="token punctuation">;</span> 
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token comment">// 第二配色方案 </span>
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>clrYellow<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>clrPink<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>clrLightSlateGray<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Color scheme &quot;</span><span class="token operator">+</span>modified<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token keyword">break</span><span class="token punctuation">;</span> 
            <span class="token keyword">default</span><span class="token operator">:</span><span class="token comment">// 第三配色方案 </span>
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>clrLightGoldenrod<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>clrOrchid<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>clrLimeGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Color scheme &quot;</span><span class="token operator">+</span>modified<span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 
      <span class="token keyword">else</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 设置初始位置 </span>
         limit<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 现在为每柱设置线的颜色 </span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>limit<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
            ColorBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">getIndexOfColor</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 为下一次调用返回prev_calculated值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div><h2 id="_24-9-plotindexsetstring"><a href="#_24-9-plotindexsetstring" class="header-anchor">#</a> 24.9 PlotIndexSetString</h2> <p>该函数设置指标的相应属性值，指标属性必须是字符串型。</p> <p>该函数设置指标的相应属性值，指标属性必须是字符串型。
参数</p> <p>plot_index</p> <p>[in] 绘制风格的索引编号</p> <p>prop_id</p> <p>[in] 取值范围是ENUM_PLOT_PROPERTY_STRING 枚举值之一。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true， 否则返回 false。</p> <h2 id="_24-10-plotindexgetinteger"><a href="#_24-10-plotindexgetinteger" class="header-anchor">#</a> 24.10 PlotIndexGetInteger</h2> <p>该函数设置指标的相应属性值，指标属性必须是整型，短整型，布尔型或者颜色型。此函数有两种变体。</p> <ol><li>通过指定的属性标识符进行调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>int  PlotIndexGetInteger( 
   int  plot_index,        // 图样式指数 
   int  prop_id,           // 属性标识符 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>通过指定的属性标识符和属性修饰语调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>int  PlotIndexGetInteger( 
   int  plot_index,        // 绘图指数 
   int  prop_id,           // 属性标识符 
   int  prop_modifier      // 属性修饰符 
   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>plot_index</p> <p>[in] 绘制风格的索引编号</p> <p>prop_id</p> <p>[in] 取值范围是ENUM_PLOT_PROPERTY_INTEGER 枚举值之一。</p> <p>prop_modifier</p> <p>[in] 指定属性的修饰符。只有颜色索引属性需要修饰符。</p> <p>prop_value</p> <p>[in] 属性值。</p> <p>返回值</p> <p>如果成功，返回 true，否则 false。</p> <p>注意</p> <p>此函数的功能旨在提取相应指标线的绘图设置。此函数通常与PlotIndexSetInteger函数协同工作，将绘制一条线的 绘图属性 复制到 另一条线上。</p> <p>示例：根据星期几为蜡烛着色的指标。每天的颜色以编程方式设置。
<img src="data:image/png;base64,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" alt="为蜡烛着色的指标"></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//---- 蜡烛颜色图 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;ColorCandles&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_CANDLES </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span>         OpenBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         HighBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         LowBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         CloseBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>         ColorCandlesColors<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
color          ColorOfDay<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>CLR_NONE<span class="token punctuation">,</span>clrMediumSlateBlue<span class="token punctuation">,</span> 
                              clrDarkGoldenrod<span class="token punctuation">,</span>clrForestGreen<span class="token punctuation">,</span>clrBlueViolet<span class="token punctuation">,</span>clrRed<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓冲区绘图 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>OpenBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>HighBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>LowBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>CloseBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>ColorCandlesColors<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 颜色缓存区设置颜色数 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_COLOR_INDEXES<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 为颜色缓存设置颜色 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>i<span class="token punctuation">,</span>ColorOfDay<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置精确度 </span>
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_DIGITS<span class="token punctuation">,</span>_Digits<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;We have %u colors of days&quot;</span><span class="token punctuation">,</span><span class="token function">PlotIndexGetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_COLOR_INDEXES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标重复函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">int</span> i<span class="token punctuation">;</span> 
   MqlDateTime t<span class="token punctuation">;</span> 
<span class="token comment">//---- </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
   <span class="token keyword">else</span> i<span class="token operator">=</span>prev_calculated<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//---- </span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      OpenBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      HighBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      LowBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      CloseBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 为每个蜡烛设置颜色 </span>
      <span class="token function">TimeToStruct</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      ColorCandlesColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>t<span class="token punctuation">.</span>day_of_week<span class="token punctuation">;</span> 
      <span class="token comment">//--- </span>
      i<span class="token operator">++</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 为下一次调用返回prev_calculated值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mql5yao/Chapter/twentythree.html" class="prev">
        23 第二十三章 文件函数
      </a></span> <span class="next"><a href="/mql5yao/Chapter/twentyfive.html">
        25 第二十五章 物件函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mql5yao/assets/js/app.f23448f4.js" defer></script><script src="/mql5yao/assets/js/3.a8269cb7.js" defer></script><script src="/mql5yao/assets/js/5.47d44717.js" defer></script>
  </body>
</html>
