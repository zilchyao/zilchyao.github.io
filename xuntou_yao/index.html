<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>迅投QMT Python文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="国信iQuant">
    
    <link rel="preload" href="/xuntou_yao/assets/css/0.styles.707c87bf.css" as="style"><link rel="preload" href="/xuntou_yao/assets/js/app.a1e6da50.js" as="script"><link rel="preload" href="/xuntou_yao/assets/js/3.1a891015.js" as="script"><link rel="preload" href="/xuntou_yao/assets/js/2.a20b9854.js" as="script"><link rel="prefetch" href="/xuntou_yao/assets/js/4.dd6953a0.js"><link rel="prefetch" href="/xuntou_yao/assets/js/5.aa654f77.js"><link rel="prefetch" href="/xuntou_yao/assets/js/6.5c16d474.js"><link rel="prefetch" href="/xuntou_yao/assets/js/7.39c2038a.js">
    <link rel="stylesheet" href="/xuntou_yao/assets/css/0.styles.707c87bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xuntou_yao/" aria-current="page" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">迅投QMT Python文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xuntou_yao/#_0-安装软件" class="sidebar-link">0） 安装软件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_0-1-下载-python-库" class="sidebar-link">0.1 下载 Python 库</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_0-2-补充历史数据" class="sidebar-link">0.2 补充历史数据</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_0-3-绑定模拟帐户" class="sidebar-link">0.3 绑定模拟帐户</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_0-4-测试程序下单指令" class="sidebar-link">0.4 测试程序下单指令</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#小结" class="sidebar-link">小结：</a></li></ul></li><li><a href="/xuntou_yao/#_1-模型研究" class="sidebar-link">1）模型研究</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_1-1-策略列表" class="sidebar-link">1.1 策略列表</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_1-2-参数设置" class="sidebar-link">1.2 参数设置</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_1-3-历史数据回测" class="sidebar-link">1.3 历史数据回测</a></li></ul></li><li><a href="/xuntou_yao/#_2-重要方法-函数-和对象" class="sidebar-link">2） 重要方法（函数）和对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-1-初始化函数-init" class="sidebar-link">2.1 初始化函数 init()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-2-行情事件函数-handlebar" class="sidebar-link">2.2 行情事件函数 handlebar()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-最重要的对象-contextinfo" class="sidebar-link">2.3 最重要的对象 ContextInfo</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-01-设置帐户-contextinfo-set-account" class="sidebar-link">2.3.01 设置帐户  ContextInfo.set_account()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-02-将毫秒时间转换成日期时间timetag-to-datetime" class="sidebar-link">2.3.02 将毫秒时间转换成日期时间timetagtodatetime()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-03-设置定时运行-contextinfo-run-time" class="sidebar-link">2.3.03 设置定时运行  ContextInfo.run_time()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-04-程序停止-stop" class="sidebar-link">2.3.04 程序停止 stop()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#小结-2" class="sidebar-link">小结：</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#品种相关" class="sidebar-link">=====品种相关=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-05-根据代码获取股票中文名称-contextinfo-get-stock-name" class="sidebar-link">2.3.05  根据代码获取股票中文名称  ContextInfo.getstockname()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-06-根据代码获取该股票的上市时间-get-open-date" class="sidebar-link">2.3.06  根据代码获取该股票的上市时间 getopendate()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-07-判断股票是否停牌-contextinfo-is-suspended-stock" class="sidebar-link">2.3.07  判断股票是否停牌  ContextInfo.issuspendedstock()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-8-获取板块目录信息-get-sector-list" class="sidebar-link">2.3.8  获取板块目录信息 getsectorlist()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-9-判定给定股票代码是否在指定的板块中-is-sector-stock" class="sidebar-link">2.3.9 判定给定股票代码是否在指定的板块中 issectorstock()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-10-判定给定股票是否属于某个类别-is-typed-stock" class="sidebar-link">2.3.10 判定给定股票是否属于某个类别 istypedstock()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-11-判定给定股票代码是否在指定的行业分类中-get-industry-name-of-stock" class="sidebar-link">2.3.11  判定给定股票代码是否在指定的行业分类中 getindustrynameofstock()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-12-创建板块-create-sector" class="sidebar-link">2.3.12  创建板块 create_sector()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-13-创建板块目录节点-create-sector-folder" class="sidebar-link">2.3.13 创建板块目录节点 createsectorfolder()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-14-设置板块成分股-reset-sector-stock-list" class="sidebar-link">2.3.14  设置板块成分股 resetsectorstock_list()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-15-移除板块成分股-remove-stock-from-sector" class="sidebar-link">2.3.15 移除板块成分股 removestockfrom_sector()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-16-添加板块成分股-add-stock-to-sector" class="sidebar-link">2.3.16  添加板块成分股 addstockto_sector()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#图表k线相关" class="sidebar-link">=====图表K线相关=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-17-获取当前主图市场-contextinfo-market" class="sidebar-link">2.3.17  获取当前主图市场 ContextInfo.market</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-18-获取当前图表的品种代码-contextinfo-stockcode" class="sidebar-link">2.3.18  获取当前图表的品种代码 ContextInfo.stockcode</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-19-获取当前图表的复权方式-contextinfo-dividend-type" class="sidebar-link">2.3.19  获取当前图表的复权方式 ContextInfo.dividend_type</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-20-获取当前周期-contextinfo-period" class="sidebar-link">2.3.20  获取当前周期 ContextInfo.period</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-21-获取当前图表上k线的数量-contextinfo-time-tick-size" class="sidebar-link">2.3.21  获取当前图表上K线的数量 ContextInfo.timeticksize</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-22-获取当前运行到-k-线索引号contextinfo-barpos" class="sidebar-link">2.3.22  获取当前运行到 K 线索引号ContextInfo.barpos</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-23-判定是否为最后一根-k-线contextinfo-is-last-bar" class="sidebar-link">2.3.23  判定是否为最后一根 K 线ContextInfo.islastbar()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-24-判定是否为新的-k-线contextinfo-is-new-bar" class="sidebar-link">2.3.24  判定是否为新的 K 线ContextInfo.isnewbar()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#回测相关" class="sidebar-link">=====回测相关=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-25-设定回测起止时间contextinfo-start-contextinfo-end" class="sidebar-link">2.3.25  设定回测起止时间ContextInfo.start / ContextInfo.end</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-26-获取回测基准品种contextinfo-benchmark" class="sidebar-link">2.3.26  获取回测基准品种ContextInfo.benchmark</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-27-设定回测初始资金contextinfo-capital" class="sidebar-link">2.3.27  设定回测初始资金ContextInfo.capital</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-28-获取策略回测的净值contextinfo-get-net-value" class="sidebar-link">2.3.28 获取策略回测的净值ContextInfo.getnetvalue()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-29-设定回测滑点contextinfo-set-slippage" class="sidebar-link">2.3.29  设定回测滑点ContextInfo.set_slippage()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-30-获取策略设定的滑点contextinfo-get-slippage" class="sidebar-link">2.3.30 获取策略设定的滑点ContextInfo.get_slippage()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-31-设定回测手续费率contextinfo-set-commission" class="sidebar-link">2.3.31  设定回测手续费率ContextInfo.set_commission()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-32-获取策略设定的各种手续费率contextinfo-get-commission" class="sidebar-link">2.3.32 获取策略设定的各种手续费率ContextInfo.get_commission()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-33-表示当前是否开启回测模式contextinfo-do-back-test" class="sidebar-link">2.3.33  表示当前是否开启回测模式ContextInfo.dobacktest</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_2-3-34-获取某个记录类型对应的某个时刻的记录情况get-result-records" class="sidebar-link">2.3.34  获取某个记录类型对应的某个时刻的记录情况getresultrecords()</a></li></ul></li><li><a href="/xuntou_yao/#_3-获取数据" class="sidebar-link">3） 获取数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#最常用的方法" class="sidebar-link">=====最常用的方法=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-01-获取帐户交易数据get-trade-detail-data" class="sidebar-link">3.01  获取帐户交易数据gettradedetail_data()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-02-获取板块成份股contextinfo-get-stock-list-in-sector" class="sidebar-link">3.02 获取板块成份股ContextInfo.getstocklistinsector()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-03-获取市场行情第二版contextinfo-get-market-data-ex" class="sidebar-link">3.03 获取市场行情第二版ContextInfo.getmarketdata_ex()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-04-获取分笔数据contextinfo-get-full-tick" class="sidebar-link">3.04  获取分笔数据ContextInfo.getfulltick()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-05-获取当日新股新债get-ipo-data" class="sidebar-link">3.05  获取当日新股新债getipodata()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-06-获取账户新股申购额度get-new-purchase-limit" class="sidebar-link">3.06 获取账户新股申购额度getnewpurchase_limit()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-07-获取指定市场的最新时间get-market-time" class="sidebar-link">3.07 获取指定市场的最新时间getmarkettime()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-08-获取当前k-线对应的时间戳contextinfo-get-bar-timetag" class="sidebar-link">3.08 获取当前K 线对应的时间戳ContextInfo.getbartimetag()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-09-获取给定日期对应的-k-线索引号contextinfo-get-date-location" class="sidebar-link">3.09 获取给定日期对应的 K 线索引号ContextInfo.getdatelocation()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-10-获取当前主图品种最新分笔报价对应的时间戳contextinfo-get-tick-timetag" class="sidebar-link">3.10 获取当前主图品种最新分笔报价对应的时间戳ContextInfo.getticktimetag()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-11-获取一篮子证券编码数据contextinfo-load-stk-list" class="sidebar-link">3.11 获取一篮子证券编码数据ContextInfo.loadstklist()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-12-获取一篮子证券编码及数量数据contextinfo-load-stk-vol-list" class="sidebar-link">3.12 获取一篮子证券编码及数量数据ContextInfo.loadstkvol_list()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#行情相关" class="sidebar-link">=====行情相关=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-13-订阅行情数据contextinfo-subscribe-quote" class="sidebar-link">3.13 订阅行情数据ContextInfo.subscribe_quote()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-14-获取当前所有的行情订阅信息contextinfo-get-all-subscription" class="sidebar-link">3.14 获取当前所有的行情订阅信息ContextInfo.getallsubscription()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-15-订阅全推数据contextinfo-subscribe-whole-quote" class="sidebar-link">3.15 订阅全推数据ContextInfo.subscribewholequote()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-16-反订阅行情数据contextinfo-unsubscribe-quote" class="sidebar-link">3.16 反订阅行情数据ContextInfo.unsubscribe_quote()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-17-获取筹码分布-分价-完整档位数据get-chip-distribution" class="sidebar-link">3.17 获取筹码分布（分价）完整档位数据getchipdistribution()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-18-获取筹码分布中指定价格所在的比例-get-winner-chips" class="sidebar-link">3.18 获取筹码分布中指定价格所在的比例 getwinnerchips()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-19-获取筹码分布中指定比例所在的价格档位get-chips-price" class="sidebar-link">3.19 获取筹码分布中指定比例所在的价格档位getchipsprice&quot;()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#品种相关-2" class="sidebar-link">=====品种相关=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-20-根据代码获取合约详细信息-contextinfo-get-instrumentdetail" class="sidebar-link">3.20 根据代码获取合约详细信息 ContextInfo.get_instrumentdetail()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-21-获取最新流通股本contextinfo-get-last-volume" class="sidebar-link">3.21 获取最新流通股本ContextInfo.getlastvolume()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-22-获取总股数-本-contextinfo-get-total-share" class="sidebar-link">3.22 获取总股数（本）ContextInfo.gettotalshare()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-23-获取换手率contextinfo-get-turnover-rate" class="sidebar-link">3.23 获取换手率ContextInfo.getturnoverrate()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-24-根据代码获取对应股票的内盘-外盘成交量contextinfo-get-svol-contextinfo-get-bvol" class="sidebar-link">3.24 根据代码获取对应股票的内盘/外盘成交量ContextInfo.get_bvol()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-25-获取行业成份股contextinfo-get-industry" class="sidebar-link">3.25 获取行业成份股ContextInfo.get_industry()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-26-获取指数成份股contextinfo-get-sector" class="sidebar-link">3.26 获取指数成份股ContextInfo.get_sector()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-27-获取某只股票在某指数中的绝对权重contextinfo-get-weight-in-index" class="sidebar-link">3.27 获取某只股票在某指数中的绝对权重ContextInfo.getweightin_index()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-28-获取财务数据contextinfo-get-financial-data" class="sidebar-link">3.28 获取财务数据ContextInfo.getfinancialdata()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-29-获取原始财务数据contextinfo-get-raw-financial-data" class="sidebar-link">3.29 获取原始财务数据ContextInfo.getrawfinancial_data()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-30-获取指定个股-合约-指数的-k-线-交易日-列表-contextinfo-get-trading-dates" class="sidebar-link">3.30 获取指定个股 / 合约 / 指数的 K 线（交易日）列表 ContextInfo.gettradingdates()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-31-获取龙虎榜数据contextinfo-get-longhubang" class="sidebar-link">3.31 获取龙虎榜数据ContextInfo.get_longhubang()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-32-获取十大股东数据contextinfo-get-top10-share-holder" class="sidebar-link">3.32 获取十大股东数据ContextInfo.gettop10share_holder()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-33-获取股东数数据contextinfo-get-holder-num" class="sidebar-link">3.33 获取股东数数据ContextInfo.getholdernum()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#用于期货市场" class="sidebar-link">=====用于期货市场=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-34-获取当前期货主力合约contextinfo-get-main-contract" class="sidebar-link">3.34 获取当前期货主力合约ContextInfo.getmaincontract()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-35-获取合约乘数contextinfo-get-contract-multiplier" class="sidebar-link">3.35 获取合约乘数ContextInfo.getcontractmultiplier()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-36-获取期货合约到期日contextinfo-get-contract-expire-date" class="sidebar-link">3.36 获取期货合约到期日ContextInfo.getcontractexpire_date()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-37-获取指定期权品种的详细信息contextinfo-get-option-detail-data" class="sidebar-link">3.37 获取指定期权品种的详细信息ContextInfo.getoptiondetail_data()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-38-获取指定期权标的对应的期权品种列表contextinfo-get-option-undl-data" class="sidebar-link">3.38 获取指定期权标的对应的期权品种列表ContextInfo.getoptionundl_data()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-39-获取指定期权列表contextinfo-get-option-list" class="sidebar-link">3.39 获取指定期权列表ContextInfo.getoptionlist()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-40-获取股票期权的实时隐含波动率contextinfo-get-option-iv" class="sidebar-link">3.40 获取股票期权的实时隐含波动率ContextInfo.getoptioniv()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-41-基于bs模型计算欧式期权理论价格contextinfo-bsm-price" class="sidebar-link">3.41 基于BS模型计算欧式期权理论价格ContextInfo.bsm_price()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-42-基于bs模型计算欧式期权隐含波动率contextinfo-bsm-iv" class="sidebar-link">3.42 基于BS模型计算欧式期权隐含波动率ContextInfo.bsm_iv()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#几乎不用" class="sidebar-link">=====几乎不用=====</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-43-获取历史行情-contextinfo-get-history-data" class="sidebar-link">3.43  获取历史行情 ContextInfo.gethistorydata()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-44-下载指定合约代码指定周期对应时间范围的行情数据down-history-data-download-history-data" class="sidebar-link">3.44 下载指定合约代码指定周期对应时间范围的行情数据downloadhistorydata()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-45-获取本地行情数据contextinfo-get-local-data" class="sidebar-link">3.45 获取本地行情数据ContextInfo.getlocaldata()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-46-根据etf基金代码获取etf申赎清单及对应成分股数据get-etf-info" class="sidebar-link">3.46 根据ETF基金代码获取ETF申赎清单及对应成分股数据getetfinfo()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-47-根据etf基金代码获取etf的基金份额参考净值get-etf-iopv" class="sidebar-link">3.47 根据ETF基金代码获取ETF的基金份额参考净值getetfiopv()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-48-获取某只指数历史调整日的历史的成分股列表contextinfo-get-his-index-data" class="sidebar-link">3.48 获取某只指数历史调整日的历史的成分股列表ContextInfo.gethisindex_data()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-49-获取市场已退市合约contextinfo-get-his-contract-list" class="sidebar-link">3.49 获取市场已退市合约ContextInfo.gethiscontract_list()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-50-获取对应周期的北向数据contextinfo-get-north-finance-change" class="sidebar-link">3.50 获取对应周期的北向数据ContextInfo.getnorthfinance_change()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-51-获取-北向-指定品种的持股统计及明细contextinfo-get-hkt-statistics-contextinfo-get-hkt-details" class="sidebar-link">3.51 获取（北向）指定品种的持股统计及明细ContextInfo.gethktdetails()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-52-获取无风险利率contextinfo-get-risk-free-rate" class="sidebar-link">3.52 获取无风险利率ContextInfo.getriskfree_rate()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-53-获取除权除息日和复权因子contextinfo-get-divid-factors" class="sidebar-link">3.53 获取除权除息日和复权因子ContextInfo.getdividfactors()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-54-获取某只股票st的历史contextinfo-get-his-st-data-获取历史st状态get-st-status" class="sidebar-link">3.54 获取某只股票ST的历史getststatus()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-55-设置股票池-contextinfo-set-universe" class="sidebar-link">3.55 设置股票池  ContextInfo.set_universe()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_3-56-获取已设置的股票池中的品种列表contextinfo-get-universe" class="sidebar-link">3.56 获取已设置的股票池中的品种列表ContextInfo.get_universe()</a></li></ul></li><li><a href="/xuntou_yao/#_4-交易动作的方法-函数" class="sidebar-link">4） 交易动作的方法（函数）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-01-综合交易下单passorder" class="sidebar-link">4.01  综合交易下单passorder()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-02-智能算法交易smart-algo-passorder" class="sidebar-link">4.02  智能算法交易smartalgopassorder()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-03-根据委托号获取委托或成交信息get-value-by-order-id" class="sidebar-link">4.03  根据委托号获取委托或成交信息getvaluebyorderid()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-04-获取最新的委托或成交的委托号get-last-order-id" class="sidebar-link">4.04  获取最新的委托或成交的委托号getlastorder_id()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-05-查询委托是否可撤销can-cancel-order" class="sidebar-link">4.05 查询委托是否可撤销cancancelorder()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-06-取消委托-cancel" class="sidebar-link">4.06 取消委托 cancel()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-07-取消任务cancel-task" class="sidebar-link">4.07 取消任务cancel_task()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-08-暂停任务pause-task" class="sidebar-link">4.08 暂停任务pause_task()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-09-继续任务resume-task" class="sidebar-link">4.09 继续任务resume_task()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-10-实时触发前一根k线信号do-order" class="sidebar-link">4.10 实时触发前一根K线信号do_order()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-11-指定手数交易order-lots" class="sidebar-link">4.11 指定手数交易order_lots()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-12-指定价值交易order-value" class="sidebar-link">4.12 指定价值交易order_value()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-13-指定比例交易order-percent" class="sidebar-link">4.13 指定比例交易order_percent()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-14-指定目标价值交易order-target-value" class="sidebar-link">4.14 指定目标价值交易ordertargetvalue()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-15-指定目标比例交易order-target-percent" class="sidebar-link">4.15 指定目标比例交易ordertargetpercent()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-16-指定股数交易order-shares" class="sidebar-link">4.16 指定股数交易order_shares()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-17-期货买入开仓buy-open" class="sidebar-link">4.17 期货买入开仓buy_open()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-18-期货买入平仓-平今优先-buy-close-tdayfirst" class="sidebar-link">4.18 期货买入平仓（平今优先）buyclosetdayfirst()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-19-期货买入平仓-平昨优先-buy-close-ydayfirst" class="sidebar-link">4.19 期货买入平仓（平昨优先）buycloseydayfirst()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-20-期货卖出开仓sell-open" class="sidebar-link">4.20 期货卖出开仓sell_open()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-21-期货卖出平仓-平今优先-sell-close-tdayfirst" class="sidebar-link">4.21 期货卖出平仓（平今优先）sellclosetdayfirst()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-22-期货卖出平仓-平昨优先-sell-close-ydayfirst" class="sidebar-link">4.22 期货卖出平仓（平昨优先）sellcloseydayfirst()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-23-已弃用-获取两融负债合约明细-5-24-get-debt-contract" class="sidebar-link">4.23 [已弃用]获取两融负债合约明细（5.24） getdebtcontract()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-24-获取两融担保标的明细get-assure-contract" class="sidebar-link">4.24 获取两融担保标的明细getassurecontract()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-25-获取可融券明细-get-enable-short-contract" class="sidebar-link">4.25 获取可融券明细 getenableshort_contract()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-26-算法交易下单algo-passorder" class="sidebar-link">4.26 算法交易下单algo_passorder()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-27-获取股票篮子get-basket" class="sidebar-link">4.27 获取股票篮子get_basket()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-28-设置股票篮子set-basket" class="sidebar-link">4.28 设置股票篮子set_basket()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-29-获取未了结负债合约明细get-unclosed-compacts" class="sidebar-link">4.29 获取未了结负债合约明细getunclosedcompacts()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-30-获取已了结负债合约明细get-closed-compacts" class="sidebar-link">4.30 获取已了结负债合约明细getclosedcompacts()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-31-获取沪深港通汇率数据get-hkt-exchange-rate" class="sidebar-link">4.31 获取沪深港通汇率数据gethktexchange_rate()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-32-取可融券明细get-enable-short-contract" class="sidebar-link">4.32 取可融券明细getenableshort_contract()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-33-取期权标的持仓get-option-subject-position" class="sidebar-link">4.33 取期权标的持仓getoptionsubject_position()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-34-取期权组合持仓get-comb-option" class="sidebar-link">4.34 取期权组合持仓getcomboption()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-35-构建期权组合持仓make-option-combination" class="sidebar-link">4.35 构建期权组合持仓makeoptioncombination()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_4-36-解除期权组合持仓release-option-combination" class="sidebar-link">4.36 解除期权组合持仓releaseoptioncombination()</a></li></ul></li><li><a href="/xuntou_yao/#_5-成交回报实时主推函数" class="sidebar-link">5） 成交回报实时主推函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_5-1-资金账号变化account-callback" class="sidebar-link">5.1  资金账号变化account_callback()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_5-2-任务状态变化task-callback" class="sidebar-link">5.2 任务状态变化task_callback()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_5-3-委托状态变化order-callback" class="sidebar-link">5.3 委托状态变化order_callback()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_5-4-成交状态变化deal-callback" class="sidebar-link">5.4 成交状态变化deal_callback()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_5-5-持仓状态变化position-callback" class="sidebar-link">5.5 持仓状态变化position_callback()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_5-6-异常下单主推ordererror-callback" class="sidebar-link">5.6 异常下单主推orderError_callback()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#需帐户支持的方法-略" class="sidebar-link">需帐户支持的方法，略</a></li></ul></li><li><a href="/xuntou_yao/#_6-引用函数" class="sidebar-link">6）  引用函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-1-获取外部扩展数据" class="sidebar-link">6.1 获取外部扩展数据</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#ext-data" class="sidebar-link">ext_data()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-2-获取扩展数据按数值品种排名" class="sidebar-link">6.2 获取扩展数据按数值品种排名</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#ext-data-rank" class="sidebar-link">extdatarank()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-3-获取扩展数据按时间品种排名" class="sidebar-link">6.3 获取扩展数据按时间品种排名</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#ext-data-rank-range" class="sidebar-link">extdatarank_range()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-4-获取扩展数据时间区间内的值" class="sidebar-link">6.4 获取扩展数据时间区间内的值</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#ext-data-range" class="sidebar-link">extdatarange()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-5-获取因子数据" class="sidebar-link">6.5 获取因子数据</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#get-factor-value" class="sidebar-link">getfactorvalue()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-6-获取因子数据品种排名" class="sidebar-link">6.6 获取因子数据品种排名</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#get-factor-rank" class="sidebar-link">getfactorrank()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-7-调用vba模型" class="sidebar-link">6.7 调用VBA模型</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#call-vba" class="sidebar-link">call_vba()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_6-8-调用vba组合模型" class="sidebar-link">6.8 调用VBA组合模型</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#call-formula" class="sidebar-link">call_formula()</a></li></ul></li><li><a href="/xuntou_yao/#_7-绘图函数" class="sidebar-link">7）  绘图函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#_7-1-在界面上画图contextinfo-paint" class="sidebar-link">7.1 在界面上画图ContextInfo.paint()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_7-2-在图形上显示文字contextinfo-draw-text" class="sidebar-link">7.2 在图形上显示文字ContextInfo.draw_text()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_7-3-在图形上显示数字contextinfo-draw-number" class="sidebar-link">7.3 在图形上显示数字ContextInfo.draw_number()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_7-4-在两个数之间绘垂直线contextinfo-draw-vertline" class="sidebar-link">7.4 在两个数之间绘垂直线ContextInfo.draw_vertline()</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#_7-5-在图形上绘制小图标contextinfo-draw-icon" class="sidebar-link">7.5 在图形上绘制小图标ContextInfo.draw_icon()</a></li></ul></li><li><a href="/xuntou_yao/#附录" class="sidebar-link">附录：</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xuntou_yao/#一、macd-红绿买卖-回测模型源码" class="sidebar-link">一、MACD 红绿买卖 回测模型源码</a></li><li class="sidebar-sub-header"><a href="/xuntou_yao/#二、macd-红绿买卖-实时交易模型源码" class="sidebar-link">二、MACD 红绿买卖 实时交易模型源码</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><img src="/xuntou_yao/assets/img/xtqmtyao.dd80c0aa.jpg" alt="封面logo"></p> <p><font size="16" color="blue">迅投QMT开发上手指南</font></p> <p><font size="4" color="gray">基于官方知识库，写给股民朋友们的迅投内置Python开发入门指南</font></p> <p>【腾讯文档】迅投QMT开发上手指南
https://docs.qq.com/doc/DR1dTc2d6T3hUUGFz</p> <h2 id="_0-安装软件"><a href="#_0-安装软件" class="header-anchor">#</a> 0） 安装软件</h2> <p>本文档由 <strong>智能交易*姚</strong> 个人维护 <font color="blue"> vx: 21523544</font>，<font color="red">欢迎加入QQ群：861129742 </font>
基于 迅投官方知识库（https://dict.thinktrader.net/?id=PN4WZC）</p> <p>迅投QMT 是一款国产的量化交易工具。类似于通达信、同花顺、大智慧、文华财经等，是国内A股、期货市场上，投资者电脑（PC）上应用的一套软件，目前（2024年）还没有手机端的应用App。目前已经 覆盖了绝大部分的券商和期货公司。支持 Python 语言编程，同时兼容 VBA 公式的运用。</p> <p>安装迅投QMT最低配置只需要 Windows 7 x 32 位操作系统即可，但强烈建议还是用 Win10 x 64位以上的操作系统吧，别怀旧了。内存建议 8G - 16G，硬盘至少 1T以上了吧，现在硬件真的不贵了。何必为难自己呢。</p> <p>获取迅投QMT最简单的方式就是直接找你的客户经理，从券商那里获得一个安装文件比较可靠，同时也能获取一个或多个仿真帐户，用于之后的练习操作，简单方便。（然后你会发现客户经理一问三不知，牛头不对马嘴。还是得靠自己啊。）</p> <p>我看看，都4202年了，还有谁不知道 迅投的投研版是可以直接下载试用的？同时还可以申请A股和期货的仿真帐号，24小时都可以模拟交易。链接如下：
https://xuntou.net/#/download?id=PN4WZC
普通券商版的，也可以通过网页，全程自助下载，申请仿真帐号。通常24小时之内就可以用上了。</p> <p>一，需要先申请一个 迅投 的帐号，以便登入 迅投 的软件，通常是 手机号。（不用挣扎了，天朝之下谈什么隐私嘛。）并且，要求开通 程序化交易 的权限，才有用。</p> <p>二，需要至少一个仿真帐号，就是一个可以交易股票的模拟帐号。并且这个帐号也需要开通 程序化交易 的权限，并且这个程序化交易特指是 来自迅投QMT的程序化交易指令，用别的程序化还不行！</p> <p>到目前为止 ，国信证券的 iQuant （就是迅投QMT换了个名）仍然是 0 门坎，完全免费。网页上直接申请，一步到位。</p> <p>国信证券的 iQuant 可访问下面的链接直接下载：
https://www.guosen.com.cn/gs/iquant/index.html</p> <p>下载后可得到一个安装文件包，解压安装即可。以上操作如果有疑问，可参考视频内容，更加流畅直观。或在线寻求帮助。</p> <p><img src="/xuntou_yao/assets/img/xtqmt00.3136002f.png" alt="安装包"></p> <p>如前所述，迅投QMT目前流行的版本，主要为 券商提供的普通版，和官方推行的投研版（高级版）。2者都包含 miniQMT 库，有经验的 Python 开发者可以作为一个第三方库导入使用。</p> <p>本文档主要介绍 迅投QMT 中 内置 的 Python 语言调用的方法。暂不涉及 miniQMT ，VBA 等内容。其中 迅投QMT投研版 中用到的高级函数和功能，也会在文档中标注，敬请留意。</p> <p>相关文档、视频也可通过以下链接观看：
B站视频
https://www.bilibili.com/video/BV1rh4y1z7e3/?spm_id_from=333.337.search-card.all.click
迅投视频中心的课程
https://www.xuntou.net/plugin.php?id=keke_video_base&amp;ac=list&amp;cid=1&amp;scid=5&amp;user_code=PN4WZC</p> <p>如果你是一名初学者，希望本文档能成为你的入门指引。从上手安装软件 到 运行你的第一个量化程序。通过实例建立起基本概念，从而打开你的思路，进入量化交易的世界，进而成为你终身事业版图中的一块拼图，即是本文档的意义所在。</p> <p>如果你是一名有经验 Python 开发人员，那么本文档对你而言就是一个简明参考手册。在开发过程中，调用需要的函数即可。在目录大纲中，我已尽可能的按功能需求做了编号。希望能帮助到你快速的找到需求对应的方法。同时欢迎你随时提出宝贵意见，不胜感谢。</p> <p>如果你完全不了解量化交易，更没有 Python语言的基础。就是要硬啃本文档，那......劝退吧！（我就是这么傲骄！咋的！！）建议从本人写的另一个文档开始，即 Python 语言基础，链接如下：
Python 基础文档
https://zilchyao.github.io/python/</p> <p>如果你还对其它量化工具感兴趣，也可以参考本人创建的其它文档。同样欢迎各种高手、大神们的不吝赐教。
MQL5中文手册线上精校版
https://zilchyao.github.io/mql5yao
新手小白 功夫量化上手指南
https://zilchyao.github.io/kungfu</p> <hr> <p>安装过程。一路点击 next 即可，此过程就不再赘述。
安装完成，成功登录之后，请先检查以下3点：</p> <h3 id="_0-1-下载-python-库"><a href="#_0-1-下载-python-库" class="header-anchor">#</a> 0.1 下载 Python 库</h3> <p>如果用 Python 语言做为开发语言，请先下载 Python库。
请参考下图操作（如图片显示太小，不清晰。可用鼠标右键点击图片，然后在菜单中点击 “在新标签页中打开图像”，即可看到高清大图 ）：</p> <p><img src="/xuntou_yao/assets/img/xtqmt02.63b27b78.png" alt="添加帐号"></p> <p>点击界面顶部的“设置”铵钮，然后在弹出的 系统设置 窗口中，点击 “交易设置” 最下面的 “模型设置” ，然后点击 Python库下载。下载过程中，请不要断网。如果很卡慢，也可以直接找券商技术支持部门要一个压缩包。</p> <p><strong>迅投QMT自带的 Python 环境</strong></p> <table><thead><tr><th><strong>名称</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>NumPy</td> <td>NumPy (Numeric Python) 提供了许多高级的数值编程工具。</td></tr> <tr><td>Pandas</td> <td>Python Data Analysis Library 或 Pandas 是基于 NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。</td></tr> <tr><td>Patsy</td> <td>一个线性模型分析和构建工具库。</td></tr> <tr><td>SciPy</td> <td>SciPy 函数库在 NumPy 库的基础上增加了众多的数学、科学以及工程计算中常用的库函数。例如线性代数、常微分方程数值求解、信号处理、图像处理、稀疏矩阵等等。</td></tr> <tr><td>Statsmodels</td> <td>Python 的统计建模和计量经济学工具包，包括一些描述统计、统计模型估计和推断。</td></tr> <tr><td>TA_Lib</td> <td>技术分析库，是一种广泛用在程序化交易中进行金融市场数据的技术分析的函数库。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>迅投自带 Python 版本 3.6 版。因此无需再安装  Python 相关的软件。</p></div> <p>新手用户无需过多关注，直接使用就可以了。有Python基础的朋友可以通过下面的操作来查看一下这些库的版本号：</p> <p>第一步，在主界面中点击 “新建策略”按钮，选择“Python 策略”，打开代码编辑窗口；</p> <p>第二步，把下列代码粘帖到文本窗口中；</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>
<span class="token keyword">import</span> sys<span class="token punctuation">,</span>numpy<span class="token punctuation">,</span>pandas<span class="token punctuation">,</span>patsy<span class="token punctuation">,</span>scipy<span class="token punctuation">,</span>statsmodels<span class="token punctuation">,</span>talib

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Python的版本是：&quot;</span><span class="token punctuation">,</span>sys<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;模块 NumPy 的版本是：&quot;</span><span class="token punctuation">,</span>numpy<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;模块 Pandas 的版本是：&quot;</span><span class="token punctuation">,</span>pandas<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;模块 Patsy 的版本是：&quot;</span><span class="token punctuation">,</span>patsy<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;模块 SciPy 的版本是：&quot;</span><span class="token punctuation">,</span>scipy<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;模块 statsmodels 的版本是：&quot;</span><span class="token punctuation">,</span>statsmodels<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;模块 TA-Lib 的版本是：&quot;</span><span class="token punctuation">,</span>talib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果:
Python的版本是： 3.6.8 (default, Dec 19 2022, 22:05:09) [MSC v.1900 64 bit (AMD64)]
模块 NumPy 的版本是： 1.19.1
模块 Pandas 的版本是： 0.22.0
模块 Patsy 的版本是： 0.5.0
模块 SciPy 的版本是： 1.5.2
模块 statsmodels 的版本是： 0.12.0
模块 TA-Lib 的版本是： 0.4.17
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>第三步，点击策略代码编辑器顶部的“编译”按钮；</p> <p>第四步，点击“运行”按钮，即可 在日志窗口中看到相关信息。</p> <h3 id="_0-2-补充历史数据"><a href="#_0-2-补充历史数据" class="header-anchor">#</a> 0.2 补充历史数据</h3> <p>1） 点击界面顶部的 “操作” 铵钮；<br>
2） 然后在出现的下拉菜单中点击选择 “数据管理”；<br>
3） 然后在弹出的 数据管理 窗口中点击 “补充数据” ；<br>
4） 在左侧，可以勾选交易所，选择数据类型；通常勾选上海和深圳交易所，K线数据；也可以根据自己的需要选择；<br></p> <p>5） 在右侧，可以选择数据范围；如最近1月，1分钟数据；<br>
6） 决定之后记得点击 开始。<br></p> <p><img src="/xuntou_yao/assets/img/xtqmt03.26c4d320.png" alt="补充历史数据"></p> <p>即会开始下载数据，视数据量大小，所需的时间不同。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>建议在休盘时间下载数据，速度较快。请尽可能下载好 1分钟的 K线数据以备用。另 投研版 与 普通券商版 提供的数据 有所差别。但基本的 K线数据、财务数据等，都是与交易所保持一致的。</p></div> <h3 id="_0-3-绑定模拟帐户"><a href="#_0-3-绑定模拟帐户" class="header-anchor">#</a> 0.3 绑定模拟帐户</h3> <p>确认模拟帐户是否已绑定到讯投的终端中。国信的iQuant自带仿真帐户，可以略过此步骤。如果没有看到模拟帐号，需手动添加，请按下图所示操作：</p> <p><img src="/xuntou_yao/assets/img/xtqmt01.07786f04.png" alt="添加帐号"></p> <p>点击界面顶部的 “当前帐号” ，然后在弹出的 系统设置 窗口中，点击 “帐号管理”。如果已看到自己的帐号即表示已成功绑定；如果没有，则需要手动添加，点击 “添加”按钮，输入帐号信息即可。</p> <h3 id="_0-4-测试程序下单指令"><a href="#_0-4-测试程序下单指令" class="header-anchor">#</a> 0.4 测试程序下单指令</h3> <p>绑定了股票交易帐号后，需要先检证一下，是否可以通过程序指令下单。</p> <p>第一步，在主界面中点击 “新建策略”按钮，选择“Python 策略”，打开代码编辑窗口；</p> <p><img src="/xuntou_yao/assets/img/xtqmt04.16b29b4a.jpg" alt="复制粘帖代码"></p> <p>第二步，把下列代码粘帖到文本窗口中。注意其中的帐号要替换成你自己的帐号，并提前登录成功；</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">import</span> time  <span class="token comment"># 导入 time 模块</span>

<span class="token keyword">def</span> <span class="token function">myHandlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 自定义函数</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span> <span class="token comment"># 在日志中打印输出 Hello world</span>
	<span class="token comment"># 下单指令 在帐户 368920 中买入股票 000004.SZ 以对手价买入 100 股，即时下单。</span>
    passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">1101</span><span class="token punctuation">,</span> <span class="token string">'00368920'</span><span class="token punctuation">,</span> <span class="token string">'000004.SZ'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'00368920'</span><span class="token punctuation">)</span>  <span class="token comment"># 设置交易帐号为 00368920 注意此处替换成你自己的帐号</span>
	stocklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'000004.SZ'</span><span class="token punctuation">]</span>            
	<span class="token comment"># 每5秒执行一次自定义函数 myHandlebar</span>
    ContextInfo<span class="token punctuation">.</span>run_time<span class="token punctuation">(</span><span class="token string">&quot;myHandlebar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5nSecond&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1970-01-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;SH&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>本文档中的示例代码都可以按此操作步骤进行测试运行。</p></div> <p>第三步，给这段代码起外名称，如“TESTACC”，然后先点击“编译”，再点击“运行”。然后在下面的“日志输出”窗口中，应该可以看到每5秒有一行文字“ Hello world ” 输出。即表示这段代码运行成功了，此时可以点击停止按钮，以结束运行。然后关闭代码编写窗口。</p> <p><img src="/xuntou_yao/assets/img/xtqmt05.3d127f80.png" alt="编译运行代码"></p> <p>第四步，请点击主界面上的“模型交易”按钮，以切换到模型交易界面。在此界面左侧，可以找到刚刚创建的策略代码“TESTACC”，</p> <p><img src="/xuntou_yao/assets/img/xtqmt27.a36e7054.png" alt="新建策略交易"></p> <p>点击之后会弹出“新建策略交易”</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtgAAAENCAYAAAA1yBIEAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABeISURBVHhe7dxPi27LVQfg+wlEv0GUaDRRI+ZonAk6yVxHImTsJxBEMvIbOBMchUAmESUDBVHzzyQaEzH4BzEXJ4KDBGJwIJFO2ltHiqy7zqpd++2ud7+7u5/Bw65atWr3cd99av9oTnzr397+9/t/+pd/vf/6P/7z/df+4ev3X/nq1+6//LdfWeKTn/7Lsl754pf/5lBf+OKXDvWJP/7z+8994a8P9dnPf+FBPv5Hf1bW9/jM5z7/rHz8U39a1s/oKf1ZnwLP8wc8ix/wLPbzrPaLz+pXfvUjr/32H/zJ/Uc+/1dX99Mf/KX7z3z6N96l1Z6Mn/3w4T7wM7/4jg/fv/+d609+4Bfu3/f+D93/xE996P697/v5+x/78Z+7f897P3j/1g/9zrfvAQCANQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFHhSw7+7uXqvWut4z6+suuefe+h6X7n1o/0y1FwCAp+fBv8GugmEMjHltZs+eeO/YX9Wb2Vpc7/M9Ltkz673kXgAAnN9FAbuHwZnH7I229ud6Huf1bGt9tnem77/kHnEPAADH+4/v3L926Vp28W+wcyCM87w2UvXFWl4fzXN9T2+31dvnK8zueY2fCQDAw1RB+pJw3Tzq32DncJjnlbhvj+oe3SU9e1X3aEbre/fNVHsBADheDNSXhuvmKv9EJKvuEWu5nnv6/FJbe/u9Y0+sRddeBwDgXHqwvjRcNw/+HzlWYpCsQmWu9flI3FvZ0xfvF43W4964nuvZVt/eewAAcA43CdhVaIy1rfWttViL4r49LtlX9fZaXttb7/r6HtV+AACOFYP1Q0L2Vf6JSOzN94hrM9WeS2t9nsU9e+W9s3tt9Y/GAADcThWoLw3ZT+432Hk+MuubrY3s7c3rW/O8BgDA8baC9CUh++KA3cNgFtfyOOr1vfL+rXtc2hvH1Xxkb1+X+2dzAACergf9E5HRuKr1vd2l9aj39L5q3Od5TzXfWhvpPZf25lrVF2sAADxNy/6JyGwea1trsZbX9uwZ9VZibzTr3aptGfVecg8AAM7t0f9EJNaqvtl8pvdX9vRsyftH81zPZn2jtVEdAICn68G/wQYAAN4kYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACz0OmD//Te/DwAAPNK7Ava3/+ceAAB4IAEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhAXux9hzh7Kp3F+AxqrMGzqZ6d69BwF6sPce7uzs4rSMPGODl8P3j7I78/gnYizlgOLsjDxjg5fD94+yO/P4J2IttHTCzw6et/+jv/df9597+brkOK7T3rHp3AR5j9o2DWzvy+3fTgP3q1auL6pVr9Y7M7rF1wMwOn7b+2W9893XIbteqBx6rvWfVuwvcxuy70tb3qvbmcdUX9XtlVW80+8bx/Nz/2lu7amdx5Pfv5gG7+stb1XNtVO/36GJtNI61Suzv15GtA2Z2+PT1HrLf/ub/vtEDj9Xes+rdBW5n69uS10a9VT3WtsZRr0ejejT7xvE87Q3ZvdauM3nvKkd+/24WsONf1kvG8RrX41pW7Y3rUVyrxlt7m60DZnb4tPXoNz/x32/0tJ+fbdWrtVl/X4/zXqv6R3XOqb1b1bsLnFM7V+M4q/r2zLNL7lVpZ0s+b9q+7gx1rqcKyl3uifN4rcZdrz2k3h35/bvpb7Cz9hehqjd9bXStxnv1PdU98jj3Z9UB022tVX7kd+vDqrqOxrFW1Wd9s/msj/M58oABau2snIm9cU+vx7U83pq3a1et53E1r+RvXNtTzW9V57pGoXZvfe/80np05Pfvpr/B3qv3V9d4rz7PtvZ2/R6VuKdfR/IBE1Vr3/uLP7z//ic/9i6tdvedb73RG7U/x6gW16q+aLTe6nvuM7s/53PkAQPs087Sqt7ktTbvcj33xHGsZbk+m1fyN67tqeaX1rNV9+Fx9gTaUT3WRuOsr+WeWT068vv3pH6DnfV67OnjqjbrzfVqPNrX5QMmqta+/7Ffvr//6A+/vnZt3tz95zfe6O/an6OqdVU91uLaqBbXLtnPMdr7NFL1d229eneB22lnaVVv2lo0W8vX2BvnUd8f91byviifPa2/ml9aj/NYG/WP6qwXQ2wVaGN9tj7S1mNP7u/zUT068vt304DdXvqZ2Juvcb2r9ozk9dl8VIvyARNVaz1Uv6v+nW/9f+j+/Y++ux60P8eoVq2N6nvvc8k9OU57p7KqL2o91bsL3E47S6t6k9favOqv+rbmsd7XRj3N1lqTz5/WX80vrWer7sNaLdCOxJ5Zb9P7o17P67N6dOT37+YBe++8j6tr1PsrW+uzvc2en5EPmKhaKwP2Rr1rf449tSz3jO4Tjfq26hynvVddtZ61vurdBY4Tz9iR2Bv3juqXzqO+tqdnJJ9Brb+aX1rPVt2HtapAu1XvZutd78v9s3p05PfvNAG7jbs4z72jazXeq+/JttZG8gETVWtVkP7e21+9v//1tx78G+w4zn2zea7N7jOqc6yt9y5rvdW7C9xOOzurehPX2njUm+tVX75XHrdrJfdX8jnU+qv5repcxyjg7tH2dNVaNb+0Hh35/btpwG7ai9/0ca7lvijuyeOs6s/a2ky1L8oHTFSttXD9xr/Bfidc3//We4b/Bjv+eapaXKtq1Z5cq+Z9HNe36pzTkQcMsE87P6t6U631MzfXtua5HtfbuOu1bGutqb5x8b5nqLPWKNyOxL68t7pHq3WPqXdHfv9uFrD7i59red5ro97e08WeuD6rVfb0ZNUB01VrrwP1O2H6Xf9fRL70qTf6YJUjDxhgn63vTf9m7ZH3xXmU+/t4tqeqd1vfP56fGGJHgTbqPTkA53Gcr3bk9+/mv8GOZn95K9UB0cez+8WePt4j3yfaOmCqtf5b61yHaznygAHeVH1XRnp/vkcl9832XXLfPb1b3z+er8cG4msG6uzI79+pAvZzsHXAVGsCNkc78oABXo6t7x+cwZHfPwF7MQcMZ3fkAQO8HL5/nN2R3z8BezEHDGd35AEDvBy+f5zdkd8/AXux9hzh7Kp3F+AxqrMGzqZ6d69BwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjAXqw9Rzi76t0FeIzqrIGzqd7daxCwF2vP8e7uDk7ryAMGeDl8/zi7I79/AvZiDhjO7sgDBng5fP84uyO/fwL2Yg4Yzu7IAwZ4OXz/OLsjv3+nC9ivXr0q611bH6n6oz09M7N7PPaAif/3zFT7uz3rI1U/z8eRBwxQa2dtVZ+5ZF8810dibzW+xEO+f+1nbc1n9WZrDaIjv383C9jtL0TW67Gnj7dqe+t77l2J/f06Uh0w8V7NqFaJ/Xmt17Nejz19vFXbqvN8HHnAAGPtvI3jLPb2njjOYm/vybUorm+No16vVN+/mXbPrfms3mytQXTk9++mAbua52t2ab3Ze+8mrlXjrb1NdcC0PXlc1eJ8Zmtvdc0urfN8HHnAAGu0s7mqb8l7RvN2reQ9cVypvn9N2/fYeqtFeS3OYeTI79/NA3Z17eNKX6/s7cvyvq1x7s+qA6btyeOqVs1n/Xk9XmNf1tcrVT/Px5EHDPB47VyuxjO9t5/tUVx/yLgy+v41ud7X9tS3+rKqD7ojv3+nDNi9Z5U9P6PVRuKefh3ZOmCian2rP4u9W1fIjjxggDe187nL8yzve0j/nnnf383qler717R9e2pRXu8/v4s9+QojR37/ThWwR2brWf8Z8f5b42jWP9rXVQdM21ONV+j3i9eR2XrWfwbn1N61kaq/a+vVuwscq52ze2q9vrU2qs/E3kvGldHZ0/ZV83Yd2dqX56N+nq/4vcuq/q6tV+/uNZz2N9j9Wtlai2Z9eX02H9Wi6j9u2xPHldw/E3v3XCtbazwN7X3Lqr6o9VTvLnCsdgZvzXN9tr633sX1No5GPX1cGZ0/bV9V7/L6qH/Ul6+8DPG711V9Ueup3t1reHIBe1TfY2vvnvu2nllf9R+47+t6La738aXy/UbXbFTn6WnvXFetZ62veneBY7VzuBpX81FtT71ds7g+G0e9XhmdQW1fVe/yejXPtuq8HGf+/p02YOdxrG3Z2xfF+0dbayPVf+R2nzzO17i+V3WffM3jWNuS+zm3vYdLc+QBA4y1s7ZfR6r+bFYf3SdeK7Enjyujc6jtq+pNtTbqz/U+z1delrN+/24WsLv2F2I0z2szW/19bdYzU+2Lqv/Qbd9svGVPX+55yM/pLu3naTnygAHG2llb1bu8Puqf1ds1i+tbYs+sf/T96/JaX99Ti/W8PuqH7Mjv300DdvtLEa99nOd9PFP15vuNapVLfnY3OmDyOF+zak8e51rum+0buaSXp+fIAwaotXM2XvcY9Vb1PfeNPZeOK9X3b0u736X1am3UD9mR37+bBez2F6Ka5/oebU91v9m9Yk8f75HvE+UDpvXHcZd7ct9orVqv1nJ9j7bnIft4Wo48YIA3tXM2z0dyX57v6cvyvqo/rlfzSv7+bWn3yvMu1qPR2tYeiI78/t30N9jP0SUHDNzCkQcM8HL4/nF2R37/BOzFHDCc3ZEHDPBy+P5xdkd+/wTsxRwwnN2RBwzwcvj+cXZHfv8E7MXac4Szq95dgMeozho4m+rdvQYBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQF7sfYc4eyqdxcAWEPAXqw9x7u7OzgtARsArkvAXkzA5uwEbAC4LgF7MQGbsxOwAeC6bhqwX716tTmfubS/me1p6yNVfyZgc3YCNgBc181/gx2Daw60XeyPvfGaxf1dr8eePt6qbdUzAZuzE7AB4LpuHrC7UfDdE4Iv6cnX7NJ6VgXstrd7TD2uVbVr1XleBGwAuK5T/QY7znO921vP94nX3Bv19UrVn+WA3fZV80vro/Gof1Wd50fABoDrulnAbgGuGc1zrRpHVc/W9VoeG7CzUX83us+qOs+PgA0A13Xz32A/RguBVb3pa/E6MlvP+s+orArYbR5rcd+oN9bzOM5jvRpXc86nvWsjVX/X1qt3FwBY46YBuwe/LdW+bmu9r82ula21mRxu2r2q+aiexf7YE+u9ludxz1bfnjnn1N63rOqLWk/17gIAa9w8YF86n8l7Z9dsVN8rB5x2v2o+qmez/kvvk8ej2ug+nE9757pqPWt91bsLAKzxpAJ2trXe10bXPI61Lbk/yyGn7anmR9ZH42h0H56GveG6EbAB4LpuGrCjFuj6tY8rcW00jnJ9z56RPf1V0Gn7ulvUq1pUrcU9PC8CNgBc180Ddg90e+t9rbpm1Xob53kfz+zprQI2nImADQDXdbOAnYPuSO/p/XvEfdV9Yn2PeN8ZAZuzE7AB4Lpu/hvs50bA5uwEbAC4LgF7MQGbsxOwAeC6BOzFBGzOTsAGgOsSsBdrzxHOrnp3AYA1BGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIVuFrDbz9ur2t+9evVqcz6rN1tr0d6+7NJ9rb+r1rvVf57V9wMAeIluGrCrevaQgB3ltUvGla31ttblepxHcU9X9WV7+kb33Nob1+L+Lvb2njjOYi8AwEvwpAN2DnCzeRTXRuM+n4n9la2ePfu7+DNHqn3Z3r6ZVfcBAHhOnmzAjuEuhst8zT1xfSTvi/Nsz3qW1+N8y6x3z736nyGq+mbivofeAwDgOXrSAXsUEFcGvtm9+nr/s0S5J4/7fGa0N8u92agv9+d51veO9mexHwDguXuyAbvLAa7PZ/V2Hcn7ZnJ/nOfanv6R1jtT7dmq5fW99+j1rbWqDgDw3D3pgB1DXBX2Yi1fo6rWba1lo95Yzz0r7t/tvXesz/bM7jFbBwB4aZ5swG4Brqvqsdbr+TqS983E3njN9a21dh3JvSN5vc9H9cesbdW26gAAz92T/g32llkY7OPRtWvzXIu29s3GcZ7rXd47U+3L8z197TpS9WejOgDAc/fkA3YMfXE8Enu3rqNaFnuyuJ77t8bRnp4u92a5Z88829s/uw8AwHN104C9V7W/BbitcJfXcq2PR9dc29L7K3k9zvN4pOqvzNab3FPdf899ulHvJfcAAHhObhawj7AV8qq1Vuv1uH7pfbp8j617ju5T3WNL3JvF9dyf9/b1Su7L86oPAOCleNYBGwAAjiZgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEJvBOy/+8a3AACAB/IbbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwA4HRaLuFy1bOsVHuZq55lRcAGAE4nhhr2q55lpdrLXPUsKwI2AHA6MdSwX/UsK9Ve5qpnWRGwAYDTiaGG/apnWan2Mlc9y4qADQCcTgw17Fc9y0q1l7nqWVYEbADgdGKoYb/qWVaqvcxVz7IiYAMApxNDDftVz7JS7WWuepYVARsAOJ0Yam7l7u6urGd7+45QPctKtfcpuPWzrp5lRcAGAE4nhppra6EtmtUrs/WjVM+yUu29lvwcu6q3i+t7xkepnmVFwAYATieGmqNshbe8tle8xxGqZ1mp9l5TfBZ9HJ9TXM99cZyvR6ueZUXABgBOJ4aao4xCW67vDXe3CIHVs6xUe68pPotqfOZnGlXPsiJgAwCnE0PNEXJwa/NK7Dmj6llWqr3XNHqOfVzV4nwk9h2hepYVARsAOJ0Yao6QQ1u+5tpefe9RqmdZqfZeU3wW1Tg/q1F/NKpfU/UsKwI2AHA6MdRcWwtqPazFayXui7bWjlQ9y0q195pGz7GPYy2L+7Kq/5qqZ1kRsAGA04mh5gg9rI2ueTxbu5XqWVaqvdc0elZ9vPX8Rmtbe66lepYVARsAOJ0Yao6Qg167Vqo9o/7Ye5TqWVaqvdcUn0d+PqNn1eu9v5L3XFv1LCsCNgBwOjHUHCGHtnzN49narVTPslLtvZb2bLK8Hue5Vq1v1a+pepYVARsAOJ0Yao7Qw9roOhpXfbdUPctKtfcoW88xj6v5rH5N1bOsCNgAwOnEUHO0Kri1Wq/n9b5WiX1HqJ5lpdp7lP5c8vMZPa+q3mqj/muqnmVFwAYATieGGvarnmWl2stc9SwrAjYAcDox1LBf9Swr1V7mqmdZEbABgNOJoYb9qmdZqfYyVz3LioANAJxODDXsVz3LSrWXuepZVgRsAOB0Yqhhv+pZVqq9zFXPsiJgAwCnE0MN+1XPslLtZa56lhUBGwA4nRhq2K96lpVqL3PVs6wI2AAAsJCADQAACwnYAACwkIANAAALCdgAALCQgA0AAAsJ2AAAsJCADQAACwnYAACwkIANAAALvStgAwAAK3z7/v8AUF1pz9MnfyIAAAAASUVORK5CYII=" alt="新建策略交易"></p> <p>在此窗口中，请选择指定你的帐号类型、资金帐号、主图代码、运行周期。最后记得点击 “确定”。</p> <p>第五步，点击了 “新建策略交易”窗口中的“确定”之后，即可在中间的策略列表部分看到刚刚选择的策略，其中策略名称就是上一步中选择的策略名称，主图标的、策略周期都是在“新建策略交易”窗口中的设定值，请仔细核对一下。</p> <p>此时请点击“运行模式”下面的按钮，以切换到“实盘”模式，在弹出的“提示”窗口中，点击“确定”</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAACGCAYAAADkZUw3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA19SURBVHhe7d1LryVVFcBxPoFvYtTEKEFbQYUIiiNNdOJMRyb4fkxM/AAmKipREw0SYoyYOHAgIGAEow7UibxaRIm8BAkiEhIGAsrtbm7TdNNNeddpF2f1umvt2nVO7epbnv/gl9q11tp7V+omtXIe994zHn7k0e6BBx/q7rv/b91d997X3fmXu7o7/nznyq779e+72+/401r23/7Hld26/w/Vrr7xd7tit9y2fy0333rbLF11w2/COMbHvR6X3s/3f+CDC1/80S+7t533HtR4x0VrO/ft795xUXfOzvEt576r23fOBd2b33pBd/a+d3Znven87g1nn9ed8ZIvbXUAALRCowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0tVKjOX78+EKUAwDAGqXR6HnEzuurtfw8AMA8jdpoSjUAgHl5/GC3MDTnDWo02jyGiNYBAMxD1FCGNBnBKxoAQJFtLEObjJjsM5ooV0PnAwBOH20wQ5uMWKvRjNEMxlgDANDWaW80fbL5pTEAYG+wDWaVZrPWlwFKNVFO2Rpf788BAKdP1FiGNpvRvwzgc57PR/VRDAAwrVJDGdJsmjUaG4vqSrFSHAAwL5O9ohkrDgCYl7UbjY49PycztB4AMC9rfRlA1eatmhoAwPyt9IoGAIBaNBoAQFM0GgBAUzQaAEBTNBoAQFM0GgBAUzQaAEBTi0Zz91MvAAAwulMazbETHQAAo6HRAACaotEAAJqi0QAAmqLRAACaotEAAJqi0QAAmqLRAACaotEAAJqi0QAAmqLRAACaotEAAJqi0QAAmqLRAACaotEAAJo6bY3m0f+c6C676Uj3oR8/0+37zsHuzK9uda/5+oHugisOdR/eiUnuH/8+Ec4FAMzH5I1GGsynrz3cvfwr8X9gs1725a1FrcyJ1gIA7H2TNppfPXCse+2lBxYbvuqSre4TP93urrvnaPfIziuX7WNdt3Xkhe6Bfx1fxD5+zfaiRmrllY7EojUBAHvbZI3m+/ufW7xCkX0uvmq7e+jJ/lcpUnPx1duLOS/dmfu9254L6wAAe9ckjeZn9x5bNAp5u+y7Nw9vFjJH5soaslZUAwDYm5o3Gvl8Rd76kvWjJiOvWuQttNf97y01qf3IT7a7ux8/fkqdzNV8689sLrzwwjCe8fVD53ul+UPWrqld9VrXuQ49X2WN2jlSp6L8EH4Ne963/pD9V7nWoXNaXk9NvdT0ieYNEa2paus8O88r5bPcKnMyvr5mvtQM3WcdzRvNZ647vNjgY9ds78o9/NSJ7o3fPNlgPrnTbC6/5bnu8z8/3L1i59XLq792oNv/6POn1MsaUvupaw+fEh+b/QHoD8TL6vU8q8v4ur56z8/P2Dpbb8eerdUaO/ZsrdZktcrP8WyNr7frKJsv1WXsHD/2x0xtnVVTa2tK9ZKrVTvP1kX6atbN18jWWPf6JWf1xW2+JqZsTtf0sno9j+psPhq31LTR/HPnlYd8LiMf6j/29O5XIdIwZF//2csv7j+2iL/vykOnxB/bOrFYS9aUtW1uTNHNL/1wsly0Tk3cH/v4umx+7Xolq6xRe30lpdpVrilj15KxZ+NaF/H5rF7X6uPnRGOvlLOy9bO4Pa81ZI7dYxXRmiqqV7amVG/jviab45XqolztnqU6jfmaqG5sTRuNvt312Z1XNVFe3i6TVy6Hju7e9/zLDy4+k/Hxz11/sjlFb8ONRW++/4H4sa1TUb3l49GcaG5Ul8lq++b1GbqW1FhRTONZLqNzdJ49X0fNWn37Z2uMdZ2yTkk2JxpHstq+eTWG7L2qbI1SXHO+JppTWieKR0q1klM25se2TkX1VlSX1Y6paaORX7yUdW+4L/4A/8ntF7q/P7X7lckzR7vurG8d6F7/jQO7cjf+9eSrHVnb59alNz268Tbm8z7nlXLKrqNHryZfy9f3zff7rFLvx9F5plQnuT59tTav46i+FI/Glq+xVo1FNRmtzeZIvFY0t3Ru432ieUNEa6qozsfsuY9la3g+Z+doLorV1Pu8z3m21urLj6lpo9n37YOLxYe8zXXk+a77wg0nX7Vc8tsju/KyluRkbZ8bS3Tzbczno5w/ekPm9J17teuU4qXaoevYuJ5btj5TqqtdQ0S1NubzpdzY+vaqjXm+pm+O5mvnjRXfC/quTfJKz+3Rj6PzLKb66kvr69gfPYlnuRaaNhr5szKyrrxCifKeNBn98oC8YpFf4vQ1EpO8fFbjc2OJfgA25vP2h5YdvShemmNj2ZrC5+ya2bxsjmfX8rksLjEV1UTnXlRnlXJeVGtjPi/nVlSzDr9+JporSjnL1g1ZT8/lGM2z+Zq4xvpE9TYWsfP7RPP72Ln2GPHzonMfV1HcxqL1NJYdPTtnCpM0mqefrVtXX8nIL3RGTUbspUajP6wsZ486zmRza9l5Q9l5fo1ozWyfbK6Ny9jTnOXjWZ3QnK4X8bVWKR/lsnoZ14rm1/JrWbV1ntbb+UPVrGNzNWM997FaffN07RJfXzr6cencx1UUtzE7X0U5e/T8vNaaNhp96+zBJ/rfOpMaqX3vDw51z+68solqxJRvnWU/rOxcjhlbb+dEsSinSjkh+T7RnL65Ub03JJ7VqiFzNN6X13Ekqo3qbY0eI6WcVVuXGTq/r17yfaJ5qpT3OXuejUuxjF/Ly2ojWb09Rvrm2KPXV5edyzFj60+Hpo1G/jKzrJt9GcCSOhHlrJZfBlD+h+N/ULXnPm6tkrNxGUd1viaLWVHM8vmsvi8ux0w2J4rZXDa2amqUz0dz5RjFs/NSPKutNWS+rZVx3/XoOIpFovpMac2+8z6ltb2heTlXNm/r7FjPo7roXGM23jcnO/dxS3Kl/NiaNpq+rzdbUieinDXV15ujcRYr1UfzNW75nD/3MZvLznUcxfy5j5dktbXxmj0lZ/m4Pfe5iNb08bX2XMd9NX2yuauomR/ta3PZuY6jmCUxH49iNheNS7FaOtcfM5Lv4+tLRz8ekotifXl/Xsr5eJZroWmjkb/KXPqFzaHkFzblcx9ZU9aOasYU/dBKMZ9TNm/rIzbfV6t8fQ07z66T8XX+PKqzeT36GhvTsa/xbH0U9/rWE1KjfNzmbdzSeB+/hs31sfv1sfV+Hc/X17D1di3P15TGvnYoP9eu6WVzvFI+yvn1fW6deLS2jfmcyuJTatpohP72v/zZ/yivpEZEOSVrSE3rP0EDABhP80Zj/6im/C2zqEZIXkQ5IXMlP8Uf1QQAjKd5oxHX33P0xX8TcOXtwz9b+eHOHP03AbJWVAMA2JsmaTTC/uOzj15d/4/P9C82S5O54tZ2XwAAALQxWaMR/l85y7fR5OvK8sH+4WPdgowlJjmpkVp5u+zau3klAwBzNGmjEfL5inyYr69uSqRGavlMBgDma/JGo6R5XHbTkcUvdcpv+b9y59WLkLHEJCf/GC2aCwCYj9PWaAAAm4FGAwBoikYDAGiKRgMAaIpGAwBoikYDAGiKRgMAaIpGAwBoikYDAGiKRgMAaIpGAwBoikYDAGiKRgMAaIpGA8zMmZc+gYLonkXkmYdcdM9WRaMBZiZ6uGIpumeRsR+m/09oNMCGix6uWIruWYRGk6PRABsuerhiKbpnERpNjkYDbLjo4Yql6J5FaDQ5Gg2w4aKHK5aiexah0eRoNMCGix6uWIruWYRGk6PRABsuerhiKbpnERpNjkYDbLjo4TqF2r1P5zUKe69K5tRopr5WGg2w4aKH65iy/bJ4pC/fkr/OTOuHt6wfiWqVzdeMWxl7DxoNMDPRw7UFu5ff1+dq2TVaifaNTP3A1rEcLc37Ojv2x9bG3odGA8xM9HBtIdvLx2uvaaprl31qTPHQtntE49prmOJarbH3o9EAMxM9XMfm9/HXoGzNXhFdZ2SKh7fsYdm4PfqxnmdsXQtj70GjAWYmeriOze/njz5WS+e2FO0bmfqBHY39NWT1VhYf09h70GiAmYkermOy+9hjxM6zSrnW/DVmpnpgWzZujxE7z4vqxzT2HjQaYGaih+vYdJ/s6Md9uSnJ3jWmfmBH49I1ZLnSnLGMvQeNBpiZ6OE6Nt3HHiPRnKze1rYU7R2Z+oEtY3+uY0vjWh/xc8Y29h40GmBmoofr2Px+/ujHfbkpyd41Wj+wZX3P5+25j0X5UnxMY+9BowFmJnq4jk33yY7ZOKqbmuxdY4oHtmX303EUy8774mMaew8aDTAz0cO1pWhPey0+r7mIrWsl2jcyxQPb0v38vtl1RHGJZfVjGnsPGg0wM9HDFUvRPYtM8cCeKxoNsOGihyuWonsWodHkaDTAhoserliK7lmERpOj0QAbLnq4Yim6ZxEaTY5GA2y46OGKpeieRWg0ORoNsOGihyuWonsWodHkaDTAhoserliK7lmERpOj0QAbLnq4Yim6ZxEaTY5GA2y46OGKpeieReSZh1x0z1ZFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANLWr0QAAMLYXGw0AAG1sdf8FcEIGaAyMU64AAAAASUVORK5CYII=" alt="确定运行策略"></p> <p>然后，请点击 “操作”下面的 三角符号，即可开始运行该策略。在下面的“成交”标签页中，如果看到了实际成交的股票，即表示该帐号已经通畅可用。</p> <p><img src="/xuntou_yao/assets/img/xtqmt07.02a6563a.png" alt="核对策略名称"></p> <p>如果下单失败，可能需要 <u>管理端  开放权限，这需要与券商联系</u>。</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结：</h3> <p>到此，安装 迅投软件 的全部操作步骤，包含下载 Python 环境、补充历史数据，绑定模拟帐户，并用一段代码测试模拟帐户是否已开通交易权限的全过程即全部完成。之后即可顺利开始使用 迅投软件，来进行量化交易的程序开发、历史测试、模拟测试等工作。</p> <hr> <h2 id="_1-模型研究"><a href="#_1-模型研究" class="header-anchor">#</a> 1）模型研究</h2> <p>本文档主要描述 量化程序交易 的功能。因此 迅投QMT 的基本操作教程，并未涉及。如果对 QMT 基础操作还不熟悉的朋友，建议先熟悉一下界面风格、基本操作。</p> <h3 id="_1-1-策略列表"><a href="#_1-1-策略列表" class="header-anchor">#</a> 1.1 策略列表</h3> <p>成功登录 迅投QMT之后，在主页界面中间部分即可看到 “策略列表”，其中应该包含的是 “我的策略”。如果点击 “返回”按钮，可以看到全部的（更多的）策略列表，如下图所示：</p> <p><img src="/xuntou_yao/assets/img/xtqmt09.9b7d81e0.png" alt="全部策略"></p> <p>其中在“类型”一栏中标明了该策略运用的语言，vba/python。在 PYTHON 模型指标 中，有一个 《PY简单示例》，请点击它后面的“编辑”按钮，即可打开策略编辑器，看到源代码，如下图所示：</p> <p><img src="/xuntou_yao/assets/img/xtqmt10.4227149d.png" alt="PY简单示例"></p> <p>从这个简单示例中，可以看到。在 迅投QMT中，编写 Python 程序，第一行声明了字符集是 <code>#coding:gbk</code> 。其中最重要的两个自定义函数就是 <strong>init()</strong> 和  <strong>handlebar()</strong></p> <p><font size="6" color="red">init()</font> —— 是初始化函数，即策略程序一启动，首先执行此函数。通常在这个函数中，书写获取股票池、验证帐号、声明全局变量等语句；</p> <p><font size="6" color="red">handlebar()</font> —— 表示每一根 K 线收盘后，即执行一次此函数。策略的核心逻辑都是写在该函数中的，比如，需要获取什么数据，获取后如何计算，得出结果后是否下单交易等等。通常用户还可以通过 paint() 方法将需要绘图输出的结果展示出来。</p> <p>其中 <font size="4" color="red"><b>ContextInfo</b></font>  是整个 Python 框架中的<u>核心对象</u>。它包含了各种与 Python 底层框架交互的 API 方法，也是一个全局的关联上下文的对象（object），可以在 init 以及 handlebar 这两个函数中自由地传递用户创建的各种自定义数据。</p> <p>现在我们来创建第一个策略程序吧。如之前在安装步骤中的操作，请点击中间上侧的 “新建策略”按钮，然后选择 “Python” 策略，然后把下列代码复制到窗口中。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是初始化函数 init() 中的 Hello World'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'这是 handlebar 中的 say hi~~~'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/xuntou_yao/assets/img/xtqmt04.16b29b4a.jpg" alt="新建策略"></p> <p>然后点击“运行”按钮，在下面的“日志输出”窗口中能看到输出的文字即表示成功。</p> <p><img src="/xuntou_yao/assets/img/xtqmt11.9bcfe97e.png" alt="运行策略"></p> <h3 id="_1-2-参数设置"><a href="#_1-2-参数设置" class="header-anchor">#</a> 1.2 参数设置</h3> <p>在“策略编辑器”的右侧，基本信息面板的底部，中间的标签是“参数设置”，用鼠标点击一下该标签，即可在这里可以设置策略程序中的外部参数。通常用于策略程序源码必须加密，但同时又要允许用户可以自己修改参数的需求；或者用历史数据回测时，优化参数时使用。最多允许设置20个外部参数。在对应的栏位中填上“参数名”、“最新（值）”、“最小（值）”、“最大（值）”、“步长”、“初始（值）”，填完之后回车即可。</p> <p><img src="/xuntou_yao/assets/img/xtqmt32.35170d9e.png" alt="PY模型回测示例"></p> <p>在“参数设置”面板中填写的参数，可以理解为就是在策略程序中声明的全局变量，在策略中的各个方法（函数）中都是可见的，包括用户自定义的函数中，也是可见的。因此在程序中可以直接使用，赋值、参与运算都可以。如上图中的示例，在参数设置中，填写了3个变量，<code>xyz,abc,message</code>，并且填写了各自的值。回车之后，在策略程序中，就可以直接打印出这些变量的值。并不需要提前声明或赋值操作。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>参数在最外层的代码中是 不可见 的。意即，顶格书写的代码是看不到这些外部设置的参数的。在 方法（函数）中都是可见的。</p></div> <p>但在代码最外层是不可见的，即：顶格书写的代码是找不到这些变量的!</p> <p>如上图中的示例，在参数设置中，填写了3个变量，<code>xyz,abc,message</code>，并且填写了各自的值。回车之后，在策略程序中，就可以直接打印出这些变量的值。并不需要提前声明或赋值操作。</p> <p>在“策略交易”中运行某一个策略时，在“编辑策略交易”的窗口，对应的变量如下图所示：</p> <p><img src="/xuntou_yao/assets/img/xtqmt42.26b84dab.png" alt="模型内置变量"></p> <p>另，如果想要在 “模型/策略交易”界面，让策略程序给出如下的参数设置面板：</p> <p><img src="/xuntou_yao/assets/img/xtqmt43.bff948c0.png" alt="模型交易参数设置"></p> <p>可以在迅投QMT的安装文件夹中，具体路径为：</p> <p>X:\QMT\python\formulaLayout</p> <p>找到 .xml 类型的文件，用文本编辑器打开，即可发现，其中就是扩展的参数。对应的参数名称（name），参数提示（note），默认值（value），输入类型（type），绑定的变量名称（bind），（学过前端的朋友应该秒懂了。）都可以由用户根据需求自已定制。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TCStageLayout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>control</span> <span class="token attr-name">note</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>控件<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">note</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>控件<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xyz<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">note</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>变量xyz<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xyz<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>intput<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3.4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">note</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>变量abc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>intput<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>面板设置参数<span class="token punctuation">&quot;</span></span> <span class="token attr-name">note</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>变量message<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>intput<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>variable</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>control</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TCStageLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>建议复制其中一个文件，然后修改成与你的模型程序文件同名，后缀为 .xml 即可。如 “TEST01.xml” ，对应的策略模型名称为 “TEST01.py”。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>
<span class="token comment"># TEST01.py 即可接收到来自面板设置的参数</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;从模型交易面板获取的变量 xyz：&quot;</span><span class="token punctuation">,</span>xyz<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;从模型交易面板获取的变量 abc：&quot;</span><span class="token punctuation">,</span>abc<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;从模型交易面板获取的变量 message：&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
从模型交易面板获取的变量 xyz： 10000
从模型交易面板获取的变量 abc： 3.4
从模型交易面板获取的变量 message： 面板设置参数

&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_1-3-历史数据回测"><a href="#_1-3-历史数据回测" class="header-anchor">#</a> 1.3 历史数据回测</h3> <p>在 迅投 的主界面中，“我的” --&gt; “模型研究” 中，有一个 “PY模型回测示例” ，如下图所示：</p> <p><img src="/xuntou_yao/assets/img/xtqmt12.1f548a9d.png" alt="PY模型回测示例"></p> <p>点击其后的编辑按钮，即可看到源代码。其策略大致为：</p> <p><img src="/xuntou_yao/assets/img/xtqmt13.8211915c.png" alt="PY模型回测示例源码"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>此模型文件已是老旧版本，建议参考本文档附录中的案例</p></div> <p>策略说明描述大致如下：<br>
观察“上证50”成份股中的全部股票，关注 5日均线 和 20日均线。<br>
如果发现某只股票 5日均线 在 20日均线之下，并且持有该股票，即卖出。<br>
如果发现某只股票 5日均线 在 20日均线之上，并且没有持有该股票，即买入。</p> <p>该示例中，导入了 time, datetime 和 numpy 模块，分别用来计算日期时间和平均值（均线）。同时还用到自定义函数来获取持仓股票列表。调取历史数据（如果之前没有补齐历史数据，会导致失败和错误）等功能，具体代码的解析，在阅读理解了 api 手册之后会有更详细的讨论。</p> <p>第一步，点击右侧面板底部的“回测参数”按钮，以切换到 回测参数 面板。在此处可以选择回测的时间段，前提条件是下载过历史数据。其它参数可按需填写，如：初始资金、保证金比例、印花税等......（如图片显示太小，不清晰。可用鼠标右键点击图片，然后在菜单中点击 “在新标签页中打开图像”，即可看到高清大图 ）</p> <p><img src="/xuntou_yao/assets/img/xtqmt18.ea47fa71.png" alt="回测参数"></p> <p>第二步，点击“策略编辑器”顶部的 <kdb>“回测”</kdb>按钮，即可开始历史数据回测。如果有历史数据，回测过程会顺利进行。在“模型研究”窗口，可以看到数据变化。（如图片显示太小，不清晰。可用鼠标右键点击图片，然后在菜单中点击 “在新标签页中打开图像”，即可看到高清大图 ）</p> <p><img src="/xuntou_yao/assets/img/xtqmt19.c915a129.png" alt="回测参数"></p> <p>在 “模型研究” 窗口中，分为左右两个部分。 左边是K线图表，右边是 操作明细 和 日志输出。</p> <p><img src="/xuntou_yao/assets/img/xtqmt20.1b0eef73.png" alt="回测参数"></p> <p>左边的K线图表，可以用键盘上的 上下箭头键放大和缩小。左右箭头键可以前进或后退到某一根K线对应的日期时间，同时，右边的数据会显示对应的K线时间的操作。右侧底部有四个按钮，分别是：持仓明细、持仓分析、历史汇总和日志输出。</p> <ul><li>持仓明细 是随着左边的K线图联动的，当十字光标停留在某一根K线上时，在右侧即可看到对应的时间上，当时的操作记录。本例是日线图上的策略，因此每根K线对应一天，在右侧上半部分可以看到 “当日买入” 和 “当日卖出”，在下半部分可以看到“当日持仓明细”。</li></ul> <p><img src="/xuntou_yao/assets/img/xtqmt22.394a5507.png" alt="持仓明细"></p> <ul><li>持仓分析 标签页中可以看到当时持有的股票的权重。有饼形图 和 直方图表示，一目了然。这些数据也是和 十字光标对应的K线，对应的时间联动的。可以按左右键移动光标，观察数据的变化。</li></ul> <p><img src="/xuntou_yao/assets/img/xtqmt23.49105b1c.png" alt="持仓分析"></p> <ul><li>历史汇总 面板，其中包括了历史回测时间段内的全部交易结果。可以看到合计交易次数、盈亏、交易量等信息。</li></ul> <p><img src="/xuntou_yao/assets/img/xtqmt24.5ae013e9.png" alt="历史汇总"></p> <ul><li>日志输出 面板中的内容和 “策略编辑器”窗口下面的 日志输出 是一致的，用于显示程序运行过程中的各种文本输出信息，如： print()的输出，错误消息等......</li></ul> <p><img src="/xuntou_yao/assets/img/xtqmt21.4d600005.png" alt="持仓分析"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>一般约定 在 迅投 中编写一个 Python 策略时，第一行我们写上</p> <p><code># coding:gbk</code></p> <p>这表示程序的编码格式统一是GBK</p></div> <hr> <h2 id="_2-重要方法-函数-和对象"><a href="#_2-重要方法-函数-和对象" class="header-anchor">#</a> 2） 重要方法（函数）和对象</h2> <p>在 迅投 中编写 Python 策略时，实际上是已经继承了一个来自底层的 基类（class） 。我们需要且仅能够在这个 类（class） 的框架之内，编写我们自己的程序来描述策略需求。其中有2个重要的 方法，就是 <code>init()</code> 和 <code>handlebar()</code> 和一个重要的 对象（Object）， <code>ContextInfo</code>。</p> <h3 id="_2-1-初始化函数-init"><a href="#_2-1-初始化函数-init" class="header-anchor">#</a> 2.1 初始化函数 init()</h3> <p><font size="4" color="red"><b> init() </b></font> —— 初始化方法（函数），只执行一次。一般在程序开始启动时，在这个方法的代码中，把交易佣金、滑点、基准，订阅品种、帐户等信息设置好。这些只需要设置一次的操作，就放在初始化方法 init() 中；</p> <p>功能： 初始化函数，只在整个策略开始时调用运行一次</p> <p>语法：<code>def init(ContextInfo)</code></p> <p>参数： ContextInfo——继承自底层 基类 的策略运行环境对象，可以绑定自定义的属性、全局可见。</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ContextInfo<span class="token punctuation">.</span>initProfit <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 这个 initProfit 绑定到 ContextInfo 上，即是一个全局可见的属性（变量）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-2-行情事件函数-handlebar"><a href="#_2-2-行情事件函数-handlebar" class="header-anchor">#</a> 2.2 行情事件函数 handlebar()</h3> <p><font color="red"><b>handlebar()</b></font> —— 行情处理函数。当点击 “运行” 时，此方法会在每根K线上执行一次此函数。如果不点击“停止”，并且没有休市，实时行情仍在跳动，则会在每一次价格跳动时，即每一个 tick 都会执行一次此函数。因此在这个方法中，书写整个策略的执行代码。</p> <p>功能： 此函数会在每根 K 线上运行一次；在实时联网，获取行情的状态下，会先每根据附着的主图上的K 线数量，每根K线运行一次；然后每接收到一次 tick 数据，即运行一次。</p> <p>语法：<code>def handlebar(ContextInfo)</code></p> <p>参数： ContextInfo —— 继承自底层 基类 的策略运行环境对象，可以绑定自定义的属性、全局可见。</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 打印输出当前运行到的 K 线的索引编号（位置序号）</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在 迅投 中，编写 Python 策略必须包含以上这两个基本方法，否则策略将运行不起来。</p> <h3 id="_2-3-最重要的对象-contextinfo"><a href="#_2-3-最重要的对象-contextinfo" class="header-anchor">#</a> 2.3 最重要的对象 ContextInfo</h3> <p><b><font size="4" color="red"> ContextInfo </font></b> 是 迅投QMT 中策略程序运行环境中最重要的对象，没有之一！前述的 <code>init()</code> 和 <code>handlebar()</code> 这两个基本方法运行时必须要传入这个参数。</p> <p>ContextInfo 里面已经封装了多达 100+  个属性 和 方法。因版本变化，此数量仍在变化中。当然，<code>ContextInfo</code> 这个对象（Object）也可以随时绑定 自定义 的 属性 和 方法，如同使用一般 对象（Object） 的方式一模一样，并无二致。<br></p> <p>接下来介绍一些常用的 <code>ContextInfo</code> 自带的 属性和方法。更详细的信息，请参考附录和官方发布的文档为准。</p> <h3 id="_2-3-01-设置帐户-contextinfo-set-account"><a href="#_2-3-01-设置帐户-contextinfo-set-account" class="header-anchor">#</a> 2.3.01 设置帐户  <br>ContextInfo.set_account()</h3> <p>功能： 设定交易账号。在参数中传入的账号用于之后的交易操作。<br>
语法： ContextInfo.set_account(account)<br>
*注：<br>
一、可多次调用以设置多个账号，应在 init() 中设置完毕，init() 执行之后再设置将无效；<br>
二、调用 passorder 交易指令时，如果传入的账号为空，将会使用最后一次设置的账号作为交易下单账号。<br>
参数： 字符串（string） <br>
返回： 无 <br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>
<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    account <span class="token operator">=</span> <span class="token string">'6000000223'</span>   <span class="token comment"># 假设这是一个 股票帐号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span>account<span class="token punctuation">)</span>  <span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>设定交易帐号是最常用、也是必须用的第一个方法（函数），连帐号都没设置好，那程序咋交易呢？往哪儿下单呢？因此在 <code>init()</code> 这个方法（函数）中，第一个要用到的，就是这个设置帐号的方法（函数），也必须写在 <code>init()</code> 这个方法（函数）中。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果在代码中没有声明变量 account ，那么在 “策略交易”中，会自动读出策略选择的帐号。</p></div> <p>实际运用中，更多情况是结合以下方法（函数）来设置关注的股票池：</p> <p>获取指数成份股；ContextInfo.get_sector()<br>获取行业成份股；ContextInfo.get_industry()<br>获取板块成份股；ContextInfo.get_stock_list_in_sector()<br></p> <p>可以一次设置多个品种，简单方便。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置股票池为 沪深300指数 000300.SH 中的全部品种</span>
    stock_list <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_sector<span class="token punctuation">(</span><span class="token string">'000300.SH'</span><span class="token punctuation">)</span>
    ContextInfo<span class="token punctuation">.</span>set_universe<span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在实际运用中，通常是先获取一个板块中的全部品种，保存到一个列表中。然后再经过筛选，最终传给订阅品种的方法 <code>ContextInfo.set_universe()</code>，完成设置股票池的动作。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置股票池为 沪深转债  中的全部品种</span>
    stock_list <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_stock_list_in_sector<span class="token punctuation">(</span><span class="token string">'沪深转债'</span><span class="token punctuation">)</span>
    ContextInfo<span class="token punctuation">.</span>set_universe<span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>另一种常见的操作就是文件单，意即从文件中读取想要订阅的品种，会用到 <code>ContextInfo.load_stk_list()</code> 和 <code>ContextInfo.load_stk_vol_list()</code>方法，后面会有更详细的讨论。</p> <h3 id="_2-3-02-将毫秒时间转换成日期时间timetag-to-datetime"><a href="#_2-3-02-将毫秒时间转换成日期时间timetag-to-datetime" class="header-anchor">#</a> 2.3.02 将毫秒时间转换成日期时间<br>timetag_to_datetime()</h3> <p>功能： 将毫秒时间戳格式 转换为 日期时间格式参数：</p> <p>语法： timetag_to_datetime(timetag, format)<br>参数：</p> <ul><li>timetag——时间戳：毫秒，如：1512748800000</li> <li>Format——日期时间格式字符串，如：'%Y-%m-%d %H:%M:%S'</li></ul> <p>返回： str，日期时间</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>


<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'把时间戳 1512748860000 转换为 日期时间格式：\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>timetag_to_datetime<span class="token punctuation">(</span><span class="token number">1512748860000</span><span class="token punctuation">,</span> <span class="token string">'%Y%m%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
把时间戳 1512748860000 转换为 日期时间格式：
20171209 00:01:00
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2-3-03-设置定时运行-contextinfo-run-time"><a href="#_2-3-03-设置定时运行-contextinfo-run-time" class="header-anchor">#</a> 2.3.03 设置定时运行  <br>ContextInfo.run_time()</h3> <p>功能： 设置定时器<br>
语法： run_time(funcName,period,startTime,market)<br></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>*注：模型回测时无效，定时器没有结束方法，会随着策略的结束而结束。另外定时器函数在第一次运行前
会先等待一个 时间周期（period）</p></div> <p>参数：<br></p> <ul><li><p>funcName——想要复重执行的函数名称，通常是一个 自定义 函数的名称<br></p></li> <li><p>period——重复调用的时间间隔。<br>'5nSecond'表示每5秒运行1次,<br>'5nDay'表示每5天运行一次,<br>'500nMilliSecond'表示每500毫秒运行1次<br></p></li> <li><p>startTime——表示定时器第一次启动的时间。如果想立刻启动,可以设置为已过去的历史时间<br></p></li></ul> <p>回调函数参数： ContextInfo<br></p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>


<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 从 2019-10-14 13:20:00 之后开始 每5s 运行一次 myHandlebar 函数</span>
    ContextInfo<span class="token punctuation">.</span>run_time<span class="token punctuation">(</span><span class="token string">&quot;myHandlebar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5nSecond&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2019-10-14 13:20:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;SH&quot;</span><span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">myHandlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 此函数必须带一个参数 ContextInfo</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'每5秒打印输出一次 hello world'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-3-04-程序停止-stop"><a href="#_2-3-04-程序停止-stop" class="header-anchor">#</a> 2.3.04 程序停止 <br>stop()</h3> <p>功能： 停止处理。Python策略模型中用来关闭停止之前运行的函数。在一个复杂的策略模型程序中，如果其中有发起多线程时，可通过此函数实现停止线程的操作。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>*注：Python策略程序基本不用此函数<br></p></div> <p>语法： stop(ContextInfo)<br>
参数： ContextInfo：策略模型全局对象</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>


<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span> <span class="token string">'strategy is stop !'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结：</h3> <p>以上只是简单的介绍了在 迅投QMT 中开始自动交易程序时的基本要素，包括：<br>
两个重要的方法（函数）<code>init()</code> 和 <code>handlebar()</code> ；<br>
关联上下文的重要 对象（Object）<code>ContextInfo</code>，它自带很多属性和方法（函数）。</p> <p>更多的信息，请继续阅读以下内容，或参考附录和官方手册为准。</p> <h3 id="品种相关"><a href="#品种相关" class="header-anchor">#</a> =====品种相关=====</h3> <h3 id="_2-3-05-根据代码获取股票中文名称-contextinfo-get-stock-name"><a href="#_2-3-05-根据代码获取股票中文名称-contextinfo-get-stock-name" class="header-anchor">#</a> 2.3.05  根据代码获取股票中文名称  <br>ContextInfo.get_stock_name()</h3> <p>功能： 根据品种代码获取品种的中文名称 <br>
语法： ContextInfo.get_stock_name('stockcode')<br>
参数： stockcode——字符串型，代表一个股票代码，如'000001.SZ'，如果缺省，则默认为当前图表上的品种代码。一次只能传入一个字符串。如果传入的字符串没有对应的名称，则返回 空。<br>
返回： 返回字符串；（GBK编码）<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_stock_name<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment"># 返回字符串，“平安银行”    </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-06-根据代码获取该股票的上市时间-get-open-date"><a href="#_2-3-06-根据代码获取该股票的上市时间-get-open-date" class="header-anchor">#</a> 2.3.06  根据代码获取该股票的上市时间 <br>get_open_date()</h3> <p>功能： 根据代码返回对应股票的上市时间</p> <p>语法： get_open_date('stockcode')</p> <p>参数： stockcode——股票代码，如'000001.SZ'，缺省值 ' ' 默认为当前图代码</p> <p>返回： int 整数</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_open_date<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
返回值是一个 int 如：
20050523
即表示该品种是 2005年5月23日上市的
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-3-07-判断股票是否停牌-contextinfo-is-suspended-stock"><a href="#_2-3-07-判断股票是否停牌-contextinfo-is-suspended-stock" class="header-anchor">#</a> 2.3.07  判断股票是否停牌  <br>ContextInfo.is_suspended_stock()</h3> <p>功能： 判断一支股票是否停牌<br>
语法： ContextInfo.is_suspended_stock(stockcode.market)<br>
参数： 字符串（string），指定品种代码；<br>
返回： 返回一个 布尔值，True 表示 停牌， False 表示 未停牌；<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;600004.SH 是否停牌： &quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>is_suspended_stock<span class="token punctuation">(</span><span class="token string">'600004.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot; 运行结果
600004.SH 是否停牌：  False
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-3-8-获取板块目录信息-get-sector-list"><a href="#_2-3-8-获取板块目录信息-get-sector-list" class="header-anchor">#</a> 2.3.8  获取板块目录信息 <br>get_sector_list()</h3> <p>功能： 获取板块目录信息</p> <p>语法： get_sector_list(node)</p> <p>参数：node——str，板块节点名。如果传入空字符串 '' ，即表示 顶层目录
返回： info_list：[[s1,s2,...],[f1,f2,...]]s为板块名，f为目录节点名，例如[['我的自选'],['新建分类1']]</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token comment"># 显示顶层目录 中的板块名称</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_sector_list<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;----------------------------------&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># 显示 沪市板块 中的板块名称</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_sector_list<span class="token punctuation">(</span><span class="token string">'沪市板块'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
[[], ['我的', '沪深板块', '沪市板块', '深市板块', '期货板块', '期权板块', '指数板块', '持仓板块', '全球市场', '扩展数据', 'WIND数据库', '过期合约']]
----------------------------------
[['沪深A股', '沪深B股', '沪深指数', '沪深基金', '沪深ETF', '沪深债券', '沪深CDR', '沪深转债', '沪深回购'], []]
&quot;&quot;&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>此方法中的板块目录，与 QMT 界面中的 “行情” --&gt; “板块” 中的标签文件夹名称相对应，如下图：</p> <p><img src="/xuntou_yao/assets/img/xtqmt28.dc9b5e3c.png" alt="添加帐号"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果想获取板块中所包含的具体品种代码，需要用以下方法：</p> <p>ContextInfo.get_stock_list_in_sector('沪深转债')</p></div> <h3 id="_2-3-9-判定给定股票代码是否在指定的板块中-is-sector-stock"><a href="#_2-3-9-判定给定股票代码是否在指定的板块中-is-sector-stock" class="header-anchor">#</a> 2.3.9 判定给定股票代码是否在指定的板块中 <br>is_sector_stock()</h3> <p>功能： 判定给定股票代码是否在指定的板块中</p> <p>语法： is_sector_stock(sectorname, market, stockcode)</p> <p>参数：</p> <ul><li>sectorname——string，板块名</li> <li>market——string，市场</li> <li>stockcode——string，股票代码</li></ul> <p>返回： bool，返回值含义：True：在板块中  False：不在板块中</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>is_sector_stock<span class="token punctuation">(</span><span class="token string">'沪深300'</span><span class="token punctuation">,</span><span class="token string">'SH'</span><span class="token punctuation">,</span><span class="token string">'600000'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-10-判定给定股票是否属于某个类别-is-typed-stock"><a href="#_2-3-10-判定给定股票是否属于某个类别-is-typed-stock" class="header-anchor">#</a> 2.3.10 判定给定股票是否属于某个类别 <br>is_typed_stock()</h3> <p>功能： 判定给定股票是否属于某个类别</p> <p>语法： is_typed_stock(stocktypenum, market, stockcode)</p> <p>参数：</p> <ul><li>stocktypenum——number，类别标号，如股票类别标号为100003，详细见 附录 http://docs.thinktrader.net/pages/b5fc7f/</li> <li>market——string，市场</li> <li>stockcode——string，股票代码</li></ul> <p>返回： number，返回值含义：1：True    0：False</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>is_typed_stock<span class="token punctuation">(</span><span class="token number">100003</span><span class="token punctuation">,</span><span class="token string">'SH'</span><span class="token punctuation">,</span><span class="token string">'600000'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-11-判定给定股票代码是否在指定的行业分类中-get-industry-name-of-stock"><a href="#_2-3-11-判定给定股票代码是否在指定的行业分类中-get-industry-name-of-stock" class="header-anchor">#</a> 2.3.11  判定给定股票代码是否在指定的行业分类中 <br>get_industry_name_of_stock()</h3> <p>语法： get_industry_name_of_stock(industryType, stockcode)</p> <p>功能： 判定给定股票代码是否在指定的行业分类中</p> <p>参数：</p> <ul><li>industryType——string，行业类别，有 'CSRC' 和 'SW' 两种</li> <li>stockcode——string，形式如 'stockcode.market'，如 '600000.SH'</li></ul> <p>返回： string：对应行业名，找不到则返回空 string</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_industry_name_of_stock<span class="token punctuation">(</span><span class="token string">'SW'</span><span class="token punctuation">,</span><span class="token string">'600000.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-12-创建板块-create-sector"><a href="#_2-3-12-创建板块-create-sector" class="header-anchor">#</a> 2.3.12  创建板块 <br>create_sector()</h3> <p>功能： 创建板块</p> <p>语法： create_sector(parent_node,sector_name,overwrite)</p> <p>参数：</p> <ul><li>parent_node——str，父节点，''为'我的'（默认目录）</li> <li>sector_name——str，要创建的板块名</li> <li>overwrite——bool，是否覆盖。如果目标节点已存在，为True时跳过，为False时在sector_name后增加数字编号，编号为从1开始自增的第一个不重复的值。</li></ul> <p>返回： sector_name2：实际创建的板块名</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>sector<span class="token operator">=</span>create_sector<span class="token punctuation">(</span><span class="token string">'我的'</span><span class="token punctuation">,</span><span class="token string">'新建板块'</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>通常用户都是手动去创建一个“我的自选”，然后将自己所关心的品种，添加到这个板块文件夹中。用程序代码来操作板块在日常工作中几乎很少用到。</p></div> <h3 id="_2-3-13-创建板块目录节点-create-sector-folder"><a href="#_2-3-13-创建板块目录节点-create-sector-folder" class="header-anchor">#</a> 2.3.13 创建板块目录节点 <br>create_sector_folder()</h3> <p>功能： 创建板块目录节点</p> <p>语法： create_sector_folder(parent_node,folder_name,overwrite)</p> <p>参数：</p> <ul><li>parent_node——str，父节点，''为'我的'（默认目录）</li> <li>sector_name——str，要创建的节点名</li> <li>overwrite——bool，是否覆盖。如果目标节点已存在，为True时跳过，为False时在folder_name后增加数字编号，编号为从1开始自增的第一个不重复的值。</li></ul> <p>返回： sector_name2：实际创建的节点名</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>folder<span class="token operator">=</span>create_sector_folder<span class="token punctuation">(</span><span class="token string">'我的'</span><span class="token punctuation">,</span><span class="token string">'新建分类'</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-14-设置板块成分股-reset-sector-stock-list"><a href="#_2-3-14-设置板块成分股-reset-sector-stock-list" class="header-anchor">#</a> 2.3.14  设置板块成分股 <br>reset_sector_stock_list()</h3> <p>功能： 设置板块成分股</p> <p>语法： reset_sector_stock_list(sector,stock_list)</p> <p>参数：</p> <ul><li>sector——板块名</li> <li>stock_list——list，品种代码列表，例如['000001.SZ','600000.SH']</li></ul> <p>返回： bool值，操作成功为True，失败为False</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>reset_sector_stock_list<span class="token punctuation">(</span><span class="token string">'我的自选'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span><span class="token string">'600000.SH'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-15-移除板块成分股-remove-stock-from-sector"><a href="#_2-3-15-移除板块成分股-remove-stock-from-sector" class="header-anchor">#</a> 2.3.15 移除板块成分股 <br>remove_stock_from_sector()</h3> <p>功能： 移除板块成分股</p> <p>语法： remove_stock_from_sector(sector,stock_code)</p> <p>参数：</p> <ul><li>sector——板块名</li> <li>stock_code——品种代码，例如'000001.SZ'</li></ul> <p>返回： bool值。操作成功为True，失败为False</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>remove_stock_from_sector<span class="token punctuation">(</span><span class="token string">'我的自选'</span><span class="token punctuation">,</span><span class="token string">'000001.SZ'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-16-添加板块成分股-add-stock-to-sector"><a href="#_2-3-16-添加板块成分股-add-stock-to-sector" class="header-anchor">#</a> 2.3.16  添加板块成分股 <br>add_stock_to_sector()</h3> <p>功能： 添加板块成分股</p> <p>语法： add_stock_to_sector(sector,stock_code)</p> <p>参数：</p> <ul><li>sector——板块名</li> <li>stock_code——品种代码，例如'000001.SZ'</li></ul> <p>返回： bool值。操作成功为True，失败为False</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>add_stock_to_sector<span class="token punctuation">(</span><span class="token string">'我的自选'</span><span class="token punctuation">,</span><span class="token string">'000001.SZ'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="图表k线相关"><a href="#图表k线相关" class="header-anchor">#</a> =====图表K线相关=====</h3> <p>前面介绍过，在 迅投QMT 中， 策略程序必须是附着在一个 K 线图表上，才能运行的。如果想要知道当前的程序附着在哪个品种的K线图上，就可以打印输出对应的属性（变量）值就可以了。</p> <h3 id="_2-3-17-获取当前主图市场-contextinfo-market"><a href="#_2-3-17-获取当前主图市场-contextinfo-market" class="header-anchor">#</a> 2.3.17  获取当前主图市场 <br>ContextInfo.market</h3> <p>这是一个属性（变量），获取当前主图市场，只读。其值为一个字符串（string），对应主图市场的代码，&quot;SH&quot; 表示 上海沪市，&quot;SZ&quot; 表示 深市。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前主图的市场代码是：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>market<span class="token punctuation">)</span>
    <span class="token comment">#当前主图的市场代码是： SH</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-18-获取当前图表的品种代码-contextinfo-stockcode"><a href="#_2-3-18-获取当前图表的品种代码-contextinfo-stockcode" class="header-anchor">#</a> 2.3.18  获取当前图表的品种代码 <br>ContextInfo.stockcode</h3> <p>这是一个属性（变量）， 获取当前图代码，只读。其值为一个字符串（string），对应主图品种的代码。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前程序附着的K线图品种是：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>stockcode<span class="token punctuation">)</span>
    <span class="token comment"># 当前程序附着的K线图品种是： 000300</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-19-获取当前图表的复权方式-contextinfo-dividend-type"><a href="#_2-3-19-获取当前图表的复权方式-contextinfo-dividend-type" class="header-anchor">#</a> 2.3.19  获取当前图表的复权方式 <br>ContextInfo.dividend_type</h3> <p>这是一个属性（变量）， 获取当前主图复权处理方式，只读。其值为一个字符串（string）。</p> <p>'none'：不复权<br>
'front'：向前复权<br>
'back'：向后复权<br>
'front_ratio'：等比向前复权<br>
'back_ratio'：等比向后复权<br></p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前图表的复权方法是：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>dividend_type<span class="token punctuation">)</span>
    <span class="token comment"># 当前图表的复权方法是： front_ratio</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-20-获取当前周期-contextinfo-period"><a href="#_2-3-20-获取当前周期-contextinfo-period" class="header-anchor">#</a> 2.3.20  获取当前周期 <br>ContextInfo.period</h3> <p>这是一个属性（变量）， 获取当前图表的时间框架周期，只读。其值为一个字符串（string）。
'1d'	日线、'1m'	1分钟线、'3m'	3分钟线、'5m'	5分钟线、'15m'	15分钟线、'30m'	30分钟线、'1h'	小时线、'1w'	周线、'1mon'	月线、'1q'	季线、'1hy'	半年线、'1y'	年线。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前图表的时间周期是：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>period<span class="token punctuation">)</span>
    <span class="token comment"># 当前图表的时间周期是： 1d</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-21-获取当前图表上k线的数量-contextinfo-time-tick-size"><a href="#_2-3-21-获取当前图表上k线的数量-contextinfo-time-tick-size" class="header-anchor">#</a> 2.3.21  获取当前图表上K线的数量 <br>ContextInfo.time_tick_size</h3> <p>这是一个属性（变量）， 获取当前图表上 K 线的总数量，只读。其值为一个整数（int）。</p> <p>*注：只有 handlebar()方法启动后才会去计算图表上的K线。init() 只是初始化，还没有开始读取图表。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前图表上包含的K线数量为：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>time_tick_size<span class="token punctuation">)</span>
    <span class="token comment"># 当前图表上包含的K线数量为：4858</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-3-22-获取当前运行到-k-线索引号contextinfo-barpos"><a href="#_2-3-22-获取当前运行到-k-线索引号contextinfo-barpos" class="header-anchor">#</a> 2.3.22  获取当前运行到 K 线索引号<br>ContextInfo.barpos</h3> <p>这是一个属性（变量）， 获取当前运行到 K 线索引号，只读。其值为一个整数（int），
只读，索引号从0开始。</p> <p>*注： K线的序号是从左向右排序的，最早的K线是图表最左边的第 0 根，最新的K线是图表最右边的，索引号最大的那一根。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-23-判定是否为最后一根-k-线contextinfo-is-last-bar"><a href="#_2-3-23-判定是否为最后一根-k-线contextinfo-is-last-bar" class="header-anchor">#</a> 2.3.23  判定是否为最后一根 K 线<br>ContextInfo.is_last_bar()</h3> <p>功能： 判定是否为最后一根 K 线</p> <p>语法： ContextInfo.is_last_bar()</p> <p>参数： 无</p> <p>返回： bool，返回值含义：True：是  False：否</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>is_last_bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-24-判定是否为新的-k-线contextinfo-is-new-bar"><a href="#_2-3-24-判定是否为新的-k-线contextinfo-is-new-bar" class="header-anchor">#</a> 2.3.24  判定是否为新的 K 线<br>ContextInfo.is_new_bar()</h3> <p>功能： 某根 K 线的第一个 tick 数据到来时，判定该 K 线为新的 K 线。</p> <p>语法： ContextInfo.is_new_bar()</p> <p>参数： 无</p> <p>返回： bool，返回值含义：True：是  False：否</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>is_new_bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="回测相关"><a href="#回测相关" class="header-anchor">#</a> =====回测相关=====</h3> <p>以下属性和方法与 策略编辑器 右侧的面板中的设置参数相对应，可相互参考。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>一、只支持回测模式；</p> <p>二、仅在 init() 中设置生效；</p> <p>三、如果在 init() 中未设置，则以 策略编辑器 界面右侧设定的回测时间范围为准；</p> <p>四、如果同时在 策略编辑器 右侧参数面板中也设置了回测时间范围，则以 init() 中的设置为准；</p> <p>五、如果设置的结束时间 小于等于 开始时间 ，则回测时计算范围为空。</p></div> <p><img src="/xuntou_yao/assets/img/xtqmt29.7b31e752.png" alt="回测参数"></p> <h3 id="_2-3-25-设定回测起止时间contextinfo-start-contextinfo-end"><a href="#_2-3-25-设定回测起止时间contextinfo-start-contextinfo-end" class="header-anchor">#</a> 2.3.25  设定回测起止时间<br>ContextInfo.start / ContextInfo.end</h3> <p>功能： 设定回测起止时间，标准格式如&quot;2009-07-14 01:13:30&quot;。这2个属性值可以修改。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ContextInfo<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token string">'2012-06-06 10:00:00'</span>
    ContextInfo<span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token string">'2013-08-08 14:30:00'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-3-26-获取回测基准品种contextinfo-benchmark"><a href="#_2-3-26-获取回测基准品种contextinfo-benchmark" class="header-anchor">#</a> 2.3.26  获取回测基准品种<br>ContextInfo.benchmark</h3> <p>这是一个属性（变量）， 获取回测基准，只读。其值为一个字符串（string）。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>benchmark<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-27-设定回测初始资金contextinfo-capital"><a href="#_2-3-27-设定回测初始资金contextinfo-capital" class="header-anchor">#</a> 2.3.27  设定回测初始资金<br>ContextInfo.capital</h3> <p>这是一个属性（变量）， 用于设定回测初始资金，默认为 1000000。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ContextInfo<span class="token punctuation">.</span>capital <span class="token operator">=</span> <span class="token number">10000000</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>capital<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-28-获取策略回测的净值contextinfo-get-net-value"><a href="#_2-3-28-获取策略回测的净值contextinfo-get-net-value" class="header-anchor">#</a> 2.3.28 获取策略回测的净值<br>ContextInfo.get_net_value()</h3> <p>功能：获取策略回测的净值
语法：ContextInfo.get_net_value()
参数：index 任意整数即可。
返回：number</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置手续费 </span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_net_value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-3-29-设定回测滑点contextinfo-set-slippage"><a href="#_2-3-29-设定回测滑点contextinfo-set-slippage" class="header-anchor">#</a> 2.3.29  设定回测滑点<br>ContextInfo.set_slippage()</h3> <p>功能： 设定策略回测滑点，默认值 0.00</p> <p>语法： ContextInfo.set_slippage(slippageType, slippage)</p> <p>参数：</p> <ul><li>slippageType——滑点类型，可选值：<br>0 —— tick跳数设置滑点<br> 1 —— 按照固定值（价格）设置滑点 <br>2 ——价格比例设置滑点</li> <li>slippage：滑点值</li></ul> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 按照固定值（价格）设置滑点值为 0.01</span>
    ContextInfo<span class="token punctuation">.</span>set_slippage<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-3-30-获取策略设定的滑点contextinfo-get-slippage"><a href="#_2-3-30-获取策略设定的滑点contextinfo-get-slippage" class="header-anchor">#</a> 2.3.30 获取策略设定的滑点<br>ContextInfo.get_slippage()</h3> <p>功能：获取策略设定的滑点，对应设置 set 滑点的方法。用来检验 get 设定是否生效。
语法： ContextInfo.get_slippage()
参数： 无
返回： 一个字典 dict</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置滑点值 </span>
    ContextInfo<span class="token punctuation">.</span>set_slippage<span class="token punctuation">(</span><span class="token number">0.003</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;设置的滑点为：\n&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_slippage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
设置的滑点为： 
{'slippage_type': 0, 'slippage': 0.003}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2-3-31-设定回测手续费率contextinfo-set-commission"><a href="#_2-3-31-设定回测手续费率contextinfo-set-commission" class="header-anchor">#</a> 2.3.31  设定回测手续费率<br>ContextInfo.set_commission()</h3> <p>功能： 设定策略回测时的各种手续费率，默认类型值 0 按比例，默认值 0.000</p> <p>语法： ContextInfo.set_commission(commissionType, commissionList)</p> <p>参数：</p> <ul><li><p>commissionType——整数型，可选值：0 表示 按比例  1表示 按每手（股）</p></li> <li><p>commissionList——列表型。包含如下六个值</p></li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code>commissionList <span class="token operator">=</span> <span class="token punctuation">[</span>open_tax<span class="token punctuation">,</span>               <span class="token comment"># 买入印花税</span>
                  close_tax<span class="token punctuation">,</span>              <span class="token comment"># 卖出印花税</span>
                  open_commission<span class="token punctuation">,</span>        <span class="token comment"># 开仓手续费</span>
                  close_commission<span class="token punctuation">,</span>       <span class="token comment"># 平仓（平昨）手续费</span>
                  close_tdaycommission<span class="token punctuation">,</span>   <span class="token comment"># 平今手续费</span>
                  min_commission          <span class="token comment"># 最少手续费</span>
                 <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果只填写一个参数则代表输入的参数值同时 赋值给 <br>open_commission = close_commission = close_today_commission <br></p> <p>而其他的值均为 0，这时 commissionType 亦为 0</p></div> <p>返回： 无</p> <p>示例1：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 万三</span>
    commission <span class="token operator">=</span> <span class="token number">0.0003</span>
    
    <span class="token comment"># 设定开仓手续费和平仓手续费以及平今手续费均为 0.0003，其余为 0   </span>
    ContextInfo<span class="token punctuation">.</span>set_commission<span class="token punctuation">(</span>commission<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>示例2：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    commissionList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.0001</span><span class="token punctuation">,</span> <span class="token number">0.0003</span><span class="token punctuation">,</span> <span class="token number">0.0003</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 设定买入印花税为 0，卖出印花税为 0.0001，开仓手续费和平仓（平昨）手续费均为万三，平今手续费为 0，最小手续费为 5</span>
    ContextInfo<span class="token punctuation">.</span>set_commission<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> commissionList<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-32-获取策略设定的各种手续费率contextinfo-get-commission"><a href="#_2-3-32-获取策略设定的各种手续费率contextinfo-get-commission" class="header-anchor">#</a> 2.3.32 获取策略设定的各种手续费率<br>ContextInfo.get_commission()</h3> <p>功能： 获取策略设定的各种手续费率。对应设置 set 手续费的方法。用来检验 get 设定是否生效。</p> <p>参数： 无</p> <p>返回：一个字典 dict，其中包含的信息请见示例中的注释。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置手续费 </span>
    ContextInfo<span class="token punctuation">.</span>set_commission<span class="token punctuation">(</span><span class="token number">0.0003</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;设置的手续费为：\n&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_commission<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
设置的手续费为： 
{'commission_type': 0,            # 手续费类型
 'open_tax': 0.0,                 # 开仓印花税
 'close_tax': 0.0,                # 平仓印花税
 'open_commission': 0.0003,       # 开仓手续费
 'close_commission': 0.0003,      # 平仓手续费
 'close_tdaycommission': 0.0003,  # 平今手续费 
 'min_commission': 0.0,           # 最小手续费
 'margin_ratio': 0.05             # 保证金比例
}
&quot;&quot;&quot;</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_2-3-33-表示当前是否开启回测模式contextinfo-do-back-test"><a href="#_2-3-33-表示当前是否开启回测模式contextinfo-do-back-test" class="header-anchor">#</a> 2.3.33  表示当前是否开启回测模式<br>ContextInfo.do_back_test</h3> <p>这是一个属性（变量）， 用于判断是否开启回测模式，只读，默认值为 False。此属性常用于在一个策略中同时包含回测和实时运行的代码时，用于区分执行哪部分的代码。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>强烈建议，回测模型程序和实时运行程序，代码分开编写。</p></div> <h3 id="_2-3-34-获取某个记录类型对应的某个时刻的记录情况get-result-records"><a href="#_2-3-34-获取某个记录类型对应的某个时刻的记录情况get-result-records" class="header-anchor">#</a> 2.3.34  获取某个记录类型对应的某个时刻的记录情况<br>get_result_records()</h3> <p>功能： 官网的文档语文真心不及格。此方法的用法是根据指定的时刻（参数 index），记录类型（参数 Recordtype），获取对应的历史回测记录。如：“电脑，告诉我运行到第 84根K线的时候，持仓的品种有哪些？交易明细列出来，我看看。”</p> <p>语法： get_result_records (recordtype, index, ContextInfo)</p> <p>参数：</p> <ul><li>Recordtype——字符串，记录类型：<br></li></ul> <p>'buys'：买入持仓<br>
'sells'：卖出持仓<br>
'holdings'：当前持仓<br>
'historysums'：历史汇总<br>
'dealdetails'：交易明细<br></p> <ul><li><p>index——number，当前主图对应 K 线索引，即第几根K线。从最左边开始，索引编号是： 0</p></li> <li><p>ContextInfo——这里必须是ContextInfo</p></li></ul> <p>返回值： list。其中可能包含 0 个或多个 Python 对象，对象的属性值及表达意义如下：</p> <table><thead><tr><th>属性名称</th> <th>数据类型</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>market</td> <td>string</td> <td>市场代码</td> <td></td></tr> <tr><td>stockcode</td> <td>string</td> <td>合约品种代码</td> <td></td></tr> <tr><td>open_close</td> <td>number</td> <td>期货：1 开 0 平<br>股票： 1 买 0 卖</td> <td></td></tr> <tr><td>direction</td> <td>number</td> <td>方向：1 多 -1 空<br>回购：1 逆回购 -1 正回购</td> <td></td></tr> <tr><td>trade_price</td> <td>number</td> <td>持仓成本</td> <td></td></tr> <tr><td>current_price</td> <td>number</td> <td>最新价，持仓中用这个价</td> <td></td></tr> <tr><td>profit</td> <td>number</td> <td>持仓盈亏</td> <td></td></tr> <tr><td>position</td> <td>number</td> <td>仓位数量</td> <td></td></tr> <tr><td>current_weight</td> <td>number</td> <td>仓位权重</td> <td>[暂无有效数据]</td></tr> <tr><td>benefit_weight</td> <td>number</td> <td>盈利占比权重</td> <td>记录类型是 'historysums' 时有效</td></tr> <tr><td>holding_periods</td> <td>number</td> <td>累计持仓天数</td> <td>记录类型是 'historysums' 时有效</td></tr> <tr><td>buy_sell_times</td> <td>number</td> <td>交易次数</td> <td>记录类型是 'historysums' 时有效</td></tr> <tr><td>commission</td> <td>number</td> <td>手续费</td> <td></td></tr> <tr><td>trade_balance</td> <td>number</td> <td>成交额或市值</td> <td></td></tr> <tr><td>operate_type</td> <td>number</td> <td>操作类型</td> <td>记录类型是 'dealdetails' 时有效</td></tr> <tr><td>trade_date</td> <td>number</td> <td>交易日期，毫秒标记</td> <td>记录类型是 'dealdetails' 时有效</td></tr></tbody></table> <p>示例：（这个例子写得真是和没写一样）</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    index <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>barpos
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_result_records<span class="token punctuation">(</span><span class="token string">'buys'</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>一、此方法只支持回测模式；</p> <p>二、获取的是回测面板中的记录结果；</p></div> <hr> <h2 id="_3-获取数据"><a href="#_3-获取数据" class="header-anchor">#</a> 3） 获取数据</h2> <p>通过前面的学习，已经认识了 迅投QMT 中基本的方法（函数）和 重要的对象 <code>ContextInfo</code> 了。接下来，就要按策略的要求，开始写自动交易的程序了。</p> <p>其实开发自动交易程序，和写其它程序其实都一样，就三步：<br>
一、获取数据；<br>
二、计算数据；<br>
三、展示数据；<br>
没别的了。</p> <p>一个自动交易的程序更具体的一些基本动作，大致如下：<br>
（1）首先要检查一下帐户、登录的状态是否正常，看看帐户里的资金是否充足，帐户里有没有持仓......等等；<br>
股票帐户里可能会有三种订单：<br> <b>持有单（Position）</b> —— 已买入还未卖出的单子；<br> <b>挂单/委托单（Order）</b> —— 已委托交易，但还没成交的单子 ；<br> <b>成交单（Trade/deal）</b> —— 以及今天已成交的单子；<br>
因此，获取这 3 个列表<b><u>（委托单、成交单、持有单）</u></b>的数据，是很重要、必不可少的一个步骤；<br></p> <p>（2）当然要看看时间、和市场对对时间；尤其现在都要玩高频交易的，时间更显得尤为重要；<br></p> <p>（3）获取市场上的报价行情；股票市场通常是 快照行情，也就是 3秒一跳的报价；更快的还有 逐笔（成交）行情 和 逐笔委托；当然有时还要参考历史行情，比如、分钟级、小时级、或日线级别的历史数据；<br></p> <p>（4）根据获取到的行情数据、经过计算，比如比较最高价、最低价、均价或者交易量等，这就是指标了。设置指标达到了某个条件，也就是什么时候买入，什么时候卖出，满足了，就下单交易；无非 两种可能，买入一个品种 或者 把已持有一个品种 卖出。注意这时下的单，是一个委托单，应该会有一个委托单号，如果没有，那就是出错了，要有处理出错的后续操作；关于交易相关的方法（函数）会在下一章讨论；<br></p> <p>（5）如果委托成功了，有了委托单号。接下来就可以决定是 等待成交 或 是撤消这个委托；如果委托单已经成交了，那当然就无法撤消了，那么会就生成对应的 成交单号，意即 成交单 里会出现对应的单子；<br></p> <p>（6）既然成交了，那肯定 持有单 会有一些变化 ，要么添加了一条买入的记录，或者是一条卖出的记录。检查下，然后再回到第（1）步；</p> <p>有买入、有卖出，就形成了一个完整的交易。这个过程交给电脑程序自动完成，这就是自动交易，也没什么神秘吧？</p> <p>必须要吐槽两句：迅投的官方文档，就是把一堆方法（函数），堆在一起。意思就是：你自己看着办。潜台词儿就是：我就给这么一堆，你自己用，不会用？用不好？那是你没水平，怨不得我。你要真一看就懂，一用就会，那岂不是显得我不牛逼了？</p> <p>我真是......服了，厉害厉害，牛逼牛逼，66666</p> <p>吐槽结束，还得说正事儿吧。下面的内容，是来源于个人心得，期望从那一堆方法（函数）当中，先选出那些主要用于A股交易的，常用的、简单的、容易理解的，让大家先容易上手嘛。上手之后，再根据自己的需要、深入研究、灵活运用，方成大器嘛。如果你必须要对自己下手狠一点、非要硬核一点，还请参考官方文档。顺祝一切都好。</p> <p>本章所讨论的，主要是一些 获取数据 的方法（函数），有关更多 指标 的数据以及参数的动用，可以参考 TA_lib 这个库中的信息。</p> <hr> <p>接下来按个人经验，把官方文档中的那一堆方法（函数）简单分了几个类别，目的就是希望让新手思路更清晰，更容易上手。<br></p> <p>最常用的、行情相关、品种相关、期货相关、几乎不用。</p> <h3 id="最常用的方法"><a href="#最常用的方法" class="header-anchor">#</a> =====最常用的方法=====</h3> <h3 id="_3-01-获取帐户交易数据get-trade-detail-data"><a href="#_3-01-获取帐户交易数据get-trade-detail-data" class="header-anchor">#</a> 3.01  获取帐户交易数据<br>get_trade_detail_data()</h3> <p>第一个必须要用的、当然也是最常用的，就是检查帐户的方法（函数）。但官方文档却把这个放在“交易函数”中，哎......  因为它是每一个策略程序中肯定要用上的方法（函数），所以我们先来学习它的语法：</p> <p>功能： 这个方法（函数）十分强大，可以用来获取：<u>帐户、持仓单、委托单、成交单</u> 的信息。是必须、也是最常用的方法（函数）之一。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这是重点！这个方法（函数）没学好，后面就不用看了！</p></div> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>get_trade_detail_data(
                      accountID,        # 帐号
                      strAccountType,   # 帐号类型，如 STOCK表示股票帐号
                      strDatatype,      # 数据类型，如 POSITION 表示持仓单，ORDER 表示委托单
                      strategyName      # 策略名称
                     ) 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数：<br></p> <ol><li>accountID —— 字符串型（String），表达 资金账号；<br></li> <li>strAccountType —— 字符串型（String），表达 账号类型。<br></li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>'FUTURE'</td> <td>期货</td> <td></td></tr> <tr><td>'STOCK'</td> <td>股票</td> <td></td></tr> <tr><td>'CREDIT'</td> <td>信用</td> <td></td></tr> <tr><td>'HUGANGTONG'</td> <td>沪港通</td> <td></td></tr> <tr><td>'SHENGANGTONG'</td> <td>深港通</td> <td></td></tr> <tr><td>'STOCK_OPTION'</td> <td>期权</td> <td></td></tr></tbody></table> <ol start="3"><li>strDatatype —— 字符串型（String），</li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>'POSITION'</td> <td>持仓</td> <td></td></tr> <tr><td>'ORDER'</td> <td>委托</td> <td></td></tr> <tr><td>'DEAL'</td> <td>成交</td> <td></td></tr> <tr><td>'ACCOUNT'</td> <td>账号</td> <td></td></tr> <tr><td>'TASK'</td> <td>任务</td> <td></td></tr></tbody></table> <ol start="4"><li>strategyName —— 字符串（String）策略名，对应 passorder 下单函数中的参数 strategyName 的值，只对   委托 'ORDER' 和 成交 'DEAL' 有效。</li></ol> <p>返回：列表（Llist），在列表（List） 中保存的是一个对象，通过 <code>dir()</code> 可返回对象的属性列表。有五种交易相关信息：</p> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>POSITION</td> <td>持仓</td> <td></td></tr> <tr><td>ORDER</td> <td>委托</td> <td></td></tr> <tr><td>DEAL</td> <td>成交</td> <td></td></tr> <tr><td>ACCOUNT</td> <td>账号</td> <td></td></tr> <tr><td>TASK</td> <td>任务</td> <td></td></tr></tbody></table> <p>我们来看几个例子，就更直观了。</p> <p>先查询一个股票帐户的信息：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 获取股票 stock 帐户信息。注意提前登录该帐户，否则无结果返回</span>
	account_list <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span><span class="token string">'2000515'</span><span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'account'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===========Account 帐户对象===============================&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐户 2000515 的相关信息 ：&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> acc <span class="token keyword">in</span> account_list<span class="token punctuation">:</span>  <span class="token comment"># 遍历这个 列表（List），取出其中的 对象（Object）打印输出属性值</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐号ID &quot;</span>        <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐号类型 &quot;</span>       <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_nBrokerType<span class="token punctuation">)</span>  
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;保证金比率 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dMaxMarginRate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结保证金 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dFrozenMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结金额 &quot;</span>        <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dFrozenCash<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结手续费 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dFrozenCommission<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;风险度 &quot;</span>          <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dRisk<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;单位净值 &quot;</span>        <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dNav<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期初权益 &quot;</span>        <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dPreBalance<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总资产 &quot;</span>          <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dBalance<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可用金额 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dAvailable<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;手续费 &quot;</span>          <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dCommission<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓盈亏 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dPositionProfit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出入金净值 &quot;</span>       <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dCashIn<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前使用的保证金 &quot;</span>  <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dCurrMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;初始权益 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dInitBalance<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐户状态 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_strStatus<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期初平仓盈亏 &quot;</span>     <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dInitCloseMoney<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总市值 &quot;</span>          <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dInstrumentValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;入金 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dDeposit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出金 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dWithdraw<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上次信用额度 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dPreCredit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上次质押 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dPreMortgage<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;质押 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dMortgage<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;信用额度 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dCredit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券初始资金 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dAssetBalance<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;起始日期 &quot;</span>          <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_strOpenDate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可取金额 &quot;</span>          <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dFetchBalance<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易日 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_strTradingDate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股票总市值 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dStockValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;债券总市值 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dLoanValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;基金总市值 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dFundValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;回购总市值 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dRepurchaseValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;多单总市值 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dLongValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;空单总市值 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dShortValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;净持仓总市值 &quot;</span>       <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dNetValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总负债 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dTotalDebit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可信资产 &quot;</span>           <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dEntrustAsset<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总市值（人民币） &quot;</span>    <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dInstrumentValueRMB<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;申购费 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dSubscribeFee<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;库存市值 &quot;</span>           <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dGoldValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;现货冻结 &quot;</span>           <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dGoldFrozen<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;占用保证金 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;币种 &quot;</span>              <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_strMoneyType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;购买力 &quot;</span>            <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dPurchasingPower<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原始保证金 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dRawMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买入待交收金额（元） &quot;</span> <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dBuyWaitMoney<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;卖出待交收金额（元） &quot;</span> <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dSellWaitMoney<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;本期间应计利息 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dReceiveInterestTotal<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;权利金收支 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dRoyalty<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结权利金 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dFrozenRoyalty<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时占用保证金 &quot;</span>      <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dRealUsedMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时风险度 &quot;</span>         <span class="token punctuation">,</span> acc<span class="token punctuation">.</span>m_dRealRiskDegree<span class="token punctuation">)</span>	
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------------------------------------------&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 运行结果
start trading mode
===========Account 帐户对象===============================
帐户 2000515 的相关信息 ：
帐号ID  2000515
帐号类型  2   （1-期货账号,2-股票账号,3-信用账号,5-期货期权账号,6-股票期权账）
保证金比率  0.0
冻结保证金  4195596.793568001
冻结金额  708883.2000000001
冻结手续费  0.0
风险度  0.0
单位净值  0.0
期初权益  4195596.793568001
总资产  10093132.85904
可用金额  4195596.793568001
手续费  0.0
持仓盈亏  23470.272214303957
平仓盈亏  0.0
出入金净值  0.0
当前使用的保证金  0.0
初始权益  0.0
帐户状态  登录成功
期初平仓盈亏  2374.9999999999927
总市值  5129332.0
入金  0.0
出金  0.0
上次信用额度  0.0
上次质押  0.0
质押  0.0
信用额度  0.0
证券初始资金  10093132.85904
起始日期  
可取金额  4904628.8590400005
交易日  20231123
股票总市值  5129332.0
债券总市值  0.0
基金总市值  0.0
回购总市值  0.0
多单总市值  0.0
空单总市值  0.0
净持仓总市值  0.0
总负债  0.0
可信资产  0.0
总市值（人民币）  0.0
申购费  0.0
库存市值  0.0
现货冻结  0.0
占用保证金  0.0
币种  
购买力  0.0
原始保证金  0.0
买入待交收金额（元）  0.0
卖出待交收金额（元）  0.0
本期间应计利息  0.0
权利金收支  0.0
冻结权利金  0.0
实时占用保证金  0.0
实时风险度  0.0
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><p>查询一个股票帐户中持有的交易品种：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

	<span class="token comment"># 获取股票 stock 帐户的现有持仓。注意提前登录该帐户，否则无结果返回</span>
	pos_list <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span><span class="token string">'2000515'</span><span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'position'</span><span class="token punctuation">)</span>
	
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐户 2000515 的持仓信息，共有多少条记录 ：&quot;</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>pos_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> pos <span class="token keyword">in</span> pos_list<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号ID &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场ID &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场名称 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券代码 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券名称 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保类型 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖方向 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交日期 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strOpenDate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交ID &quot;</span>     <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strTradeID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前拥股 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓价格 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dOpenPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易日 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strTradingDay<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;保证金 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓成本 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dOpenCost<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;结算价 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dSettlementPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓量 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nCloseVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓额 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dCloseAmount<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;浮动盈亏 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dFloatProfit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市值 &quot;</span>       <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dMarketValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持有成本 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dPositionCost<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓盈亏 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dPositionProfit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新结算价 &quot;</span>  <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dLastSettlementPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约价值 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dInstrumentValue<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否今仓 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_bIsToday<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股东帐号 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strStockHolder<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结数量 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nFrozenVolume<span class="token punctuation">)</span>  <span class="token comment"># 期货不用这个字段，只用于股票品种</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可用数量 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nCanUseVolume<span class="token punctuation">)</span>  <span class="token comment"># 期货不用这个字段，只用于股票品种</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在途股份 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nOnRoadVolume<span class="token punctuation">)</span>  <span class="token comment"># 期货不用这个字段，只用于股票品种</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;昨仓数量 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nYesterdayVolume<span class="token punctuation">)</span> <span class="token comment"># 期货不用这个字段，只用于股票品种</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新价 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dLastPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓均价 &quot;</span>     <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dAvgOpenPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;盈亏比例 &quot;</span>     <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dProfitRate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交类型 &quot;</span>     <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_eFutureTradeType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;到期日 &quot;</span>       <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strExpireDate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合成交号 &quot;</span>    <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strComTradeID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合序号 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nLegId<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;累计成本 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dTotalCost<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;单股成本 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dSingleCost<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑数量 &quot;</span>      <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nCoveredVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓类型 &quot;</span>       <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_eSideFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率 &quot;</span>          <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;基金拆合数量 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dStructFundVol<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;基金可赎回量 &quot;</span>   <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dRedemptionVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;申赎可用量 &quot;</span>     <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nPREnableVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时占用保证金 &quot;</span>  <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dRealUsedMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;权利金 &quot;</span>         <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dRoyalty<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;标的证券最新价 &quot;</span>  <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dStockLastPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;静态持仓保证金 &quot;</span>  <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_dStaticHoldMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期权组合占用量 &quot;</span>  <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nOptCombUsedVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可行权数量 &quot;</span>     <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_nEnableExerciseVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key &quot;</span>       <span class="token punctuation">,</span>pos<span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;++++++++++++++++++++++++++++++++++++++++++++++++++++&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果
start trading mode
帐户 2000515 的持仓信息，共有多少条记录 ： 8
账号ID  2000515
市场ID  SH
市场名称  上证所
品种代码  
品种名称  
证券代码  600027
证券名称  华电国际
投保类型  49
买卖方向  48
成交日期  
成交ID  
当前拥股  0
开仓价格  0.0
交易日  20231123
保证金  0.0
持仓成本  0.0
结算价  5.07
平仓量  0
平仓额  0.0
浮动盈亏  0.0
平仓盈亏  0.0
市值  0.0
持有成本  0.0
持仓盈亏  0.0
最新结算价  0.0
合约价值  0.0
是否今仓  True
股东帐号  
冻结数量  0
可用数量  0
在途股份  0
昨仓数量  0
最新价  5.07
开仓均价  0.0
盈亏比例  0.0
成交类型  48   （48：普通成交 49：期权成交  50：OTC 成交  51：期转现衍生成交  52：组合衍生成交）
到期日  
组合成交号  
组合序号  0
累计成本  0.0
单股成本  0.0
备兑数量  0
持仓类型  48 
汇率  0.0
基金拆合数量  0
基金可赎回量  0
申赎可用量  0
实时占用保证金  0.0
权利金  0.0
标的证券最新价  1.7976931348623157e+308
静态持仓保证金  1.7976931348623157e+308
期权组合占用数量  0
可行权数量  -1
账号key  2____11194____114911____49____2000515____
++++++++++++++++++++++++++++++++++++++++++++++++++++
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><p>看了上例之后，你是不是马上就想到了，这可以设置 止盈止损了嘛。因为这已经获取到了持仓单的品种、浮动盈亏的金额、甚至还有盈亏比例。这设置一个条件，比较一下大小，就立即卖出，这不就是 止盈止损 嘛。</p> <p>接下来，我们再来看看 委托单 的例子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

	ord_list <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span><span class="token string">'2000515'</span><span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'order'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===========Order  委托对象===============================&quot;</span><span class="token punctuation">)</span>	
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐户 2000515 的委托单信息，共有多少条记录 ：&quot;</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>ord_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token builtin">ord</span> <span class="token keyword">in</span> ord_list<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号ID &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场ID &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场名称 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券代码 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券名称 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;内部委托号 &quot;</span>      <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strOrderRef<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格类型 &quot;</span>    <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nOrderPriceType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托操作方向 &quot;</span>    <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖/开平标志 &quot;</span>   <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nOffsetFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保标志 &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格 &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dLimitPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最初委托量 &quot;</span>      <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nVolumeTotalOriginal<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托状态 &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nOrderStatus<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;已成交量 &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nVolumeTraded<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托剩余量 &quot;</span>      <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nVolumeTotal<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;错误代码 &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nErrorID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;错误消息 &quot;</span>        <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strErrorMsg<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务号 &quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结保证金 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dFrozenMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结手续费 &quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dFrozenCommission<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托日期 &quot;</span>         <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strInsertDate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托时间 &quot;</span>         <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strInsertTime<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交均价 &quot;</span>         <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dTradedPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;已撤数量 &quot;</span>         <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dCancelAmount<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖中文标记 &quot;</span>      <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strOptName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交金额 &quot;</span>         <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dTradeAmount<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托类型 &quot;</span>         <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_eEntrustType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;废单原因&quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strCancelInfo<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;标的证券代码&quot;</span>       <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strUnderCode<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑标记&quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_eCoveredFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格（人民币）&quot;</span>  <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dOrderPriceRMB<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交金额（人民币）&quot;</span>  <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dTradeAmountRMB<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率&quot;</span>             <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约编号&quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strCompactNo<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;头寸来源&quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_eCashgroupProp<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;预估在途占用保证金&quot;</span>  <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_dShortOccupedMargin<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否是迅投交易&quot;</span>     <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strXTTrade<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key&quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投资备注&quot;</span>          <span class="token punctuation">,</span><span class="token builtin">ord</span><span class="token punctuation">.</span>m_strRemark<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;+++++++++++++++++++++++++++++++++++++++++++++++++++&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果
账号ID  2000515
市场ID  SZ
市场名称  深交所
品种代码  
品种名称  
证券代码  300607
证券名称  拓斯达
内部委托号  SZ____895
委托价格类型  50
委托操作方向  48
买卖/开平标志  49
投保标志  49
委托价格  16.5
最初委托量  2400
委托状态  56
已成交量  2400
委托剩余量  0
错误代码  2147483647
错误消息  
任务号  -1
冻结保证金  0.0
冻结手续费  0.0
委托日期  20231123
委托时间  100658
成交均价  16.5
已撤数量  0.0
买卖中文标记  限价卖出
成交金额  39600.0
委托类型  48
废单原因 
标的证券代码 
备兑标记 0
委托价格（人民币） 0.0
成交金额（人民币） 0.0
汇率 0.0
合约编号 
头寸来源 48
预估在途占用保证金 1.7976931348623157e+308
是否是迅投交易 其他终端
账号key 2____11194____114911____49____2000515____
投资备注 
+++++++++++++++++++++++++++++++++++++++++++++++++++
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><p>通过上例，可以看到获取到的 委托单 的信息。</p> <p>再来看一个关于 成交单 的示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

	<span class="token comment"># 获取股票 stock 帐户的现有持仓。注意提前登录该帐户，否则无结果返回</span>
	deal_list <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span><span class="token string">'2000515'</span><span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'DEAL'</span><span class="token punctuation">)</span>
	
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐户 2000515 的成交信息，共有多少条记录 ：&quot;</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>deal_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> deal <span class="token keyword">in</span> deal_list<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号ID &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场ID &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场名称 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券代码 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券名称 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交ID &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strTradeID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单引用 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strOrderRef<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合同编号 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strOrderSysID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖方向 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开平标志 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nOffsetFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保类型 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交均价 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交量 &quot;</span>           <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交日期 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strTradeDate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交时间 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strTradeTime<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;手续费 &quot;</span>           <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dCommission<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交额 &quot;</span>           <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dTradeAmount<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务号 &quot;</span>           <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格类型 &quot;</span>       <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nOrderPriceType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖标记 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strOptName<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托类别 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_eEntrustType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交类型 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_eFutureTradeType<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实际开平 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nRealOffsetFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑标记 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_eCoveredFlag<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平今量 &quot;</span>            <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nCloseTodayVolume<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格（人民币） &quot;</span>  <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dOrderPriceRMB<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交价格（人民币） &quot;</span>  <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dPriceRMB<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交金额（人民币） &quot;</span>  <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dTradeAmountRMB<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率 &quot;</span>              <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否是迅投交易 &quot;</span>     <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strXTTrade<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约编号 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strCompactNo<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投资备注 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strRemark<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;订单编号 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nRef<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;++++++++++++++++++++++++++++++++++++++++++++++++++++&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果
账号ID  2000515
市场ID  SH
市场名称  上证所
品种代码  
品种名称  
证券代码  605555
证券名称  德昌股份
成交ID  12
下单引用  
合同编号  670
买卖方向  48
开平标志  49
投保类型  49
成交均价  22.89
成交量  600
成交日期  20231123
成交时间  94239
成交额  13734.0
任务号  -1
委托价格类型  50
买卖标记  限价卖出
委托类别  48
成交类型  48
实际开平  -1
备兑标记  48
平今量  0
委托价格（人民币）  0.0
成交价格（人民币）  0.0
成交金额（人民币）  0.0
汇率  0.0
是否是迅投交易  其他终端
合约编号  
平仓盈亏  0.0
投资备注  
账号key  2____11194____114911____49____2000515____
订单编号  0
++++++++++++++++++++++++++++++++++++++++++++++++++++
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><p>由此可见，get_trade_detail_data() 是一个强大的方法（函数），通过传入不同的形式参数，它就可以返回帐户信息、持有单、委托单的信息。当然还有其它的参数，在此就不一一举例了，有兴趣的话可以参考官方文档为准。</p> <p>再来看一个关于 任务 的示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

	<span class="token comment"># 获取股票 stock 帐户的现有持仓。注意提前登录该帐户，否则无结果返回</span>
	deal_list <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span><span class="token string">'620000123673'</span><span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'TASK'</span><span class="token punctuation">)</span>
	
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐户 620000123673 的成交信息，共有多少条记录 ：&quot;</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>deal_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> deal <span class="token keyword">in</span> deal_list<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务ID号 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务状态 &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_eStatus<span class="token punctuation">)</span>  <span class="token comment"># 2 提交中 3 执行中 7完成  4 暂停</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务消息 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strMsg<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务开始时间 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_startTime<span class="token punctuation">)</span>  <span class="token comment"># 时间戳格式</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务结束时间 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_endTime<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务取消时间 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_cancelTime<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;已成交量 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nBusinessNum<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合Id &quot;</span>          <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nGroupId<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单品种代码 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_stockCode<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单用户 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单操作 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_eOperationType<span class="token punctuation">)</span> <span class="token comment"># 0 开多 3 开空 14 平多 15 平空 18 买入 19卖出</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易类型 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_eOrderType<span class="token punctuation">)</span>  <span class="token comment"># 0 常规交易  1 算法交易 11 智能VWAP</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;报价方式 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_ePriceType<span class="token punctuation">)</span>  <span class="token comment"># 5 最新价  14对手价 11 指定价 18 市价最优价</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_dFixPrice<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托量 &quot;</span>           <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_nNum<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投资备注 &quot;</span>         <span class="token punctuation">,</span>deal<span class="token punctuation">.</span>m_strRemark<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;++++++++++++++++++++++++++++++++++++++++++++++++++++&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果
任务ID号  1
任务状态  4
任务消息  12.8200全部委托! 报价行情已31秒未更新!
任务开始时间  1734261320
任务结束时间  2147483647
任务取消时间  2147483647
已成交量  0
组合Id  1
下单品种代码  600089.SH
下单用户  620000123673
下单操作  18
交易类型  0
报价方式  5
委托价  12.82
委托量  1000
投资备注  ++++++++++++++++++++++++++++++++++++++++++++++++++++
&quot;&quot;&quot;</span>
             
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="_3-02-获取板块成份股contextinfo-get-stock-list-in-sector"><a href="#_3-02-获取板块成份股contextinfo-get-stock-list-in-sector" class="header-anchor">#</a> 3.02 获取板块成份股<br>ContextInfo.get_stock_list_in_sector()</h3> <p>语法： ContextInfo.get_stock_list_in_sector(sectorname, realtime)</p> <p>功能： 获取板块中包含的股票品种代码列表。板块名称即 “行情”界面中，“板块”标签中的板块名称。也支持自定义板块名称。</p> <p><img src="/xuntou_yao/assets/img/xtqmt28.dc9b5e3c.png" alt="添加帐号"></p> <p>参数：</p> <p>string——板块名称，如“沪深转债”，“创业板”、“上证50”、“我的自选”等
realtime——毫秒级时间戳
返回： list：其中包含板块中的全部股票代码，如：['000002.SZ','000257.SZ'] 等。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    index <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>barpos  <span class="token comment"># 图表中最新一根K线的索引编号</span>
    realtime <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>index<span class="token punctuation">)</span>  <span class="token comment"># 最新一根K线对应的时间戳</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;板块 上证50 中包含哪些股票：\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_stock_list_in_sector<span class="token punctuation">(</span><span class="token string">'上证50'</span><span class="token punctuation">,</span> realtime<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-03-获取市场行情第二版contextinfo-get-market-data-ex"><a href="#_3-03-获取市场行情第二版contextinfo-get-market-data-ex" class="header-anchor">#</a> 3.03 获取市场行情第二版<br>ContextInfo.get_market_data_ex()</h3> <p>功能：这个方法（函数）功能也很强大，并且这是第二版，可见又添加了一些新的功能。因此要好好理解、熟练掌握！</p> <p>据说这个 第二版 是为了接收 Level 2 行情的 逐笔行情 和 逐笔委托 的。但是，前提也是需要帐户支持；同时，至今为止（2022年9月），迅投官方也自称，软件的性能仅能够最多支持 20 个品种的 Level 2 逐笔行情数据。最多的数据，软件处理不了，会导致崩溃。这也是 迅投QMT 只能做为一款个人量化工具的原因。用比喻的话就是一辆奥托，也不是不能开。但性能也就那样。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ContextInfo.get_market_data_ex(
    fields=[ ],                  # 默认为一个空列表（[]），表示获取所有字段 
    stock_code=[],               # 品种代码列表。如：['600027.SZ','000187.SH']
    period='follow',             # 时间周期，默认为 'follow' 表示当前主图表的时间周期 
    start_time='',               # 开始时间，如果为空字符串，表示取当前主图表上最左边K线的时间
    end_time='',                 # 结束时间，字符串格式为'2020093000'。如果为空，表示此时此刻
    count=-1,                    # 表示从图表右边开始，向左取 多少根 K线。 -1 表示无限制
    dividend_type='follow',      # 复权类型
    fill_data=True,              # 如果休市停牌期间，是否自动填充数据
    subscribe=True               # 订阅数据开关，默认为True
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>参数：
fields —— 字段列表</p> <table><thead><tr><th>字符串</th> <th>表达意义</th></tr></thead> <tbody><tr><td>'time'</td> <td>时间</td></tr> <tr><td>'open'</td> <td>开盘价</td></tr> <tr><td>'high'</td> <td>最高价</td></tr> <tr><td>'low'</td> <td>最低</td></tr> <tr><td>'close'</td> <td>收盘价</td></tr> <tr><td>'volume'</td> <td>成交量</td></tr> <tr><td>'amount'</td> <td>成交额</td></tr> <tr><td>'settle'</td> <td>结算价</td></tr> <tr><td>'openInterest'</td> <td>持仓量</td></tr> <tr><td>'preClose'</td> <td>前收盘价</td></tr> <tr><td>'suspendFlag'</td> <td>1 -停牌 0 - 不停牌</td></tr></tbody></table> <p>对于不同时间周期的数据，其取值范围不同。默认为空列表（List）时，即代表所有字段。</p> <p>period周期为tick时，field字段可选:</p> <table><thead><tr><th>字符串</th> <th>数据类型</th> <th>表达意义</th></tr></thead> <tbody><tr><td>time</td> <td>int</td> <td>时间</td></tr> <tr><td>lastPrice</td> <td>float</td> <td>最新价</td></tr> <tr><td>lastClose	float</td> <td>前收盘价</td> <td></td></tr> <tr><td>open</td> <td>float</td> <td>开盘价</td></tr> <tr><td>high</td> <td>float</td> <td>最高价</td></tr> <tr><td>low</td> <td>float</td> <td>最低价</td></tr> <tr><td>close</td> <td>float</td> <td>收盘价</td></tr> <tr><td>volume</td> <td>float</td> <td>成交量</td></tr> <tr><td>amount</td> <td>float</td> <td>成交额</td></tr> <tr><td>settle</td> <td>float</td> <td>今结算</td></tr> <tr><td>openInterest</td> <td>float</td> <td>持仓量</td></tr> <tr><td>stockStatus</td> <td>int</td> <td>停牌 1停牌，0 不停牌</td></tr></tbody></table> <p>stock_code —— 列表型（List），品种合约的代码列表。如：['600027.SZ','000187.SZ']</p> <p>period：字符串型（String），表示时间框架周期，默认为'follow'，即表示取当前主图的周期。取值范围如下：</p> <table><thead><tr><th>参数值</th> <th>表达意义说明</th></tr></thead> <tbody><tr><td>'tick'</td> <td>分笔线</td></tr> <tr><td>'1d'</td> <td>日线</td></tr> <tr><td>'1m'</td> <td>1分钟线</td></tr> <tr><td>'5m'</td> <td>5分钟线</td></tr> <tr><td>'l2quote'</td> <td>Level2行情快照</td></tr> <tr><td>'l2quoteaux'</td> <td>Level2行情快照补充</td></tr> <tr><td>'l2order'</td> <td>Level2逐笔委托</td></tr> <tr><td>'l2transaction'</td> <td>Level2逐笔成交</td></tr> <tr><td>'l2transactioncount'</td> <td>Level2大单统计</td></tr> <tr><td>'l2orderqueue'</td> <td>Level2委买委卖队列</td></tr></tbody></table> <p>注：行情数据字段列表见附录5.5</p> <p>start_time —— 开始时间，为空表示取当前主图表上最左边K线的时间，时间格式为'20201231'或'20201231093000'
end_time —— 结束时间，为空视为此时此刻，时间格式为'20201231'或'20201231093000'
count：—— 数据最大个数，-1 表示无限制
dividend_type —— 复权方式，默认为'follow'，为当前主图复权方式，可选值：</p> <table><thead><tr><th>字符串</th> <th>表达意义</th></tr></thead> <tbody><tr><td>’none'</td> <td>不复权</td></tr> <tr><td>'fornt'</td> <td>向前复权</td></tr> <tr><td>'back'</td> <td>向后复权</td></tr> <tr><td>'front_ratio'</td> <td>等比向前复权</td></tr> <tr><td>'back_ratio'</td> <td>等比向后复权</td></tr></tbody></table> <p>fill_data —— 停牌填充方式，默认为 True（暂不可用）</p> <p>subscribe —— 订阅数据开关，默认为 True，设置为 False时不做数据订阅，只读取本地已有数据。订阅模式下，除分笔以外的周期只会自动补充当天数据，分笔周期不自动补充数据。</p> <p>返回：一个字典（Dict），这个字典的 key（键），当然参数 <code>stock_code</code> 中想要获取的 品种代码 了，想要几个品种，就有几个对应的 key（键）。对应的 value（值），是一个 Pandas 的 数据帧。对 Pandas 不熟悉的同学请自行补课哈。简单说就象一个 excel 表格，表头就是 <code>fields</code> 对应的字段，也就是 列（栏），然后每一行中包含获取到的数据。一共多少行由参数 <code>count</code> 决定。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取 000300.SH 这个品种，日线图 1d 的，最近 10 根 K 线的，高开低收 的价格数据。保存到 data 这个变量中。</span>
    data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_market_data_ex<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">,</span><span class="token string">'high'</span><span class="token punctuation">,</span><span class="token string">'low'</span><span class="token punctuation">,</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 获取 高开低收的价格</span>
        <span class="token punctuation">[</span><span class="token string">'000300.SH'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment"># 获取的品种是 00300.SH</span>
        period<span class="token operator">=</span><span class="token string">'1d'</span><span class="token punctuation">,</span>                    <span class="token comment"># 获取 日K线的 周期</span>
        start_time<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                  <span class="token comment"># 开始时间 缺省</span>
        end_time<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                    <span class="token comment"># 结束时间 缺省</span>
        count<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                       <span class="token comment"># 从最右边的一根K线开始，获取 10 根K线的数据</span>
        dividend_type<span class="token operator">=</span><span class="token string">'follow'</span><span class="token punctuation">,</span>         <span class="token comment"># 复权方式以主图表的方式为准</span>
        fill_data<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 <span class="token comment"># 休市停盘时自动填充数据</span>
        subscribe<span class="token operator">=</span><span class="token boolean">True</span>                  <span class="token comment"># 订阅数据</span>
       <span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 输出结果</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果如下：
{
 '000300.SH':
stime     open       high       low        close   
20220221  4646.0520  4646.6720  4613.2970  4634.314
20220222  4601.9180  4602.0660  4550.8040  4574.153
20220223  4582.0060  4625.2980  4579.2940  4623.046
20220224  4592.0690  4610.8790  4488.4760  4529.319
20220225  4564.6320  4611.8600  4561.8960  4573.425
20220228  4563.7430  4581.6460  4530.6760  4581.646
20220301  4597.8550  4623.4310  4583.9170  4619.686
20220302  4594.0170  4594.0170  4558.4420  4578.601
20220303  4595.0250  4599.3970  4544.4310  4551.628
20220304  4513.3636  4539.3924  4481.4928  4496.430
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>由例程的运行结果，可以看到，打印输出的结果是一个 字典。只有一个 key（键）， “000300.SH”，对应的 value（值）是一个 Pandas 的 数据帧，字段名是 stime、open、high、low、close，分别表示时间、开盘价、最高价、最低价和收盘价。然后是 10 条记录，从最近的日期开始向前一共 10 天的数据，就已经获取到了。</p> <p>日线图 1d 有什么意思嘛，必须给我来 Level 2 级的 逐笔成交 数据，我要高频、高速的！行，把参数修改一下即可，请看下例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取 000300.SH 这个品种，最新的报价数据， level 2 逐笔行情，最近 10 次的价格数据。保存到 data 这个变量中。</span>
    data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_market_data_ex<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                             <span class="token comment"># 获取 全部字段的数据</span>
        <span class="token punctuation">[</span><span class="token string">'000300.SH'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment"># 获取的品种是 00300.SH</span>
        period<span class="token operator">=</span><span class="token string">'l2transaction'</span><span class="token punctuation">,</span>         <span class="token comment"># 获取 Level 2 级 逐笔行情 的数据</span>
        start_time<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                  <span class="token comment"># 开始时间 缺省</span>
        end_time<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                    <span class="token comment"># 结束时间 缺省</span>
        count<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>                       <span class="token comment"># 从最右边的一根K线开始，获取 10 根K线的数据</span>
        dividend_type<span class="token operator">=</span><span class="token string">'follow'</span><span class="token punctuation">,</span>         <span class="token comment"># 复权方式以主图表的方式为准</span>
        fill_data<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 <span class="token comment"># 休市停盘时自动填充数据</span>
        subscribe<span class="token operator">=</span><span class="token boolean">True</span>                  <span class="token comment"># 订阅数据</span>
<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 输出结果</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果如下：
请求失败, 没有Level-2增强版权限
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>如示例显示，你会收到错误消息，没有 Level - 2  增强版极限。简单说，要花钱（目前还不见得有效）。</p> <p>因此，通常在 迅投QMT 中，用此方法（函数），获取到的最快的行情数据，即 3秒一跳  的快照行情了。请参考下例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 订阅市场行情获取数据</span>
    data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_market_data_ex<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 获取 高开低收的价格</span>
        <span class="token punctuation">[</span><span class="token string">'000300.SH'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment"># 获取的品种是 000300.SH</span>
        period<span class="token operator">=</span><span class="token string">'tick'</span><span class="token punctuation">,</span>                  <span class="token comment"># 获取 日K线的 周期</span>
        start_time<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                  <span class="token comment"># 开始时间 缺省</span>
        end_time<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                    <span class="token comment"># 结束时间 缺省</span>
        count<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>                        <span class="token comment"># 从最右边的一根K线开始，获取 10 根K线的数据</span>
        dividend_type<span class="token operator">=</span><span class="token string">'follow'</span><span class="token punctuation">,</span>         <span class="token comment"># 复权方式以主图表的方式为准</span>
        fill_data<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 <span class="token comment"># 休市停盘时自动填充数据</span>
        subscribe<span class="token operator">=</span><span class="token boolean">True</span>                  <span class="token comment"># 订阅数据</span>
       <span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 输出结果</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果如下：
{'000300.SH':                           amount                   askPrice           askVol  \
stime                                                                          
20220915155954.490  2.543675e+11  [0.0, 0.0, 0.0, 0.0, 0.0]  [0, 0, 0, 0, 0]   
20220915155954.490  2.543675e+11  [0.0, 0.0, 0.0, 0.0, 0.0]  [0, 0, 0, 0, 0]   
20220915155954.490  2.543675e+11  [0.0, 0.0, 0.0, 0.0, 0.0]  [0, 0, 0, 0, 0]   

                                     bidPrice           bidVol     high  \
stime                                                                     
20220915155954.490  [0.0, 0.0, 0.0, 0.0, 0.0]  [0, 0, 0, 0, 0]  4088.81   
20220915155954.490  [0.0, 0.0, 0.0, 0.0, 0.0]  [0, 0, 0, 0, 0]  4088.81   
20220915155954.490  [0.0, 0.0, 0.0, 0.0, 0.0]  [0, 0, 0, 0, 0]  4088.81   

                    lastClose  lastPrice  lastSettlementPrice      low  \
stime                                                                    
20220915155954.490    4065.36    4027.12                  0.0  3998.86   
20220915155954.490    4065.36    4027.12                  0.0  3998.86   
20220915155954.490    4065.36    4027.12                  0.0  3998.86   

                       open  openInt      pvolume  settlementPrice  \
stime                                                                
20220915155954.490  4078.65       15  12395119616              0.0   
20220915155954.490  4078.65       15  12395119616              0.0   
20220915155954.490  4078.65       15  12395119616              0.0   

                                 stime  stockStatus           time  \
stime                                                                
20220915155954.490  20220915155954.490            1  1663228794490   
20220915155954.490  20220915155954.490            1  1663228794490   
20220915155954.490  20220915155954.490            1  1663228794490   

                    transactionNum     volume  
stime                                          
20220915155954.490               0  123951200  
20220915155954.490               0  123951200  
20220915155954.490               0  123951200  }
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>看着有点乱哈，用 Excel 整理下，就明白多了。</p> <p><img src="/xuntou_yao/assets/img/tickdata.89a22034.png" alt="获取市场行情Pandas数据帧"></p> <p>现在明白了 Pandas 的功能了吧？没学好的同学自己抓紧补课哈。由此可见，这个带 ex 的第二版方法（函数），主要是想用来获取 Level 2 行情的，但条件是客户的帐户需要购买对应的权限。而其基本功能，还是获取一个 Pandas 的数据帧，用于方便后面的计算，比如取一段时间的最高价/最低价啊、算一个平均值啊、因此结合 Pandas 运用好这个方法（函数），还是十分高效的。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>前一个版本的 获取市场行情数据 的方法（函数） ContextInfo.get_market_data()，可以弃用了。<br></p> <p>同时 ContextInfo.get_history_data() 也可以弃用了。</p></div> <p>此方法可以 获取快照行情 和 历史行情 。实际运用中，如果只想要实时的市场行情，通常用下面这个方法：</p> <p><code>ContextInfo.get_full_tick()</code></p> <h3 id="_3-04-获取分笔数据contextinfo-get-full-tick"><a href="#_3-04-获取分笔数据contextinfo-get-full-tick" class="header-anchor">#</a> 3.04  获取分笔数据<br>ContextInfo.get_full_tick()</h3> <p>大多数股民的日常行为就是 盯盘，所谓 盯盘 其实就是看着屏幕上的数字跳动。其实这是一个毫无意义且消耗精力的行为。做量化自动交易程序，就是要解放这种行为，让电脑程序帮人 盯盘，效率高、准确度高、速度还快。</p> <p>与上一个方法 <code>ContextInfo.get_market_data_ex()</code> 相比，此方法主要用来接收实时的市场行情，记录每一次的价格变化、再根据需要进行计算，判断是否买卖。量化自动交易程序无非如此，没有什么神奇的秘密。</p> <p><u>到今天为止，根据国家政策， Level 2 级的 逐笔成交 行情报价 和 深圳市场才有的 逐笔委托 行情是不允许出券商的机房的；同时 迅投 QMT 自己也承受不了超过20+ 品种的 逐笔报价 的数据流量，软件自身都会崩溃。因此，在 迅投 QMT 中，如果在本地自己的电脑上运行，只可能用上 3秒一跳的 快照行情。市场上各种说法，各种名词，混淆概念，称之为 tick 行情啊、逐笔行情啊、高速行情啊、一口一跳啊，都是指的这种 3秒一跳 的报价行情。</u></p> <p>因此，在 迅投QMT 中的 <code>handlebar()</code> 中使用此方法（函数），通常也只能接收到 3秒一跳 的快照行情。</p> <p>语法： <code>ContextInfo.get_full_tick(stock_code=[])</code></p> <p>参数：</p> <p>stock_code  —— 列表型（List）默认参数，品种代码的列表，如 <code>['600000.SH','600036.SH']</code>。如果此参数缺省，则取当前主图表上的品种合约。</p> <p>返回：根据参数 stock_code 订阅的品种，返回一个 分笔数据 的字典（Dict）。该字典的 key 对应的就是每一个订阅的品种代码，每个 key 对应的 value 还是一个字典（Dict），在该字典中即存放着对应的 品种代码 的最新报价数据，这个字典的 key 如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{  
 'timetag':                 # 最近一次收到报价的时间
 'lastPrice'：              # 最新价
 'open':                    # 开盘价
 'high':                    # 最高价
 'low':                     # 最低价
 'lastClose':               # 昨收盘价
 'amount'：                 # 成交额  今日累积 
 'volume'：                 # 成交量（手）今日累积  
 'pvolumn'：                # 成交量（股）今日累积   
 'stockStatus'：            # 股票状态  
 'openInt'：                # 持仓量  
 'settlementPrice'：        # 结算价  
 'lastSettlementPrice'：    # 最新结算价  
 'askPrice'：               # 列表（List)，卖价五档  
 'bidPrice'：               # 列表（List)，买价五档  
 'askVol'：                 # 列表（List)，卖量五档  
 'bidVol'；                 # 列表（List)，买量五档  
}  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>请参考以下示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ContextInfo<span class="token punctuation">.</span>set_universe<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'600000.SH'</span><span class="token punctuation">,</span><span class="token string">'600036.SH'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 订阅了两支股票</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

	fulltick <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_full_tick<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'600000.SH'</span><span class="token punctuation">,</span><span class="token string">'600036.SH'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment"># 获取逐笔报价数据</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;返回的数据是什么类型？：&quot;</span><span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>fulltick<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;返回的字典包括的 KEY 为：&quot;</span><span class="token punctuation">,</span>fulltick<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打印输出返回的字典（dict）的全部 key</span>
	
	<span class="token keyword">for</span> Asymbol <span class="token keyword">in</span> fulltick<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 遍历字典（dict）中的每一个品种</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;======================================&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码：&quot;</span><span class="token punctuation">,</span>Asymbol<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新报价时间：&quot;</span> <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'timetag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新价：&quot;</span>      <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'lastPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开盘价：&quot;</span>      <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最高价：&quot;</span>      <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'high'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最低价：&quot;</span>      <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;昨收盘价：&quot;</span>  <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'lastClose'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交额：&quot;</span>      <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交量（手）：&quot;</span> <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'volume'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交量（股）：&quot;</span> <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pvolume'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股票状态：&quot;</span>    <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'stockStatus'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;结算价：&quot;</span>     <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'settlementPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token comment"># 适用期货</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新结算价：&quot;</span>  <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'lastSettlementPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 适用期货</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;卖价五档：&quot;</span>   <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'askPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买价五档：&quot;</span>   <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'bidPrice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;卖价量：&quot;</span>     <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'askVol'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买价量：&quot;</span>     <span class="token punctuation">,</span>fulltick<span class="token punctuation">[</span>Asymbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'bidVol'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;  运行结果如下
返回的数据是什么类型？： &lt;class 'dict'&gt;
返回的字典包括的 KEY 为： dict_keys(['600000.SH', '600036.SH'])
======================================
品种代码： 600000.SH
最新报价时间： 20200902 10:00:04
最新价： 7.21
开盘价： 7.24
最高价： 7.2700000000000005
最低价： 7.2
昨收盘价： 7.23
成交额： 144223110.0
成交量（手）： 199755
成交量（股）： 199755
股票状态： 0
结算价： 0.0
最新结算价： 0.0
卖价五档： [0.0, 0.0, 0.0, 0.0, 0.0]
买价五档： [0.0, 0.0, 0.0, 0.0, 0.0]
卖价量： [0, 0, 0, 0, 0]
买价量： [0, 0, 0, 0, 0]
......
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>通过上例，再看看下图。</p> <p><img src="/xuntou_yao/assets/img/600ft.384dcb66.png" alt="获取报价行情"></p> <p>是不是感觉就对上了。解放了你的眼睛吧，电脑程序比你的肉眼精准多了，速度也快得多。</p> <h3 id="_3-05-获取当日新股新债get-ipo-data"><a href="#_3-05-获取当日新股新债get-ipo-data" class="header-anchor">#</a> 3.05  获取当日新股新债<br>get_ipo_data()</h3> <p>功能： 自动打新的最爱。获取当日新股新债信息，返回结果为一个字典,包括新股申购代码,申购名称,最大申购数量,最小申购数量等数据。</p> <p>语法： <code>get_ipo_data([,type])</code></p> <p>参数：
type ——  字符串型（String），缺省时返回新股新债信息。 type=&quot;STOCK&quot; 表示只返回新股申购信息，type=&quot;BOND&quot; 表示只返回新的可转债申购信息。
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ipoData <span class="token operator">=</span> get_ipo_data<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#返回新股新债信息</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'今天可以申购的新股和新债：'</span><span class="token punctuation">,</span>ipoData<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
	
	ipoStock <span class="token operator">=</span> get_ipo_data<span class="token punctuation">(</span><span class="token string">&quot;STOCK&quot;</span><span class="token punctuation">)</span> <span class="token comment">#返回新股信息</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'今天可以申购的新股：'</span><span class="token punctuation">,</span>ipoStock<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

	ipoCB <span class="token operator">=</span> get_ipo_data<span class="token punctuation">(</span><span class="token string">&quot;BOND&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 返回新债申购信息</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'今天可以申购的新债：'</span><span class="token punctuation">,</span>ipoCB<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
今天可以申购的新股和新债： {'732075.SH': {'name': '热威申购', 'type': 'STOCK', 'maxPurchaseNum': 12000, 'minPurchaseNum': 500, 'purchaseDate': '20200830', 'issuePrice': 23.1}}

今天可以申购的新股： {'732075.SH': {'name': '热威申购', 'type': 'STOCK', 'maxPurchaseNum': 12000, 'minPurchaseNum': 500, 'purchaseDate': '20200830', 'issuePrice': 23.1}}

今天可以申购的新债： {}
&quot;&quot;&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-06-获取账户新股申购额度get-new-purchase-limit"><a href="#_3-06-获取账户新股申购额度get-new-purchase-limit" class="header-anchor">#</a> 3.06 获取账户新股申购额度<br>get_new_purchase_limit()</h3> <p>功能： 获取账户允许的新股申购额度</p> <p>语法： get_new_purchase_limit(accid)</p> <p>参数：
accid —— 资金账号，必须是股票账号或者信用账号</p> <p>返回：一个字典，包括上海主板,深圳市场,上海科创版的申购额度。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	purchase_limit <span class="token operator">=</span> get_new_purchase_limit<span class="token punctuation">(</span><span class="token string">&quot;410038216969&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 此处是一个 股票帐号</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐号 410038216969 的新股申购额度为：&quot;</span><span class="token punctuation">,</span>purchase_limit<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-07-获取指定市场的最新时间get-market-time"><a href="#_3-07-获取指定市场的最新时间get-market-time" class="header-anchor">#</a> 3.07 获取指定市场的最新时间<br>get_market_time()</h3> <p>功能： 根据指定的交易所市场，如沪市/深市，获取来自交易所的最新时间
语法： get_market_time(market)
参数：
market —— 市场代码（如&quot;SH&quot;）
返回： 整数型。市场最新时间，最小单位是 秒</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上海沪市的最新时间是：&quot;</span><span class="token punctuation">,</span>get_market_time<span class="token punctuation">(</span><span class="token string">&quot;SH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;深市的最新时间是：&quot;</span><span class="token punctuation">,</span>get_market_time<span class="token punctuation">(</span><span class="token string">&quot;SZ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;  运行结果
上海沪市的最新时间是： 111530
深市的最新时间是： 111530
休市停盘之后，对应的时间也会停止。
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>迅投QMT 中的这种 6 位整数的时间表达方式，一度让我感到很谜。后面才慢慢想明白，这意味着最小的单位，就到 秒。</p> <p>111530 对应着 11:15:30 。用 6 位整数，可以直接比较大小，不必转换。一分钟之内的 秒 数，也可以直接用最后两位数直接相减即可。</p> <h3 id="_3-08-获取当前k-线对应的时间戳contextinfo-get-bar-timetag"><a href="#_3-08-获取当前k-线对应的时间戳contextinfo-get-bar-timetag" class="header-anchor">#</a> 3.08 获取当前K 线对应的时间戳<br>ContextInfo.get_bar_timetag()</h3> <p>语法： ContextInfo.get_bar_timetag(index)</p> <p>功能： 获取指定 索引号 K 线对应的时间戳（毫秒），如未指定，则默认为当前K线。</p> <p>参数： index —— 指定主图表中某一根 K 线的索引序号</p> <p>返回： 时间戳（毫秒）</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span><span class="token number">1080</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span><span class="token number">580</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前主图表上 索引号为 1080 的K线，对应的时间是：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;毫秒时间戳为：&quot;</span><span class="token punctuation">,</span>t1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;转换后为 &quot;</span><span class="token punctuation">,</span>timetag_to_datetime<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token string">'%Y%m%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前主图表上 索引号为 580 的K线，对应的时间是：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;毫秒时间戳为：&quot;</span><span class="token punctuation">,</span>t2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;转换后为 &quot;</span><span class="token punctuation">,</span>timetag_to_datetime<span class="token punctuation">(</span>t2<span class="token punctuation">,</span> <span class="token string">'%Y%m%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=============================&quot;</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果
当前主图表上 索引号为 1080 的K线，对应的时间是：
毫秒时间戳为： 1657072800000
转换后为  20220706 10:00:00
当前主图表上 索引号为 580 的K线，对应的时间是：
毫秒时间戳为： 1648704600000
转换后为  20220331 13:30:00
=============================
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_3-09-获取给定日期对应的-k-线索引号contextinfo-get-date-location"><a href="#_3-09-获取给定日期对应的-k-线索引号contextinfo-get-date-location" class="header-anchor">#</a> 3.09 获取给定日期对应的 K 线索引号<br>ContextInfo.get_date_location()</h3> <p>此方法与 <code>ContextInfo.get_bar_timetag()</code> 正好互补，根据指定的日期，返回对应的K线索引号。</p> <p>功能： 根据指定的一个日期时间，返回当前主图表上对应的 K 线索引序号。如果当前主图上的第 0 号K线的日期都在指定的日期之后，则返回 0 表示没找到对应的K线。</p> <p>语法： ContextInfo.get_date_location(strdate)</p> <p>参数： string：形式如 'yyyymmdd' ，如 '20170711'</p> <p>返回： 时间戳（毫秒）</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot; 20230120 对应的K线索引编号为：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_date_location<span class="token punctuation">(</span><span class="token string">&quot;20230120&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot; 20220720 10:30:00对应的K线索引编号为：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_date_location<span class="token punctuation">(</span><span class="token string">&quot;20220720 10:30:00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果
20230120 对应的K线索引编号为： 2159
20220720 10:30:00对应的K线索引编号为： 1159
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-10-获取当前主图品种最新分笔报价对应的时间戳contextinfo-get-tick-timetag"><a href="#_3-10-获取当前主图品种最新分笔报价对应的时间戳contextinfo-get-tick-timetag" class="header-anchor">#</a> 3.10 获取当前主图品种最新分笔报价对应的时间戳<br>ContextInfo.get_tick_timetag()</h3> <p>语法： ContextInfo.get_tick_timetag()</p> <p>功能： 获取当前主图品种最新分笔报价对应的时间戳</p> <p>参数： 无</p> <p>返回： 时间戳（毫秒）</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_tick_timetag<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;转换后为 &quot;</span><span class="token punctuation">,</span>timetag_to_datetime<span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">'%Y%m%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果:
1653265012659
转换后为  20220831 10:30:12
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-11-获取一篮子证券编码数据contextinfo-load-stk-list"><a href="#_3-11-获取一篮子证券编码数据contextinfo-load-stk-list" class="header-anchor">#</a> 3.11 获取一篮子证券编码数据<br>ContextInfo.load_stk_list()</h3> <p>功能： 从指定的文件路径中，获取一篮子 证券代码</p> <p>语法：ContextInfo.load_stk_list(filePath，fileName)</p> <p>文件类型可以是 .txt 或 .csv 格式，内容如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>600000.SH,600004.SH,600006.SH,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>中间的分隔符为 英文半角逗号（,）。</p> <p>参数：</p> <p>filePath —— 文件路径</p> <p>fileName —— 文件名(比如：a.txt,b.csv)</p> <p>返回： 一个列表（list），其中包含文档中的品种名称代码。</p> <p>示例：请提前在 D:/data 文件夹中准备一个 list.txt 的文件。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>load_stk_list<span class="token punctuation">(</span><span class="token string">'D:/data'</span><span class="token punctuation">,</span><span class="token string">'list.txt'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/xuntou_yao/assets/img/xtqmt26.d2bb81c0.png" alt="示例图片"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li><p>文件名称和路径中，不要使用中文，否则可能会失败！</p></li> <li><p>如果执行成功，会更改文件名，(在文件末尾以加上调用的时间)</p></li> <li><p>如果不希望策略程序修改文件名称，可在 设置 面板，交易设置中，取消 “允许load_stk_list函数重命名文件”前面的 勾；</p></li></ol></div> <p><img src="/xuntou_yao/assets/img/xtqmt30.d8494483.png" alt="示例图片"></p> <h3 id="_3-12-获取一篮子证券编码及数量数据contextinfo-load-stk-vol-list"><a href="#_3-12-获取一篮子证券编码及数量数据contextinfo-load-stk-vol-list" class="header-anchor">#</a> 3.12 获取一篮子证券编码及数量数据<br>ContextInfo.load_stk_vol_list()</h3> <p>功能： 与上一个方法类似，区别是可以一次读取到品种名称和数量的信息。从指定的文件路径中，获取自选的一篮子 证券代码 和 数量 信息。</p> <p>语法： ContextInfo.load_stk_vol_list(filePath，fileName)</p> <p>文件类型可以是 .txt 或 .csv 格式，内容如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>600000.SH,100,600004.SH,500,600006.SH,200,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>中间的分隔符为 英文半角逗号（,）。</p> <ul><li><p>参数：</p> <p>filePath —— 文件路径</p> <p>fileName —— 文件名(比如：a.txt,b.csv)</p></li></ul> <p>返回： 一个字典（dict），其中包含文档中的内容。key 为品种名称代码，value 为数量信息。</p> <p>示例：请提前在 D：/data/ 文件夹中准备一个 list.txt 的文件，其中的内容如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ContextInfo<span class="token punctuation">.</span>load_stk_vol_list<span class="token punctuation">(</span><span class="token string">'D:/data'</span><span class="token punctuation">,</span><span class="token string">'list.txt'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="行情相关"><a href="#行情相关" class="header-anchor">#</a> =====行情相关=====</h3> <h3 id="_3-13-订阅行情数据contextinfo-subscribe-quote"><a href="#_3-13-订阅行情数据contextinfo-subscribe-quote" class="header-anchor">#</a> 3.13 订阅行情数据<br>ContextInfo.subscribe_quote()</h3> <p>一般情况下，<code>handlebar()</code> 基于主图品种的分笔数据，每3秒执行一次。因为 分笔数据 是3秒跳动一次。但有时因品种的交易活跃程度不一，某一个时段内，可能某个品种报价跳动快，次数多；而有的品种报价慢，半天都没有跳动。因此，就可以用上这个方法，单独订阅某一个品种，只要报价跳动了，就立即调用执行一个自定义函数。可以做为 <code>handlebar()</code>的补充。（其实在实际应用中，Level 1 行情，就是 3秒一跳，用 <code>handlebar()</code> 足矣。Level 2 肯定用不着这个方法了。）</p> <p>功能：订阅某一个品种的行情数据。在实际运行策略时，驱动方法 <code>handlebar()</code> 执行的频次，只与主图品种的分笔报价频繁相关。如果需要同时监控另一个品种代码时，可能出现主图报价与品种报价不同步，一个更新快，一个更新慢的情况。此时，即可通过此 方法来实现，一旦接收到某个品种的报价后立即调用执行一个自定义函数的功能。此方法支持订阅 level-2 行情，需要额外开通 level-2 增强版权限。</p> <p>语法：ContextInfo.subscribe_quote(stockcode,period,dividend_type,callback)</p> <p>参数：</p> <p>stockcode —— 字符串型，代表一个股票代码，如'000001.SZ'，如果缺省，则默认为当前图表上的品种代码<br>
period —— 字符串型（String），指定 K 线图表的时间帧框架周期，取值如：'tick'：表示分笔线，'1d'：表示日K线，'1m'：表示一分钟K线，'5m'：表示5分钟K线<br></p> <p>dividend_type —— 默认参数可省略，数值型（number），指定复权类型，默认为 不复权，'follow'：表示用当前图复权方式，'none'：不复权，'front'：向前复权，'back'：向后复权，'front_ratio'：等比向前复权，'back_ratio'：等比向后复权,（分笔周期返回数据均为不复权）
callback —— 推送行情的回调
返回：一个订阅号，整数型（number），取消订阅方法（函数） <code>ContextInfo.unsubscribe_quote()</code> 需要用到这个订阅号。
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">quote_callback</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">return</span> callback  <span class="token comment"># 这里返回的是 函数名称。是Python 中高阶函数的用法。</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    T <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>subscribe_quote<span class="token punctuation">(</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tick&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>quote_callback<span class="token punctuation">(</span><span class="token string">'600000.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;订阅号为：&quot;</span><span class="token punctuation">,</span>T<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-14-获取当前所有的行情订阅信息contextinfo-get-all-subscription"><a href="#_3-14-获取当前所有的行情订阅信息contextinfo-get-all-subscription" class="header-anchor">#</a> 3.14 获取当前所有的行情订阅信息<br>ContextInfo.get_all_subscription()</h3> <p>功能：如果之前用了多次 <code>ContextInfo.subscribe_quote()</code>方法，订阅了多个品种的行情报价。则可用此方法获取已订阅的品种信息。</p> <p>语法：ContextInfo.get_all_subscription()</p> <p>返回： 一个字典（Dict），其 Key 值为：订阅号；对应的 value 中包括，&quot;func&quot; 表示订阅的函数， &quot;stockcode&quot; 表示订阅的品种代码，  &quot;period&quot; 表示时间周期，&quot;dividendType&quot; 表示除权方式。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">quote_callback</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">return</span> callback  <span class="token comment"># 这里返回的是 函数名称。是Python 中高阶函数的用法。</span>


<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 调用了 2 次 subscribe_quote() ，分别订阅了 600027 和 600000 。</span>
    ContextInfo<span class="token punctuation">.</span>subscribe_quote<span class="token punctuation">(</span><span class="token string">&quot;600027.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tick&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>quote_callback<span class="token punctuation">(</span><span class="token string">&quot;600027.SH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ContextInfo<span class="token punctuation">.</span>subscribe_quote<span class="token punctuation">(</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tick&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
    data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_all_subscription<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
{45:{
     'func': 'subscribe_quote', 
     'stock_code': '600027.SH', 
     'stockCode': '600027.SH', 
     'period': 'tick', 
     'dividend_type': 'none', 
     'dividendType': 'none'
    }, 
 46:{
     'func': 'subscribe_quote', 
     'stock_code': '600000.SH', 
     'stockCode': '600000.SH', 
     'period': 'tick', 
     'dividend_type': 'none', 
     'dividendType': 'none'
    }
}
&quot;&quot;&quot;</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_3-15-订阅全推数据contextinfo-subscribe-whole-quote"><a href="#_3-15-订阅全推数据contextinfo-subscribe-whole-quote" class="header-anchor">#</a> 3.15 订阅全推数据<br>ContextInfo.subscribe_whole_quote()</h3> <p>功能： 订阅全推数据，全推数据只有分笔周期，每次增量推送数据有变化的品种。实际工作中很少用到此方法，不仅产生的负载消耗很大，更因为数据太多，不便提取。更多情况是用 <code>get_full_tick()</code> 方法来获取品种的行情报价数据。</p> <p>语法： ContextInfo.subscribe_whole_quote(code_list,callback=None)</p> <p>参数：</p> <ul><li>code_list：list([str,str,...])
<ul><li>市场代码列表，如['SH','SZ']</li> <li>品种代码列表，如 ['600000.SH', '000001.SZ']</li></ul></li> <li>callback：数据推送回调</li></ul> <p>返回：int，订阅号，可用unsubscribe_quote做反订阅。此方法传递给调用函数的参数是一个 分笔数据 的字典，与 <code>ContextInfo.get_full_tick()</code>的返回值一样。该字典的 key 对应的就是每一个订阅的品种代码，每个 key 对应的 value 还是一个字典（Dict），在该字典中即存放着对应的 品种代码 的最新报价数据。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    T <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>subscribe_whole_quote<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'SH'</span><span class="token punctuation">,</span> <span class="token string">'SZ'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> on_quote<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;订阅号为：&quot;</span><span class="token punctuation">,</span>T<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果
订阅号为： 26
其中 datas 是一个 分笔数据 的字典，其内容大致如下：

{'000170.SH': {
    'time': 1693884793805,             # 最近一次收到报价的时间
    'stime': '20230905113313.805', 
    'lastPrice': 4850.68,              # 最新价
    'amount': 19866300416.0,           # 成交额  今日累积 
    'volume': 12083863,                # 成交量（手）今日累积  
    'pvolume': 1208386304,             # 成交量（股）今日累积  
    'openInt': 13,                     # 持仓量
    'stockStatus': 1,                  # 股票状态 
    'lastSettlementPrice': 0.0,        # 最新结算价（期货用）
    'open': 4863.9,                    # 开盘价 
    'high': 4865.89,                   # 最高价
    'low': 4839.09,                    # 最低价
    'settlementPrice': 0.0,            # 结算价    
    'lastClose': 4883.29,              # 昨收盘价
    'transactionNum': 0, 
    'askPrice': [0.0, 0.0, 0.0, 0.0, 0.0],  # 卖价五档 
    'bidPrice': [0.0, 0.0, 0.0, 0.0, 0.0],  # 买价五档 
    'askVol': [0, 0, 0, 0, 0],              # 卖量五档  
    'bidVol': [0, 0, 0, 0, 0]               # 买量五档
   }, 
 '000867.SH':  {
    'time': 1693884793805, 
    'stime': '20230905113313.805', 
    'lastPrice': 2054.43, 
    'amount': 3677979904.0, 
    'volume': 12047773, 
    'pvolume': 1204777344, 
    'openInt': 13, 
    'stockStatus': 1, 
    'lastSettlementPrice': 0.0, 
    'open': 2070.54, 
    'high': 2071.23, 
    'low': 2051.09, 
    'settlementPrice': 0.0, 
    'lastClose': 2071.52, 
    'transactionNum': 0, 
    'askPrice': [0.0, 0.0, 0.0, 0.0, 0.0], 
    'bidPrice': [0.0, 0.0, 0.0, 0.0, 0.0], 
    'askVol': [0, 0, 0, 0, 0], 
    'bidVol': [0, 0, 0, 0, 0]
   }
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="_3-16-反订阅行情数据contextinfo-unsubscribe-quote"><a href="#_3-16-反订阅行情数据contextinfo-unsubscribe-quote" class="header-anchor">#</a> 3.16 反订阅行情数据<br>ContextInfo.unsubscribe_quote()</h3> <p>功能： 如果之前使用过 <code>ContextInfo.subscribe_quote()</code> 或 <code>ContextInfo.subscribe_whole_quote()</code> 方法来订阅过行情数据，则会自动生成对应的订阅号。此时如果想取消订阅，即可用此方法，传入对应的订阅号即可。</p> <p>语法： ContextInfo.unsubscribe_quote(subId)</p> <p>参数：</p> <ul><li>subId：行情订阅返回的订阅号</li></ul> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    T1 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>subscribe_quote<span class="token punctuation">(</span><span class="token string">&quot;600027.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tick&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
    T2 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>subscribe_quote<span class="token punctuation">(</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tick&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
    T3 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>subscribe_quote<span class="token punctuation">(</span><span class="token string">&quot;000010.SZ&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tick&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
    data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_all_subscription<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;订阅号为：&quot;</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span><span class="token string">&quot;对应的品种为：&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'stock_code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
    ContextInfo<span class="token punctuation">.</span>unsubscribe_quote<span class="token punctuation">(</span>T1<span class="token punctuation">)</span>  <span class="token comment"># 取消订阅 T1 600027.SH</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;========取消订阅后========================&quot;</span><span class="token punctuation">)</span>
    data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_all_subscription<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;订阅号为：&quot;</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span><span class="token string">&quot;对应的品种为：&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'stock_code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
订阅号为： 63 对应的品种为： 600027.SH
订阅号为： 64 对应的品种为： 600000.SH
订阅号为： 65 对应的品种为： 000010.SZ
========取消订阅后========================
订阅号为： 64 对应的品种为： 600000.SH
订阅号为： 65 对应的品种为： 000010.SZ
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>以上4个有关 <code>subscribe</code>订阅行情的方法，是旧版的方法，实际中已几乎弃用。</p></div> <h3 id="_3-17-获取筹码分布-分价-完整档位数据get-chip-distribution"><a href="#_3-17-获取筹码分布-分价-完整档位数据get-chip-distribution" class="header-anchor">#</a> 3.17 获取筹码分布（分价）完整档位数据<br>get_chip_distribution()</h3> <p>功能： 获取筹码分布完整档位数据</p> <p>语法： get_chip_distribution(stock_code, period, time)</p> <p>参数：</p> <ul><li>stock_code——str，合约代码</li> <li>period——str，周期，目前仅支持日线 - '1d'</li> <li>time——str，时间格式为'20201231'或'20201231093000'</li></ul> <p>返回： 一个字典：其中的 key 值为 价格，对应的 value 即为该价格的成交量。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
 price1: volume1, 
 price2: volume2, 
 ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/xuntou_yao/assets/img/xtqmt44.2eb07b58.jpg" alt="筹码峰（分价）图例"></p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>


<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> get_chip_distribution<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'20210730'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果
{1.76: 77057, 1.77: 1036973, 1.78: 4569153, 1.79: 8915689, 1.8: 11812067, 1.81: 12674887, 1.8199999999999998: 15296514, 1.83: 15627174, 1.8399999999999999: 11754403, 1.85: 10958208, 1.8599999999999999: 11655163, 1.87: 11894942, 1.88: 12139527, 1.8900000000000001: 11390879, 1.9: 12490094, 1.9100000000000001: 8650945, 1.92: 9108137, 1.9300000000000002: 8656432, 1.94: 8166178, 1.95: 5054632, 1.96: 5541973, 1.97: 5846457, 1.98: 4916237, 1.99: 4364013, 2.0: 6750606, 2.01: 5593591, 2.02: 5043607, 2.03: 5049569, 2.04: 7002185, 2.05: 9060798, 2.06: 9024885, 2.07: 5687880, 2.08: 4530077, 2.09: 2999774, 2.1: 2683479, 2.11: 2590133, 2.12: 2470753, 2.13: 1977601, 2.14: 2098021, 2.15: 1954859, 2.16: 1763790, 2.17: 1780889, 2.18: 1398368, 2.19: 1416188, 2.2: 1002104, 2.21: 749418, 2.22: 694715, 2.23: 589296, 2.24: 491357, 2.25: 546294, 2.26: 654860, 2.27: 676624, 2.2800000000000002: 618698, 2.29: 524735, 2.3: 376159, 2.31: 258452, 2.32: 206092, 2.33: 206635, 2.34: 246118, 2.35: 278052, 2.36: 481367, 2.37: 739283, 2.38: 878905, 2.39: 852924, 2.4: 735960, 2.41: 658182, 2.42: 586559, 2.43: 593200, 2.44: 555539, 2.45: 500903, 2.46: 445769, 2.4699999999999998: 367416, 2.48: 313680, 2.49: 292696, 2.5: 288422, 2.51: 284148, 2.52: 279874, 2.5300000000000002: 273631, 2.54: 249616, 2.55: 231401, 2.56: 213187, 2.57: 194973, 2.58: 184743, 2.59: 165205, 2.6: 178938, 2.61: 192673, 2.62: 206406, 2.63: 220141, 2.64: 233876, 2.65: 247610, 2.66: 200258, 2.67: 156415, 2.68: 112572, 2.69: 68729, 2.7: 34364, 2.71: 0}
&quot;&quot;&quot;</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>参考下图有助于理解此方法（函数）的功能，右侧即是筹码分布的图形指标，纵轴y为价格，横轴x为交易量。</p> <p><img src="/xuntou_yao/assets/img/xtqmt31.14c95590.png" alt="筹码峰图例"></p> <h3 id="_3-18-获取筹码分布中指定价格所在的比例-get-winner-chips"><a href="#_3-18-获取筹码分布中指定价格所在的比例-get-winner-chips" class="header-anchor">#</a> 3.18 获取筹码分布中指定价格所在的比例 get_winner_chips()</h3> <p>功能： 获取筹码分布中指定价格所在的比例</p> <p>语法： get_winner_chips(stock_code, period, time, price)</p> <p>参数：</p> <ul><li>stock_code——str，合约代码</li> <li>period——str，周期，目前仅支持日线 - '1d'</li> <li>time——str，时间格式为'20201231'或'20201231093000'</li> <li>price——float，指定的价格</li></ul> <p>返回： ratio：float，指定价格所在的比例</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data02 <span class="token operator">=</span> get_winner_chips<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'20230405'</span><span class="token punctuation">,</span> <span class="token number">23.04</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2022年4月5日，品种 000001.SZ ，当天在价格 23.04 元的成交量占当天成交量的比例为：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data02<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果
2022年4月5日，品种 000001.SZ ，当天在价格 23.04 元的成交量占当天成交量的比例为：0.9859408926072876

&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-19-获取筹码分布中指定比例所在的价格档位get-chips-price"><a href="#_3-19-获取筹码分布中指定比例所在的价格档位get-chips-price" class="header-anchor">#</a> 3.19 获取筹码分布中指定比例所在的价格档位<br>get_chips_price&quot;()</h3> <p>功能： 获取筹码分布中指定比例所在的价格档位</p> <p>语法： get_chips_price(stock_code, period, time, ratio)</p> <p>参数：</p> <ul><li>stock_code：str，合约代码</li> <li>period：str，周期，目前仅支持日线 - '1d'</li> <li>time：str，时间格式为'20201231'或'20201231093000'</li> <li>ratio：float，指定的比例</li></ul> <p>返回： price：float，指定比例所在的价格档位</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data02 <span class="token operator">=</span> get_chips_price<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'20220405'</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2022年4月5日，品种 000001.SZ ，当天成交量占 0.8 的价位为：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data02<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
2022年4月5日，品种 000001.SZ ，当天成交量占 0.8 的价位为：
19.87
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>关于筹码分布的这3个方法（函数），其数值与其它软件中的 筹码峰 因计算方式不同，因此结果并不一致。</p></div> <h3 id="品种相关-2"><a href="#品种相关-2" class="header-anchor">#</a> =====品种相关=====</h3> <h3 id="_3-20-根据代码获取合约详细信息-contextinfo-get-instrumentdetail"><a href="#_3-20-根据代码获取合约详细信息-contextinfo-get-instrumentdetail" class="header-anchor">#</a> 3.20 根据代码获取合约详细信息 <br>ContextInfo.get_instrumentdetail()</h3> <p>功能： 获取指定代码品种的合约详细信息</p> <p>语法： ContextInfo.get_instrumentdetail(stockcode)</p> <p>参数：</p> <ul><li>stockcode：string，比如：某支股票代码 '600000.SH'</li></ul> <p>返回： 根据stockcode返回一个字典（dict），其中包含的数据详见示例中的注释。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_instrumentdetail<span class="token punctuation">(</span><span class="token string">'600000.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
{
 'ExchangeID': 'SH',                # 交易所 ID
 'InstrumentID': '600000',          # 品种代码
 'InstrumentName': '浦发银行',       # 品种名称
 'ProductID': None,                 # 产品 ID （期货品种）
 'ProductName': None,               # 产品名称 （期货品种）
 'CreateDate': 19991110,            # 创建日期 （期货品种）
 'OpenDate': 19991110,              # 上市日期
 'ExpireDate': 20991231,            # 过期日期
 'PreClose': 7.04,                  # 前收盘价
 'SettlementPrice': 0.0,            # 前结算价（期货品种）
 'UpStopPrice': 7.74,               # 当日涨停价
 'DownStopPrice': 6.34,             # 当日跌停价
 'FloatVolumn': 29352170000.0,      # 流通股本
 'TotalVolumn': 29352170000.0,      # 总股本
 'LongMarginRatio': None,           # 多头保证金（期货品种）
 'ShortMarginRatio': None,          # 空头保证金（期货品种）
 'PriceTick': 0.01,                 # 报价最小跳动单位
 'VolumeMultiple': 1,               # 合约单位（1手）
 'MainContract': None,              # 主力合约标记（期货品种）
 'LastVolume': 0,                   # 昨日持仓量
 'InstrumentStatus': 0,             # 品种状态： 0 表示未停牌；n 表示已停牌n天, -1表示当天复牌
 'IsTrading': True,                 # 是否可交易 True 表示可交易；False 表示不可交易
 'IsRecent': None,                  # 是否近月合约（期货品种用）
 'HSGTFlag': 0                      # 标的标记： 0: 非标的, 1: 沪港通标的, 2: 沪港通历史标的, 3: 深港通标的, 4:深港通历史标的, 5: 沪深港通标的, 6: 沪港通标的 深港通历史标的, 7: 沪港通历史标的 深港通标的, 8: 沪深港通历史标的
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>如想了解某一个品种的详细合约信息，用此方法足矣。字典中包含的数据已十分详细。</p> <h3 id="_3-21-获取最新流通股本contextinfo-get-last-volume"><a href="#_3-21-获取最新流通股本contextinfo-get-last-volume" class="header-anchor">#</a> 3.21 获取最新流通股本<br>ContextInfo.get_last_volume()</h3> <p>功能： 获取最新流通股本。理论上与 方法   <code>ContextInfo.get_instrumentdetail()</code> 返回的字典中的键 'FloatVolumn'对应的值是一致的。</p> <p>语法：ContextInfo.get_last_volume(stockcode)</p> <p>参数： string：必须是 'stock.market' 形式</p> <p>返回： 整数型（int）</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    d <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_instrumentdetail<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n品种 000002.SZ 的流通股本（取字典中的KEY值 ）为：&quot;</span><span class="token punctuation">,</span>d<span class="token punctuation">[</span><span class="token string">'FloatVolumn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n品种 000002.SZ 的流通股本（用方法获取）为：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_last_volume<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
品种 000002.SZ 的流通股本（取字典中的KEY值 ）为： 9716660000.0
品种 000002.SZ 的流通股本（用方法获取）为： 9716660000
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-22-获取总股数-本-contextinfo-get-total-share"><a href="#_3-22-获取总股数-本-contextinfo-get-total-share" class="header-anchor">#</a> 3.22 获取总股数（本）<br>ContextInfo.get_total_share()</h3> <p>功能： 获取总股本。理论上与 方法   <code>ContextInfo.get_instrumentdetail()</code> 返回的字典中的键 'TotalVolumn'对应的值是一致的。</p> <p>语法： ContextInfo.get_total_share(stockcode)</p> <p>参数： stockcode：string，股票代码，如：'600000.SH'，默认为当前主图品种代码</p> <p>返回： 整数型（int）</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    d <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_instrumentdetail<span class="token punctuation">(</span><span class="token string">'600089.SH'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n品种 600089.SH 的总股本（取字典中的KEY值 ）为：&quot;</span><span class="token punctuation">,</span>d<span class="token punctuation">[</span><span class="token string">'TotalVolumn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n品种 600089.SH 的总股本（用方法获取）为：&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_total_share<span class="token punctuation">(</span><span class="token string">'600089.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
品种 600089.SH 的总股本（取字典中的KEY值 ）为： 5052790000.0

品种 600089.SH 的总股本（用方法获取）为： 5052790000
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="/xuntou_yao/assets/img/xtqmt45.d4ec8038.png" alt="取总股本数据"></p> <h3 id="_3-23-获取换手率contextinfo-get-turnover-rate"><a href="#_3-23-获取换手率contextinfo-get-turnover-rate" class="header-anchor">#</a> 3.23 获取换手率<br>ContextInfo.get_turnover_rate()</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>使用之前需要下载相关数据。如果未下载，将自动使用最新流通股本来计算历史换手率，结果可能不正确。</p> <p>具体操作如下：</p> <p>1 点击菜单栏中的“操作”--&gt;“数据管理”，在弹出的 数据管理 窗口中， 点击 数据选项 框右侧的 2 下三角，显示下拦菜单，选中其中相应的数据，然后在右侧选择 数据范围，确定时间段，建议最近1周或最近1月即可，最后点击窗口右下方的 “开始”按钮。</p></div> <p><img src="/xuntou_yao/assets/img/xtqmt33.c2a318c0.png" alt="取换手率数据"></p> <p>功能： 获取换手率</p> <p>语法： ContextInfo.get_turnover_rate(stock_list,startTime,endTime)</p> <p>参数：</p> <ul><li>stock_list —— 股票列表，list,如['600000.SH','000001.SZ']</li> <li>startTime —— 起始时间，如'20170101'</li> <li>endTime —— 结束时间，如'20180101'</li></ul> <p>返回： Pandas 的数据帧 dataframe</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span> ContextInfo<span class="token punctuation">.</span>get_turnover_rate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'000002.SZ'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'20200901'</span><span class="token punctuation">,</span><span class="token string">'20200905'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
           000002.SZ
20200901   0.010809
20200904   0.010958
如果未提前下载好，则可能返回空数据，或不准确的数据。
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-24-根据代码获取对应股票的内盘-外盘成交量contextinfo-get-svol-contextinfo-get-bvol"><a href="#_3-24-根据代码获取对应股票的内盘-外盘成交量contextinfo-get-svol-contextinfo-get-bvol" class="header-anchor">#</a> 3.24 根据代码获取对应股票的内盘/外盘成交量<br>ContextInfo.get_svol()<br>ContextInfo.get_bvol()</h3> <p>功能： 获取指定品种代码对应股票的内盘/外盘成交量。</p> <p>语法：<br>ContextInfo.get_svol(stockcode)<br>ContextInfo.get_bvol(stockcode)</p> <p>参数： stockcode —— 股票代码，如 '000001.SZ'，默认为当前图品种代码</p> <p>返回： int 整数型</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股票品种 000001.SZ 的内盘成交量为：\n&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_svol<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股票品种 000001.SZ 的外盘成交量为：\n&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_bvol<span class="token punctuation">(</span><span class="token string">'000001.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
股票品种 000001.SZ 的内盘成交量为：
 0
股票品种 000001.SZ 的外盘成交量为： 0
&quot;&quot;&quot;</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-25-获取行业成份股contextinfo-get-industry"><a href="#_3-25-获取行业成份股contextinfo-get-industry" class="header-anchor">#</a> 3.25 获取行业成份股<br>ContextInfo.get_industry()</h3> <p>功能： 类似 <code>ContextInfo.get_stock_list_in_sector()</code>方法。用来获取行业成份股的品种。</p> <p>语法： ContextInfo.get_industry(industry)</p> <p>参数： string：如 'CSRC1矿业'</p> <p>返回： list：内含成份股代码，里面股票代码为 '000002.SZ' 形式</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;CSRC1采矿业 中包含哪些股票：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_industry<span class="token punctuation">(</span><span class="token string">'CSRC1采矿业'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
['600028.SH', '600121.SH', '600123.SH', '600188.SH', '600256.SH', '600259.SH', '600338.SH', '600339.SH', '600348.SH', '600395.SH', '600397.SH', '600403.SH', '600489.SH', '600497.SH', '600508.SH', '600547.SH', '600583.SH', '600711.SH', '600758.SH', '600759.SH', '600777.SH', '600871.SH', '600925.SH', '600938.SH', '600968.SH', '600971.SH', '600985.SH', '600988.SH', '601001.SH', '601020.SH', '601069.SH', '601088.SH', '601101.SH', '601121.SH', '601168.SH', '601225.SH', '601666.SH', '601699.SH', '601808.SH', '601857.SH', '601898.SH', '601899.SH', '601918.SH', '601958.SH', '601969.SH', '603132.SH', '603505.SH', '603619.SH', '603727.SH', '603979.SH', '603993.SH', '605086.SH', '000426.SZ', '000506.SZ', '000552.SZ', '000603.SZ', '000655.SZ', '000688.SZ', '000758.SZ', '000762.SZ', '000923.SZ', '000937.SZ', '000968.SZ', '000975.SZ', '000983.SZ', '001203.SZ', '001337.SZ', '002128.SZ', '002155.SZ', '002192.SZ', '002207.SZ', '002554.SZ', '002629.SZ', '002683.SZ', '002828.SZ', '002978.SZ', '300084.SZ', '300157.SZ', '300164.SZ', '300191.SZ', '300483.SZ']
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-26-获取指数成份股contextinfo-get-sector"><a href="#_3-26-获取指数成份股contextinfo-get-sector" class="header-anchor">#</a> 3.26 获取指数成份股<br>ContextInfo.get_sector()</h3> <p>功能： 类似 <code>ContextInfo.get_stock_list_in_sector()</code>方法。获取板块成份股，只支持取指数中的成份股品种。</p> <p>语法： ContextInfo.get_sector(sector, realtime)</p> <p>参数：</p> <ul><li>string：必须是 ‘stock.market’ 形式，如 ‘000300.SH’ ，可取如沪深300（000300.SH）、中证500（000905.SH）、上证50（000016.SH）等指数的历史成份股</li> <li>realtime：毫秒级时间戳，如不填则默认取目前最新成份股</li></ul> <p>返回： list：内含成份股代码，里面股票代码为 ‘000002.SZ’ 形式</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;指数 上证50（000016.SH） 中包含哪些股票：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_sector<span class="token punctuation">(</span><span class="token string">'000016.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token triple-quoted-string string">&quot;&quot;&quot;
执行结果
指数 上证50（000016.SH） 中包含哪些股票：
['600010.SH', '600028.SH', '600030.SH', '600031.SH', '600036.SH', '600048.SH', '600050.SH', '600089.SH', '600104.SH', '600111.SH', '600196.SH', '600276.SH', '600309.SH', '600406.SH', '600436.SH', '600438.SH', '600519.SH', '600690.SH', '600745.SH', '600809.SH', '600887.SH', '600893.SH', '600900.SH', '600905.SH', '601012.SH', '601066.SH', '601088.SH', '601166.SH', '601225.SH', '601288.SH', '601318.SH', '601390.SH', '601398.SH', '601628.SH', '601633.SH', '601668.SH', '601669.SH', '601728.SH', '601857.SH', '601888.SH', '601899.SH', '601919.SH', '603259.SH', '603260.SH', '603288.SH', '603501.SH', '603799.SH', '603986.SH', '688111.SH', '688599.SH']
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-27-获取某只股票在某指数中的绝对权重contextinfo-get-weight-in-index"><a href="#_3-27-获取某只股票在某指数中的绝对权重contextinfo-get-weight-in-index" class="header-anchor">#</a> 3.27 获取某只股票在某指数中的绝对权重<br>ContextInfo.get_weight_in_index()</h3> <p>语法： ContextInfo.get_weight_in_index(indexcode, stockcode)</p> <p>功能： 获取某只股票在某指数中的绝对权重</p> <p>参数：</p> <ul><li>indexcode：string，指数代码，形式如 'stockcode.market'，如 '000300.SH'</li> <li>stockcode：string，股票代码，形式如 'stockcode.market'，如 '600004.SH'</li></ul> <p>返回： number：返回的数值单位是 %，如 1.6134 表示权重是 1.6134%</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n股票 000002.SZ 在指数 沪深300 （000300）中所占的权重为：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_weight_in_index<span class="token punctuation">(</span><span class="token string">'000300.SH'</span><span class="token punctuation">,</span> <span class="token string">'000002.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">' %'</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
股票 000002.SZ 在指数 沪深300 （000300）中所占的权重为：0.501  %
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-28-获取财务数据contextinfo-get-financial-data"><a href="#_3-28-获取财务数据contextinfo-get-financial-data" class="header-anchor">#</a> 3.28 获取财务数据<br>ContextInfo.get_financial_data()</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>a .需要提前下载 “财务数据”。</p> <p>b. 此方法（函数）是一个 重载函数，即拥有2套参数列表。传入不同的参数，返回的结果也不一样。</p> <p>c. 必须提前导入 Pandas 模块</p></div> <p>功能：此方法用于获取财务数据，与界面中按 F10 键功能对应。
语法一：
ContextInfo.get_financial_data(fieldList,stockList,startDate,endDate,report_type='announce_time')
语法二：
ContextInfo.get_financial_data(tabname,colname,market,code,report_type='report_time',barpos)
参数：
fieldList —— 字段列表。对应 财务分析 中的报表；</p> <table><thead><tr><th><strong>报表名称</strong></th> <th><strong>内置字符串</strong></th> <th><strong>原生字符串</strong></th></tr></thead> <tbody><tr><td>资产负债表</td> <td>ASHAREBALANCESHEET</td> <td>Balance</td></tr> <tr><td>利润表</td> <td>ASHAREINCOME</td> <td>Income</td></tr> <tr><td>现金流表</td> <td>ASHARECASHFLOW</td> <td>CashFlow</td></tr> <tr><td>股本表</td> <td>CAPITALSTRUCTURE</td> <td>Capital</td></tr> <tr><td>主要指标</td> <td>PERSHAREINDEX</td> <td>PershareIndex</td></tr> <tr><td>十大股东/十大流通股东</td> <td>TOP10HOLDER/TOP10FLOWHOLDER</td> <td>Top10holder/Top10flowholder</td></tr> <tr><td>股东数</td> <td>SHAREHOLDER</td> <td>Holdernum</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>以上表格中分别包括不同的字段，需配合下面的参数来获取具体的值。</p></div> <p>stockList —— 列表（List），想要查询的股票代码列表。如：['600000.SH', '000001.SZ']
StartDate,endDate —— 查询时间段的开始时间和结束时间，格式如：“20220301”。
report_type —— 报表时间类型。此参数可省缺 ，默认按公告期区分数据。'report_time' 表示按报告时间，' announce_time' 表示按公告时间</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>'report_time' 和 ' announce_time' 的区别：
若某公司当年 4 月 26 日发布上年度年报，如果选择按照公告期取数，则当年 4 月 26 日之后至下个财报发布日期之间的数据都是上年度年报的财务数据。
若选择按照报告期取数，则上年度第 4 季度（上年度 10 月 1 日 - 12 月 31 日）的数据就是上年度报告期的数据。</p></div> <p>返回：根据参数不同，返回的结果也不同。有可能是一个 Pandas 的数据帧，也可能是一个数值。具体详情请参考官方文档中的 “财务数据接口”章节。
“https://dict.thinktrader.net/dictionary/stock.html?id=PN4WZC#%E8%B4%A2%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%88%97%E8%A1%A8”</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ASHAREBALANCESHEET.tot_liab'</span><span class="token punctuation">]</span>   
    stockList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;000001.SZ&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    startDate <span class="token operator">=</span> <span class="token string">'20220920'</span>
    endDate <span class="token operator">=</span> <span class="token string">'20220930'</span>
    data <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_financial_data<span class="token punctuation">(</span>fieldList<span class="token punctuation">,</span> stockList<span class="token punctuation">,</span> startDate<span class="token punctuation">,</span> endDate<span class="token punctuation">,</span> report_type <span class="token operator">=</span> <span class="token string">'report_time'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot; 600000.SH 浦发银行 2022年9月底公布的 资产负债表中，负债合计是：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token string">'20220930'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot; 0000001.SZ 平安银行 2022年9月底公布的 资产负债表中，负债合计是：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&quot;000001.SZ&quot;</span><span class="token punctuation">,</span><span class="token string">'20220930'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果：
600000.SH 浦发银行 2022年9月底公布的 资产负债表中，负债合计是：
tot_liab    8.685534e+12
Name: 20220930, dtype: float64

 0000001.SZ 平安银行 2022年9月底公布的 资产负债表中，负债合计是：
tot_liab    5.255519e+12Name: 20220930, dtype: float64
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>其实直接中文汉字也是可以的，如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'资产负债表.负债合计'</span><span class="token punctuation">]</span>   
    stockList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;000001.SZ&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    startDate <span class="token operator">=</span> <span class="token string">'20220920'</span>
    endDate <span class="token operator">=</span> <span class="token string">'20220930'</span>
    data <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_financial_data<span class="token punctuation">(</span>fieldList<span class="token punctuation">,</span> stockList<span class="token punctuation">,</span> startDate<span class="token punctuation">,</span> endDate<span class="token punctuation">,</span> report_type <span class="token operator">=</span> <span class="token string">'report_time'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot; 600000.SH 浦发银行 2022年9月底公布的 资产负债表中，负债合计是：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token string">'20220930'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot; 0000001.SZ 平安银行 2022年9月底公布的 资产负债表中，负债合计是：&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&quot;000001.SZ&quot;</span><span class="token punctuation">,</span><span class="token string">'20220930'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
600000.SH 浦发银行 2022年9月底公布的 资产负债表中，负债合计是：
负债合计    8.685534e+12
Name: 20220930, dtype: float64
 0000001.SZ 平安银行 2022年9月底公布的 资产负债表中，负债合计是：
负债合计    5.255519e+12Name: 20220930, dtype: float64
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-29-获取原始财务数据contextinfo-get-raw-financial-data"><a href="#_3-29-获取原始财务数据contextinfo-get-raw-financial-data" class="header-anchor">#</a> 3.29 获取原始财务数据<br>ContextInfo.get_raw_financial_data()</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>此方法与 与get_financial_data的区别是，不填充每个交易日的数据</p></div> <p>功能：此方法用于获取财务数据，与界面中按 F10 键功能对应。
语法一：
ContextInfo.get_raw_financial_data(fieldList,stockList,startDate,endDate,report_type='announce_time')
参数：
fieldList —— 字段列表。对应 财务分析 中的报表与 get_financial_data() 相同；
stockList —— 列表（List），想要查询的股票代码列表。如：['600000.SH', '000001.SZ']
StartDate,endDate —— 查询时间段的开始时间和结束时间，格式如：“20220301”。
report_type —— 报表时间类型。此参数可省缺 ，默认按公告期区分数据。'report_time' 表示按报告时间，' announce_time' 表示按公告时间</p> <p>示例：</p> <div class="language-Python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'资产负债表.负债合计'</span><span class="token punctuation">]</span>   
    stockList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;000001.SZ&quot;</span><span class="token punctuation">]</span>
    startDate <span class="token operator">=</span> <span class="token string">'20240920'</span>
    endDate <span class="token operator">=</span> <span class="token string">'20240930'</span>
    df<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_raw_financial_data<span class="token punctuation">(</span>fieldList<span class="token punctuation">,</span>stockList<span class="token punctuation">,</span>startDate<span class="token punctuation">,</span>endDate<span class="token punctuation">,</span>report_type <span class="token operator">=</span> <span class="token string">'report_time'</span><span class="token punctuation">)</span> <span class="token comment"># 获取原始财务数据</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果：
 {'000001.SZ': {'资产负债表.负债合计': {1727625600000: 5255519010816.0}}}
其中 1727625600000 是时间戳
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_3-30-获取指定个股-合约-指数的-k-线-交易日-列表-contextinfo-get-trading-dates"><a href="#_3-30-获取指定个股-合约-指数的-k-线-交易日-列表-contextinfo-get-trading-dates" class="header-anchor">#</a> 3.30 获取指定个股 / 合约 / 指数的 K 线（交易日）列表<br> ContextInfo.get_trading_dates()</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>此方法在 <code>init()</code>  中是无效的，可在 <code>after_init()</code> 中使用。当然也可以在 <code>handlebar()</code> 中使用。但基本没什么用。</p></div> <p>功能： 指定某个个股 / 合约 / 指数的 K 线（交易日）列表。</p> <p>语法： ContextInfo.get_trading_dates(stockcode, start_date, end_date, count, period)</p> <p>参数：</p> <ul><li>stockcode —— string，某一支股票的代码如 '600000.SH'，默认为当前图代码。</li> <li>start_date —— string，开始时间，为空时不使用，如 '20170101'，'20170101000000'</li> <li>end_date —— string，结束时间，默认为当前bar的时间，如 '20170102'，'20170102000000'</li> <li>count —— int，K 线个数，必须大于 0，取包括 end_date 往前的 count 个 K 线，start_date 不为空时不使用</li> <li>period —— string，时间周期。如：'1d'：日线、'1m'：1分钟线、'1h'：小时线</li></ul> <p>返回： 一个列表List，其中包括 交易日，period为日线时返回 ['20170101', '20170102', ...]，其它返回['20170101010000', '20170102020000', ...]。有数据表示对应的时间上有K线数据</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_trading_dates<span class="token punctuation">(</span><span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span> <span class="token string">'20170401'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-31-获取龙虎榜数据contextinfo-get-longhubang"><a href="#_3-31-获取龙虎榜数据contextinfo-get-longhubang" class="header-anchor">#</a> 3.31 获取龙虎榜数据<br>ContextInfo.get_longhubang()</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>使用前需要提前下载 “龙虎榜数据”</p></div> <p>功能： 获取龙虎榜数据。</p> <p>语法：ContextInfo.get_longhubang(stock_list, startTime, endTime)</p> <p>参数：</p> <p>stock_list——股票列表，list，如 ['600000.SH', '600036.SH']</p> <p>startTime——起始时间，如 '20170101'</p> <p>endTime——结束时间，如 '20180101'</p> <p>返回： Pandas 数据帧 Dataframe，其中包含的信息请见示例：</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_longhubang<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'600027.SH'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'20190101'</span><span class="token punctuation">,</span><span class="token string">'20230910'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
stockCode stockName                 date                                  reason close SpreadRate TurnoverVolume Turnover_Amount                                     buyTraderBooth                                    sellTraderBooth
0  600027.SH      华电国际  2021-09-23 00:00:00  非ST、*ST和S证券连续三个交易日内收盘价格涨幅偏离值累计达到20%的证券  5.44       8.15     76530.1299     388755.6709    traderName     buyAmount buyPercent sellAmou...                    traderName buyAmount buyPerc...
1  600027.SH      华电国际  2021-10-20 00:00:00              有价格涨跌幅限制的日收盘价格涨幅偏离值达到7%的证券  4.48      10.07     11636.7716      50368.3519                      traderName    buyAmount bu...               traderName buyAmount buyPercent  ...
2  600027.SH      华电国际  2021-10-27 00:00:00                  有价格涨跌幅限制的日价格振幅达到15%的证券  4.68       8.84     27722.0452     125135.0469            traderName    buyAmount buyPercent s...                   traderName buyAmount buyPerce...
3  600027.SH      华电国际  2021-12-07 00:00:00  非ST、*ST和S证券连续三个交易日内收盘价格涨幅偏离值累计达到20%的证券  4.67       7.85     73638.2808     314165.6832                 traderName     buyAmount buyPer...               traderName buyAmount buyPercent  ...
4  600027.SH      华电国际  2022-02-25 00:00:00              有价格涨跌幅限制的日收盘价格涨幅偏离值达到7%的证券  4.35      10.13     15628.7642      65477.1779                 traderName    buyAmount buyPerc...               traderName buyAmount buyPercent  ...
5  600027.SH      华电国际  2022-09-07 00:00:00  非ST、*ST和S证券连续三个交易日内收盘价格涨幅偏离值累计达到20%的证券  6.94       9.98     40982.4477     256002.9234    traderName     buyAmount buyPercent sellAmou...    traderName buyAmount buyPercent    sellAmoun...
6  600027.SH      华电国际  2022-10-11 00:00:00              有价格涨跌幅限制的日收盘价格涨幅偏离值达到7%的证券  6.47      10.03      7713.4191      48472.8911                  traderName    buyAmount buyPer...                  traderName buyAmount buyPercen...
7  600027.SH      华电国际  2022-11-29 00:00:00              有价格涨跌幅限制的日收盘价格跌幅偏离值达到7%的证券  5.94      -6.01     12295.4677      74357.9426    traderName   buyAmount buyPercent sellAmount...    traderName buyAmount buyPercent    sellAmoun...
8  600027.SH      华电国际  2023-01-03 00:00:00              有价格涨跌幅限制的日收盘价格涨幅偏离值达到7%的证券  6.47      10.03     14498.3965      90578.7301                traderName     buyAmount buyPerc...            traderName buyAmount buyPercent   se...9  600027.SH      华电国际  2023-05-29 00:00:00              有价格涨跌幅限制的日收盘价格涨幅偏离值达到7%的证券  7.12      10.05     19955.4837     137691.0019            traderName     buyAmount buyPercent ...                   traderName buyAmount buyPerce...
&quot;&quot;&quot;</span>    
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>其中字段的表达意义如下：</p> <table><thead><tr><th>字段名称</th> <th>说明</th></tr></thead> <tbody><tr><td>reason</td> <td>上榜原因</td></tr> <tr><td>close</td> <td>收盘价</td></tr> <tr><td>spreadRate</td> <td>涨跌幅</td></tr> <tr><td>TurnoverVolune</td> <td>成交量</td></tr> <tr><td>Turnover_Amount</td> <td>成交金额</td></tr> <tr><td>buyTraderBooth</td> <td>买方席位,datframe</td></tr> <tr><td>sellTraderBooth</td> <td>卖方席位,datframe</td></tr></tbody></table> <p>buyTraderBooth 或 sellTraderBooth 包含字段：</p> <table><thead><tr><th>字段名称</th> <th>说明</th></tr></thead> <tbody><tr><td>traderName</td> <td>交易营业部名称</td></tr> <tr><td>buyAmount</td> <td>买入金额</td></tr> <tr><td>buyPercent</td> <td>买入金额占总成交占比</td></tr> <tr><td>sellAmount</td> <td>卖出金额</td></tr> <tr><td>sellPercent</td> <td>卖出金额占总成交占比</td></tr> <tr><td>totalAmount</td> <td>该席位总成交金额</td></tr> <tr><td>rank</td> <td>席位排行</td></tr> <tr><td>direction</td> <td>买卖方向</td></tr></tbody></table> <p><img src="/xuntou_yao/assets/img/xtqmt35.60f4b7f8.png" alt=""></p> <h3 id="_3-32-获取十大股东数据contextinfo-get-top10-share-holder"><a href="#_3-32-获取十大股东数据contextinfo-get-top10-share-holder" class="header-anchor">#</a> 3.32 获取十大股东数据<br>ContextInfo.get_top10_share_holder()</h3> <p>功能： 获取十大股东数据。</p> <p>语法： get_top10_share_holder(self, stock_list, data_name, start_time, end_time)</p> <p>参数：</p> <ul><li>data_name —— flow_holder 或 holder</li> <li>stock_list —— 股票列表，list，如['600000.SH', '600036.SH']</li> <li>startTime —— 起始时间，如 '20170101'</li> <li>endTime —— 结束时间，如 '20180101'</li></ul> <p>返回：Pandas 数据类型</p> <p>示例：</p> <div class="language-Python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_top10_share_holder<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'600027.SZ'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'flow_holder'</span><span class="token punctuation">,</span> <span class="token string">'20230101'</span><span class="token punctuation">,</span> <span class="token string">'20230101'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span>df<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><table><thead><tr><th>字段名称</th> <th>说明</th></tr></thead> <tbody><tr><td>holdName</td> <td>股东名称</td></tr> <tr><td>holderType</td> <td>持股类型</td></tr> <tr><td>holdNum</td> <td>持股数量</td></tr> <tr><td>changReason</td> <td>变动原因</td></tr> <tr><td>holdRatio</td> <td>持股比例</td></tr> <tr><td>stockType</td> <td>股份性质</td></tr> <tr><td>rank</td> <td>持股排名</td></tr> <tr><td>status</td> <td>持股状态</td></tr> <tr><td>changNum</td> <td>增减数量</td></tr> <tr><td>changeRatio</td> <td>增减比例</td></tr></tbody></table> <h3 id="_3-33-获取股东数数据contextinfo-get-holder-num"><a href="#_3-33-获取股东数数据contextinfo-get-holder-num" class="header-anchor">#</a> 3.33 获取股东数数据<br>ContextInfo.get_holder_num()</h3> <p>功能： 获取股东数数据。</p> <p>语法： ContextInfo.get_holder_num(stock_list,start_time,end_time)</p> <p>参数：</p> <ul><li>stock_list —— 股票列表,list,如['600000.SH','600036.SH']</li> <li>startTime —— 起始时间,如'20170101'</li> <li>endTime —— 结束时间,如'20180101'</li></ul> <p>返回： pd.DataFrame，字段如下</p> <table><thead><tr><th>字段名称</th> <th>说明</th></tr></thead> <tbody><tr><td>stockCode</td> <td>产品代码</td></tr> <tr><td>timetag</td> <td>日期</td></tr> <tr><td>holdNum</td> <td>股东总数</td></tr> <tr><td>AHoldNum</td> <td>A股股东户数</td></tr> <tr><td>BHoldNum</td> <td>B股股东户数</td></tr> <tr><td>HHoldNum</td> <td>H股股东户数</td></tr> <tr><td>uncirculatedHoldNum</td> <td>已流通股东户数</td></tr> <tr><td>circulatedHoldNum</td> <td>未流通股东户数</td></tr></tbody></table> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span>  ContextInfo<span class="token punctuation">.</span>get_holder_num<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'000002.SZ'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'20100101'</span><span class="token punctuation">,</span><span class="token string">'20180101'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span>df<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="用于期货市场"><a href="#用于期货市场" class="header-anchor">#</a> =====用于期货市场=====</h3> <p>在迅投QMT中，国内各期货市场的简称代码，参照表如下：</p> <table><thead><tr><th>市场</th> <th>市场代码</th> <th>迅投市场代码</th></tr></thead> <tbody><tr><td>上期所</td> <td>SHFE</td> <td>SF</td></tr> <tr><td>大商所</td> <td>DCE</td> <td>DF</td></tr> <tr><td>郑商所</td> <td>CZCE</td> <td>ZF</td></tr> <tr><td>中金所</td> <td>CFFEX</td> <td>IF</td></tr> <tr><td>能源中心</td> <td>INE</td> <td>INE</td></tr> <tr><td>广期所</td> <td>GFEX</td> <td>GF</td></tr></tbody></table> <p><font size="5">中金所</font></p> <table><thead><tr><th>名称</th> <th>主力连续代码</th> <th>加权合约代码</th> <th>开始时间</th> <th>退市时间</th> <th>备注</th></tr></thead> <tbody><tr><td>沪深 300 合约</td> <td>IF00.IF</td> <td>IFJQ00.IF</td> <td>2010-04-16</td> <td></td> <td></td></tr> <tr><td>5 年期国债合约</td> <td>TF00.IF</td> <td>TFJQ00.IF</td> <td>2013-09-06</td> <td></td> <td></td></tr> <tr><td>10 年期国债合约</td> <td>T00.IF</td> <td>TJQ00.IF</td> <td>2015-03-20</td> <td></td> <td></td></tr> <tr><td>中证 500 合约</td> <td>IC00.IF</td> <td>ICJQ00.IF</td> <td>2015-04-16</td> <td></td> <td></td></tr> <tr><td>上证 50 合约</td> <td>IH00.IF</td> <td>IHJQ00.IF</td> <td>2015-04-16</td> <td></td> <td></td></tr> <tr><td>2 年期国债合约</td> <td>TS00.IF</td> <td>TSJQ00.IF</td> <td>2018-08-17</td> <td></td> <td></td></tr> <tr><td>中证 1000 合约</td> <td>IM00.IF</td> <td>IMJQ00.IF</td> <td>2022-07-22</td> <td></td> <td></td></tr> <tr><td>30 年期国债合约</td> <td>TL00.IF</td> <td>TLJQ00.IF</td> <td>2023-04-21</td> <td></td> <td></td></tr></tbody></table> <p><font size="5">大商所</font></p> <table><thead><tr><th>名称</th> <th>主力连续代码</th> <th>加权合约代码</th> <th>开始时间</th> <th>退市时间</th> <th>备注</th></tr></thead> <tbody><tr><td>豆一合约</td> <td>a00.DF</td> <td>aJQ00.DF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>豆二合约</td> <td>b00.DF</td> <td>bJQ00.DF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>豆粕合约</td> <td>m00.DF</td> <td>mJQ00.DF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>玉米合约</td> <td>c00.DF</td> <td>cJQ00.DF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>豆油合约</td> <td>y00.DF</td> <td>yJQ00.DF</td> <td>2006-01-09</td> <td></td> <td></td></tr> <tr><td>聚乙烯合约</td> <td>l00.DF</td> <td>lJQ00.DF</td> <td>2007-07-31</td> <td></td> <td></td></tr> <tr><td>棕榈油合约</td> <td>p00.DF</td> <td>pJQ00.DF</td> <td>2007-10-29</td> <td></td> <td></td></tr> <tr><td>聚氯乙烯合约</td> <td>v00.DF</td> <td>vJQ00.DF</td> <td>2009-05-25</td> <td></td> <td></td></tr> <tr><td>焦炭合约</td> <td>j00.DF</td> <td>jJQ00.DF</td> <td>2011-04-15</td> <td></td> <td></td></tr> <tr><td>焦煤合约</td> <td>jm00.DF</td> <td>jmJQ00.DF</td> <td>2013-03-22</td> <td></td> <td></td></tr> <tr><td>铁矿石合约</td> <td>i00.DF</td> <td>iJQ00.DF</td> <td>2013-10-18</td> <td></td> <td></td></tr> <tr><td>鸡蛋合约</td> <td>jd00.DF</td> <td>jdJQ00.DF</td> <td>2013-11-08</td> <td></td> <td></td></tr> <tr><td>胶合板合约</td> <td>bb00.DF</td> <td>bbJQ00.DF</td> <td>2013-12-06</td> <td></td> <td></td></tr> <tr><td>纤维板合约</td> <td>fb00.DF</td> <td>fbJQ00.DF</td> <td>2013-12-06</td> <td></td> <td></td></tr> <tr><td>聚丙烯合约</td> <td>pp00.DF</td> <td>ppJQ00.DF</td> <td>2014-02-28</td> <td></td> <td></td></tr> <tr><td>玉米淀粉合约</td> <td>cs00.DF</td> <td>csJQ00.DF</td> <td>2014-12-19</td> <td></td> <td></td></tr> <tr><td>乙二醇合约</td> <td>eg00.DF</td> <td>egJQ00.DF</td> <td>2018-12-10</td> <td></td> <td></td></tr> <tr><td>粳米合约</td> <td>rr00.DF</td> <td>rrJQ00.DF</td> <td>2019-08-16</td> <td></td> <td></td></tr> <tr><td>苯乙烯合约</td> <td>eb00.DF</td> <td>ebJQ00.DF</td> <td>2019-09-26</td> <td></td> <td></td></tr> <tr><td>液化石油气合约</td> <td>pg00.DF</td> <td>pgJQ00.DF</td> <td>2020-03-30</td> <td></td> <td></td></tr> <tr><td>生猪合约</td> <td>lh00.DF</td> <td>lhJQ00.DF</td> <td>2021-01-08</td> <td></td> <td></td></tr></tbody></table> <p><font size="5">上海国际能源交易中心</font></p> <table><thead><tr><th>名称</th> <th>主力连续代码</th> <th>加权合约代码</th> <th>开始时间</th> <th>退市时间</th> <th>备注</th></tr></thead> <tbody><tr><td>原油合约</td> <td>sc00.INE</td> <td>scJQ00.INE</td> <td>2018-03-27</td> <td></td> <td></td></tr> <tr><td>20 号胶合约</td> <td>nr00.INE</td> <td>nrJQ00.INE</td> <td>2019-08-12</td> <td></td> <td></td></tr> <tr><td>低硫燃料油合约</td> <td>lu00.INE</td> <td>luJQ00.INE</td> <td>2020-06-22</td> <td></td> <td></td></tr> <tr><td>阴极铜合约</td> <td>bc00.INE</td> <td>bcJQ00.INE</td> <td>2020-11-19</td> <td></td> <td></td></tr> <tr><td>集运指数（欧线）合约</td> <td>ec00.INE</td> <td>ecJQ00.INE</td> <td>2023-08-18</td> <td></td> <td></td></tr></tbody></table> <p><font size="5">广期所</font></p> <table><thead><tr><th>名称</th> <th>主力连续代码</th> <th>加权合约代码</th> <th>开始时间</th> <th>退市时间</th> <th>备注</th></tr></thead> <tbody><tr><td>碳酸锂</td> <td>lc00.GF</td> <td>lcJQ00.GF</td> <td>2023-07-21</td> <td></td> <td></td></tr> <tr><td>工业硅</td> <td>si00.GF</td> <td>siJQ00.GF</td> <td>2022-12-22</td> <td></td> <td></td></tr></tbody></table> <p><font size="5">上期所</font></p> <table><thead><tr><th>名称</th> <th>主力连续代码</th> <th>加权合约代码</th> <th>开始时间</th> <th>退市时间</th> <th>备注</th></tr></thead> <tbody><tr><td>铝合约</td> <td>al00.SF</td> <td>alJQ00.SF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>天然橡胶合约</td> <td>ru00.SF</td> <td>ruJQ00.SF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>燃料油合约</td> <td>fu00.SF</td> <td>fuJQ00.SF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>铜合约</td> <td>cu00.SF</td> <td>cuJQ00.SF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>锌合约</td> <td>zn00.SF</td> <td>znJQ00.SF</td> <td>2007-03-26</td> <td></td> <td></td></tr> <tr><td>黄金合约</td> <td>au00.SF</td> <td>auJQ00.SF</td> <td>2008-01-09</td> <td></td> <td></td></tr> <tr><td>线材合约</td> <td>wr00.SF</td> <td>wrJQ00.SF</td> <td>2009-03-27</td> <td></td> <td></td></tr> <tr><td>螺纹钢合约</td> <td>rb00.SF</td> <td>rbJQ00.SF</td> <td>2009-03-27</td> <td></td> <td></td></tr> <tr><td>铅合约</td> <td>pb00.SF</td> <td>pbJQ00.SF</td> <td>2011-03-24</td> <td></td> <td></td></tr> <tr><td>白银合约</td> <td>ag00.SF</td> <td>agJQ00.SF</td> <td>2012-05-10</td> <td></td> <td></td></tr> <tr><td>石油沥青合约</td> <td>bu00.SF</td> <td>buJQ00.SF</td> <td>2013-10-09</td> <td></td> <td></td></tr> <tr><td>热轧卷板合约</td> <td>hc00.SF</td> <td>hcJQ00.SF</td> <td>2014-03-21</td> <td></td> <td></td></tr> <tr><td>锡合约</td> <td>sn00.SF</td> <td>snJQ00.SF</td> <td>2015-03-27</td> <td></td> <td></td></tr> <tr><td>镍合约</td> <td>ni00.SF</td> <td>niJQ00.SF</td> <td>2015-03-27</td> <td></td> <td></td></tr> <tr><td>纸浆合约</td> <td>sp00.SF</td> <td>spJQ00.SF</td> <td>2018-11-27</td> <td></td> <td></td></tr> <tr><td>不锈钢合约</td> <td>ss00.SF</td> <td>ssJQ00.SF</td> <td>2019-09-25</td> <td></td> <td></td></tr> <tr><td>氧化铝合约</td> <td>ao00.SF</td> <td>aoJQ00.SF</td> <td>2023-06-19</td> <td></td> <td></td></tr> <tr><td>丁二烯橡胶合约</td> <td>br00.SF</td> <td>brJQ00.SF</td> <td>2023-07-28</td> <td></td> <td></td></tr></tbody></table> <p><font size="5">郑商所</font></p> <table><thead><tr><th>名称</th> <th>主力连续代码</th> <th>加权合约代码</th> <th>开始时间</th> <th>退市时间</th> <th>备注</th></tr></thead> <tbody><tr><td>硬白小麦合约</td> <td>WT00.ZF</td> <td>WTJQ00.ZF</td> <td>2005-01-03</td> <td>2012-11-22</td> <td></td></tr> <tr><td>强麦合约</td> <td>WS00.ZF</td> <td>WSJQ00.ZF</td> <td>2005-01-03</td> <td>2013-05-23</td> <td>WS为旧的强麦合约代码，自WS 1305 停止执行</td></tr> <tr><td>绿豆合约</td> <td>GN00.ZF</td> <td>GNJQ00.ZF</td> <td>2005-01-03</td> <td>2010-03-23</td> <td></td></tr> <tr><td>棉花合约</td> <td>CF00.ZF</td> <td>CFJQ00.ZF</td> <td>2005-01-03</td> <td></td> <td></td></tr> <tr><td>白糖合约</td> <td>SR00.ZF</td> <td>SRJQ00.ZF</td> <td>2006-01-06</td> <td></td> <td></td></tr> <tr><td>PTA合约</td> <td>TA00.ZF</td> <td>TAJQ00.ZF</td> <td>2006-12-18</td> <td></td> <td></td></tr> <tr><td>菜籽油合约</td> <td>RO00.ZF</td> <td>ROJQ00.ZF</td> <td>2007-06-08</td> <td>2013-05-15</td> <td>RO为旧的菜籽油合约, 自RO 1305 停止执行</td></tr> <tr><td>早籼稻合约</td> <td>ER00.ZF</td> <td>ERJQ00.ZF</td> <td>2009-04-20</td> <td>2013-05-23</td> <td>ER为旧的早籼稻合约, 自ER 1305 停止执行</td></tr> <tr><td>甲醇合约</td> <td>MA00.ZF</td> <td>MAJQ00.ZF</td> <td>2011-10-28</td> <td>2015-05-15</td> <td></td></tr> <tr><td>普麦合约</td> <td>PM00.ZF</td> <td>PMJQ00.ZF</td> <td>2012-01-17</td> <td></td> <td></td></tr> <tr><td>菜籽油合约</td> <td>OI00.ZF</td> <td>OIJQ00.ZF</td> <td>2012-07-16</td> <td></td> <td>OI为新的菜籽油合约, 自OI 1307 开始执行</td></tr> <tr><td>强麦合约</td> <td>WH00.ZF</td> <td>WHJQ00.ZF</td> <td>2012-07-24</td> <td></td> <td>WH为新的强麦合约代码，自WH 1307 开始执行</td></tr> <tr><td>早籼稻合约</td> <td>RI00.ZF</td> <td>RIJQ00.ZF</td> <td>2012-07-24</td> <td></td> <td>RI为新的早籼稻合约, 自RI 1307 开始执行</td></tr> <tr><td>玻璃合约</td> <td>FG00.ZF</td> <td>FGJQ00.ZF</td> <td>2012-12-03</td> <td></td> <td></td></tr> <tr><td>菜籽粕合约</td> <td>RM00.ZF</td> <td>RMJQ00.ZF</td> <td>2012-12-28</td> <td></td> <td></td></tr> <tr><td>油菜籽合约</td> <td>RS00.ZF</td> <td>RSJQ00.ZF</td> <td>2012-12-28</td> <td></td> <td></td></tr> <tr><td>动力煤合约</td> <td>TC00.ZF</td> <td>TCJQ00.ZF</td> <td>2013-09-26</td> <td>2016-04-08</td> <td>TC为旧的动力煤合约，自TC 1605 停止执行</td></tr> <tr><td>粳稻谷合约</td> <td>JR00.ZF</td> <td>JRJQ00.ZF</td> <td>2013-11-18</td> <td></td> <td></td></tr> <tr><td>甲醇合约</td> <td>MA00.ZF</td> <td>MAJQ00.ZF</td> <td>2014-06-17</td> <td></td> <td>MA为新的甲醇合约代码，自MA 1506 开始执行</td></tr> <tr><td>晚籼稻合约</td> <td>LR00.ZF</td> <td>LRJQ00.ZF</td> <td>2014-07-08</td> <td></td> <td></td></tr> <tr><td>硅铁合约</td> <td>SF00.ZF</td> <td>SFJQ00.ZF</td> <td>2014-08-08</td> <td></td> <td></td></tr> <tr><td>锰硅合约</td> <td>SM00.ZF</td> <td>SMJQ00.ZF</td> <td>2014-08-08</td> <td></td> <td></td></tr> <tr><td>动力煤合约</td> <td>ZC00.ZF</td> <td>ZCJQ00.ZF</td> <td>2015-05-18</td> <td></td> <td>ZC为新的动力煤合约，自ZC 1605 开始执行</td></tr> <tr><td>棉纱合约</td> <td>CY00.ZF</td> <td>CYJQ00.ZF</td> <td>2017-08-18</td> <td></td> <td></td></tr> <tr><td>苹果合约</td> <td>AP00.ZF</td> <td>APJQ00.ZF</td> <td>2017-12-22</td> <td></td> <td></td></tr> <tr><td>红枣合约</td> <td>CJ00.ZF</td> <td>CJJQ00.ZF</td> <td>2019-04-30</td> <td></td> <td></td></tr> <tr><td>尿素合约</td> <td>UR00.ZF</td> <td>URJQ00.ZF</td> <td>2019-08-09</td> <td></td> <td></td></tr> <tr><td>纯碱合约</td> <td>SA00.ZF</td> <td>SAJQ00.ZF</td> <td>2019-12-06</td> <td></td> <td></td></tr> <tr><td>短纤合约</td> <td>PF00.ZF</td> <td>PFJQ00.ZF</td> <td>2020-10-12</td> <td></td> <td></td></tr> <tr><td>花生合约</td> <td>PK00.ZF</td> <td>PKJQ00.ZF</td> <td>2021-02-01</td> <td></td> <td></td></tr> <tr><td>烧碱合约</td> <td>SH00.ZF</td> <td>SHJQ00.ZF</td> <td>2023-09-15</td> <td></td> <td></td></tr> <tr><td>对二甲苯合约</td> <td>PX00.ZF</td> <td>PXJQ00.ZF</td> <td>2023-09-15</td> <td></td> <td></td></tr></tbody></table> <h3 id="_3-34-获取当前期货主力合约contextinfo-get-main-contract"><a href="#_3-34-获取当前期货主力合约contextinfo-get-main-contract" class="header-anchor">#</a> 3.34 获取当前期货主力合约<br>ContextInfo.get_main_contract()</h3> <p>功能： 获取当前期货主力合约。</p> <p>语法： ContextInfo.get_main_contract(codemarket)</p> <p>参数： codemarket —— 主力连续代码，格式为品种名加00，如“IF00.IF”，“zn00.SF”，“SA00.ZF”</p> <p>返回： 字符串str，当月主力合约代码</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前主力合约的代码:&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_main_contract<span class="token punctuation">(</span><span class="token string">'IF00.IF'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
当前主力合约的代码: IF2009
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-35-获取合约乘数contextinfo-get-contract-multiplier"><a href="#_3-35-获取合约乘数contextinfo-get-contract-multiplier" class="header-anchor">#</a> 3.35 获取合约乘数<br>ContextInfo.get_contract_multiplier()</h3> <p>功能： 获取合约乘数。</p> <p>语法： ContextInfo.get_contract_multiplier(contractcode)</p> <p>参数： contractcode —— 字符串型。合约代码， 'code.market'，如：“IF1707.IF”</p> <p>返回： 数值</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约 IF1707.IF 的乘数:&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_contract_multiplier<span class="token punctuation">(</span><span class="token string">'IF1707.IF'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
合约 IF1707.IF 的乘数: 300
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-36-获取期货合约到期日contextinfo-get-contract-expire-date"><a href="#_3-36-获取期货合约到期日contextinfo-get-contract-expire-date" class="header-anchor">#</a> 3.36 获取期货合约到期日<br>ContextInfo.get_contract_expire_date()</h3> <p>功能： 获取期货合约到期日。</p> <p>语法： ContextInfo.get_contract_expire_date(codemarket)</p> <p>参数：</p> <ul><li>Codemarket —— 合约和市场,如IF00.IF,zn00.SF</li></ul> <p>返回：整数值 int，表示合约到期日</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约 IF00.IF 的到期日是:&quot;</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">.</span>get_contract_expire_date<span class="token punctuation">(</span><span class="token string">'IF00.IF'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
合约 IF00.IF 的到期日是: 20230915
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-37-获取指定期权品种的详细信息contextinfo-get-option-detail-data"><a href="#_3-37-获取指定期权品种的详细信息contextinfo-get-option-detail-data" class="header-anchor">#</a> 3.37 获取指定期权品种的详细信息<br>ContextInfo.get_option_detail_data()</h3> <p>功能： 获取指定期权品种的详细信息。</p> <p>语法： ContextInfo.get_option_detail_data(optioncode)</p> <p>参数：</p> <ul><li>optioncode —— 期权代码,如'10001506.SHO',参数必填，可以为空字符串，则取当前主图的品种</li></ul> <p>返回：一个字典。其中包含的信息请参考示例</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n期权品种 10001506.SHO 的详细信息如下：'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_option_detail_data<span class="token punctuation">(</span><span class="token string">'10001506.SHO'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
期权品种 10001506.SHO 的详细信息如下：
{'ExchangeID': 'SHO',                          # 期权市场代码
 'InstrumentID': '10001506',                   # 期权代码
 'ProductID': '50ETF(510050)',                 # 期权标的的产品ID
 'OpenDate': 20181025,                         # 发行日期
 'ExpireDate': 20190626,                       # 到期日
 'PreClose': 0.3711,                           # 前收价格
 'SettlementPrice': 0.3701,                    # 前结算价格
 'UpStopPrice': 0.662,                         # 当日涨停价 
 'DownStopPrice': 0.0001,                      # 当日跌停价
 'LongMarginRatio': 12.0,                      # 多头保证金率
 'ShortMarginRatio': 7.0,                      # 空头保证金率
 'PriceTick': 0.0001,                          # 最小变价单位 
 'VolumeMultiple': 10202,                      # 合约乘数
 'MaxMarketOrderVolume': 10,                   # 涨跌停价最大下单量
 'MinMarketOrderVolume': 1,                    # 涨跌停价最小下单量
 'MaxLimitOrderVolume': 1,                     # 限价单最大下单量
 'MinLimitOrderVolume': 1,                     # 限价单最小下单量
 'OptUnit': 1.7976931348623157e+308,           # 期权合约单位
 'MarginUnit': 7349.32,                        # 期权单位保证金
 'OptUndlCode': '',                            # 期权标的证券代码
 'OptUndlMarket': '',                          # 期权标的证券市场
 'OptExercisePrice': 2.549,                    # 期权行权价
 'NeeqExeType': 0,                             # 全国股转转让类型
 'OptUndlRiskFreeRate': 1.7976931348623157e+308,   # 期权标的无风险利率
 'OptUndlHistoryRate': 1.7976931348623157e+308,    # 期权标的历史波动率
 'EndDelivDate': 20190626,                         # 期权行权终止日
 'optType': 'CALL'
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_3-38-获取指定期权标的对应的期权品种列表contextinfo-get-option-undl-data"><a href="#_3-38-获取指定期权标的对应的期权品种列表contextinfo-get-option-undl-data" class="header-anchor">#</a> 3.38 获取指定期权标的对应的期权品种列表<br>ContextInfo.get_option_undl_data()</h3> <p>功能： 获取指定期权标的对应的期权品种列表。</p> <p>语法： ContextInfo.get_option_undl_data(undl_code_ref)</p> <p>参数：</p> <ul><li>undl_code_ref——期权标的代码,如'510300.SH'，传空字符串时获取全部标的数据</li></ul> <p>返回：</p> <p>指定期权标的代码时返回对应该标的的期权合约列表list</p> <p>期权标的代码为空字符串时返回全部标的对应的品种列表的字典dict</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n期权标的 510300.SH 对应的期权品种如下：'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_option_undl_data<span class="token punctuation">(</span><span class="token string">'510300.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果： 
期权标的 510300.SH 对应的期权品种如下：
['10005123.SHO', '10005124.SHO', '10005125.SHO', '10005126.SHO', '10005127.SHO', '10005128.SHO', '10005129.SHO', '10005130.SHO', '10005131.SHO', '10005132.SHO', '10005133.SHO', '10005134.SHO', '10005135.SHO', '10005136.SHO', '10005137.SHO', '10005138.SHO', '10005139.SHO', '10005140.SHO', ...
]
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-39-获取指定期权列表contextinfo-get-option-list"><a href="#_3-39-获取指定期权列表contextinfo-get-option-list" class="header-anchor">#</a> 3.39 获取指定期权列表<br>ContextInfo.get_option_list()</h3> <p>功能： 获取指定期权列表。如获取历史期权，需先下载过期合约列表。</p> <p>语法： ContextInfo.get_option_list(undl_code,dedate,opttype,isavailable)</p> <p>参数：</p> <ul><li>undl_code——期权标的代码,如'510300.SH'</li> <li>dedate——期权到期月或当前交易日期，&quot;YYYYMM&quot;格式为期权到期月，&quot;YYYYMMDD&quot;格式为获取当前日期交易的期权</li> <li>opttype——期权类型，默认值为空，&quot;CALL&quot;，&quot;PUT&quot;，为空时认购认沽都取</li> <li>isavailable——是否可交易，当dedate的格式为&quot;YYYYMMDD&quot;格式为获取当前日期交易的期权时，isavailable为True时返回当前可用，为False时返回当前和历史可用</li></ul> <p>返回： 期权合约列表list</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 获取到期月份为202101的上交所510300ETF认购合约</span>
data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_option_list<span class="token punctuation">(</span><span class="token string">'510300.SH'</span><span class="token punctuation">,</span><span class="token string">'202101'</span><span class="token punctuation">,</span><span class="token string">&quot;CALL&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 获取20210104当天上交所510300ETF可交易的认购合约</span>
data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_option_list<span class="token punctuation">(</span><span class="token string">'510300.SH'</span><span class="token punctuation">,</span><span class="token string">'20210104'</span><span class="token punctuation">,</span><span class="token string">&quot;CALL&quot;</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 获取20210104当天上交所510300ETF已经上市的认购合约(包括退市)</span>
data<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>get_option_list<span class="token punctuation">(</span><span class="token string">'510300.SH'</span><span class="token punctuation">,</span><span class="token string">'20210104'</span><span class="token punctuation">,</span><span class="token string">&quot;CALL&quot;</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-40-获取股票期权的实时隐含波动率contextinfo-get-option-iv"><a href="#_3-40-获取股票期权的实时隐含波动率contextinfo-get-option-iv" class="header-anchor">#</a> 3.40 获取股票期权的实时隐含波动率<br>ContextInfo.get_option_iv()</h3> <p>功能： 获取股票期权的实时隐含波动率。</p> <p>语法： ContextInfo.get_option_iv(optioncode)</p> <p>参数：</p> <ul><li>optioncode——期权代码，如'10003280.SHO'</li></ul> <p>返回： 浮点数</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_option_iv<span class="token punctuation">(</span><span class="token string">'10003280.SHO'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-41-基于bs模型计算欧式期权理论价格contextinfo-bsm-price"><a href="#_3-41-基于bs模型计算欧式期权理论价格contextinfo-bsm-price" class="header-anchor">#</a> 3.41 基于BS模型计算欧式期权理论价格<br>ContextInfo.bsm_price()</h3> <p>功能： 基于Black-Scholes-Merton模型，输入期权标的价格、期权行权价、无风险利率、期权标的年化波动率、剩余天数、标的分红率、计算期权的理论价格。</p> <p>语法： ContextInfo.bsm_price(optionType,objectPrices,strikePrice,riskFree,sigma,days,dividend)</p> <p>参数：</p> <ul><li>optionType——期权类型，认购：'C'，认沽：'P'</li> <li>objectPrices——期权标的价格，可以是价格列表或者单个价格</li> <li>strikePrice——期权行权价</li> <li>riskFree——无风险收益率</li> <li>sigma——标的波动率</li> <li>days——剩余天数</li> <li>dividend——分红率</li></ul> <p>返回：objectPrices为float时，返回float；objectPrices为list时，返回list；计算结果最小值0.0001，结果保留4位小数。如果输入非法参数则返回NaN</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
object_prices<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#计算剩余15天的行权价3.5的认购期权,在无风险利率3%,分红率为0,标的年化波动率为23%时标的价格从3元到4元变动过程中期权理论价格序列</span>
prices<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>bsm_price<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span>object_prices<span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">0.23</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prices<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#计算剩余15天的行权价3.5的认购期权,在无风险利率3%,分红率为0,标的年化波动率为23%时标的价格为3.51元的平值期权的理论价格</span>
price<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>bsm_price<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token number">3.51</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">0.23</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-42-基于bs模型计算欧式期权隐含波动率contextinfo-bsm-iv"><a href="#_3-42-基于bs模型计算欧式期权隐含波动率contextinfo-bsm-iv" class="header-anchor">#</a> 3.42 基于BS模型计算欧式期权隐含波动率<br>ContextInfo.bsm_iv()</h3> <p>功能： 基于Black-Scholes-Merton模型,输入期权标的价格、期权行权价、期权现价、无风险利率、剩余天数、标的分红率,计算期权的隐含波动率。</p> <p>语法： ContextInfo.bsm_iv(optionType,objectPrices,strikePrice,optionPrice,riskFree,days,dividend)</p> <p>参数：</p> <ul><li>optionType——期权类型，认购：'C'，认沽：'P'</li> <li>objectPrice——期权标的价格</li> <li>strikePrice——期权行权价</li> <li>optionPrice——期权现价</li> <li>riskFree——无风险收益率</li> <li>days——剩余天数</li> <li>dividend——分红率</li></ul> <p>返回： 浮点数</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>iv<span class="token operator">=</span>ContextInfo<span class="token punctuation">.</span>bsm_iv<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token number">3.51</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">0.0725</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#计算剩余15天的行权价3.5的认购期权,在无风险利率3%,分红率为0时,标的现价3.51元,期权价格0.0725元时的隐含波动率</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="几乎不用"><a href="#几乎不用" class="header-anchor">#</a> =====几乎不用=====</h3> <h3 id="_3-43-获取历史行情-contextinfo-get-history-data"><a href="#_3-43-获取历史行情-contextinfo-get-history-data" class="header-anchor">#</a> 3.43  获取历史行情 ContextInfo.get_history_data()</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>此方法已不再使用，请使用 ContextInfo.get_market_data_ex()</p></div> <h3 id="_3-44-下载指定合约代码指定周期对应时间范围的行情数据down-history-data-download-history-data"><a href="#_3-44-下载指定合约代码指定周期对应时间范围的行情数据down-history-data-download-history-data" class="header-anchor">#</a> 3.44 下载指定合约代码指定周期对应时间范围的行情数据<br>down_history_data()<br>download_history_data()</h3> <p>功能： 下载指定合约代码指定周期对应时间范围的行情数据。</p> <p>语法：</p> <p>down_history_data(stockcode,period,startTime,endTime)<br>download_history_data(stockcode,period,startTime,endTime)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>此方法意指在策略运行时下载历史数据，但几乎不会应用在实际工作中，强烈建议手动在主界面顶部菜单中，点击  “操作” --&gt; “数据管理” 面板中下载历史数据。</p></div> <p><img src="/xuntou_yao/assets/img/xtqmt03.26c4d320.png" alt="补充历史数据"></p> <p>参数：</p> <p>stockcode——string，股票代码，形式如'stkcode.market'，如'600000.SH'<br>
period——string，时间周期，'tick' 表示 分笔线，'1d' 表示 日线，'1m'：表示1分钟线，'5m' 表示 5分钟线<br>
startTime，endTime：string —— 分别代表起止时间，&quot;20200101&quot;或&quot;20200101093000&quot;，可以为空；
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    down_history_data<span class="token punctuation">(</span><span class="token string">&quot;600000.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    
<span class="token comment"># 执行后没有任何反馈，也没有进度条之类的提示。因此几乎不用。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-45-获取本地行情数据contextinfo-get-local-data"><a href="#_3-45-获取本地行情数据contextinfo-get-local-data" class="header-anchor">#</a> 3.45 获取本地行情数据<br>ContextInfo.get_local_data()</h3> <p>功能： 获取某一个指定品种的本地行情数据。使用前需提前下载好历史数据。  此方法同 <code>ContextInfo.get_history_data()</code>一样，几乎已弃用。</p> <p>语法：  ContextInfo.get_local_data(stock_code,start_time='',end_time='',period='1d',divid_type='none',count=-1)
参数：</p> <p>stock_code —— 字符串型。表示想要获取的品种代码。</p> <p>start_date —— 字符串型（String），表示开始时间，如 '20170101'，'20170101000000'。如果缺省则表示不使用</p> <p>end_date —— 字符串型（String），表示结束时间，如 '20170101'，'20170101000000'。如果缺省则使用当前 K 线的时间</p> <p>period —— 字符串型（String），指定时间周期。</p> <p>dividend_type —— 数值型（number），表示复权类型，默认为 不复权。</p> <table><thead><tr><th>字符串</th> <th>表达意义</th></tr></thead> <tbody><tr><td>0</td> <td>不复权</td></tr> <tr><td>1</td> <td>向前复权</td></tr> <tr><td>2</td> <td>向后复权</td></tr> <tr><td>3</td> <td>等比向前复权</td></tr> <tr><td>4</td> <td>等比向后复权</td></tr></tbody></table> <p>count —— 默认参数，缺省值为 -1，大于等于 0 时，效果与 获取历史行情数据的方法（get_history_data） 保持一致。<br></p> <p>如果此参数 count 和 参数 start_time/end_time 同时使用，则最终的效果如下表所示：</p> <table><thead><tr><th>count 取值</th> <th>start_time/end_time是否生效</th> <th>start_time/end_time设置效果</th></tr></thead> <tbody><tr><td>count &gt;= 0</td> <td>无效</td> <td>从当前时间往回取多少个周期的值，取值数量完全取决于 count</td></tr> <tr><td>count = -1</td> <td>生效</td> <td>同时设置开始时间和结束时间，在所设置的时间段内取值</td></tr> <tr><td>count = -1</td> <td>生效</td> <td>开始时间结束时间都不设置，取当前最新bar的值</td></tr> <tr><td>count = -1</td> <td>生效</td> <td>只设置开始时间，取所设开始时间到当前时间的值</td></tr> <tr><td>count = -1</td> <td>生效</td> <td>只设置结束时间，取股票上市第一根 bar 到所设结束时间的值</td></tr></tbody></table> <p>返回：返回一个字典（Dict），键（key） 为  timetag，值（value）为另一个 Dict (valuedict)</p> <p>当参数 period='tick' 时，返回值为分笔数据，valuedict 字典中包含的 key 如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{  
 'lastPrice'：              # 最新价
 'amount'：                 # 成交额  
 'volume'：                 # 成交量  
 'pvolumn'：                # 前成交量  
 'openInt'：                # 持仓量  
 'stockStatus'：            # 股票状态  
 'lastSettlementPrice'：    # 最新结算价  
 'open':                    # 开盘价
 'high':                    # 最高价
 'low':                     # 最低价
 'settlementPrice'：        # 结算价  
 'lastClose':               # 昨收盘价
 'askPrice'：               # 列表（List)，卖价五档  
 'bidPrice'：               # 列表（List)，买价五档  
 'askVol'：                 # 列表（List)，卖量五档  
 'bidVol'；                 # 列表（List)，买量五档  
}  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>当参数 period 为其它值时，valuedict字典中包含的 key 如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
 amount：  # 成交额  
 volume：  # 成交量  
 open：    # 开盘价  
 high：    # 最高价  
 low：     # 最低价  
 close：   # 收盘价  
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>*注：时间区间两边闭区间</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 需提前下载好本地数据</span>
    Result <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_local_data<span class="token punctuation">(</span>
        stock_code<span class="token operator">=</span><span class="token string">'600027.SH'</span><span class="token punctuation">,</span>  <span class="token comment"># 指定品种</span>
        start_time<span class="token operator">=</span><span class="token string">'20200901'</span><span class="token punctuation">,</span>
        end_time<span class="token operator">=</span><span class="token string">'20200905'</span><span class="token punctuation">,</span>
        period<span class="token operator">=</span><span class="token string">'1m'</span><span class="token punctuation">,</span>
        divid_type<span class="token operator">=</span><span class="token string">'none'</span>
        <span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span>Result<span class="token punctuation">)</span>  <span class="token comment"># 打印输出</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
如果返回值为一个 空字典 {} ，则需检查是否已下载了历史数据。
运行结果：
{1693531860000:            # 对应的时间戳
  {'open': 5.06,             # 开盘价
   'high': 5.09,             # 最高价
   'low': 5.04,              # 最低价
   'close': 5.06,            # 收盘价
   'volume': 14988,          # 成交量
   'amount': 7586910.0       # 成交金额
  }, 
 1693531920000: 
  {'open': 5.05, 
   'high': 5.05, 
   'low': 5.03, 
   'close': 5.04, 
   'volume': 11412, 
   'amount': 5752400.0
  }, 
 1693531980000: 
   {'open': 5.04, 
    'high': 5.05, 
    'low': 5.03, 
    'close': 5.04, 
    'volume': 8661, 
    'amount': 4365096.0
   }, 
 1693532040000: 
   {'open': 5.04, 
    'high': 5.04, 
    'low': 5.03, 
    'close': 5.04, 
    'volume': 5682, 
    'amount': 2860395.0
   },
 ......
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="_3-46-根据etf基金代码获取etf申赎清单及对应成分股数据get-etf-info"><a href="#_3-46-根据etf基金代码获取etf申赎清单及对应成分股数据get-etf-info" class="header-anchor">#</a> 3.46 根据ETF基金代码获取ETF申赎清单及对应成分股数据<br>get_etf_info()</h3> <p>功能： 根据指定的ETF基金代码获取申赎清单及对应成分股数据。此方法需要ETF交易权限，并且需要提前下载申赎清单数据。如帐户没有相应权限，则无法使用。</p> <p>语法： get_etf_info(stockcode)</p> <p>参数：</p> <p>​    stockcode —— ETF基金代码，如&quot;510050.SH&quot;
返回：</p> <p>​    返回一个字典dict，其中包含的数据详见示例：</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取ETF基金代码为511050的全部ETF申赎清单数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_etf_info<span class="token punctuation">(</span><span class="token string">&quot;510050.SH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
{'etfCode': '510050',      # ETF 代码
 'etfExchID': 'SH',        # 交易所
 'prCode': '510050',       # 基金申赎代码
 'cashBalance': 62182.33,  # 现金差额（单位：元）
 'maxCashRatio': 0.5,      # 现金替代比例上限
 'reportUnit': 900000,     # 最小申购、赎回单位（单位：份）
 'name': ' ',              # 基金名称
 'navPerCU': 2374240.29,   # 最小申购、赎回单位净值（单位：元）
 'nav': 2.638,             # 基金份额净值（单位：元）
 'ecc': 67484.89,          # 预估现金差额（单位：元）
 'needPublish': 1,         # 是否需要公布IOPV（1：是，0：否）
 'enableCreation': 1,      # 是否允许申购（1：是，0：否）
 'enableRedemption': 1,    # 是否允许赎回（1：是，0：否）
 'creationLimit': 0,       # 申购上限（单位:份，0：不限制）
 'redemptionLimit': 0,     # 赎回上限（单位:份，0：不限制）
 'type': 14, 
 'tradingDay': '',         # 交易日期（格式YYYYMMDD）
 'preTradingDay': '',      # 前交易日期（格式YYYYMMDD）
 'stocks':                 # 成分股列表
     {'600010.SH':              # 股票代码
         {'exchangeID': 'SH',   # ETF基金市场代码
          'etfCode': '510050',  # ETF基金代码
          'etfName': ' ',       # ETF基金名称
          'componentExchID': 'SH',    # 成份股市场代码
          'componentCode': '600010',  # 成份股代码 
          'componentName': '包钢股份', # 成份股名称
          'componentVolume': 7900,    # 成份股数量
          'ReplaceFlag': 49,          # 替代标记（48:禁止替代，49：允许替代，50：必须替代，51：替补替代）
          'ReplaceRatio': 0.1,       # 溢价比率
          'ReplaceBalance': 0.0      # 替代金额
         }, 
      '600028.SH': 
         {'exchangeID': 'SH', 
          'etfCode': '510050', 
          'etfName': ' ', 
          'componentExchID': 'SH', 
          'componentCode': '600028', 
          'componentName': '中国石化', 
          'componentVolume': 6600, 
          'ReplaceFlag': 49, 
          'ReplaceRatio': 0.1, 
          'ReplaceBalance': 0.0
         }, 
      '600030.SH': 
         {'exchangeID': 'SH', 
          'etfCode': '510050', 
          'etfName': ' ', 
          'componentExchID': 'SH', 
          'componentCode': '600030', 
          'componentName': '中信证券', 
          'componentVolume': 3400, 
          'ReplaceFlag': 49, 
          'ReplaceRatio': 0.1, 
          'ReplaceBalance': 0.0
         },
         ...
     }
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h3 id="_3-47-根据etf基金代码获取etf的基金份额参考净值get-etf-iopv"><a href="#_3-47-根据etf基金代码获取etf的基金份额参考净值get-etf-iopv" class="header-anchor">#</a> 3.47 根据ETF基金代码获取ETF的基金份额参考净值<br>get_etf_iopv()</h3> <p>功能： 根据ETF基金代码获取ETF的基金份额参考净值</p> <p>语法： get_etf_iopv(stockcode)</p> <p>参数：</p> <ul><li>stockcode：ETF基金代码（如&quot;510050.SH&quot;）</li></ul> <p>返回： IOPV，基金份额参考净值</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ETF基金 511050 的 净值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_etf_iopv<span class="token punctuation">(</span><span class="token string">&quot;510050.SH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
2.613
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-48-获取某只指数历史调整日的历史的成分股列表contextinfo-get-his-index-data"><a href="#_3-48-获取某只指数历史调整日的历史的成分股列表contextinfo-get-his-index-data" class="header-anchor">#</a> 3.48 获取某只指数历史调整日的历史的成分股列表<br>ContextInfo.get_his_index_data()</h3> <p>使用前需要下载 “板块成分股”，否则此方法返回值是一个空列表。</p> <p>功能： 获取某只指数历史调整日的历史的成分股列表。</p> <p>参数：</p> <ul><li>stockcode —— 股票代码，如'000300.SH'</li></ul> <p>返回： 一个字典，其中的key是日期，对应的值即是当天调整的股票代码。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n沪深300指数 曾经调整的股票代码：\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_his_index_data<span class="token punctuation">(</span><span class="token string">'000300.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
沪深300指数 曾经调整的股票代码：
{'20050408': ['000001.SZ', '000002.SZ', '000009.SZ', '000012.SZ', '000016.SZ', '000021.SZ', ...]
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-49-获取市场已退市合约contextinfo-get-his-contract-list"><a href="#_3-49-获取市场已退市合约contextinfo-get-his-contract-list" class="header-anchor">#</a> 3.49 获取市场已退市合约<br>ContextInfo.get_his_contract_list()</h3> <p>使用前需要下载 “过期合约列表”，否则此方法返回值是一个空列表。当然，基本也用不上这个方法。谁没事去查已经退市的品种？</p> <p>功能： 获取市场已退市合约。执行前需要提前下载好 “过期合约列表”。</p> <p>参数：</p> <ul><li>market ——市场代码。如：上证所SH、深交所SZ、上期所SF、大商所DF、郑商所ZF、中金所IF、能源中心INE、沪港通HGT、 深港通SGT、外部自定义市场ED。</li></ul> <p>返回： 列表list。其中包含合约品种的代码。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上海沪市已退市的品种合约有：\n&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_his_contract_list<span class="token punctuation">(</span><span class="token string">'SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
【2023-09-08 09:27:38.805】  上海沪市已退市的品种合约有：
 ['719103.SH', '141945.SH', '105901.SH', '708376.SH', '512571.SH', '134338.SH', '164862.SH', '161109.SH', '106327.SH', '148333.SH', '122480.SH', '787633.SH', '756797.SH', '134723.SH', '787228.SH', '517801.SH', '148728.SH', '161512.SH', '172670.SH', '104230.SH', '127441.SH', '136634.SH', '000842.SH',  '136519.SH', '600485.SH', '517286.SH', '172146.SH', '163333.SH', '140542.SH', '136102.SH', '174610.SH', '020323.SH', '738153.SH', '732518.SH', '124951.SH', '130654.SH', '521969.SH', '732103.SH', '738548.SH', '176707.SH', '107291.SH', '511861.SH', '144303.SH', '787105.SH', '106411.SH', '736359.SH', '148405.SH', '147925.SH', '515391.SH', '161224.SH', '715133.SH', '134015.SH', '103961.SH', '136176.SH', '172529.SH', ......]
&quot;&quot;&quot;</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-50-获取对应周期的北向数据contextinfo-get-north-finance-change"><a href="#_3-50-获取对应周期的北向数据contextinfo-get-north-finance-change" class="header-anchor">#</a> 3.50 获取对应周期的北向数据<br>ContextInfo.get_north_finance_change()</h3> <p>功能： 获取对应周期的北向数据。</p> <p>语法： ContextInfo.get_north_finance_change(period)</p> <p>参数：period —— '1d' 表示日线 ；'1m' 表示一分钟</p> <p>返回：一个字典dict，其中的key是时间戳， 对应的 value值仍然是一个dict，其中包含的信息详见以下示例：</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n北向资金当日数据：\n&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>get_north_finance_change<span class="token punctuation">(</span><span class="token string">'1d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：

北向资金当日数据：
{1416153600000: 
  {'hgtNorthBuyMoney': 120820000,       # 沪港通HGT北向买入资金
   'hgtNorthSellMoney': 0,              # 沪港通HGT北向卖出资金
   'hgtSouthBuyMoney': 1772000000,      # 沪港通HGT南向买入资金
   'hgtSouthSellMoney': 84000000,       # 沪港通HGT南向卖出资金
   'sgtNorthBuyMoney': 0,               # 深港通SGT北向买入资金
   'sgtNorthSellMoney': 0,              # 深港通SGT北向卖出资金
   'sgtSouthBuyMoney': 0,               # 深港通SGT南向买入资金
   'sgtSouthSellMoney': 0,              # 深港通SGT南向卖出资金
   'hgtNorthNetInFlow': 13000000000,    # 沪港通HGT北向资金净流入 
   'hgtNorthBalanceByDay': 0,           # 沪港通HGT北向当日资金余额
   'hgtSouthNetInFlow': 1768000000,     # 沪港通HGT南向资金净流入
   'hgtSouthBalanceByDay': 8732000000,  # 沪港通HGT南向当日资金余额
   'sgtNorthNetInFlow': 0,              # 深港通SGT北向资金净流入
   'sgtNorthBalanceByDay': 0,           # 深港通SGT北向当日资金余额
   'sgtSouthNetInFlow': 0,              # 深港通SGT南向资金净流入
   'sgtSouthBalanceByDay': 0            # 深港通SGT南向当日资金余额
  }
}
&quot;&quot;&quot;</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_3-51-获取-北向-指定品种的持股统计及明细contextinfo-get-hkt-statistics-contextinfo-get-hkt-details"><a href="#_3-51-获取-北向-指定品种的持股统计及明细contextinfo-get-hkt-statistics-contextinfo-get-hkt-details" class="header-anchor">#</a> 3.51 获取（北向）指定品种的持股统计及明细<br>ContextInfo.get_hkt_statistics()<br>ContextInfo.get_hkt_details()</h3> <p>这2个方法是与 北向资金有关的持股信息。需要提前下载好 “港股资金流向数据”，否则无返回值。</p> <p>功能： 获取北向持股中，指定品种的有关数据。</p> <p>参数：stockcode —— 指定的股票品种，如：600000.SH</p> <p>返回：一个字典，其中key值是统计数据的时间戳，对应的 value 仍是一个字典，所包含内容详见示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n北向资金持股中 600000.SH 的统计信息如下：\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_hkt_statistics<span class="token punctuation">(</span><span class="token string">'600000.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'==============分割线===================='</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n北向资金持股中 600000.SH 的详细信息如下：\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_hkt_details<span class="token punctuation">(</span><span class="token string">'600000.SH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n\n如返回值为空，请先在 数据管理 中下载“港股资金流向数据”&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
北向资金持股中 600000.SH 的统计信息如下：
{1507478400000:                              # 统计的时间戳
    {'stockCode': '600000.SH',               # 股票名称
     'ownSharesAmount': 185395143,           # 持股数量
     'ownSharesMarketValue': 2417552664.72,  # 持股市值
     'ownSharesRatio': 0.65,                 # 持股数量占比
     'ownSharesNetBuy': 0.0                  # 净买入
    }
}
==============分割线====================
北向资金持股中 600000.SH 的详细信息如下：
{1597766400000:                                            # 统计的时间戳
  {'stockCode': '600000.SH',                               # 股票名称
   'ownSharesCompany':'ABN AMRO CLEARING HONG KONG LTD',   # 机构名称
   'ownSharesAmount': 147700,                              # 持股数量
   'ownSharesMarketValue': 1562200.0,                      # 持股市值
   'ownSharesRatio': 0.0,                                  # 持股数量占比
   'ownSharesNetBuy': 0.0                                  # 净买入
  }
}

如返回值为空，请先在 数据管理 中下载“港股资金流向数据”
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_3-52-获取无风险利率contextinfo-get-risk-free-rate"><a href="#_3-52-获取无风险利率contextinfo-get-risk-free-rate" class="header-anchor">#</a> 3.52 获取无风险利率<br>ContextInfo.get_risk_free_rate()</h3> <p>语法：ContextInfo.get_risk_free_rate(index)</p> <p>功能： 获取无风险利率，用十年期国债收益率CGB10Y作无风险利率</p> <p>参数： index —— 当前主图 上最新一根K 线的索引号。不可省缺，任一整数即可。</p> <p>返回：浮点数</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_risk_free_rate<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
十年期国债收益率 CGB10Y 为： 11.98
&quot;&quot;&quot;</span>    

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-53-获取除权除息日和复权因子contextinfo-get-divid-factors"><a href="#_3-53-获取除权除息日和复权因子contextinfo-get-divid-factors" class="header-anchor">#</a> 3.53 获取除权除息日和复权因子<br>ContextInfo.get_divid_factors()</h3> <p>需要提前下载好 “除权数据”，否则无返回值。</p> <p>功能：获取除权除息日和复权因子。</p> <p>参数： stock.market：股票代码.市场代码，如 '600000.SH'</p> <p>返回：一个字典 dict。其中的key为除权除息的日期，对应的 value 即为复权因子。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Result <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_divid_factors<span class="token punctuation">(</span><span class="token string">'600000.SH'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>Result<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
{962812800000: [0.15000000596046448, 0.0, 0.0, 0.0, 0.0, 0, 1.0065019505851756], 1029945600000: [0.20000000298023224, 0.0, 0.5, 0.0, 0.0, 0, 1.5169002473206923], 1056297600000: [0.10000000149011612, 0.0, 0.0, 0.0, 0.0, 0, 1.0083612040133778], 1084982400000: [0.10999999940395355, 0.0, 0.0, 0.0, 0.0, 0, 1.011853448275862], 1115827200000: [0.11999999731779099, 0.0, 0.0, 0.0, 0.0, 0, 1.0172910662824206], 1147363200000: [0.0, 0.30000001192092896, 0.0, 0.0, 0.0, 0, 1.3005988023952095], 1148486400000: [0.12999999523162842, 0.0, 0.0, 0.0, 0.0, 0, 1.0131712259371835], 1184688000000: [0.15000000596046448, 0.0, 0.0, 0.0, 0.0, 0, 1.0041459369817578], 1208966400000: [0.1599999964237213, 0.30000001192092896, 0.0, 0.0, 0.0, 0,]
......
&quot;&quot;&quot;</span>    

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-54-获取某只股票st的历史contextinfo-get-his-st-data-获取历史st状态get-st-status"><a href="#_3-54-获取某只股票st的历史contextinfo-get-his-st-data-获取历史st状态get-st-status" class="header-anchor">#</a> 3.54 获取某只股票ST的历史<br>ContextInfo.get_his_st_data()<br>获取历史ST状态<br>get_st_status()</h3> <p>这2个方法（函数）都需要提前下载“过期合约K线”的数据，不是“过期合约列表”。否则返回值为空。</p> <p>功能： 获取某只股票ST的历史，历史ST状态。</p> <p>参数：stockcode——string，股票代码，如'000004.SZ'</p> <p>返回：一个字典。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n股票 000792.SZ 的历史ST状态\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_st_status<span class="token punctuation">(</span><span class="token string">'000792.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n===========分割线=====================\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n股票 000004.SZ 的ST历史\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_his_st_data<span class="token punctuation">(</span><span class="token string">'000004.SZ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
股票 000792.SZ 的历史ST状态
{'*ST': [['20190430', '20210810']]}
===========分割线=====================
股票 000004.SZ 的ST历史
{'ST': [['19990427', '20010306'], 
        ['20070525', '20090421'], 
        ['20100531', '20110608'], 
        ['20220506', '20230628']
       ], 
 '*ST': [['20060421', '20070525'], 
         ['20090421', '20100531']
        ]
}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_3-55-设置股票池-contextinfo-set-universe"><a href="#_3-55-设置股票池-contextinfo-set-universe" class="header-anchor">#</a> 3.55 设置股票池  <br>ContextInfo.set_universe()</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>此法是早期订阅股票池的函数，不再推荐使用！</p></div> <p>功能：设定股票池，声明想要订阅的交易品种<br>
语法：  ContextInfo.set_universe(stocklist)<br>
参数： stocklist —— 是一个列表（List），其中包含想要订阅的品种代码。<br>
返回值： 无<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stocklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'000300.SH'</span><span class="token punctuation">,</span><span class="token string">'000004.SZ'</span><span class="token punctuation">]</span>
    ContextInfo<span class="token punctuation">.</span>set_universe<span class="token punctuation">(</span>stocklist<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-56-获取已设置的股票池中的品种列表contextinfo-get-universe"><a href="#_3-56-获取已设置的股票池中的品种列表contextinfo-get-universe" class="header-anchor">#</a> 3.56 获取已设置的股票池中的品种列表<br>ContextInfo.get_universe()</h3> <p>功能：获取已设置好的股票池中的股票<br>
语法：ContextInfo.get_universe()<br>
参数：无<br>
返回值： 一个包含股票代码的列表<br>
示例：通常用于核验一下 ContextInfo.set_universe()方法设置的品种。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	stocklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'000300.SH'</span><span class="token punctuation">,</span><span class="token string">'000004.SZ'</span><span class="token punctuation">]</span>
	ContextInfo<span class="token punctuation">.</span>set_universe<span class="token punctuation">(</span>stocklist<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>get_universe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot; 运行结果
['000004.SZ', '000300.SH']
与第5行设置的结果是一致的。
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这个方法（函数）用来检查上一个方法（函数）的运行结果，一个 <code>set</code>，一个是 <code>get</code>，很明显嘛。</p> <hr> <h2 id="_4-交易动作的方法-函数"><a href="#_4-交易动作的方法-函数" class="header-anchor">#</a> 4） 交易动作的方法（函数）</h2> <p>交易函数下单 和 手动在交易界面中点击下单 ，二者的流程其实是一样的，唯一的区别是：交易函数下单通过解析下单函数接口传过来的参数，形成相应的下单任务；而手动点击下单通过解析界面的输入、选择，形成相应的下单任务。</p> <p>运行策略模型的流程如下：</p> <p>一、编写测试代码，并保存。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">1101</span><span class="token punctuation">,</span><span class="token string">'6000000248'</span><span class="token punctuation">,</span><span class="token string">'000001.SZ'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
    <span class="token comment"># 在帐户 6000000248 中，买入（23）单支股票（1101），代码为 000001.SZ，按最新价（5），无论价格类型（-1），回传ContextInfo     </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>二、运行策略程序</p> <p>请点击主界面上的“模型交易”按钮，以切换到模型交易界面。在此界面左侧，找到刚刚保存的策略代码。</p> <p><img src="/xuntou_yao/assets/img/xtqmt27.a36e7054.png" alt="新建策略交易"></p> <p>点击选择之后，会弹出 “新建策略交易” 窗口</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtgAAAENCAYAAAA1yBIEAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABeISURBVHhe7dxPi27LVQfg+wlEv0GUaDRRI+ZonAk6yVxHImTsJxBEMvIbOBMchUAmESUDBVHzzyQaEzH4BzEXJ4KDBGJwIJFO2ltHiqy7zqpd++2ud7+7u5/Bw65atWr3cd99av9oTnzr397+9/t/+pd/vf/6P/7z/df+4ev3X/nq1+6//LdfWeKTn/7Lsl754pf/5lBf+OKXDvWJP/7z+8994a8P9dnPf+FBPv5Hf1bW9/jM5z7/rHz8U39a1s/oKf1ZnwLP8wc8ix/wLPbzrPaLz+pXfvUjr/32H/zJ/Uc+/1dX99Mf/KX7z3z6N96l1Z6Mn/3w4T7wM7/4jg/fv/+d609+4Bfu3/f+D93/xE996P697/v5+x/78Z+7f897P3j/1g/9zrfvAQCANQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFHhSw7+7uXqvWut4z6+suuefe+h6X7n1o/0y1FwCAp+fBv8GugmEMjHltZs+eeO/YX9Wb2Vpc7/M9Ltkz673kXgAAnN9FAbuHwZnH7I229ud6Huf1bGt9tnem77/kHnEPAADH+4/v3L926Vp28W+wcyCM87w2UvXFWl4fzXN9T2+31dvnK8zueY2fCQDAw1RB+pJw3Tzq32DncJjnlbhvj+oe3SU9e1X3aEbre/fNVHsBADheDNSXhuvmKv9EJKvuEWu5nnv6/FJbe/u9Y0+sRddeBwDgXHqwvjRcNw/+HzlWYpCsQmWu9flI3FvZ0xfvF43W4964nuvZVt/eewAAcA43CdhVaIy1rfWttViL4r49LtlX9fZaXttb7/r6HtV+AACOFYP1Q0L2Vf6JSOzN94hrM9WeS2t9nsU9e+W9s3tt9Y/GAADcThWoLw3ZT+432Hk+MuubrY3s7c3rW/O8BgDA8baC9CUh++KA3cNgFtfyOOr1vfL+rXtc2hvH1Xxkb1+X+2dzAACergf9E5HRuKr1vd2l9aj39L5q3Od5TzXfWhvpPZf25lrVF2sAADxNy/6JyGwea1trsZbX9uwZ9VZibzTr3aptGfVecg8AAM7t0f9EJNaqvtl8pvdX9vRsyftH81zPZn2jtVEdAICn68G/wQYAAN4kYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACz0OmD//Te/DwAAPNK7Ava3/+ceAAB4IAEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhAXux9hzh7Kp3F+AxqrMGzqZ6d69BwF6sPce7uzs4rSMPGODl8P3j7I78/gnYizlgOLsjDxjg5fD94+yO/P4J2IttHTCzw6et/+jv/df9597+brkOK7T3rHp3AR5j9o2DWzvy+3fTgP3q1auL6pVr9Y7M7rF1wMwOn7b+2W9893XIbteqBx6rvWfVuwvcxuy70tb3qvbmcdUX9XtlVW80+8bx/Nz/2lu7amdx5Pfv5gG7+stb1XNtVO/36GJtNI61Suzv15GtA2Z2+PT1HrLf/ub/vtEDj9Xes+rdBW5n69uS10a9VT3WtsZRr0ejejT7xvE87Q3ZvdauM3nvKkd+/24WsONf1kvG8RrX41pW7Y3rUVyrxlt7m60DZnb4tPXoNz/x32/0tJ+fbdWrtVl/X4/zXqv6R3XOqb1b1bsLnFM7V+M4q/r2zLNL7lVpZ0s+b9q+7gx1rqcKyl3uifN4rcZdrz2k3h35/bvpb7Cz9hehqjd9bXStxnv1PdU98jj3Z9UB022tVX7kd+vDqrqOxrFW1Wd9s/msj/M58oABau2snIm9cU+vx7U83pq3a1et53E1r+RvXNtTzW9V57pGoXZvfe/80np05Pfvpr/B3qv3V9d4rz7PtvZ2/R6VuKdfR/IBE1Vr3/uLP7z//ic/9i6tdvedb73RG7U/x6gW16q+aLTe6nvuM7s/53PkAQPs087Sqt7ktTbvcj33xHGsZbk+m1fyN67tqeaX1rNV9+Fx9gTaUT3WRuOsr+WeWT068vv3pH6DnfV67OnjqjbrzfVqPNrX5QMmqta+/7Ffvr//6A+/vnZt3tz95zfe6O/an6OqdVU91uLaqBbXLtnPMdr7NFL1d229eneB22lnaVVv2lo0W8vX2BvnUd8f91byviifPa2/ml9aj/NYG/WP6qwXQ2wVaGN9tj7S1mNP7u/zUT068vt304DdXvqZ2Juvcb2r9ozk9dl8VIvyARNVaz1Uv6v+nW/9f+j+/Y++ux60P8eoVq2N6nvvc8k9OU57p7KqL2o91bsL3E47S6t6k9favOqv+rbmsd7XRj3N1lqTz5/WX80vrWer7sNaLdCOxJ5Zb9P7o17P67N6dOT37+YBe++8j6tr1PsrW+uzvc2en5EPmKhaKwP2Rr1rf449tSz3jO4Tjfq26hynvVddtZ61vurdBY4Tz9iR2Bv3juqXzqO+tqdnJJ9Brb+aX1rPVt2HtapAu1XvZutd78v9s3p05PfvNAG7jbs4z72jazXeq+/JttZG8gETVWtVkP7e21+9v//1tx78G+w4zn2zea7N7jOqc6yt9y5rvdW7C9xOOzurehPX2njUm+tVX75XHrdrJfdX8jnU+qv5repcxyjg7tH2dNVaNb+0Hh35/btpwG7ai9/0ca7lvijuyeOs6s/a2ky1L8oHTFSttXD9xr/Bfidc3//We4b/Bjv+eapaXKtq1Z5cq+Z9HNe36pzTkQcMsE87P6t6U631MzfXtua5HtfbuOu1bGutqb5x8b5nqLPWKNyOxL68t7pHq3WPqXdHfv9uFrD7i59red5ro97e08WeuD6rVfb0ZNUB01VrrwP1O2H6Xf9fRL70qTf6YJUjDxhgn63vTf9m7ZH3xXmU+/t4tqeqd1vfP56fGGJHgTbqPTkA53Gcr3bk9+/mv8GOZn95K9UB0cez+8WePt4j3yfaOmCqtf5b61yHaznygAHeVH1XRnp/vkcl9832XXLfPb1b3z+er8cG4msG6uzI79+pAvZzsHXAVGsCNkc78oABXo6t7x+cwZHfPwF7MQcMZ3fkAQO8HL5/nN2R3z8BezEHDGd35AEDvBy+f5zdkd8/AXux9hzh7Kp3F+AxqrMGzqZ6d69BwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjAXqw9Rzi76t0FeIzqrIGzqd7daxCwF2vP8e7uDk7ryAMGeDl8/zi7I79/AvZiDhjO7sgDBng5fP84uyO/fwL2Yg4Yzu7IAwZ4OXz/OLsjv3+nC9ivXr0q611bH6n6oz09M7N7PPaAif/3zFT7uz3rI1U/z8eRBwxQa2dtVZ+5ZF8810dibzW+xEO+f+1nbc1n9WZrDaIjv383C9jtL0TW67Gnj7dqe+t77l2J/f06Uh0w8V7NqFaJ/Xmt17Nejz19vFXbqvN8HHnAAGPtvI3jLPb2njjOYm/vybUorm+No16vVN+/mXbPrfms3mytQXTk9++mAbua52t2ab3Ze+8mrlXjrb1NdcC0PXlc1eJ8Zmtvdc0urfN8HHnAAGu0s7mqb8l7RvN2reQ9cVypvn9N2/fYeqtFeS3OYeTI79/NA3Z17eNKX6/s7cvyvq1x7s+qA6btyeOqVs1n/Xk9XmNf1tcrVT/Px5EHDPB47VyuxjO9t5/tUVx/yLgy+v41ud7X9tS3+rKqD7ojv3+nDNi9Z5U9P6PVRuKefh3ZOmCian2rP4u9W1fIjjxggDe187nL8yzve0j/nnnf383qler717R9e2pRXu8/v4s9+QojR37/ThWwR2brWf8Z8f5b42jWP9rXVQdM21ONV+j3i9eR2XrWfwbn1N61kaq/a+vVuwscq52ze2q9vrU2qs/E3kvGldHZ0/ZV83Yd2dqX56N+nq/4vcuq/q6tV+/uNZz2N9j9Wtlai2Z9eX02H9Wi6j9u2xPHldw/E3v3XCtbazwN7X3Lqr6o9VTvLnCsdgZvzXN9tr633sX1No5GPX1cGZ0/bV9V7/L6qH/Ul6+8DPG711V9Ueup3t1reHIBe1TfY2vvnvu2nllf9R+47+t6La738aXy/UbXbFTn6WnvXFetZ62veneBY7VzuBpX81FtT71ds7g+G0e9XhmdQW1fVe/yejXPtuq8HGf+/p02YOdxrG3Z2xfF+0dbayPVf+R2nzzO17i+V3WffM3jWNuS+zm3vYdLc+QBA4y1s7ZfR6r+bFYf3SdeK7Enjyujc6jtq+pNtTbqz/U+z1delrN+/24WsLv2F2I0z2szW/19bdYzU+2Lqv/Qbd9svGVPX+55yM/pLu3naTnygAHG2llb1bu8Puqf1ds1i+tbYs+sf/T96/JaX99Ti/W8PuqH7Mjv300DdvtLEa99nOd9PFP15vuNapVLfnY3OmDyOF+zak8e51rum+0buaSXp+fIAwaotXM2XvcY9Vb1PfeNPZeOK9X3b0u736X1am3UD9mR37+bBez2F6Ka5/oebU91v9m9Yk8f75HvE+UDpvXHcZd7ct9orVqv1nJ9j7bnIft4Wo48YIA3tXM2z0dyX57v6cvyvqo/rlfzSv7+bWn3yvMu1qPR2tYeiI78/t30N9jP0SUHDNzCkQcM8HL4/nF2R37/BOzFHDCc3ZEHDPBy+P5xdkd+/wTsxRwwnN2RBwzwcvj+cXZHfv8E7MXac4Szq95dgMeozho4m+rdvQYBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQEbAAAWErABAGAhARsAABYSsAEAYCEBGwAAFhKwAQBgIQF7sfYc4eyqdxcAWEPAXqw9x7u7OzgtARsArkvAXkzA5uwEbAC4LgF7MQGbsxOwAeC6bhqwX716tTmfubS/me1p6yNVfyZgc3YCNgBc181/gx2Daw60XeyPvfGaxf1dr8eePt6qbdUzAZuzE7AB4LpuHrC7UfDdE4Iv6cnX7NJ6VgXstrd7TD2uVbVr1XleBGwAuK5T/QY7znO921vP94nX3Bv19UrVn+WA3fZV80vro/Gof1Wd50fABoDrulnAbgGuGc1zrRpHVc/W9VoeG7CzUX83us+qOs+PgA0A13Xz32A/RguBVb3pa/E6MlvP+s+orArYbR5rcd+oN9bzOM5jvRpXc86nvWsjVX/X1qt3FwBY46YBuwe/LdW+bmu9r82ula21mRxu2r2q+aiexf7YE+u9ludxz1bfnjnn1N63rOqLWk/17gIAa9w8YF86n8l7Z9dsVN8rB5x2v2o+qmez/kvvk8ej2ug+nE9757pqPWt91bsLAKzxpAJ2trXe10bXPI61Lbk/yyGn7anmR9ZH42h0H56GveG6EbAB4LpuGrCjFuj6tY8rcW00jnJ9z56RPf1V0Gn7ulvUq1pUrcU9PC8CNgBc180Ddg90e+t9rbpm1Xob53kfz+zprQI2nImADQDXdbOAnYPuSO/p/XvEfdV9Yn2PeN8ZAZuzE7AB4Lpu/hvs50bA5uwEbAC4LgF7MQGbsxOwAeC6BOzFBGzOTsAGgOsSsBdrzxHOrnp3AYA1BGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIVuFrDbz9ur2t+9evVqcz6rN1tr0d6+7NJ9rb+r1rvVf57V9wMAeIluGrCrevaQgB3ltUvGla31ttblepxHcU9X9WV7+kb33Nob1+L+Lvb2njjOYi8AwEvwpAN2DnCzeRTXRuM+n4n9la2ePfu7+DNHqn3Z3r6ZVfcBAHhOnmzAjuEuhst8zT1xfSTvi/Nsz3qW1+N8y6x3z736nyGq+mbivofeAwDgOXrSAXsUEFcGvtm9+nr/s0S5J4/7fGa0N8u92agv9+d51veO9mexHwDguXuyAbvLAa7PZ/V2Hcn7ZnJ/nOfanv6R1jtT7dmq5fW99+j1rbWqDgDw3D3pgB1DXBX2Yi1fo6rWba1lo95Yzz0r7t/tvXesz/bM7jFbBwB4aZ5swG4Brqvqsdbr+TqS983E3njN9a21dh3JvSN5vc9H9cesbdW26gAAz92T/g32llkY7OPRtWvzXIu29s3GcZ7rXd47U+3L8z197TpS9WejOgDAc/fkA3YMfXE8Enu3rqNaFnuyuJ77t8bRnp4u92a5Z88829s/uw8AwHN104C9V7W/BbitcJfXcq2PR9dc29L7K3k9zvN4pOqvzNab3FPdf899ulHvJfcAAHhObhawj7AV8qq1Vuv1uH7pfbp8j617ju5T3WNL3JvF9dyf9/b1Su7L86oPAOCleNYBGwAAjiZgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEICNgAALCRgAwDAQgI2AAAsJGADAMBCAjYAACwkYAMAwEJvBOy/+8a3AACAB/IbbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwAAFhIwAYAgIUEbAAAWEjABgCAhQRsAABYSMAGAICFBGwA4HRaLuFy1bOsVHuZq55lRcAGAE4nhhr2q55lpdrLXPUsKwI2AHA6MdSwX/UsK9Ve5qpnWRGwAYDTiaGG/apnWan2Mlc9y4qADQCcTgw17Fc9y0q1l7nqWVYEbADgdGKoYb/qWVaqvcxVz7IiYAMApxNDDftVz7JS7WWuepYVARsAOJ0Yam7l7u6urGd7+45QPctKtfcpuPWzrp5lRcAGAE4nhppra6EtmtUrs/WjVM+yUu29lvwcu6q3i+t7xkepnmVFwAYATieGmqNshbe8tle8xxGqZ1mp9l5TfBZ9HJ9TXM99cZyvR6ueZUXABgBOJ4aao4xCW67vDXe3CIHVs6xUe68pPotqfOZnGlXPsiJgAwCnE0PNEXJwa/NK7Dmj6llWqr3XNHqOfVzV4nwk9h2hepYVARsAOJ0Yao6QQ1u+5tpefe9RqmdZqfZeU3wW1Tg/q1F/NKpfU/UsKwI2AHA6MdRcWwtqPazFayXui7bWjlQ9y0q195pGz7GPYy2L+7Kq/5qqZ1kRsAGA04mh5gg9rI2ueTxbu5XqWVaqvdc0elZ9vPX8Rmtbe66lepYVARsAOJ0Yao6Qg167Vqo9o/7Ye5TqWVaqvdcUn0d+PqNn1eu9v5L3XFv1LCsCNgBwOjHUHCGHtnzN49narVTPslLtvZb2bLK8Hue5Vq1v1a+pepYVARsAOJ0Yao7Qw9roOhpXfbdUPctKtfcoW88xj6v5rH5N1bOsCNgAwOnEUHO0Kri1Wq/n9b5WiX1HqJ5lpdp7lP5c8vMZPa+q3mqj/muqnmVFwAYATieGGvarnmWl2stc9SwrAjYAcDox1LBf9Swr1V7mqmdZEbABgNOJoYb9qmdZqfYyVz3LioANAJxODDXsVz3LSrWXuepZVgRsAOB0Yqhhv+pZVqq9zFXPsiJgAwCnE0MN+1XPslLtZa56lhUBGwA4nRhq2K96lpVqL3PVs6wI2AAAsJCADQAACwnYAACwkIANAAALCdgAALCQgA0AAAsJ2AAAsJCADQAACwnYAACwkIANAAALvStgAwAAK3z7/v8AUF1pz9MnfyIAAAAASUVORK5CYII=" alt="新建策略交易"></p> <p>在此窗口中，请选择指定你的帐号类型、资金帐号、主图代码、运行周期。最后记得点击 “确定”。</p> <p>此时，应该可以在中间的策略列表部分看到刚刚选择的策略，其中策略名称就是上一步中选择的策略名称，主图标的、策略周期都是在“新建策略交易”窗口中的设定值，请仔细核对一下。</p> <p>此时请点击“运行模式”下面的按钮，以切换到“实盘”模式，</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAACGCAYAAADkZUw3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA19SURBVHhe7d1LryVVFcBxPoFvYtTEKEFbQYUIiiNNdOJMRyb4fkxM/AAmKipREw0SYoyYOHAgIGAEow7UibxaRIm8BAkiEhIGAsrtbm7TdNNNeddpF2f1umvt2nVO7epbnv/gl9q11tp7V+omtXIe994zHn7k0e6BBx/q7rv/b91d997X3fmXu7o7/nznyq779e+72+/401r23/7Hld26/w/Vrr7xd7tit9y2fy0333rbLF11w2/COMbHvR6X3s/3f+CDC1/80S+7t533HtR4x0VrO/ft795xUXfOzvEt576r23fOBd2b33pBd/a+d3Znven87g1nn9ed8ZIvbXUAALRCowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0tVKjOX78+EKUAwDAGqXR6HnEzuurtfw8AMA8jdpoSjUAgHl5/GC3MDTnDWo02jyGiNYBAMxD1FCGNBnBKxoAQJFtLEObjJjsM5ooV0PnAwBOH20wQ5uMWKvRjNEMxlgDANDWaW80fbL5pTEAYG+wDWaVZrPWlwFKNVFO2Rpf788BAKdP1FiGNpvRvwzgc57PR/VRDAAwrVJDGdJsmjUaG4vqSrFSHAAwL5O9ohkrDgCYl7UbjY49PycztB4AMC9rfRlA1eatmhoAwPyt9IoGAIBaNBoAQFM0GgBAUzQaAEBTNBoAQFM0GgBAUzQaAEBTi0Zz91MvAAAwulMazbETHQAAo6HRAACaotEAAJqi0QAAmqLRAACaotEAAJqi0QAAmqLRAACaotEAAJqi0QAAmqLRAACaotEAAJqi0QAAmqLRAACaotEAAJo6bY3m0f+c6C676Uj3oR8/0+37zsHuzK9uda/5+oHugisOdR/eiUnuH/8+Ec4FAMzH5I1GGsynrz3cvfwr8X9gs1725a1FrcyJ1gIA7H2TNppfPXCse+2lBxYbvuqSre4TP93urrvnaPfIziuX7WNdt3Xkhe6Bfx1fxD5+zfaiRmrllY7EojUBAHvbZI3m+/ufW7xCkX0uvmq7e+jJ/lcpUnPx1duLOS/dmfu9254L6wAAe9ckjeZn9x5bNAp5u+y7Nw9vFjJH5soaslZUAwDYm5o3Gvl8Rd76kvWjJiOvWuQttNf97y01qf3IT7a7ux8/fkqdzNV8689sLrzwwjCe8fVD53ul+UPWrqld9VrXuQ49X2WN2jlSp6L8EH4Ne963/pD9V7nWoXNaXk9NvdT0ieYNEa2paus8O88r5bPcKnMyvr5mvtQM3WcdzRvNZ647vNjgY9ds78o9/NSJ7o3fPNlgPrnTbC6/5bnu8z8/3L1i59XLq792oNv/6POn1MsaUvupaw+fEh+b/QHoD8TL6vU8q8v4ur56z8/P2Dpbb8eerdUaO/ZsrdZktcrP8WyNr7frKJsv1WXsHD/2x0xtnVVTa2tK9ZKrVTvP1kX6atbN18jWWPf6JWf1xW2+JqZsTtf0sno9j+psPhq31LTR/HPnlYd8LiMf6j/29O5XIdIwZF//2csv7j+2iL/vykOnxB/bOrFYS9aUtW1uTNHNL/1wsly0Tk3cH/v4umx+7Xolq6xRe30lpdpVrilj15KxZ+NaF/H5rF7X6uPnRGOvlLOy9bO4Pa81ZI7dYxXRmiqqV7amVG/jviab45XqolztnqU6jfmaqG5sTRuNvt312Z1XNVFe3i6TVy6Hju7e9/zLDy4+k/Hxz11/sjlFb8ONRW++/4H4sa1TUb3l49GcaG5Ul8lq++b1GbqW1FhRTONZLqNzdJ49X0fNWn37Z2uMdZ2yTkk2JxpHstq+eTWG7L2qbI1SXHO+JppTWieKR0q1klM25se2TkX1VlSX1Y6paaORX7yUdW+4L/4A/8ntF7q/P7X7lckzR7vurG8d6F7/jQO7cjf+9eSrHVnb59alNz268Tbm8z7nlXLKrqNHryZfy9f3zff7rFLvx9F5plQnuT59tTav46i+FI/Glq+xVo1FNRmtzeZIvFY0t3Ru432ieUNEa6qozsfsuY9la3g+Z+doLorV1Pu8z3m21urLj6lpo9n37YOLxYe8zXXk+a77wg0nX7Vc8tsju/KyluRkbZ8bS3Tzbczno5w/ekPm9J17teuU4qXaoevYuJ5btj5TqqtdQ0S1NubzpdzY+vaqjXm+pm+O5mvnjRXfC/quTfJKz+3Rj6PzLKb66kvr69gfPYlnuRaaNhr5szKyrrxCifKeNBn98oC8YpFf4vQ1EpO8fFbjc2OJfgA25vP2h5YdvShemmNj2ZrC5+ya2bxsjmfX8rksLjEV1UTnXlRnlXJeVGtjPi/nVlSzDr9+JporSjnL1g1ZT8/lGM2z+Zq4xvpE9TYWsfP7RPP72Ln2GPHzonMfV1HcxqL1NJYdPTtnCpM0mqefrVtXX8nIL3RGTUbspUajP6wsZ486zmRza9l5Q9l5fo1ozWyfbK6Ny9jTnOXjWZ3QnK4X8bVWKR/lsnoZ14rm1/JrWbV1ntbb+UPVrGNzNWM997FaffN07RJfXzr6cencx1UUtzE7X0U5e/T8vNaaNhp96+zBJ/rfOpMaqX3vDw51z+68solqxJRvnWU/rOxcjhlbb+dEsSinSjkh+T7RnL65Ub03JJ7VqiFzNN6X13Ekqo3qbY0eI6WcVVuXGTq/r17yfaJ5qpT3OXuejUuxjF/Ly2ojWb09Rvrm2KPXV5edyzFj60+Hpo1G/jKzrJt9GcCSOhHlrJZfBlD+h+N/ULXnPm6tkrNxGUd1viaLWVHM8vmsvi8ux0w2J4rZXDa2amqUz0dz5RjFs/NSPKutNWS+rZVx3/XoOIpFovpMac2+8z6ltb2heTlXNm/r7FjPo7roXGM23jcnO/dxS3Kl/NiaNpq+rzdbUieinDXV15ujcRYr1UfzNW75nD/3MZvLznUcxfy5j5dktbXxmj0lZ/m4Pfe5iNb08bX2XMd9NX2yuauomR/ta3PZuY6jmCUxH49iNheNS7FaOtcfM5Lv4+tLRz8ekotifXl/Xsr5eJZroWmjkb/KXPqFzaHkFzblcx9ZU9aOasYU/dBKMZ9TNm/rIzbfV6t8fQ07z66T8XX+PKqzeT36GhvTsa/xbH0U9/rWE1KjfNzmbdzSeB+/hs31sfv1sfV+Hc/X17D1di3P15TGvnYoP9eu6WVzvFI+yvn1fW6deLS2jfmcyuJTatpohP72v/zZ/yivpEZEOSVrSE3rP0EDABhP80Zj/6im/C2zqEZIXkQ5IXMlP8Uf1QQAjKd5oxHX33P0xX8TcOXtwz9b+eHOHP03AbJWVAMA2JsmaTTC/uOzj15d/4/P9C82S5O54tZ2XwAAALQxWaMR/l85y7fR5OvK8sH+4WPdgowlJjmpkVp5u+zau3klAwBzNGmjEfL5inyYr69uSqRGavlMBgDma/JGo6R5XHbTkcUvdcpv+b9y59WLkLHEJCf/GC2aCwCYj9PWaAAAm4FGAwBoikYDAGiKRgMAaIpGAwBoikYDAGiKRgMAaIpGAwBoikYDAGiKRgMAaIpGAwBoikYDAGiKRgMAaIpGA8zMmZc+gYLonkXkmYdcdM9WRaMBZiZ6uGIpumeRsR+m/09oNMCGix6uWIruWYRGk6PRABsuerhiKbpnERpNjkYDbLjo4Yql6J5FaDQ5Gg2w4aKHK5aiexah0eRoNMCGix6uWIruWYRGk6PRABsuerhiKbpnERpNjkYDbLjo4TqF2r1P5zUKe69K5tRopr5WGg2w4aKH65iy/bJ4pC/fkr/OTOuHt6wfiWqVzdeMWxl7DxoNMDPRw7UFu5ff1+dq2TVaifaNTP3A1rEcLc37Ojv2x9bG3odGA8xM9HBtIdvLx2uvaaprl31qTPHQtntE49prmOJarbH3o9EAMxM9XMfm9/HXoGzNXhFdZ2SKh7fsYdm4PfqxnmdsXQtj70GjAWYmeriOze/njz5WS+e2FO0bmfqBHY39NWT1VhYf09h70GiAmYkermOy+9hjxM6zSrnW/DVmpnpgWzZujxE7z4vqxzT2HjQaYGaih+vYdJ/s6Md9uSnJ3jWmfmBH49I1ZLnSnLGMvQeNBpiZ6OE6Nt3HHiPRnKze1rYU7R2Z+oEtY3+uY0vjWh/xc8Y29h40GmBmoofr2Px+/ujHfbkpyd41Wj+wZX3P5+25j0X5UnxMY+9BowFmJnq4jk33yY7ZOKqbmuxdY4oHtmX303EUy8774mMaew8aDTAz0cO1pWhPey0+r7mIrWsl2jcyxQPb0v38vtl1RHGJZfVjGnsPGg0wM9HDFUvRPYtM8cCeKxoNsOGihyuWonsWodHkaDTAhoserliK7lmERpOj0QAbLnq4Yim6ZxEaTY5GA2y46OGKpeieRWg0ORoNsOGihyuWonsWodHkaDTAhoserliK7lmERpOj0QAbLnq4Yim6ZxEaTY5GA2y46OGKpeieReSZh1x0z1ZFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANEWjAQA0RaMBADRFowEANLWr0QAAMLYXGw0AAG1sdf8FcEIGaAyMU64AAAAASUVORK5CYII=" alt="确定运行策略"></p> <p>在弹出的“提示”窗口中，点击“确定”</p> <p><img src="/xuntou_yao/assets/img/xtqmt07.02a6563a.png" alt="核对策略名称"></p> <p>然后，请点击 “操作”下面的 三角符号，该策略即开始运行。在下面的“成交”标签页中，如果看到了实际成交的股标，即表示该帐号已经通畅可用。</p> <p>如果下单失败，可能需要 <u>管理端  开放权限，这需要与券商 以及 讯投软件商 联系</u>。</p> <hr> <p>迅投 QMT 系统提供了一系列的 Python 下单函数接口，本节将详细一一介绍。</p> <p>一个策略模型在下单交易时，通常是如下的流程：
（1）下单之前，首先会查询一下资金账号的信息，如：判定资金是否充足，账号是否在登录状态，统计持仓情况等等。 通常会用到 get_trade_detail_data() 函数，用到 account 参数；
（2）第二步通常是设置一个股票列表（蓝子）。也就是想要观察的交易品种。迅投QMT一次大概只能观察300个以内的交易品种，因此没必要那么贪心，一上来就要全市场、全品种，那......通常会用到获取某一板块的股票列标，或”我的自选“中的品种。ContextInfo.get_stock_list_in_sector('我的自选')
（3）确定了想要观察的品种之后，在 init() 中即可准备好历史数据，用 ContextInfo.get_market_data_ex() 即可，根据需要获取到 &quot;high&quot;,&quot;open&quot;,&quot;low&quot;,&quot;close&quot; 等K线数据。如果需要用到不同时间周期的数据，也可以一并准备好，并考虑数据对齐。同时，获取到K线数据后，即可计算出需要用的到的指标，如均线、RSI等。
（4）在实时行情中，策略模型中要求的条件达到（满足）了，可用下单函数，如： passorder() 等方法执行交易指令；当然，在下单前最好事先检查一下是否已经下了委托单order ，这里又要用到  get_trade_detail_data() 函数，用到 order 参数；
（5） 检查 委托单 的状态，以便判断各种情况等。通常用 get_value_by_order_id()函数。当一个 委托单 的状态变成 “已成”后，那么就会生成一条对应的成交单（deal）；用原 委托号 就可直接查看成交情况。委托单 和 成交单 的 Id号是一样的，都是对象 m_strOrderSysID 的属性值。可根据 Position 持仓信息进一步验证。
（6）根据 委托号 获取 委托信息，根据委托状态，或模型条件的要求，用 cancel 取消委托。</p> <hr> <p>注：在回测模式中，交易函数调用虚拟账号进行交易，在历史 K 线上记录买卖点，用以计算策略净值/回测指标；实盘运行调用策略中设置的资金账号进行交易，产生实际委托；模拟运行模式下交易函数无效。其中，can_cancel_order, cancel_task, cancel和do_order交易函数在回测模式中无实际意义，不建议使用。</p> <ol><li>交易函数</li></ol> <table><thead><tr><th>序号</th> <th>函数（方法）名称</th> <th>表达意义</th> <th></th></tr></thead> <tbody><tr><td>1</td> <td>passorder</td> <td>综合交易下单</td> <td></td></tr> <tr><td>2</td> <td>algo_passorder</td> <td>算法交易下单</td> <td></td></tr> <tr><td>3</td> <td>smart_algo_passorder</td> <td>智能算法交易</td> <td></td></tr> <tr><td>5</td> <td>get_value_by_order_id</td> <td>根据委托Id取委托或成交信息</td> <td></td></tr> <tr><td>6</td> <td>get_last_order_id</td> <td>获取最新的委托或成交的委托Id</td> <td></td></tr> <tr><td>7</td> <td>can_cancel_order</td> <td>查询委托是否可撤销</td> <td></td></tr> <tr><td>8</td> <td>cancel</td> <td>取消委托</td> <td></td></tr> <tr><td>9</td> <td>cancel_task</td> <td>撤销任务</td> <td></td></tr> <tr><td>10</td> <td>pause_task</td> <td>暂停任务</td> <td></td></tr> <tr><td>11</td> <td>resume_task</td> <td>继续任务</td> <td></td></tr> <tr><td>12</td> <td>do_order</td> <td>实时触发前一根 bar 信号函数</td> <td></td></tr></tbody></table> <ol start="2"><li>股票下单函数</li></ol> <table><thead><tr><th>序号</th> <th>函数（方法）名称</th> <th>表达意义</th> <th></th></tr></thead> <tbody><tr><td>1</td> <td>order_lots</td> <td>指定手数交易</td> <td></td></tr> <tr><td>2</td> <td>order_value</td> <td>指定价值交易</td> <td></td></tr> <tr><td>3</td> <td>order_percent</td> <td>一定比例下单</td> <td></td></tr> <tr><td>4</td> <td>order_target_value</td> <td>目标价值下单</td> <td></td></tr> <tr><td>5</td> <td>order_target_percent</td> <td>目标比例下单</td> <td></td></tr> <tr><td>6</td> <td>order_shares</td> <td>指定股数交易</td> <td></td></tr></tbody></table> <ol start="3"><li>期货下单函数</li></ol> <table><thead><tr><th>序号</th> <th>函数（方法）名称</th> <th>表达意义</th> <th></th></tr></thead> <tbody><tr><td>1</td> <td>buy_open</td> <td>买入开仓</td> <td></td></tr> <tr><td>2</td> <td>sell_close_tdayfirst</td> <td>卖出平仓，平今优先</td> <td></td></tr> <tr><td>3</td> <td>sell_close_ydayfirst</td> <td>卖出平仓，平昨优先</td> <td></td></tr> <tr><td>4</td> <td>sell_open</td> <td>卖出开仓</td> <td></td></tr> <tr><td>5</td> <td>buy_close_tdayfirst</td> <td>买入平仓，平今优先</td> <td></td></tr> <tr><td>6</td> <td>buy_close_ydayfirst</td> <td>买入平仓，平昨优先</td> <td></td></tr></tbody></table> <h3 id="_4-01-综合交易下单passorder"><a href="#_4-01-综合交易下单passorder" class="header-anchor">#</a> 4.01  综合交易下单<br>passorder()</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这是唯一必须要理解的下单函数。别的方法（函数）如果不理解也罢了，这个必须掌握。</p></div> <p>功能： 综合交易下单。注意：对 账号组 的操作相当于对账号组里的每个账号做同样的操作，如</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">1202</span><span class="token punctuation">,</span> <span class="token string">'testS'</span><span class="token punctuation">,</span> <span class="token string">'000001.SZ'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span>
<span class="token comment"># 对账号组 testS 里的所有账号都以最新价开仓买入 50000 元市值的 000001.SZ 平安银行 </span>

passorder<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">1101</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span><span class="token string">'510050.SH'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
<span class="token comment"># 对账号组 test 申购1个单位(900000股)的华夏上证50ETF(只申购不买入成分股)。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>语法：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code> passorder<span class="token punctuation">(</span>
           opType<span class="token punctuation">,</span>        <span class="token comment"># 操作动作。如 23 表示买入A股品种，24 表示卖出A股品种</span>
           orderType<span class="token punctuation">,</span>     <span class="token comment"># 下单方式。如 1101 表示 单股、单账号、普通、股/手方式下单</span>
           accountid<span class="token punctuation">,</span>     <span class="token comment"># 下单的账号ID</span>
           orderCode<span class="token punctuation">,</span>     <span class="token comment"># 交易品种代码</span>
           prType<span class="token punctuation">,</span>        <span class="token comment"># 下单时选择的价格。</span>
           price<span class="token punctuation">,</span>         <span class="token comment"># 下单价格</span>
           volume<span class="token punctuation">,</span>        <span class="token comment"># 交易量(手数)</span>
           <span class="token punctuation">[</span>strategyName<span class="token punctuation">,</span> <span class="token comment"># 策略名称，可省缺</span>
            quickTrade<span class="token punctuation">,</span>   <span class="token comment"># 即时下单，可省缺</span>
            userOrderId<span class="token punctuation">,</span>  <span class="token comment"># 用户自设委托 ID， 可省缺</span>
           <span class="token punctuation">]</span> 
           ContextInfo    <span class="token comment"># 必须对象参数</span>
          <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>参数：</p> <ol><li>optype 操作动作：</li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>用于期货六键</td> <td></td> <td></td></tr> <tr><td>0</td> <td>开多</td> <td></td></tr> <tr><td>1</td> <td>平昨多</td> <td></td></tr> <tr><td>2</td> <td>平今多</td> <td></td></tr> <tr><td>3</td> <td>平开空</td> <td></td></tr> <tr><td>4</td> <td>平昨空</td> <td></td></tr> <tr><td>5</td> <td>平今空</td> <td></td></tr> <tr><td>用于期货四键</td> <td></td> <td></td></tr> <tr><td>6</td> <td>平多，优先平今</td> <td></td></tr> <tr><td>7</td> <td>平多，优先平昨</td> <td></td></tr> <tr><td>8</td> <td>平空，优先平今</td> <td></td></tr> <tr><td>9</td> <td>平空，优先平昨</td> <td></td></tr> <tr><td>用于期货两键</td> <td></td> <td></td></tr> <tr><td>10</td> <td>卖出，如有多仓，优先平仓，优先平今，如有余量，再开空</td> <td></td></tr> <tr><td>11</td> <td>卖出，如有多仓，优先平仓，优先平昨，如有余量，再开空</td> <td></td></tr> <tr><td>12</td> <td>买入，如有空仓，优先平仓，优先平今，如有余量，再开多</td> <td></td></tr> <tr><td>13</td> <td>买入，如有空仓，优先平仓，优先平昨，如有余量，再开多</td> <td></td></tr> <tr><td>14</td> <td>买入，不优先平仓</td> <td></td></tr> <tr><td>15</td> <td>卖出，不优先平仓</td> <td></td></tr> <tr><td>股票买卖</td> <td></td> <td></td></tr> <tr><td>23</td> <td>买入A股，沪港通、深港通 的股票</td> <td></td></tr> <tr><td>24</td> <td>卖出A股，沪港通、深港通 的股票</td> <td></td></tr> <tr><td>融资融券</td> <td></td> <td></td></tr> <tr><td>27</td> <td>融资买入</td> <td></td></tr> <tr><td>28</td> <td>融券卖出</td> <td></td></tr> <tr><td>29</td> <td>买券还券</td> <td></td></tr> <tr><td>30</td> <td>直接还券</td> <td></td></tr> <tr><td>31</td> <td>卖券还款</td> <td></td></tr> <tr><td>32</td> <td>直接还款</td> <td></td></tr> <tr><td>33</td> <td>信用帐号股票买入</td> <td></td></tr> <tr><td>34</td> <td>信用帐号股票卖出</td> <td></td></tr> <tr><td>组合交易</td> <td></td> <td></td></tr> <tr><td>25</td> <td>组合买入，或沪港通、深港通的组合买入</td> <td></td></tr> <tr><td>26</td> <td>组合卖出，或沪港通、深港通的组合卖出</td> <td></td></tr> <tr><td>27</td> <td>融资买入</td> <td></td></tr> <tr><td>28</td> <td>融券卖出</td> <td></td></tr> <tr><td>29</td> <td>买券还券</td> <td></td></tr> <tr><td>31</td> <td>卖券还款</td> <td></td></tr> <tr><td>33</td> <td>信用账号股票买入</td> <td></td></tr> <tr><td>34</td> <td>信用账号股票卖出</td> <td></td></tr> <tr><td>35</td> <td>普通账号一键买卖</td> <td></td></tr> <tr><td>36</td> <td>信用账号一键买卖</td> <td></td></tr> <tr><td>40</td> <td>期货组合开多</td> <td></td></tr> <tr><td>43</td> <td>期货组合开空</td> <td></td></tr> <tr><td>46</td> <td>期货组合平多,优先平今</td> <td></td></tr> <tr><td>47</td> <td>期货组合平多,优先平昨</td> <td></td></tr> <tr><td>48</td> <td>期货组合平空,优先平今</td> <td></td></tr> <tr><td>49</td> <td>期货组合平空,优先平昨</td> <td></td></tr> <tr><td>期权交易</td> <td></td> <td></td></tr> <tr><td>50</td> <td>买入开仓</td> <td></td></tr> <tr><td>51</td> <td>卖出平仓</td> <td></td></tr> <tr><td>52</td> <td>卖出开仓</td> <td></td></tr> <tr><td>53</td> <td>买入平仓</td> <td></td></tr> <tr><td>54</td> <td>备兑开仓</td> <td></td></tr> <tr><td>55</td> <td>备兑平仓</td> <td></td></tr> <tr><td>56</td> <td>认购行权</td> <td></td></tr> <tr><td>57</td> <td>认沽行权</td> <td></td></tr> <tr><td>58</td> <td>证券锁定</td> <td></td></tr> <tr><td>59</td> <td>证券解锁</td> <td></td></tr> <tr><td>ETF交易</td> <td></td> <td></td></tr> <tr><td>60</td> <td>申购</td> <td></td></tr> <tr><td>61</td> <td>赎回</td> <td></td></tr> <tr><td>专项两融</td> <td></td> <td></td></tr> <tr><td>70</td> <td>专项融资买入</td> <td></td></tr> <tr><td>71</td> <td>专项融券卖出</td> <td></td></tr> <tr><td>72</td> <td>专项买券还券</td> <td></td></tr> <tr><td>73</td> <td>专项直接还券</td> <td></td></tr> <tr><td>74</td> <td>专项卖券还款</td> <td></td></tr> <tr><td>75</td> <td>专项直接还款</td> <td></td></tr> <tr><td>可转债</td> <td></td> <td></td></tr> <tr><td>80</td> <td>普通账户转股</td> <td></td></tr> <tr><td>81</td> <td>普通账户回售</td> <td></td></tr> <tr><td>82</td> <td>信用账户转股</td> <td></td></tr> <tr><td>83</td> <td>信用账户回售</td> <td></td></tr></tbody></table> <ol start="2"><li>orderType，下单方式</li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>1101</td> <td>单股、单账号、普通、股/手方式下单</td> <td></td></tr> <tr><td>1102</td> <td>单股、单账号、普通、金额（元）方式下单</td> <td>（只支持股票，不支持期货）</td></tr> <tr><td>1113</td> <td>单股、单账号、总资产、比例 [0 ~ 1] 方式下单</td> <td></td></tr> <tr><td>1123</td> <td>单股、单账号、可用、比例[0 ~ 1]方式下单</td> <td></td></tr> <tr><td>1201</td> <td>单股、账号组（无权重）、普通、股/手方式下单</td> <td></td></tr> <tr><td>1202</td> <td>单股、账号组（无权重）、普通、金额（元）方式下单</td> <td>（只支持股票，不支持期货）</td></tr> <tr><td>1213</td> <td>单股、账号组（无权重）、总资产、比例 [0 ~ 1] 方式下单</td> <td></td></tr> <tr><td>1223</td> <td>单股、账号组（无权重）、可用、比例 [0 ~ 1] 方式下单</td> <td></td></tr> <tr><td>2101</td> <td>组合、单账号、普通、按组合股票数量（篮子中股票设定的数量）方式下单 &gt; 对应  volume 的单位为篮子的份</td> <td></td></tr> <tr><td>2102</td> <td>组合、单账号、普通、按组合股票权重（篮子中股票设定的权重）方式下单 &gt; 对应   volume 的单位为元</td> <td></td></tr> <tr><td>2103</td> <td>组合、单账号、普通、按账号可用方式下单 &gt; （底层篮子股票的分配方式是按可用资金比例后按篮子中股票权重分配，如用户没填权重则按相等权重分配）</td> <td>只对股票篮子支持</td></tr> <tr><td>2201</td> <td>组合、账号组（无权重）、普通、按组合股票数量方式下单</td> <td></td></tr> <tr><td>2202</td> <td>组合、账号组（无权重）、普通、按组合股票权重方式下单</td> <td></td></tr> <tr><td>2203</td> <td>组合、账号组（无权重）、普通、按账号可用方式下单只对股票篮子支持</td> <td></td></tr> <tr><td>2331</td> <td>组合、套利、合约价值自动套利、按组合股票数量方式下单</td> <td>对应组合套利交易接口特殊设置</td></tr> <tr><td>2332</td> <td>组合、套利、按合约价值自动套利、按组合股票权重方式下单</td> <td>对应组合套利交易接口特殊设置</td></tr> <tr><td>2333</td> <td>组合、套利、按合约价值自动套利、按账号可用方式下单</td> <td>对应组合套利交易接口特殊设置</td></tr></tbody></table> <ol start="3"><li>accountID</li></ol> <p>下单的账号ID。（可以写多个帐号 或 账号组的名称 或 套利组的名称（一个篮子一个套利账号，如 accountID = '股票账户名, 期货账号'）</p> <ol start="4"><li><p>orderCode，交易的品种代码<br>
a、如果是单独一个 股票 或 期货、港股 品种，此处直接填写品种合约代码即可；<br>
b、如果是组合交易，此处填写篮子名称；<br>
c、如果是组合套利，则填一个篮子名和一个期货合约名（如orderCode = '篮子名, 期货合约名'）<br></p></li> <li><p>prType，下单时选择的价格。在套利交易中，这个 prType 只对篮子起作用，期货的采用默认的方式：</p></li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>-1</td> <td>无效</td> <td>实际下单时,取交易面板上的交易函数设定的选价类型为准</td></tr> <tr><td>0</td> <td>卖5价</td> <td></td></tr> <tr><td>1</td> <td>卖4价</td> <td></td></tr> <tr><td>2</td> <td>卖3价</td> <td></td></tr> <tr><td>3</td> <td>卖2价</td> <td></td></tr> <tr><td>4</td> <td>卖1价</td> <td></td></tr> <tr><td>5</td> <td>最新价</td> <td></td></tr> <tr><td>6</td> <td>买1价</td> <td></td></tr> <tr><td>7</td> <td>买2价</td> <td>组合不支持</td></tr> <tr><td>8</td> <td>买3价</td> <td>组合不支持</td></tr> <tr><td>9</td> <td>买4价</td> <td>组合不支持</td></tr> <tr><td>10</td> <td>买5价</td> <td>组合不支持</td></tr> <tr><td>11</td> <td>指定价模型价</td> <td>只对单股情况支持,对组合交易不支持</td></tr> <tr><td>12</td> <td>涨跌停价</td> <td></td></tr> <tr><td>13</td> <td>挂单价</td> <td></td></tr> <tr><td>14</td> <td>对手价</td> <td></td></tr> <tr><td>27</td> <td>市价即成剩撤</td> <td>仅对股票期权申报有效</td></tr> <tr><td>28</td> <td>市价即全成否则撤</td> <td>仅对股票期权申报有效</td></tr> <tr><td>29</td> <td>市价剩转限价</td> <td>仅对股票期权申报有效</td></tr> <tr><td>42</td> <td>最优五档即时成交剩余撤销申报</td> <td>仅对上交所申报有效</td></tr> <tr><td>43</td> <td>最优五档即时成交剩转限价申报</td> <td>仅对上交所申报有效</td></tr> <tr><td>44</td> <td>对手方最优价格委托</td> <td>仅对深交所申报有效</td></tr> <tr><td>45</td> <td>本方最优价格委托</td> <td>仅对深交所申报有效</td></tr> <tr><td>46</td> <td>即时成交剩余撤销委托</td> <td>仅对深交所申报有效</td></tr> <tr><td>47</td> <td>最优五档即时成交剩余撤销委托</td> <td>仅对深交所申报有效</td></tr> <tr><td>48</td> <td>全额成交或撤销委托</td> <td>仅对深交所申报有效</td></tr> <tr><td>49</td> <td>科创板盘后定价</td> <td></td></tr></tbody></table> <ol start="6"><li><p>price，下单价格。单股下单时， prType 参数为 11，49 时，此参数才有效，其它情况无效。如果 prType 参数不为 11，49 时，此参数也需要填写，可随意写任意数值，如 -1，0，2，100 等；组合下单时，是组合套利时，price 作套利比例有效，其它情况无效。</p></li> <li><p>volume，下单数量（股 / 手 / 元 / %），即交易量。根据参数  orderType 的值，最后一位确定 volume 的单位：</p></li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>单股下单时</td> <td></td> <td></td></tr> <tr><td>1</td> <td>股 / 手</td> <td></td></tr> <tr><td>2</td> <td>金额（元）</td> <td></td></tr> <tr><td>3</td> <td>比例（%）</td> <td></td></tr> <tr><td>组合下单时</td> <td></td> <td></td></tr> <tr><td>1</td> <td>按组合股票数量（份）</td> <td></td></tr> <tr><td>2</td> <td>按组合股票权重（元）</td> <td></td></tr> <tr><td>3</td> <td>按账号可用（%）</td> <td></td></tr></tbody></table> <ol start="8"><li><p>strategyName，字型串型（String），自定义的策略名，用来区分 order 委托和 deal 成交来自不同的策略。根据策略名，get_trade_detail_data，get_last_order_id 方法（函数）可以获取对应的策略名称，对应的委托或持仓结果。此参数可缺省。此参数 strategyName 只对同账号本地客户端有效，即只对当前客户端下的单进行策略区分，且该策略区分只能当前客户端使用。</p></li> <li><p>quickTrade，整数型（Int）表示是否立即触发下单。 0表示 否 ；1表示 是。passorder 执行时是对最后一根K线完全走完后，在下一根K线的第一个tick时触发下单交易；当此参数 quickTrade 设置为1时，非历史 bar上执行时（ContextInfo.is_last_bar()为True），只要策略模型中调用到就触发下单交易。当此参数 quickTrade 设置为 2 时，不判断 bar （K线）状态，只要在策略模型中调用到就触发下单交易，历史的 bar上也能触发下单，<u>因此，在实盘运用时，可能会触 发重复下单，</u>请谨慎使用。</p></li> <li><p>userOrderId，整数型（String）用户自设委托 ID，可缺省不写。此参数必须必须和前面的 strategyName 和 quickTrade 参数一起使用。对应 order 委托对象和 deal 成交对象中的 m_strRemark 属性，通过 get_trade_detail_data 函数 或 委托主推函数 order_callback  和 成交主推函数 deal_callback 可以获取到 这两个对象信息。</p></li> <li><p>userOrderParam，字符串（String），用户自定义交易参数模板名称，可缺省。如果要使用，则必须必须与前面 的 strategyName 和 quickTrade 参数一起使用。</p></li></ol> <p>返回：无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 单股单账号期货最新价买入 10 手</span>
	passorder<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1101</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span>

	<span class="token comment"># 单股单账号期货指定价买入 10 手</span>
	passorder<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1101</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span>

	<span class="token comment"># 单股单账号股票最新价买入 100 股（1 手）</span>
	passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">1101</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
	
    <span class="token comment"># 单股单账号股票指定价买入 100 股（1 手）</span>
	passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">1101</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-02-智能算法交易smart-algo-passorder"><a href="#_4-02-智能算法交易smart-algo-passorder" class="header-anchor">#</a> 4.02  智能算法交易<br>smart_algo_passorder()</h3> <p>功能： 智能算法交易</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>smart_algo_passorder(
                     opType,
                     orderType,
                     accountid,
                     orderCode,
                     prType,
                     modelprice,
                     volume,
                     strageName,
                     quickTrade,
                     userid,
                     smartAlgoType,
                     limitOverRate,
                     minAmountPerOrder,
                     [targetPriceLevel,startTime,endTime,limitControl],
                     ContextInfo
                    )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>参数：</p> <ol><li>opType 表示操作类型</li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>股票买卖</td> <td></td> <td></td></tr> <tr><td>23</td> <td>A股 或 沪港通、深港通 股票买入</td> <td></td></tr> <tr><td>24</td> <td>A股 或 沪港通、深港通 股票卖出</td> <td></td></tr> <tr><td>融资融券</td> <td></td> <td></td></tr> <tr><td>27</td> <td>融资买入</td> <td></td></tr> <tr><td>28</td> <td>融券卖出</td> <td></td></tr> <tr><td>29</td> <td>买券还券</td> <td></td></tr> <tr><td>30</td> <td>直接还券</td> <td></td></tr> <tr><td>31</td> <td>卖券还款</td> <td></td></tr> <tr><td>32</td> <td>直接还款</td> <td></td></tr> <tr><td>33</td> <td>信用账号股票买入</td> <td></td></tr> <tr><td>34</td> <td>信用账号股票卖出</td> <td></td></tr> <tr><td>35</td> <td>普通账号一键买卖</td> <td></td></tr> <tr><td>36</td> <td>信用账号一键买卖</td> <td></td></tr></tbody></table> <ol start="2"><li>orderType 表示下单方式</li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>1101</td> <td>单股、单账号、普通、股/手方式下单</td> <td></td></tr> <tr><td>1102</td> <td>单股、单账号、普通、金额（元）方式下单</td> <td>只支持股票</td></tr> <tr><td>1113</td> <td>单股、单账号、总资产、比例 [0 ~ 1] 方式下单</td> <td></td></tr> <tr><td>1123</td> <td>单股、单账号、可用、比例[0 ~ 1]方式下单</td> <td></td></tr> <tr><td>1201</td> <td>单股、账号组（无权重）、普通、股/手方式下单</td> <td></td></tr> <tr><td>1202</td> <td>单股、账号组（无权重）、普通、金额（元）方式下单</td> <td>只支持股票</td></tr> <tr><td>1213</td> <td>单股、账号组（无权重）、总资产、比例 [0 ~ 1] 方式下单</td> <td></td></tr> <tr><td>1223</td> <td>单股、账号组（无权重）、可用、比例 [0 ~ 1] 方式下单</td> <td></td></tr></tbody></table> <ol start="3"><li><p>accountID 资金账号，下单的账号ID（可多个）或 账号组的名称 或 套利组名称（一个篮子一个套利账号,如accountID=’股票
账户名,期货账号’）</p></li> <li><p>orderCode，下单的合约品种代码。此此的品种代码有两种，一种是 单股 或 单期货、港股,此参数填写合约代码即可，如 ‘600000.SH’；如果是组合交易,则该参数填写篮子名称；如果是组合套利,则填一个篮子名和一个期货合约名（如orderCode=’篮子名,期货合约名’）</p></li> <li><p>prType，下单的价格类型。特殊的情况是对于套利：此参数 prType 只对篮子起作用，期货的采用默认的方式。</p></li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>0</td> <td>卖5价</td> <td></td></tr> <tr><td>1</td> <td>卖4价</td> <td></td></tr> <tr><td>2</td> <td>卖3价</td> <td></td></tr> <tr><td>3</td> <td>卖2价</td> <td></td></tr> <tr><td>4</td> <td>卖1价</td> <td></td></tr> <tr><td>5</td> <td>最新价</td> <td></td></tr> <tr><td>6</td> <td>买1价</td> <td></td></tr> <tr><td>7</td> <td>买2价</td> <td>组合不支持</td></tr> <tr><td>8</td> <td>买3价</td> <td>组合不支持</td></tr> <tr><td>9</td> <td>买4价</td> <td>组合不支持</td></tr> <tr><td>10</td> <td>买5价</td> <td>组合不支持</td></tr> <tr><td>11</td> <td>指定价模型价</td> <td>只对单股情况支持,对组合交易不支持</td></tr> <tr><td>12</td> <td>涨跌停价</td> <td></td></tr> <tr><td>13</td> <td>挂单价</td> <td></td></tr> <tr><td>14</td> <td>对手价</td> <td></td></tr></tbody></table> <ol start="6"><li><p>price，下单价格。仅当参数 prType 为 11 时，即模型价时，此参数 price 才有效；其它情况无效。</p></li> <li><p>volume，下单数量，即交易量（股 / 元 / %）。根据参数 orderType 值的最后一位来确定此参数 volume 的单位：在单股下单时：1：表示股；2：金额（元）；3：表示比例（%）</p></li> <li><p>strageName，策略名称，与方法 passorder 不同，此处不可缺省</p></li> <li><p>quickTrade，整数值（Int），表示是否立马触发下单，0 表示 否，1表示 是</p></li> <li><p>userid，投资备注。与方法 passorder 不同，此处不可缺省</p></li> <li><p>smartAlgoType，字符串型（String），表示 智能算法类型</p></li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>VWAP</td> <td>VWAP</td> <td></td></tr> <tr><td>TWAP</td> <td>TWAP</td> <td></td></tr> <tr><td>VP</td> <td>跟量</td> <td></td></tr> <tr><td>PINLINE</td> <td>跟价</td> <td></td></tr> <tr><td>DMA</td> <td>快捷</td> <td></td></tr> <tr><td>FLOAT</td> <td>盘口</td> <td></td></tr> <tr><td>SWITCH</td> <td>换仓</td> <td></td></tr> <tr><td>ICEBERG</td> <td>冰山</td> <td></td></tr> <tr><td>MOC</td> <td>尾盘</td> <td></td></tr></tbody></table> <ol start="12"><li><p>limitOverRate，整数型（Int）量比，数据范围 0 -100，如果输入其他无效值，则limitOverRate为0。网格算法无此项。</p></li> <li><p>minAmountPerOrder，整数型（Int），智能算法最小委托金额，数据范围 0 -- 100000，默认为0。</p></li> <li><p>targetPriceLevel，智能算法目标价格</p></li></ol> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>1</td> <td>己方盘口1</td> <td></td></tr> <tr><td>2</td> <td>己方盘口2</td> <td></td></tr> <tr><td>3</td> <td>己方盘口3</td> <td></td></tr> <tr><td>4</td> <td>己方盘口4</td> <td></td></tr> <tr><td>5</td> <td>己方盘口5</td> <td></td></tr> <tr><td>6</td> <td>最新价</td> <td></td></tr> <tr><td>7</td> <td>对方盘口</td> <td></td></tr></tbody></table> <p>注：  一、输入无效值则targetPriceLevel为1； 二、本项只针对冰山算法,其他算法可缺省。</p> <ol start="15"><li><p>startTime/endTime，智能算法 开始和结束时间， 格式&quot;HH:MM:SS&quot;，如&quot;10:30:00&quot;。如果缺省值，则默认为&quot;09:30:00&quot;，&quot;15:30:00&quot;</p></li> <li><p>limitControl，涨跌停控制    1：涨停不卖跌停不卖    0：无；    默认值为1</p></li></ol> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 账户600000105 最新价 开仓 买入50000 000001.SZ平安银行,使用TWAP智能算法,量比20%,最小买卖金额0</span>
    smart_algo_passorder<span class="token punctuation">(</span>
                         <span class="token number">23</span><span class="token punctuation">,</span>
                         <span class="token number">1101</span><span class="token punctuation">,</span>
                         <span class="token string">'600000105'</span><span class="token punctuation">,</span>
                         <span class="token string">'000001.SZ'</span><span class="token punctuation">,</span>
                         <span class="token number">5</span><span class="token punctuation">,</span>
                         <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                         <span class="token number">50000</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;strageName&quot;</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;remark&quot;</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;TWAP&quot;</span><span class="token punctuation">,</span>
                         <span class="token number">20</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         ContextInfo
                        <span class="token punctuation">)</span>
    <span class="token comment"># 账户600000105最新价快速交易开仓买入50000股的000001.SZ平安银行,使用TWAP智能算法,量比20%,最小买卖金额0 且有效时长为 09:30-14:00</span>
	smart_algo_passorder<span class="token punctuation">(</span>
                         <span class="token number">23</span><span class="token punctuation">,</span>
                         <span class="token number">1101</span><span class="token punctuation">,</span>
                         <span class="token string">'600000105'</span><span class="token punctuation">,</span>
                         <span class="token string">'000001.SZ'</span><span class="token punctuation">,</span>
                         <span class="token number">5</span><span class="token punctuation">,</span>
                         <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                         <span class="token number">50000</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;strageName&quot;</span><span class="token punctuation">,</span>
                         <span class="token number">1</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;remark&quot;</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;TWAP&quot;</span><span class="token punctuation">,</span>
                         <span class="token number">20</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token string">'09:30:00'</span><span class="token punctuation">,</span>
                         <span class="token string">'14:00:00'</span><span class="token punctuation">,</span>
                         ContextInfo
                        <span class="token punctuation">)</span>
    <span class="token comment"># 账户600000105最新价快速交易开仓买入50000股的000001.SZ平安银行,使用TWAP智能算法,量比20%,最小买卖金额0且有效时长为09:30-14:00,不对智能算法涨停做限制</span>
	smart_algo_passorder<span class="token punctuation">(</span>
                         <span class="token number">23</span><span class="token punctuation">,</span>
                         <span class="token number">1101</span><span class="token punctuation">,</span>
                         <span class="token string">'600000105'</span><span class="token punctuation">,</span>
                         <span class="token string">'000001.SZ'</span><span class="token punctuation">,</span>
                         <span class="token number">5</span><span class="token punctuation">,</span>
                         <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                         <span class="token number">50000</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;strageName&quot;</span><span class="token punctuation">,</span>
                         <span class="token number">1</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;remark&quot;</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;TWAP&quot;</span><span class="token punctuation">,</span>
                         <span class="token number">20</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token string">'09:30:00'</span><span class="token punctuation">,</span>
                         <span class="token string">'14:00:00'</span><span class="token punctuation">,</span>
                         <span class="token number">0</span><span class="token punctuation">,</span>
                         ContextInfo
                        <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="_4-03-根据委托号获取委托或成交信息get-value-by-order-id"><a href="#_4-03-根据委托号获取委托或成交信息get-value-by-order-id" class="header-anchor">#</a> 4.03  根据委托号获取委托或成交信息<br>get_value_by_order_id()</h3> <p>功能： 根据当天的 委托号 获取 委托单 或 成交单 的信息。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> get_value_by_order_id(
                       orderId, 
                       accountID, 
                       strAccountType, 
                       strDatatype
                      )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数：<br>
orderId —— 字符串（String）委托号。<br>
accountID —— 字符串（String）资金账号。<br>
strAccountType —— 字符串型（String）账号类型。<br></p> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>'FUTURE'</td> <td>期货</td> <td></td></tr> <tr><td>'STOCK'</td> <td>股票</td> <td></td></tr> <tr><td>'CREDIT'</td> <td>信用</td> <td></td></tr> <tr><td>'HUGANGTONG'</td> <td>沪港通</td> <td></td></tr> <tr><td>'SHENGANGTONG'</td> <td>深港通</td> <td></td></tr> <tr><td>'STOCK_OPTION'</td> <td>期权</td> <td></td></tr></tbody></table> <p>strDatatype —— 字符串型（String）'ORDER' 表示 委托单 ，'DEAL'表示已成交的单子<br>
返回：一个对象（PythonObj）</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>accid <span class="token operator">=</span> <span class="token string">'6000000248'</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	orderid <span class="token operator">=</span> get_last_order_id<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>orderid<span class="token punctuation">)</span>

    obj <span class="token operator">=</span> get_value_by_order_id<span class="token punctuation">(</span>orderid<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_4-04-获取最新的委托或成交的委托号get-last-order-id"><a href="#_4-04-获取最新的委托或成交的委托号get-last-order-id" class="header-anchor">#</a> 4.04  获取最新的委托或成交的委托号<br>get_last_order_id()</h3> <p>功能： 获取最新的委托或成交的委托号。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>get_last_order_id(
                  accountID, 
                  strAccountType, 
                  strDatatype, 
                  strategyName
                 ) 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数：
accountID —— 字符型（String）资金账号。
strAccountType —— 字符型（String）账号类型。</p> <p>strDatatype —— 字符型（String）'ORDER' 表示 委托单 ，'DEAL'表示已成交的单子<br>
strategyName —— 字符型（String）表达策略名称，对应 passorder 下单函数中的参数strategyName 的值。<br>
返回： 字符型（String）表示委托号，如果没找到返回  '-1'<br>
示例代码见上例</p> <h3 id="_4-05-查询委托是否可撤销can-cancel-order"><a href="#_4-05-查询委托是否可撤销can-cancel-order" class="header-anchor">#</a> 4.05 查询委托是否可撤销<br>can_cancel_order()</h3> <p>功能： 查询指定的委托单是否可撤销。
语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>can_cancel_order(
                 orderId, 
                 accountID, 
                 strAccountType
                )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数：<br>
orderId —— 字符串（String），委托订单号。 <br>
accountID —— 字符串（String）资金账号。<br>
strAccountType —— 字符串（String）账号类型 <br>返回： 布尔值（Bool），True：表示撤销，False：表示不可撤销</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>accid <span class="token operator">=</span> <span class="token string">'6000000248'</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	orderid <span class="token operator">=</span> get_last_order_id<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'order'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;获取到的委托单号为：&quot;</span><span class="token punctuation">,</span>orderid<span class="token punctuation">)</span>
	
    can_cancel <span class="token operator">=</span> can_cancel_order<span class="token punctuation">(</span>orderid<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托单 &quot;</span><span class="token punctuation">,</span>orderid<span class="token punctuation">,</span><span class="token string">' 是否可撤消:'</span><span class="token punctuation">,</span> can_cance
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-06-取消委托-cancel"><a href="#_4-06-取消委托-cancel" class="header-anchor">#</a> 4.06 取消委托<br> cancel()</h3> <p>功能： 取消指定的委托
语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cancel(
       orderId, 
       accountId, 
       accountType, 
       ContextInfo
      ) 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数： <br>
orderId —— 字符串型（String）想要取消的委托订单号。<br>
accountID —— 字符串型（String）资金账号。 <br>
strAccountType —— 字符串型（String）账号类型<br>ContextInfo —— 对象（pythonobj） 默认参数，可缺省</p> <p>返回： 布尔值（Bool）是否发出了取消委托信号， True 表示 是 False表示 否</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>accid <span class="token operator">=</span> <span class="token string">'6000000248'</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	orderid <span class="token operator">=</span> get_last_order_id<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>cancel<span class="token punctuation">(</span>orderid<span class="token punctuation">,</span> ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span> <span class="token string">'stock'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_4-07-取消任务cancel-task"><a href="#_4-07-取消任务cancel-task" class="header-anchor">#</a> 4.07 取消任务<br>cancel_task()</h3> <p>功能： 撤销任务。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cancel_task(
            taskId,
            accountId,
            accountType,
            ContextInfo
           )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数：<br>
taskId —— 字符串型（String）任务编号。如果此参数为空，则表示撤销该资金账号上所有可撤销的任务。 <br>
accountID —— 字符串型（String）资金账号。<br>
strAccountType —— 字符串型（String）账号类型<br>ContextInfo —— 对象（pythonobj） 默认参数，可缺省</p> <p>返回： 布尔值（Bool）是否发出了取消任务信号， True 表示 是 False表示 否<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>accid <span class="token operator">=</span> <span class="token string">'6000000248'</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	objlist <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'task'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> obj_list<span class="token punctuation">:</span>
		cancel_task<span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-08-暂停任务pause-task"><a href="#_4-08-暂停任务pause-task" class="header-anchor">#</a> 4.08 暂停任务<br>pause_task()</h3> <p>功能： 暂停智能算法任务。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>pause_task(
           taskId,
           accountId,
           accountType,
           ContextInfo
          )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数：</p> <p>taskId —— 字符串型（String）任务编号。如果此参数为空，则表示暂停该资金账号上所有可暂停的任务。 <br>
accountID —— 字符串型（String）资金账号。<br>
strAccountType —— 字符串型（String）账号类型<br>ContextInfo —— 对象（pythonobj） 默认参数，可缺省</p> <p>返回： 布尔值（Bool）是否发出了暂停委托信号， True 表示 是 False表示 否</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>accid <span class="token operator">=</span> <span class="token string">'6000000248'</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	objlist <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'task'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> obj_list<span class="token punctuation">:</span>
		pause_task<span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-09-继续任务resume-task"><a href="#_4-09-继续任务resume-task" class="header-anchor">#</a> 4.09 继续任务<br>resume_task()</h3> <p>功能： 继续智能算法任务。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>resume_task(
           taskId,
           accountId,
           accountType,
           ContextInfo
          )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数：</p> <p>taskId —— 字符串型（String）任务编号。如果此参数为空，则表示暂停该资金账号上所有可暂停的任务。 <br>
accountID —— 字符串型（String）资金账号。<br>
strAccountType —— 字符串型（String）账号类型<br>ContextInfo —— 对象（pythonobj） 默认参数，可缺省</p> <p>返回： 布尔值（Bool）是否发出了继续任务的指令， True 表示 是， False表示 否</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ContextInfo<span class="token punctuation">.</span>accid <span class="token operator">=</span> <span class="token string">'6000000248'</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	objlist <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'task'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> obj_list<span class="token punctuation">:</span>
		resume_task<span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-10-实时触发前一根k线信号do-order"><a href="#_4-10-实时触发前一根k线信号do-order" class="header-anchor">#</a> 4.10 实时触发前一根K线信号<br>do_order()</h3> <p>功能： 实时触发前一根 K 线信号函数。 系统实盘中交易下单函数一般是把上一个周期产生的信号在最新的周期的第一个 tick 下单出去，而日 K 线第一个 tick 是在 9:25 分集合竞价结束时产生，如果策略模型在 9:25 分之后跑又想把前一天的下单信号发出去，就可用 do_order 函数配合实现。 特别需要注意的是，有调用 do_order 函数的策略模型跑在 9:25 分之前或别的日内周期下时，原有下单 函数和 do_order 函数都有下单信号，有可能导致重复下单。</p> <p>参数： 无</p> <p>返回： 无
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token comment"># 实现跑日 K 线及以上周期下,在固定时间点把前一周期的交易信号发送出去</span>
<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	order_lots<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	ticktimetag <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_tick_timetag<span class="token punctuation">(</span><span class="token punctuation">)</span>
	int_time <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>timetag_to_datetime<span class="token punctuation">(</span>ticktimetag<span class="token punctuation">,</span> <span class="token string">'%H%M%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token number">100500</span> <span class="token operator">&lt;=</span> int_time <span class="token operator">&lt;</span> <span class="token number">100505</span><span class="token punctuation">:</span>
		do_order<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-11-指定手数交易order-lots"><a href="#_4-11-指定手数交易order-lots" class="header-anchor">#</a> 4.11 指定手数交易<br>order_lots()</h3> <p>功能： 按指定手数进行， 买/卖单交易。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>order_lots(
           stockcode, 
           lots[, 
           style, 
           price], 
           ContextInfo[, 
           accId]
          )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 股票品种代码，字符型（String），如 '000002.SZ'<br>
lots —— 手数，整数型（Int）<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br></p> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>'LATEST'</td> <td>最新价</td> <td>默认值</td></tr> <tr><td>'FIX'</td> <td>指定</td> <td></td></tr> <tr><td>'HANG'</td> <td>挂单</td> <td></td></tr> <tr><td>'COMPETE'</td> <td>对手</td> <td></td></tr> <tr><td>'MARKET'</td> <td>市价</td> <td></td></tr> <tr><td>'SALE5', 'SALE4', 'SALE3', 'SALE2', 'SALE1'</td> <td>卖5-1价</td> <td></td></tr> <tr><td>'BUY1', 'BUY2', 'BUY3', 'BUY4', 'BUY5'</td> <td>买1-5价</td> <td></td></tr></tbody></table> <p>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价下 1 手买入</span>
	order_lots<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	<span class="token comment"># 用对手价下 1 手卖出</span>
	order_lots<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	<span class="token comment"># 用指定价 37.5 下 2 手卖出</span>
	order_lots<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_4-12-指定价值交易order-value"><a href="#_4-12-指定价值交易order-value" class="header-anchor">#</a> 4.12 指定价值交易<br>order_value()</h3> <p>功能： 按指定金额进行， 买/卖单交易。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>order_value(
           stockcode, 
           value[, 
           style, 
           price], 
           ContextInfo[, 
           accId]
          )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 股票品种代码，字符型（String），如 '000002.SZ'<br>
value —— 金额，双精度浮点型（Double）<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价下 10000 元买入</span>
	order_value<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	<span class="token comment"># 用对手价下 10000 元卖出</span>
	order_value<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	<span class="token comment"># 用指定价 37.5 下 20000 元卖出</span>
	order_value<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20000</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span><span class="token string">'60000248'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_4-13-指定比例交易order-percent"><a href="#_4-13-指定比例交易order-percent" class="header-anchor">#</a> 4.13 指定比例交易<br>order_percent()</h3> <p>功能： 指定一个比例值，发送一个等于目前投资组合价值（市场价值和目前现金的总和）一定百分比的买/ 卖单，正数代表买，负数代表卖。股票的股数总是会被调整成对应的一手的股票数的倍数（1 手是 100股）。百分比是一个小数，并且小于或等于1（小于等于100%），0.5 表示的是 50%。需要注意，如果资金不足，将不会发送交易指令。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> order_percent(
               stockcode, 
               percent,
               style,
               price, 
               ContextInfo,
               accId
              )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 股票品种代码，字符型（String），如 '000002.SZ'<br>
percent —— 百分比，双精度浮点型（Double）。1 表示 100%，因此通常设置的数值小于1，如 0.5 表示  50%<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价下 5.1% 价值买入</span>
	order_percent<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">0.051</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	
    <span class="token comment"># 用对手价下 5.1% 价值卖出</span>
	order_percent<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.051</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	
    <span class="token comment"># 用指定价 37.5 下 10.2% 价值卖出</span>
	order_percent<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.102</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_4-14-指定目标价值交易order-target-value"><a href="#_4-14-指定目标价值交易order-target-value" class="header-anchor">#</a> 4.14 指定目标价值交易<br>order_target_value()</h3> <p>功能： 指定目标品种价值，去执行交易 买入/卖出操作，并且自动调整该证券的仓位到一个目标价值。如果还没有任何该证券的仓位，那么会买入全部目标价值的证券；如果已经有了该证券的仓位，则会买入 / 卖出调整该证券的现在仓位和目标仓位的价值差值的数目的证券。需要注意，如果资金不足，将不会发送交易订单。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> order_target_value(
                    stockcode, 
                    tar_value[, 
                    style, 
                    price], 
                    ContextInfo[, 
                    accId]
                   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 股票品种代码，字符型（String），如 '000002.SZ'<br>
tar_value —— 目标价值金额（元），非负数，双精度浮点型（Double）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价下调仓到 10000 元持仓</span>
	order_target_value<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价调仓到 10000 元持仓</span>
	order_target_value<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span><span class="token string">'600000248'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 37.5 下调仓到 20000 元持仓</span>
    order_target_value<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span><span class="token string">'600000248'</span><span class="token punctuation">)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_4-15-指定目标比例交易order-target-percent"><a href="#_4-15-指定目标比例交易order-target-percent" class="header-anchor">#</a> 4.15 指定目标比例交易<br>order_target_percent()</h3> <p>功能：  指定目标比例交易，买入 / 卖出证券以自动调整该证券的仓位到占有一个指定的投资组合的目标百分比。投资组合价值等于所有已有仓位的价值和剩余现金的总和。买 / 卖单会被下舍入一手股数（A股是 100 的倍数）的倍数。目标百分比应该是一个小数，并且最大值应该小于等于1，比如 0.5 表示50%，需要注意，如果资金不足，该API将不会创建发送订单。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> order_target_percent(
                    stockcode, 
                    tar_percent[, 
                    style, 
                    price], 
                    ContextInfo[, 
                    accId]
                   )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 股票品种代码，字符型（String），如 '000002.SZ'<br>
tar_percent —— 目标百分比 [0 ~ 1]，双精度浮点型（Double）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价下买入调仓到 5.1% 持仓</span>
	order_target_percent<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">0.051</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>

	<span class="token comment"># 用对手价调仓到 5.1% 持仓</span>
	order_target_percent<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">0.051</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span><span class="token string">'600000248'</span><span class="token punctuation">)</span>
	<span class="token comment"># 用指定价 37.5 调仓到 10.2% 持仓</span>
	order_target_percent<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">0.102</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span><span class="token string">'600000248'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-16-指定股数交易order-shares"><a href="#_4-16-指定股数交易order-shares" class="header-anchor">#</a> 4.16 指定股数交易<br>order_shares()</h3> <p>功能：指定股票数量，下单交易买 / 卖单，这是最常见的下单方式之一。参数 style 可用于设定交易时的选价类型，默认为最新价 'LATEST'</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>order_shares(
             stockcode, 
             shares[, 
             style, 
             price], 
             ContextInfo[, 
             accId]
            )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 股票品种代码，字符型（String），如 '000002.SZ'<br>
shares —— 想要交易的股票数量，整数型（Int）。为 100 的整数倍<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价下 100 股买入</span>
	order_shares<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>
	
    <span class="token comment"># 用对手价下 100 股卖出</span>
	order_shares<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 37.5 下 200 股卖出</span>
	order_shares<span class="token punctuation">(</span><span class="token string">'000002.SZ'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'600000248'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-17-期货买入开仓buy-open"><a href="#_4-17-期货买入开仓buy-open" class="header-anchor">#</a> 4.17 期货买入开仓<br>buy_open()</h3> <p>功能： 期货买入开仓</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buy_open(
         stockcode, 
         amount[, 
         style, 
         price], 
         ContextInfo[, 
         accId]
        )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 品种代码，字符型（String），如 'IF1805.IF'<br>
amount —— 想要交易的手数，整数型（Int）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br></p> <table><thead><tr><th>参数值</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>'LATEST'</td> <td>最新价</td> <td>默认值</td></tr> <tr><td>'FIX'</td> <td>指定</td> <td></td></tr> <tr><td>'HANG'</td> <td>挂单</td> <td></td></tr> <tr><td>'COMPETE'</td> <td>对手</td> <td></td></tr> <tr><td>'MARKET'</td> <td>市价</td> <td></td></tr> <tr><td>'SALE1'</td> <td>卖1价</td> <td></td></tr> <tr><td>'BUY1'</td> <td>买1价</td> <td></td></tr></tbody></table> <p>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价 1 手买入开仓</span>
	buy_open<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价 1 手买入开仓</span>
	buy_open<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 3750 元 2 手买入开仓</span>
    buy_open<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-18-期货买入平仓-平今优先-buy-close-tdayfirst"><a href="#_4-18-期货买入平仓-平今优先-buy-close-tdayfirst" class="header-anchor">#</a> 4.18 期货买入平仓（平今优先）<br>buy_close_tdayfirst()</h3> <p>功能： 期货买入平仓，平今优先</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buy_close_tdayfirst(
         stockcode, 
         amount[, 
         style, 
         price], 
         ContextInfo[, 
         accId]
        )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 品种代码，字符型（String），如 'IF1805.IF'<br>
amount —— 想要交易的手数，整数型（Int）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价 1 手买入开仓，平今优先</span>
	buy_close_tdayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价 1 手买入开仓，平今优先</span>
	buy_close_tdayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 3750 元 2 手买入开仓，平今优先</span>
    buy_close_tdayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-19-期货买入平仓-平昨优先-buy-close-ydayfirst"><a href="#_4-19-期货买入平仓-平昨优先-buy-close-ydayfirst" class="header-anchor">#</a> 4.19 期货买入平仓（平昨优先）<br>buy_close_ydayfirst()</h3> <p>功能： 期货买入开仓，平昨优先</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buy_close_ydayfirst(
         stockcode, 
         amount[, 
         style, 
         price], 
         ContextInfo[, 
         accId]
        )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 品种代码，字符型（String），如 'IF1805.IF'<br>
amount —— 想要交易的手数，整数型（Int）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo
accId —— 账号，字符型（String）
返回： 无</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价 1 手买入开仓，平昨优先</span>
	buy_close_ydayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价 1 手买入开仓，平昨优先</span>
	buy_close_ydayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 3750 元 2 手买入开仓，平昨优先</span>
    buy_close_ydayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-20-期货卖出开仓sell-open"><a href="#_4-20-期货卖出开仓sell-open" class="header-anchor">#</a> 4.20 期货卖出开仓<br>sell_open()</h3> <p>功能： 期货卖出开仓</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sell_open(
         stockcode, 
         amount[, 
         style, 
         price], 
         ContextInfo[, 
         accId]
        )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 品种代码，字符型（String），如 'IF1805.IF'<br>
amount —— 想要交易的手数，整数型（Int）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价 1 手卖出开仓</span>
	buy_open<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价 1 手卖出开仓</span>
	buy_open<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 3750 元 2 手卖出开仓</span>
    buy_open<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-21-期货卖出平仓-平今优先-sell-close-tdayfirst"><a href="#_4-21-期货卖出平仓-平今优先-sell-close-tdayfirst" class="header-anchor">#</a> 4.21 期货卖出平仓（平今优先）<br>sell_close_tdayfirst()</h3> <p>功能： 期货卖出平仓，平今优先</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sell_close_tdayfirst(
         stockcode, 
         amount[, 
         style, 
         price], 
         ContextInfo[, 
         accId]
        )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 品种代码，字符型（String），如 'IF1805.IF'<br>
amount —— 想要交易的手数，整数型（Int）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价 1 手买入开仓，平今优先</span>
	sell_close_tdayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价 1 手买入开仓，平今优先</span>
	sell_close_tdayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 3750 元 2 手买入开仓，平今优先</span>
    sell_close_tdayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-22-期货卖出平仓-平昨优先-sell-close-ydayfirst"><a href="#_4-22-期货卖出平仓-平昨优先-sell-close-ydayfirst" class="header-anchor">#</a> 4.22 期货卖出平仓（平昨优先）<br>sell_close_ydayfirst()</h3> <p>功能： 期货卖出平仓，平昨优先</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sell_close_tdayfirst(
         stockcode, 
         amount[, 
         style, 
         price], 
         ContextInfo[, 
         accId]
        )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数：<br>
stockcode —— 品种代码，字符型（String），如 'IF1805.IF'<br>
amount —— 想要交易的手数，整数型（Int）。<br>
style —— 下单选价类型，字符串型（String）默认为最新价 'LATEST'<br>price —— 价格，双精度浮点型（Double）<br>
ContextInfo —— Python 对象（PythonObj），这里必须是 ContextInfo<br>
accId —— 账号，字符型（String）<br>
返回： 无</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 按最新价 1 手买入开仓，平昨优先</span>
	sell_close_ydayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用对手价 1 手买入开仓，平昨优先</span>
	sell_close_ydayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'COMPETE'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>

    <span class="token comment"># 用指定价 3750 元 2 手买入开仓，平昨优先</span>
    sell_close_ydayfirst<span class="token punctuation">(</span><span class="token string">'IF1805.IF'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">,</span> <span class="token string">'110476'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-23-已弃用-获取两融负债合约明细-5-24-get-debt-contract"><a href="#_4-23-已弃用-获取两融负债合约明细-5-24-get-debt-contract" class="header-anchor">#</a> 4.23 [已弃用]获取两融负债合约明细<br>（5.24） get_debt_contract()</h3> <p>已弃用</p> <h3 id="_4-24-获取两融担保标的明细get-assure-contract"><a href="#_4-24-获取两融担保标的明细get-assure-contract" class="header-anchor">#</a> 4.24 获取两融担保标的明细<br>get_assure_contract()</h3> <p>功能： 获取信用账户担保合约明细<br>
语法： get_debt_contract(accId)<br>
参数：</p> <p>accId —— 信用账户</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	obj_list <span class="token operator">=</span> get_assure_contract<span class="token punctuation">(</span><span class="token string">'6000000248'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> obj_list<span class="token punctuation">:</span>
		<span class="token comment"># 输出担保合约名</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-25-获取可融券明细-get-enable-short-contract"><a href="#_4-25-获取可融券明细-get-enable-short-contract" class="header-anchor">#</a> 4.25 获取可融券明细<br> get_enable_short_contract()</h3> <p>功能： 获取信用账户当前可融券的明细<br>
语法： get_enable_short_contract(accId)<br>
参数：</p> <p>accId —— 信用账户</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	obj_list <span class="token operator">=</span> get_enable_short_contract<span class="token punctuation">(</span><span class="token string">'6000000248'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> obj_list<span class="token punctuation">:</span>
	<span class="token comment"># 输出可融券合约名</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-26-算法交易下单algo-passorder"><a href="#_4-26-算法交易下单algo-passorder" class="header-anchor">#</a> 4.26 算法交易下单<br>algo_passorder()</h3> <p>功能： 算法交易下单，此时使用交易面板-程序交易-函数交易-函数交易参数中设置的下单类型（普通交 易,算法交易,随机量交易）。 如果函数交易参数使用未修改的默认值，此函数和passorder函数一致。 设置了函数交易参数后，将会使用函数交易参数的超价等拆单参数,如果入参的prType = -1，同 时将会使用函数交易参数的报价方式。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>algo_passorder(
               opType, 
               orderType, 
               accountid, 
               orderCode, 
               prType, 
               modelprice, 
               volume[, 
               strategyName, 
               quickTrade, 
               userOrderId, 
               userOrderParam], 
               ContextInfo
              )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>示例： 可参考 4.02 智能算法交易</p> <h3 id="_4-27-获取股票篮子get-basket"><a href="#_4-27-获取股票篮子get-basket" class="header-anchor">#</a> 4.27 获取股票篮子<br>get_basket()</h3> <p>功能： 获取股票篮子</p> <p>参数：</p> <p>basketName —— 字符串（String）股票篮子名称</p> <p>语法： <code>get_basket(basketName)</code></p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code> <span class="token keyword">print</span><span class="token punctuation">(</span> get_basket<span class="token punctuation">(</span><span class="token string">'basket1'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-28-设置股票篮子set-basket"><a href="#_4-28-设置股票篮子set-basket" class="header-anchor">#</a> 4.28 设置股票篮子<br>set_basket()</h3> <p>功能： 设置passorder的股票篮子,仅用于passorder进行篮子交易,设置成功后,用get_basket可以取出后 即可进行passorder组合交易下单</p> <p>语法： <code>set_basket(basketDict)</code></p> <p>参数：</p> <p>basketDict —— 字典类型（Dict）表示一个股票篮子，格式如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{'name':股票篮子名称, 

 'stocks':[
           {'stock':股票名称,
            'weight':权重,
            'quantity':数量,
            'optType':交易类型
           }
          ]
}  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_4-29-获取未了结负债合约明细get-unclosed-compacts"><a href="#_4-29-获取未了结负债合约明细get-unclosed-compacts" class="header-anchor">#</a> 4.29 获取未了结负债合约明细<br>get_unclosed_compacts()</h3> <p>功能： 获取未了结负债合约明细</p> <p>语法： <code>get_unclosed_compacts(accountID,accountType)</code></p> <p>参数：</p> <p>accountID —— 字符串型（String）表示资金账号</p> <p>accountType —— 字符串型（String）账号类型</p> <p>返回： 一个列表（List）<code>[ CStkUnclosedCompacts, ... ]</code></p> <p>其中 CStkUnclosedCompacts 属性如下：</p> <table><thead><tr><th>属性名称</th> <th>数据类型</th> <th>表示意义</th> <th>备注</th></tr></thead> <tbody><tr><td>m_strAccountID</td> <td>字符串型（String）</td> <td>账号ID</td> <td></td></tr> <tr><td>m_nBrokerType</td> <td>整数型（Int）</td> <td>账号类型</td> <td>1-期货账号,<br>2-股票账号,<br>3-信用账号,<br>5-期货期权账号,<br>6-股票期权账号,<br>7-沪港通账号,<br>11-深港通账号)</td></tr> <tr><td>m_strExchangeID</td> <td>字符串型（String）</td> <td>市场代码</td> <td></td></tr> <tr><td>m_strInstrumentID</td> <td>字符串型（String）</td> <td>证券代码</td> <td></td></tr> <tr><td>m_eCompactType</td> <td>整数型（Int）</td> <td>合约类型</td> <td>32-不限制,48-融资,49-融券</td></tr> <tr><td>m_eCashgroupProp</td> <td>整数型（Int）</td> <td>头寸来源</td> <td>32-不限制,48-普通头寸,49-专项头寸</td></tr> <tr><td>m_nOpenDate</td> <td>整数型（Int）</td> <td>开仓日期</td> <td>如'20201231'</td></tr> <tr><td>m_nBusinessVol</td> <td>整数型（Int）</td> <td>合约证券数量</td> <td></td></tr> <tr><td>m_nRealCompactVol</td> <td>整数型（Int）</td> <td>未还合约数量</td> <td></td></tr> <tr><td>m_nRetEndDate</td> <td>整数型（Int）</td> <td>到期日</td> <td>如'20201231'</td></tr> <tr><td>m_dBusinessBalance</td> <td>浮点型(Float)</td> <td>合约金额</td> <td></td></tr> <tr><td>m_dBusinessFare</td> <td>浮点型(Float)</td> <td>合约息费</td> <td></td></tr> <tr><td>m_dRealCompactBalance</td> <td>浮点型(Float)</td> <td>未还合约金额</td> <td></td></tr> <tr><td>m_dRealCompactFare</td> <td>浮点型(Float)</td> <td>未还合约息费</td> <td></td></tr> <tr><td>m_dRepaidFare</td> <td>浮点型(Float)</td> <td>已还息费</td> <td></td></tr> <tr><td>m_dRepaidBalance</td> <td>浮点型(Float)</td> <td>已还金额</td> <td></td></tr> <tr><td>m_strCompactId</td> <td>整数型（Int）</td> <td>合约编号</td> <td></td></tr> <tr><td>m_strEntrustNo</td> <td>字符串型（String）</td> <td>委托编号</td> <td></td></tr> <tr><td>m_nRepayPriority</td> <td>整数型（Int）</td> <td>偿还优先级</td> <td></td></tr> <tr><td>m_strPositionStr</td> <td>字符串型（String）</td> <td>定位串</td> <td></td></tr> <tr><td>m_eCompactRenewalStatus</td> <td>整数型（Int）</td> <td>合约展期状态</td> <td>48-可申请,<br>49-已申请,<br>50-审批通过,<br>51-审批不通过,<br>52-不可申请,<br>53-已执行,<br>54-已取消</td></tr> <tr><td>m_nDeferTimes</td> <td>整数型（Int）</td> <td>展期次数</td> <td></td></tr></tbody></table> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>get_unclosed_compacts<span class="token punctuation">(</span><span class="token string">'6000000248'</span><span class="token punctuation">,</span> <span class="token string">'CREDIT'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code></code></p> <h3 id="_4-30-获取已了结负债合约明细get-closed-compacts"><a href="#_4-30-获取已了结负债合约明细get-closed-compacts" class="header-anchor">#</a> 4.30 获取已了结负债合约明细<br>get_closed_compacts()</h3> <p>功能： 获取已了结负债合约明细</p> <p>语法： <code>get_closed_compacts(accountID,accountType)</code></p> <p>参数：
accountID —— 字符串型（String）资金账号
accountType —— 字符串型（String），账号类型</p> <p>返回：
一个列表（List）<code>[ CStkUnclosedCompacts, ... ]</code></p> <p>其中 CStkUnclosedCompacts 属性如前 4.29 获取未了结负债合约明细 中的描述一致。</p> <h3 id="_4-31-获取沪深港通汇率数据get-hkt-exchange-rate"><a href="#_4-31-获取沪深港通汇率数据get-hkt-exchange-rate" class="header-anchor">#</a> 4.31 获取沪深港通汇率数据<br>get_hkt_exchange_rate()</h3> <p>功能： 获取沪深港通汇率数据</p> <p>语法： <code>get_hkt_exchange_rate(accountID,accountType)</code></p> <p>参数：
accountID —— 字符串型（String）资金账号
accountType —— 字符串型（String），账号类型。必须填HUGANGTONG或者SHENGANGTONG</p> <p>返回：一个字典（Dict）字段功能：
bidReferenceRate:买入参考汇率
askReferenceRate:卖出参考汇率
dayBuyRiseRate:日间买入参考汇率浮动比例</p> <h3 id="_4-32-取可融券明细get-enable-short-contract"><a href="#_4-32-取可融券明细get-enable-short-contract" class="header-anchor">#</a> 4.32 取可融券明细<br>get_enable_short_contract()</h3> <p>功能： 取可融券明细</p> <p>语法： get_enable_short_contract(accountID)</p> <p>参数：accountID —— 字符串型（String）资金账号</p> <p>返回： 列表（List）,其中是 PythonObj ，通过 dir(pythonobj) 可返回对象的属性列表</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    obj_list <span class="token operator">=</span> get_enable_short_contract<span class="token punctuation">(</span><span class="token string">'6000000248'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> obj_list<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span> obj<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-33-取期权标的持仓get-option-subject-position"><a href="#_4-33-取期权标的持仓get-option-subject-position" class="header-anchor">#</a> 4.33 取期权标的持仓<br>get_option_subject_position()</h3> <p>功能： 取期权标的持仓</p> <p>语法：get_option_subject_position(accountID)</p> <p>accountID —— 字符串型（String）资金账号</p> <p>返回： 列表（List）,其中是 PythonObj ，通过 dir(pythonobj) 可返回对象的属性列表</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span>
	data<span class="token operator">=</span>get_option_subject_position<span class="token punctuation">(</span><span class="token string">'880399990383'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> obj <span class="token keyword">in</span> data<span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">,</span>obj<span class="token punctuation">.</span>m_lockVol<span class="token punctuation">,</span>obj<span class="token punctuation">.</span>m_coveredVol<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-34-取期权组合持仓get-comb-option"><a href="#_4-34-取期权组合持仓get-comb-option" class="header-anchor">#</a> 4.34 取期权组合持仓<br>get_comb_option()</h3> <p>功能： 取期权组合持仓</p> <p>语法： get_comb_option(accountID)</p> <p>参数：
accountID —— 字符串型（String）资金账号</p> <p>返回： 列表（List）,其中是 PythonObj ，通过 dir(pythonobj) 可返回对象的属性列表</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>obj_list<span class="token operator">=</span>get_comb_option<span class="token punctuation">(</span><span class="token string">'880399990383'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>obj_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
forobjinobj_list<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>m_strCombCodeName<span class="token punctuation">,</span>obj<span class="token punctuation">.</span>m_strCombID<span class="token punctuation">,</span>obj<span class="token punctuation">.</span>m_nVolume<span class="token punctuation">,</span>obj<span class="token punctuation">.</span>m_nFrozenVolume<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-35-构建期权组合持仓make-option-combination"><a href="#_4-35-构建期权组合持仓make-option-combination" class="header-anchor">#</a> 4.35 构建期权组合持仓<br>make_option_combination()</h3> <p>功能： 构建期权组合持仓</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>make_option_combination(
                        combType,
                        orderCodeDict,
                        modelVolume,
                        accountID,
                        strategyName,
                        userOrderId,
                        ContextInfo
                       ) 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>参数：<br>
combType —— 组合策略类型 <br>
50:认购牛市价差策略 <br>
51:认沽熊市价差策略 <br>
52:认沽牛市价差策略 <br>
53:认购熊市价差策略 <br>
54:跨式空头 <br>
55:宽跨式空头 <br>
56:保证金开仓转备兑开仓 <br>
57:备兑开仓转保证金开仓 <br></p> <p>orderCodeDict —— 期权组合，{option:holdType}。<br>
option —— 期权代码,格式如 10000001.SHO，<br>
holdType ——  48:权利 ， 49:义务 ， 50:备兑 <br>
modelVolume —— 下单量 <br>
strategyName —— 策略名 <br>
userOrderId —— 投资备注 <br></p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>ContextInfo<span class="token punctuation">.</span>accid<span class="token operator">=</span><span class="token string">'880399990383'</span>
make_option_combination<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span><span class="token string">'10003006.SHO'</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token string">'10003259.SHO'</span><span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'stragegyName'</span><span class="token punctuation">,</span>'<span class="token builtin">str</span>
Remark'<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#第一个参数50为认购牛市价差策略</span>
<span class="token comment">#第二个参数10003006.SHO(50ETF购6月3400),48(权利仓)10003259.SHO(50ETF购6月</span>
<span class="token number">4400</span><span class="token punctuation">)</span><span class="token number">49</span><span class="token punctuation">(</span>义务仓<span class="token punctuation">)</span>
<span class="token comment">#50ETF购6月3400/50ETF购6月4400g构建认购牛市价差策略</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_4-36-解除期权组合持仓release-option-combination"><a href="#_4-36-解除期权组合持仓release-option-combination" class="header-anchor">#</a> 4.36 解除期权组合持仓<br>release_option_combination()</h3> <p>功能： 解除期权组合持仓</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>release_option_combination(
                           combID,
                           accountID,
                           strategyName,
                           userOrderId,
                           contextInfo
                          )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参数：
combID —— 持仓中期权组合编码<br>
accountID —— 字符串型（String）表示账号<br>
strategyName —— 字符串型（String）表示 策略名<br>
userOrderId —— 字符串型（String）投资备注<br></p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>ContextInfo<span class="token punctuation">.</span>accid<span class="token operator">=</span><span class="token string">'880399990383'</span>
release_option_combination<span class="token punctuation">(</span><span class="token string">'V950034404'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>accid<span class="token punctuation">,</span><span class="token string">'strategyName'</span><span class="token punctuation">,</span>'use
rOrderId'<span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
<span class="token comment"># 解除组合号码为V950034404的组合期权(同组合策略持仓中的组合号码)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_5-成交回报实时主推函数"><a href="#_5-成交回报实时主推函数" class="header-anchor">#</a> 5） 成交回报实时主推函数</h2> <p>所谓主推函数，意即无需开发人员在代码中去调用的函数。而是当发生某一事件时，会自动运行的函数。如：成交了一个订单，则QMT会自动调用一次 <code>deal_callback()</code> 函数，执行其中的指令。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注：成交回报实时主推函数仅在实盘运行模式下生效。<br>意即，需要在 “策略交易”界面中，运行一个策略。并且该策略的代码中包含以下主推函数。当对应的事件发生时，才会主动运行一次这个函数，执行其中的指令。在策略编辑器中，是看不到执行效果的。</p></div> <h3 id="_5-1-资金账号变化account-callback"><a href="#_5-1-资金账号变化account-callback" class="header-anchor">#</a> 5.1  资金账号变化<br>account_callback()</h3> <p>功能： 当资金账号状态有变化时，自动运行一次这个函数</p> <p>语法： <code>account_callback(ContextInfo, accountInfo)</code></p> <p>参数：<br></p> <ul><li>ContextInfo —— 特定对象<br></li> <li>accountInfo —— 资金账号对象，可对应查看5.3. 附录3 交易函数内含属性说明<br></li></ul> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:gbk</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置对应的资金账号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'410038216969'</span><span class="token punctuation">)</span>  <span class="token comment"># 此处请替换成你自己的帐号</span>


<span class="token keyword">def</span> <span class="token function">account_callback</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">,</span> accountInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========accountInfo 对象的属性============================================'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;帐号ID&quot;</span><span class="token punctuation">,</span>         accountInfo<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号类型&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_nBrokerType<span class="token punctuation">)</span>       <span class="token comment"># 1- 期货,2-股票,3-信用,5-期货期权,6-股票期权,7-沪港通,11-深港通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;保证金比率&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dMaxMarginRate<span class="token punctuation">)</span>    <span class="token comment"># 股票的保证金率等于 1 因此股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结保证金&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dFrozenMargin<span class="token punctuation">)</span>     <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结金额&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dFrozenCash<span class="token punctuation">)</span>       <span class="token comment"># 内外源冻结保证金和手续费四个的和 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结手续费&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dFrozenCommission<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;风险度&quot;</span><span class="token punctuation">,</span>          accountInfo<span class="token punctuation">.</span>m_dRisk<span class="token punctuation">)</span>             <span class="token comment"># 冻结资金 / 可用资金，股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;单位净值&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dNav<span class="token punctuation">)</span> 
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期初权益&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dPreBalance<span class="token punctuation">)</span>       <span class="token comment"># 期初权益，也叫静态权益 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总资产&quot;</span><span class="token punctuation">,</span>          accountInfo<span class="token punctuation">.</span>m_dBalance<span class="token punctuation">)</span>          <span class="token comment"># 动态权益，即市值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可用金额&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dAvailable<span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;手续费&quot;</span><span class="token punctuation">,</span>          accountInfo<span class="token punctuation">.</span>m_dCommission<span class="token punctuation">)</span>       <span class="token comment"># 已经用掉的手续费</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓盈亏&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dPositionProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>      <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出入金净值&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dCashIn<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前使用的保证金&quot;</span><span class="token punctuation">,</span> accountInfo<span class="token punctuation">.</span>m_dCurrMargin<span class="token punctuation">)</span>       <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;初始权益&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dInitBalance<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号状态&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_strStatus<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期初平仓盈亏&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dInitCloseMoney<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总市值&quot;</span><span class="token punctuation">,</span>          accountInfo<span class="token punctuation">.</span>m_dInstrumentValue<span class="token punctuation">)</span>  <span class="token comment"># 合约价值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;入金&quot;</span><span class="token punctuation">,</span>           accountInfo<span class="token punctuation">.</span>m_dDeposit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;出金&quot;</span><span class="token punctuation">,</span>           accountInfo<span class="token punctuation">.</span>m_dWithdraw<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上次信用额度&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dPreCredit<span class="token punctuation">)</span>         <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上次质押&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dPreMortgage<span class="token punctuation">)</span>      <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;质押&quot;</span><span class="token punctuation">,</span>           accountInfo<span class="token punctuation">.</span>m_dMortgage<span class="token punctuation">)</span>          <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;信用额度&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dCredit<span class="token punctuation">)</span>           <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券初始资金&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dAssetBalance<span class="token punctuation">)</span>      <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;起始日期&quot;</span><span class="token punctuation">,</span>       accountInfo<span class="token punctuation">.</span>m_strOpenDate<span class="token punctuation">)</span>        <span class="token comment"># 股票帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可取金额&quot;</span><span class="token punctuation">,</span>       accountInfo<span class="token punctuation">.</span>m_dFetchBalance<span class="token punctuation">)</span> 
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易日&quot;</span><span class="token punctuation">,</span>         accountInfo<span class="token punctuation">.</span>m_strTradingDate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股票总市值&quot;</span><span class="token punctuation">,</span>     accountInfo<span class="token punctuation">.</span>m_dStockValue<span class="token punctuation">)</span>         <span class="token comment"># 期货帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;债券总市值&quot;</span><span class="token punctuation">,</span>     accountInfo<span class="token punctuation">.</span>m_dLoanValue<span class="token punctuation">)</span>          <span class="token comment"># 期货帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;基金总市值&quot;</span><span class="token punctuation">,</span>     accountInfo<span class="token punctuation">.</span>m_dFundValue<span class="token punctuation">)</span>          <span class="token comment"># 包括ETF和封闭式基金， 期货帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;回购总市值&quot;</span><span class="token punctuation">,</span>     accountInfo<span class="token punctuation">.</span>m_dRepurchaseValue<span class="token punctuation">)</span>    <span class="token comment"># 期货帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;多单总市值&quot;</span><span class="token punctuation">,</span>     accountInfo<span class="token punctuation">.</span>m_dLongValue<span class="token punctuation">)</span>          <span class="token comment"># 现货帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;空单总市值&quot;</span><span class="token punctuation">,</span>     accountInfo<span class="token punctuation">.</span>m_dShortValue<span class="token punctuation">)</span>         <span class="token comment"># 现货帐户没有此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;净持仓总市值&quot;</span><span class="token punctuation">,</span>   accountInfo<span class="token punctuation">.</span>m_dNetValue<span class="token punctuation">)</span>           <span class="token comment"># 净持仓市值 = 多 - 空</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;净资产&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dAssureAsset<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总负债&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dTotalDebit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可信资产&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dEntrustAsset<span class="token punctuation">)</span>        <span class="token comment"># 用于校对</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总市值&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dInstrumentValueRMB<span class="token punctuation">)</span>  <span class="token comment"># 沪港通 （人民币）</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;申购费&quot;</span><span class="token punctuation">,</span>        accountInfo<span class="token punctuation">.</span>m_dSubscribeFee<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;库存市值&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dGoldValue<span class="token punctuation">)</span>           <span class="token comment"># 黄金现货库存市值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;现货冻结&quot;</span><span class="token punctuation">,</span>      accountInfo<span class="token punctuation">.</span>m_dGoldFrozen<span class="token punctuation">)</span>          <span class="token comment"># 黄金现货冻结</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;占用保证金&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dMargin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;币种&quot;</span><span class="token punctuation">,</span>         accountInfo<span class="token punctuation">.</span>m_strMoneyType<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;购买力&quot;</span><span class="token punctuation">,</span>       accountInfo<span class="token punctuation">.</span>m_dPurchasingPower<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原始保证金&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dRawMargin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买入待交收&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dBuyWaitMoney<span class="token punctuation">)</span>        <span class="token comment"># 金额（元）</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;卖出待交收&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dSellWaitMoney<span class="token punctuation">)</span>       <span class="token comment"># 金额（元）</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;本期间应计利息&quot;</span><span class="token punctuation">,</span> accountInfo<span class="token punctuation">.</span>m_dReceiveInterestTotal<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;权利金收支&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dRoyalty<span class="token punctuation">)</span>             <span class="token comment"># 期货期权用</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结权利金&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dFrozenRoyalty<span class="token punctuation">)</span>       <span class="token comment"># 期货期权用</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时占用保证金&quot;</span><span class="token punctuation">,</span> accountInfo<span class="token punctuation">.</span>m_dRealUsedMargin<span class="token punctuation">)</span>      <span class="token comment"># 用于股票期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时风险度&quot;</span><span class="token punctuation">,</span>    accountInfo<span class="token punctuation">.</span>m_dRealRiskDegree<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
===========accountInfo 对象的属性==============================
帐号ID 410038216969
账号类型 2
保证金比率 0.0
冻结保证金 199922620.34
冻结金额 0.0
冻结手续费 0.0
风险度 0.0
单位净值 0.0
期初权益 199922620.34
总资产 199922620.34
可用金额 199922620.34
手续费 0.0
持仓盈亏 0.0
平仓盈亏 0.0
出入金净值 0.0
当前使用的保证金 0.0
初始权益 199922620.34
账号状态 登录成功
期初平仓盈亏 0.0
总市值 0.0
入金 0.0
出金 0.0
上次信用额度 0.0
上次质押 0.0
质押 0.0
信用额度 0.0
证券初始资金 199922620.34
起始日期 
可取金额 199922620.34
交易日 20230919
股票总市值 0.0
债券总市值 0.0
基金总市值 0.0
回购总市值 0.0
多单总市值 0.0
空单总市值 0.0
净持仓总市值 0.0
净资产 199922620.34
总负债 0.0
可信资产 0.0
总市值 0.0
申购费 0.0
库存市值 0.0
现货冻结 0.0
占用保证金 0.0
币种 
购买力 0.0
原始保证金 0.0
买入待交收 0.0
卖出待交收 0.0
本期间应计利息 0.0
权利金收支 0.0
冻结权利金 0.0
实时占用保证金 0.0实时风险度 0.0
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br></div></div><h3 id="_5-2-任务状态变化task-callback"><a href="#_5-2-任务状态变化task-callback" class="header-anchor">#</a> 5.2 任务状态变化<br>task_callback()</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li>仅在实盘运行模式下生效。</li> <li>需要先在init里调用 <code>ContextInfo.set_account</code> 后生效。</li></ol></div> <p>语法： task_callback(ContextInfo, taskInfo)</p> <p>功能： 当账号任务状态有变化时，这个函数会主动运行一次。</p> <p>参数：</p> <ul><li>ContextInfo —— 特定对象<br></li> <li>taskInfo —— 任务对象，请参考示例中的属性描述。</li></ul> <p>返回： 无</p> <p>示例：</p> <ol><li><p>请在策略编辑器中，将示例代码，先保存为策略文件，可用名称为“tasktest”；</p> <p><img src="/xuntou_yao/assets/img/xtqmt36.77ec9d11.png" alt=""></p></li> <li><p>然后在“策略交易”界面中运行这个策略，并点击“实盘“模式；</p> <p><img src="/xuntou_yao/assets/img/xtqmt37.b8c9756e.png" alt=""></p></li> <li><p>在”交易“界面中，任意手动下一个委托单，如委托买入某一支股票，即可触发一个任务。此时，在”任务列表“中即可看到刚刚操作的记录；</p> <p><img src="/xuntou_yao/assets/img/xtqmt38.644962dd.png" alt=""></p></li> <li><p>点击”策略交易“，回到此界面，即可在”策略日志“中看到程序的输出结果；</p> <p><img src="/xuntou_yao/assets/img/xtqmt39.a451d93d.png" alt=""></p></li></ol> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置对应的资金账号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'410038216969'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">task_callback</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">,</span> taskInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========taskInfo 对象中包含的属性============================================'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务号ID &quot;</span>    <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务状态&quot;</span>     <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_eStatus<span class="token punctuation">)</span>        <span class="token comment"># 任务状态 ETaskStatus 类型,详见 QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务状态消息&quot;</span> <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_strMsg<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务开始时间&quot;</span> <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_startTime<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务结束时间&quot;</span> <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_endTime<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务取消时间&quot;</span> <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_cancelTime<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;已成交量&quot;</span>     <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_nBusinessNum<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合Id&quot;</span>      <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_nGroupId<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单品种代码&quot;</span> <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_stockCode<span class="token punctuation">)</span>       <span class="token comment"># 不针对组合下单</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单用户&quot;</span>    <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>     <span class="token comment"># 单用户下单时适用</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;下单操作类型&quot;</span> <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_eOperationType<span class="token punctuation">)</span>  <span class="token comment">#  详见 EOperationType类型, 详见 QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;算法交易&quot;</span>     <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_eOrderType<span class="token punctuation">)</span>      <span class="token comment"># EOrderType类型, 详见 QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;报价方式&quot;</span>    <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_ePriceType<span class="token punctuation">)</span>       <span class="token comment"># 详见 EPriceType QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价&quot;</span>      <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_dFixPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托量&quot;</span>      <span class="token punctuation">,</span>taskInfo<span class="token punctuation">.</span>m_nNum<span class="token punctuation">)</span>
 <span class="token triple-quoted-string string">&quot;&quot;&quot;
 ===========taskInfo 对象中包含的属性============================================
任务号ID  5
任务状态 3
任务状态消息 5.3000全部委托!
任务开始时间 1695180356
任务结束时间 2147483647
任务取消时间 2147483647
已成交量 0
组合Id 5
下单品种代码 600027.SH
下单用户 410038216969
下单操作类型 18
算法交易 0
报价方式 10
委托价 5.3
委托量 200
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="_5-3-委托状态变化order-callback"><a href="#_5-3-委托状态变化order-callback" class="header-anchor">#</a> 5.3 委托状态变化<br>order_callback()</h3> <p>功能： 当账号委托状态有变化时，这个函数会主动运行一次。</p> <p>语法：<code>order_callback(ContextInfo, orderInfo)</code></p> <p>参数：</p> <ul><li>ContextInfo ——特定对象</li> <li>orderInfo —— 委托账号对象，请参考示例中的属性描述。</li></ul> <p>返回： 无</p> <p>示例：</p> <p>同理，需参照上例，先保存为一个策略程序，然后在“策略交易”中运行此程序。再手动操作一个 委托单，则此函数会自动执行一次，即可看到执行的结果。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置对应的资金账号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'410038216969'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">order_callback</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">,</span> orderInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========orderInfo 对象中包含的属性============================================'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;资金账号 &quot;</span>      <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券市场&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易市场&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约代码&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约名称&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;内部委托号&quot;</span>      <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strOrderRef<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格类型&quot;</span>    <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nOrderPriceType<span class="token punctuation">)</span>     <span class="token comment"># 如市价单、限价单 ， 详见 QMT 知识库中的说明 EBrokerPriceType 类型描述</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易方向&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>           <span class="token comment"># 如多、空，详见 QMT 知识库中的说明 EEntrustBS 类型描述</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开平标志&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nOffsetFlag<span class="token punctuation">)</span>          <span class="token comment"># 如：买卖/开平 ，区别 期货、股票与期权的交易。详见 EOffset_Flag_Type 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保类型&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>           <span class="token comment"># 详见 EHedge_Flag_Type 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dLimitPrice<span class="token punctuation">)</span>       
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最初委托量&quot;</span>     <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nVolumeTotalOriginal<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;报单状态&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nOrderSubmitStatus<span class="token punctuation">)</span>    <span class="token comment"># 股票没有此属性 详见 EEntrustSubmitStatus 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托号&quot;</span>         <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strOrderSysID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托状态&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nOrderStatus<span class="token punctuation">)</span>         <span class="token comment"># 详见 EEntrustStatus 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;已成交量&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nVolumeTraded<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前总委托量&quot;</span>   <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nVolumeTotal<span class="token punctuation">)</span>         <span class="token comment"># 股票的值为 总委托量 减去 已成交量</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;报错消息ID&quot;</span>     <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nErrorID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;报错消息&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strErrorMsg<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务号&quot;</span>         <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结金额&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dFrozenMargin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结手续费&quot;</span>     <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dFrozenCommission<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托日期&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strInsertDate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托时间&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strInsertTime<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交均价&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dTradedPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;已撤数量&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dCancelAmount<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖标记&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strOptName<span class="token punctuation">)</span>           <span class="token comment"># 中文显示 </span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交金额&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dTradeAmount<span class="token punctuation">)</span>         <span class="token comment"># 期货 = 均价 * 量 * 合约乘数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托类型&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_eEntrustType<span class="token punctuation">)</span>         <span class="token comment"># 详见 EEntrustTypes 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;废单原因&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strCancelInfo<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;标的证券代码&quot;</span>   <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strUnderCode<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑标记&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_eCoveredFlag<span class="token punctuation">)</span>         <span class="token comment"># ECoveredFlag 类型，'0' - 非备兑，'1' - 备兑</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;港股通委托价格&quot;</span>  <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span> m_dOrderPriceRMB<span class="token punctuation">)</span>      <span class="token comment"># （人民币），目前用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;港股通成交金额&quot;</span>  <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dTradeAmountRMB<span class="token punctuation">)</span>      <span class="token comment"># （人民币），目前用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率&quot;</span>           <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约编号&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strCompactNo<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;头寸来源&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_eCashgroupProp<span class="token punctuation">)</span>       <span class="token comment"># 详见 EXTCompactBrushSource类型 QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在途保证金&quot;</span>     <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_dShortOccupedMargin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否是迅投交易&quot;</span>  <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strXTTrade<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key&quot;</span>        <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投资备注&quot;</span>       <span class="token punctuation">,</span>orderInfo<span class="token punctuation">.</span>m_strRemark<span class="token punctuation">)</span>
 <span class="token triple-quoted-string string">&quot;&quot;&quot;
===========orderInfo 对象中包含的属性============================================
资金账号  410038216969
证券市场 SH
交易市场 上证所
品种代码 
品种名称 
合约代码 600740
合约名称 山西焦化
内部委托号 9167682570542907397
委托价格类型 50
交易方向 48
开平标志 48
投保类型 49
委托价格 5.2
最初委托量 200
报单状态 51
委托号 805011942
委托状态 50
已成交量 0
当前总委托量 200
报错消息ID 2147483647
报错消息 
任务号 6
冻结金额 1040.0
冻结手续费 2.104
委托日期 20200920
委托时间 142241
成交均价 0.0
已撤数量 0.0
买卖标记 限价买入
成交金额 0.0
委托类型 48
废单原因 
标的证券代码 
备兑标记 0
港股通委托价格 0.0
港股通成交金额 0.0
汇率 0.0
合约编号 
头寸来源 48
在途保证金 1.7976931348623157e+308
是否是迅投交易 本终端
账号key 2____11075________49____410038216969____
投资备注 
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><h3 id="_5-4-成交状态变化deal-callback"><a href="#_5-4-成交状态变化deal-callback" class="header-anchor">#</a> 5.4 成交状态变化<br>deal_callback()</h3> <p>功能： 当账号成交状态有变化时，这个函数会主动运行一次。<br>
语法：<code>deal_callback(ContextInfo, dealInfo)</code><br>
参数：<br></p> <ul><li>ContextInfo ——特定对象</li> <li>dealInfo —— 资金账号对象，请参考示例中的属性描述。
返回： 无<br>
示例：</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置对应的资金账号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'410038216969'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">deal_callback</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">,</span> dealInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========dealInfo 对象中包含的属性============================================'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;资金账号 &quot;</span>      <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券市场&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易市场&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约代码&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约名称&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交编号&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strTradeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;内部委托号&quot;</span>      <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strOrderRef<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托号&quot;</span>         <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strOrderSysID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易方向&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>           <span class="token comment"># 如多、空，详见 QMT 知识库中的说明 EEntrustBS 类型描述</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开平标志&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nOffsetFlag<span class="token punctuation">)</span>          <span class="token comment">#  如：买卖/开平 ，区别 期货、股票与期权的交易。详见 EOffset_Flag_Type 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实际开平标志&quot;</span>    <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nRealOffsetFlag<span class="token punctuation">)</span>      <span class="token comment">#  如：买卖/开平 ，主要是区分平今和平昨。详见 EOffset_Flag_Type 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保类型&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>           <span class="token comment"># 详见 EHedge_Flag_Type 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交均价&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_dPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交量&quot;</span>         <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交日期&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strTradeDate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交时间&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strTradeTime<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;手续费&quot;</span>         <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_dComssion<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交金额&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_dTradeAmount<span class="token punctuation">)</span>         <span class="token comment"># 期货 = 均价 * 量 * 合约乘数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;任务号&quot;</span>         <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nTaskId<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托价格类型&quot;</span>    <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nOrderPriceType<span class="token punctuation">)</span>     <span class="token comment"># 如市价单、限价单 ， 详见 QMT 知识库中的说明 EBrokerPriceType 类型描述</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖标记&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strOptName<span class="token punctuation">)</span>           <span class="token comment"># 中文显示 </span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;委托类型&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_eEntrustType<span class="token punctuation">)</span>         <span class="token comment"># 详见 EEntrustTypes 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交类型&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_eFutureTradeType<span class="token punctuation">)</span>     <span class="token comment"># 详见 EFutureTradeType 类型,  QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑标记&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_eCoveredFlag<span class="token punctuation">)</span>         <span class="token comment"># ECoveredFlag 类型，'0' - 非备兑，'1' - 备兑</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平今量&quot;</span>        <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nCloseTodayVolume<span class="token punctuation">)</span>       
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;港股通委托价格&quot;</span>  <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span> m_dOrderPriceRMB<span class="token punctuation">)</span>      <span class="token comment"># （人民币），目前用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;港股通成交价格&quot;</span>  <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span> m_dPriceRMB<span class="token punctuation">)</span>           <span class="token comment"># （人民币），目前用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;港股通成交金额&quot;</span>  <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_dTradeAmountRMB<span class="token punctuation">)</span>      <span class="token comment"># （人民币），目前用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率&quot;</span>           <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否是迅投交易&quot;</span>  <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strXTTrade<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约编号&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strCompactNo<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投资备注&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strRemark<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key&quot;</span>        <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;订单编号&quot;</span>       <span class="token punctuation">,</span>dealInfo<span class="token punctuation">.</span>m_nRef<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
===========dealInfo 对象中包含的属性============================================
资金账号  410038216969
证券市场 SZ
交易市场 深交所
品种代码 
品种名称 
合约代码 000851
合约名称 高鸿股份
成交编号 591627450056722
内部委托号 9167682570542907397
委托号 805054363
交易方向 48
开平标志 48
实际开平标志 -1
投保类型 49
成交均价 6.22
成交量 200
成交日期 20230921
成交时间 110542
手续费 2.1244
成交金额 1244.0
任务号 6
委托价格类型 50
买卖标记 限价买入
委托类型 48
成交类型 48
备兑标记 48
平今量 0
港股通委托价格 0.0
港股通成交价格 0.0
港股通成交金额 0.0
汇率 0.0
是否是迅投交易 本终端
合约编号 
平仓盈亏 0.0
投资备注 
账号key 2____11075________49____410038216969____
订单编号 0
&quot;&quot;&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h3 id="_5-5-持仓状态变化position-callback"><a href="#_5-5-持仓状态变化position-callback" class="header-anchor">#</a> 5.5 持仓状态变化<br>position_callback()</h3> <p>功能： 当账号持仓状态发生变化时，这个函数会主动运行一次。此方法可以在 策略编辑器 中直接运行测试，看到执行结果。</p> <p>语法：<code>position_callback(ContextInfo, positonInfo)</code></p> <p>参数：<br></p> <ul><li>ContextInfo ——特定对象<br></li> <li>positonInfo —— 资金账号对象。请参考示例中的属性描述。</li></ul> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置对应的资金账号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'410038216969'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">position_callback</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">,</span> positionInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========positionInfo 对象中包含的属性============================================'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;资金账号 &quot;</span>      <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券市场&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易市场&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约代码&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约名称&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保类型&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>          <span class="token comment"># 股票无此属性 详见 EHedge_Flag_Type 类型, QMT 知识库中的说明</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易方向&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>          <span class="token comment"># 股票无此属性 如多、空，详见 QMT 知识库中的说明 EEntrustBS 类型描述</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交日期&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strOpenDate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交编号&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strTradeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓量&quot;</span>         <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nVolume<span class="token punctuation">)</span>             <span class="token comment"># 当前持仓量</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓成本&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dOpenPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最后成交日期&quot;</span>    <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strTradingDay<span class="token punctuation">)</span>      <span class="token comment"># 实盘时即当前交易日，回测时是股票最后交易的日期</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;使用的保证金&quot;</span>    <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dMargin<span class="token punctuation">)</span>            <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓成本&quot;</span>        <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dOpenCost<span class="token punctuation">)</span>         <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;结算价&quot;</span>         <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dSettlementPrice<span class="token punctuation">)</span>   <span class="token comment"># 股票即为当前价</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓量&quot;</span>         <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nCloseVolume<span class="token punctuation">)</span>       <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓额&quot;</span>         <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dCloseAmount<span class="token punctuation">)</span>       <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;浮动盈亏&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dFloatProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>       <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市值&quot;</span>          <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dMarketValue<span class="token punctuation">)</span>       
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓成本&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dPositionCost<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓盈亏&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dPositionProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新结算价&quot;</span>     <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dLastSettlementPrice<span class="token punctuation">)</span> <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约价值&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dInstrumentValue<span class="token punctuation">)</span>    <span class="token comment"># 股票无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否今仓&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_bIsToday<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股东账号&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strStockHolder<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结数量&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nFrozenVolume<span class="token punctuation">)</span>      <span class="token comment"># 期货无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可用余额&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nCanUseVolume<span class="token punctuation">)</span>      <span class="token comment"># 期货无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在途股份&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nOnRoadVolume<span class="token punctuation">)</span>      <span class="token comment"># 期货无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;昨仓拥股&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nYesterdayVolume<span class="token punctuation">)</span>   <span class="token comment"># 期货无此属性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新价&quot;</span>         <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dLastPrice<span class="token punctuation">)</span>         <span class="token comment"># 股票即为当前价</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓均价&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dAvgOpenPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;盈亏比例&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dProfitRate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交类型&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_eFutureTradeType<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;到期日&quot;</span>         <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strExpireDate<span class="token punctuation">)</span>      <span class="token comment"># 逆回购用</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合成交号&quot;</span>     <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strComTradeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合序号&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nLegId<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;累计成本&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dTotalCost<span class="token punctuation">)</span>        <span class="token comment"># 用于股票信用帐号</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;单股成本&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dSingleCost<span class="token punctuation">)</span>       <span class="token comment"># 用于股票信用帐号</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑数量&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nCoveredVolume<span class="token punctuation">)</span>    <span class="token comment"># 用于 个股期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓类型&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_eSideFlag<span class="token punctuation">)</span>         <span class="token comment"># ESideFlag 持仓类型 ，用于个股期权 '0' - 权利，'1' - 义务，'2' - '备兑'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率&quot;</span>           <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>   <span class="token comment"># 用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;分级基金可用&quot;</span>    <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dStructFundVol<span class="token punctuation">)</span>   <span class="token comment"># 可分拆或可合并</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;分级基金可赎回量&quot;</span> <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dRedemptionVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;申赎可用量&quot;</span>      <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nPREnableVolume<span class="token punctuation">)</span>  <span class="token comment"># 录当日申购赎回的股票或基金数量</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时占用保证金&quot;</span>   <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dRealUsedMargin<span class="token punctuation">)</span>  <span class="token comment"># 用于 期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;权利金&quot;</span>          <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dRoyalty<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;标的证券最新价&quot;</span>   <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dStockLastPrice<span class="token punctuation">)</span>  <span class="token comment"># 用于 期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;静态持仓占用保证金&quot;</span><span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_dStaticHoldMargin<span class="token punctuation">)</span>  <span class="token comment"># 用于 期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期权组合占用量&quot;</span>   <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nOptCombUsedVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;个股期权量&quot;</span>       <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_nEnableExerciseVolume<span class="token punctuation">)</span> <span class="token comment"># 用于 个股期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key&quot;</span>        <span class="token punctuation">,</span>positionInfo<span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
执行结果：
===========positionInfo 对象中包含的属性============================================
资金账号  410038216969
证券市场 SH
交易市场 上证所
品种代码 
品种名称 
合约代码 600027
合约名称 华电国际
投保类型 49
交易方向 48
成交日期 
成交编号 
持仓量 200
持仓成本 5.380100049999999
最后成交日期 20230921
使用的保证金 0.0
开仓成本 1076.02
结算价 5.4
平仓量 0
平仓额 0.0
浮动盈亏 4.0000000000000036
平仓盈亏 0.0
市值 1080.0
持仓成本 1076.02
持仓盈亏 3.980000000000018
最新结算价 0.0
合约价值 1080.0
是否今仓 True
股东账号 A103190588
冻结数量 100
可用余额 100
在途股份 0
昨仓拥股 200
最新价 5.4
开仓均价 5.380100049999999
盈亏比例 0.0036988160071374306
成交类型 48
到期日 
组合成交号 
组合序号 0
累计成本 0.0
单股成本 0.0
备兑数量 0
持仓类型 0
汇率 0.0
分级基金可用 0
分级基金可赎回量 0
申赎可用量 100
实时占用保证金 0.0
权利金 0.0
标的证券最新价 1.7976931348623157e+308
静态持仓占用保证金 1.7976931348623157e+308
期权组合占用量 0
个股期权量 -1
账号key 2____11075________49____410038216969____
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><h3 id="_5-6-异常下单主推ordererror-callback"><a href="#_5-6-异常下单主推ordererror-callback" class="header-anchor">#</a> 5.6 异常下单主推<br>orderError_callback()</h3> <p>功能： 当账号下单异常时，运行这个函数</p> <p>语法：<code>orderError_callback(ContextInfo,orderArgs)</code></p> <p>参数：</p> <ul><li>ContextInfo —— 特定对象</li> <li>orderArgs —— 下单参数</li></ul> <p>errMsg —— 错误信息。 并不支持此参数，官方文档中的错误！</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置对应的资金账号</span>
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span><span class="token string">'410038216969'</span><span class="token punctuation">)</span>
    

<span class="token keyword">def</span> <span class="token function">position_callback</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">,</span>orderArgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========orderArgs 对象中包含的属性============================================'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;是否今仓 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_bIsToday<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓均价 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dAvgOpenPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓额 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dCloseAmount<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓盈亏 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dCloseProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;浮动盈亏 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dFloatProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;合约价值 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dInstrumentValue<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新价 &quot;</span>                    <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dLastPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最新结算价 &quot;</span>                 <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dLastSettlementPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;使用的保证金 &quot;</span>               <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dMargin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市值 &quot;</span>                      <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dMarketValue<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓成本 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dOpenCost<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开仓价格 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dOpenPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓成本 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dPositionCost<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓盈亏 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dPositionProfit<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;盈亏比例 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dProfitRate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;实时占用保证金 &quot;</span>              <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dRealUsedMargin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;分级基金可赎回量 &quot;</span>            <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dRedemptionVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;汇率 &quot;</span>                       <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dReferenceRate<span class="token punctuation">)</span>     <span class="token comment"># 用于港股通</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;权利金 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dRoyalty<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;结算价 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dSettlementPrice<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;单股成本 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dSingleCost<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;静态持仓占用保证金 &quot;</span>          <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dStaticHoldMargin<span class="token punctuation">)</span>   <span class="token comment"># 用于期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;标的证券最新价 &quot;</span>              <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dStockLastPrice<span class="token punctuation">)</span>     <span class="token comment"># 用于期权</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;分级基金可用 &quot;</span>                <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dStructFundVol<span class="token punctuation">)</span>      <span class="token comment"># 可分拆或可合并</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;累计成本 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_dTotalCost<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交类型 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_eFutureTradeType<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓类型 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_eSideFlag<span class="token punctuation">)</span>            <span class="token comment"># 用于个股期权，标记 '0' - 权利，'1' - 义务，'2' - '备兑'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;可用余额  &quot;</span>                  <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCanUseVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;m_nCidIncrease &quot;</span>            <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCidIncrease<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;m_nCidIsDelist &quot;</span>            <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCidIsDelist<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;m_nCidRateOfCurrentLine  &quot;</span>  <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCidRateOfCurrentLine<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;m_nCidRateOfTotalValue &quot;</span>    <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCidRateOfTotalValue<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;平仓量 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCloseVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;备兑数量 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nCoveredVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;买卖方向 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nDirection<span class="token punctuation">)</span>            <span class="token comment">#  股票 该值始终是 48</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;用于个股期权 &quot;</span>                <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nEnableExerciseVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;冻结数量 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nFrozenVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;投保 &quot;</span>                       <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nHedgeFlag<span class="token punctuation">)</span>            <span class="token comment"># 股票不需要</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合序号 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nLegId<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;在途股份 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nOnRoadVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;期权组合占用数量 &quot;</span>            <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nOptCombUsedVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;申赎可用量 &quot;</span>                 <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nPREnableVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;持仓量 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nVolume<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;昨仓拥股 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_nYesterdayVolume<span class="token punctuation">)</span>       <span class="token comment"># 截止到昨夜的持仓量，不是 昨天一天的持仓量。</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号ID &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strAccountID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;账号key &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strAccountKey<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;组合成交号 &quot;</span>                 <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strComTradeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;市场 &quot;</span>                      <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strExchangeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易所名称 &quot;</span>                 <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strExchangeName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;到期日 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strExpireDate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券代码 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strInstrumentID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;证券名称 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strInstrumentName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交日期 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strOpenDate<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种代码 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strProductID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;品种名称 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strProductName<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;股东账号 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strStockHolder<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;成交编号 &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strTradeID<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交易日 &quot;</span>                     <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_strTradingDay<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;m_xtTag &quot;</span>                   <span class="token punctuation">,</span>orderArgs<span class="token punctuation">.</span>m_xtTag<span class="token punctuation">)</span>
 <span class="token triple-quoted-string string">&quot;&quot;&quot;
 运行结果：
 ===========orderArgs 对象中包含的属性============================================
是否今仓  True
开仓均价  2.6201000999999997
平仓额  0.0
平仓盈亏  0.0
浮动盈亏  0.0
合约价值  259.0
最新价  2.59
最新结算价  0.0
使用的保证金  0.0
市值  259.0
开仓成本  262.01
开仓价格  2.6201000999999997
持仓成本  262.01
持仓盈亏  -3.009999999999991
盈亏比例  -0.011488111140796118
实时占用保证金  0.0
分级基金可赎回量  0
汇率  0.0
权利金  0.0
结算价  2.59
单股成本  0.0
静态持仓占用保证金  1.7976931348623157e+308
标的证券最新价  1.7976931348623157e+308
分级基金可用  0
累计成本  0.0
成交类型  48
持仓类型  0
可用余额   100
m_nCidIncrease  -2147473664
m_nCidIsDelist  -2072858414
m_nCidRateOfCurrentLine   0
m_nCidRateOfTotalValue  0
平仓量  0
备兑数量  0
买卖方向  48
用于个股期权  -1
冻结数量  0
投保  49
组合序号  0
在途股份  0
期权组合占用数量  0
申赎可用量  100
持仓量  100
昨仓拥股  100
账号ID  410038216969
账号key  2____11075________49____410038216969____
组合成交号  
市场  SZ
交易所名称  深交所
到期日  
证券代码  000836
证券名称  富通信息
成交日期  
品种代码  
品种名称  
股东账号  0103749588
成交编号  
交易日  20230922
m_xtTag  None 
 &quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br></div></div><h3 id="需帐户支持的方法-略"><a href="#需帐户支持的方法-略" class="header-anchor">#</a> 需帐户支持的方法，略</h3> <p>以下方法（函数），需帐户为 信用帐户或两融帐户。因此无乎用不上，具体用法略。</p> <p>查询信用账户明细<br>query_credit_account()</p> <p>查询信用账户明细回调<br>credit_account_callback()</p> <p>查询信用账户明细回调<br>query_credit_opvolume()</p> <p>查询两融最大可下单量<br>credit_opvolume_callback()</p> <h2 id="_6-引用函数"><a href="#_6-引用函数" class="header-anchor">#</a> 6）  引用函数</h2> <p>注：以下函数均支持 回测 和 实盘/模拟 运行模式。</p> <h3 id="_6-1-获取外部扩展数据"><a href="#_6-1-获取外部扩展数据" class="header-anchor">#</a> 6.1 获取外部扩展数据</h3> <h3 id="ext-data"><a href="#ext-data" class="header-anchor">#</a> ext_data()</h3> <p>功能： 获取扩展数据<br>
语法：<code>ext_data(extdataname, stockcode, deviation, ContextInfo)</code><br>
参数：<br>
extdataname ——string，扩展数据名<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH'<br>
deviation ——number，K 线偏移，可取值：<br>
0：不偏移<br>
N：向右偏移N<br>
-N：向左偏移N<br>
返回： number<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ext_data<span class="token punctuation">(</span><span class="token string">'mycci'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-2-获取扩展数据按数值品种排名"><a href="#_6-2-获取扩展数据按数值品种排名" class="header-anchor">#</a> 6.2 获取扩展数据按数值品种排名</h3> <h3 id="ext-data-rank"><a href="#ext-data-rank" class="header-anchor">#</a> ext_data_rank()</h3> <p>功能： 获取引用的扩展数据的数值在所有品种中的排名<br>
语法： <code>ext_data_rank(extdataname, stockcode, deviation, ContextInfo)</code><br>
参数：<br>
extdataname —— string，扩展数据名<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH'<br>
deviation —— number，K 线偏移，可取值：<br>
0：不偏移<br>
N：向右偏移N<br>
-N：向左偏移N<br>
ContextInfo：pythonObj，Python 对象，这里必须是 ContextInfo<br>
返回： number<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ext_data_rank<span class="token punctuation">(</span><span class="token string">'mycci'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-3-获取扩展数据按时间品种排名"><a href="#_6-3-获取扩展数据按时间品种排名" class="header-anchor">#</a> 6.3 获取扩展数据按时间品种排名</h3> <h3 id="ext-data-rank-range"><a href="#ext-data-rank-range" class="header-anchor">#</a> ext_data_rank_range()</h3> <p>功能： 获取引用的扩展数据的数值在指定时间区间内所有品种中的排名<br>
语法： <code>ext_data_rank_range(extdataname, stockcode, begintime, endtime, ContextInfo)</code><br></p> <p>参数：<br>
extdataname —— string，扩展数据名<br>
stockcode  —— string，形式如 'stkcodemarket'，如 '600000.SH'<br>
begintime  —— string，区间的起始时间（包括该时间点在内）格式为 '2016-08-02 12:12:30'<br>
endtime —— string，区间的结束时间（包括该时间点在内）格式为 '2017-08-02 12:12:30'<br>
ContextInfo：pythonObj，Python 对象，这里必须是 ContextInfo<br>
返回： pythonDict<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ext_data_rank_range<span class="token punctuation">(</span><span class="token string">'mycci'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token string">'2016-08-02 12:12:30'</span><span class="token punctuation">,</span><span class="token string">'2017-08-02 12:12:30'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-4-获取扩展数据时间区间内的值"><a href="#_6-4-获取扩展数据时间区间内的值" class="header-anchor">#</a> 6.4 获取扩展数据时间区间内的值</h3> <h3 id="ext-data-range"><a href="#ext-data-range" class="header-anchor">#</a> ext_data_range()</h3> <p>功能： 获取扩展数据在指定时间区间内的值<br>
语法：<code>ext_data_range(extdataname, stockcode, begintime, endtime, ContextInfo)</code><br>
参数：<br>
extdataname —— string，扩展数据名<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH'<br>
begintime —— string，区间的起始时间（包括该时间点在内）格式为 '2016-08-02 12:12:30'<br>
endtime —— string，区间的结束时间（包括该时间点在内）格式为 '2017-08-02 12:12:30'<br>
ContextInfo：pythonObj，Python 对象，这里必须是 ContextInfo<br>
返回： pythonDict<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ext_data_range<span class="token punctuation">(</span><span class="token string">'mycci'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token string">'2016-08-02 12:12:30'</span><span class="token punctuation">,</span> <span class="token string">'2017-08-02 12:12:30'</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_6-5-获取因子数据"><a href="#_6-5-获取因子数据" class="header-anchor">#</a> 6.5 获取因子数据</h3> <h3 id="get-factor-value"><a href="#get-factor-value" class="header-anchor">#</a> get_factor_value()</h3> <p>功能： 获取因子数据<br>
语法： <code>get_factor_value(factorname, stockcode, deviation, ContextInfo)</code><br>
参数：<br>
factorname —— string，因子名<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH'<br>
deviation —— number，K 线偏移，0 不偏移，N 向右偏移 N，-N 向左偏移 N<br>
ContextInfo —— pythonObj，Python 对象，这里必须是 ContextInfo<br>
返回： number<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_factor_value<span class="token punctuation">(</span><span class="token string">'zzz'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-6-获取因子数据品种排名"><a href="#_6-6-获取因子数据品种排名" class="header-anchor">#</a> 6.6 获取因子数据品种排名</h3> <h3 id="get-factor-rank"><a href="#get-factor-rank" class="header-anchor">#</a> get_factor_rank()</h3> <p>功能： 获取引用的因子数据的数值在所有品种中排名<br>
语法： <code>get_factor_rank(factorname, stockcode, deviation, ContextInfo)</code><br>
参数：<br>
factorname —— string，因子名<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH'<br>
deviation —— number，K 线偏移，0不偏移，N向右偏移N，-N向左偏移N<br>
ContextInfo —— pythonObj，Python 对象，这里必须是 ContextInfo<br>
返回： number<br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_factor_rank<span class="token punctuation">(</span><span class="token string">'zzz'</span><span class="token punctuation">,</span> <span class="token string">'600000.SH'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ContextInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-7-调用vba模型"><a href="#_6-7-调用vba模型" class="header-anchor">#</a> 6.7 调用VBA模型</h3> <h3 id="call-vba"><a href="#call-vba" class="header-anchor">#</a> call_vba()</h3> <p>功能： 获取引用的 VBA 模型运行的结果<br>
语法： call_vba(factorname, stockcode, [period, dividend_type, barpos, ]ContextInfo)<br>
注：使用该函数时需补充好本地 K 线或分笔数据<br>
参数：<br>
factorname —— string，模型名及引用变量，如 'MA.ma1'，其中 MA是模型名称，ma1 是其中一个变量，不区分大小写；<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH '<br>
period —— string，K 线周期类型，可缺省，默认为当前主图周期线型，可选值：'tick' 表示 分笔，'1d'表示日线，'1m' 表示1分钟......<br>
dividend_type —— string，除复权，可缺省，默认当前图复权方式，可选值：'’none' 表示 不复权<br>
barpos —— number，对应 bar 下标，可缺省，默认当前主图调用到的 bar 的对应下标<br>
ContextInfo —— pythonObj，Python 对象，这里必须是 ContextInfo<br>
返回： 浮点数，float 对应最后一根K线的值。<br></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>应用时，主图请选择对应的时间周期。如果要获取动态指标，则只支持5m， 1d；取动态数据时需要调用set_universe，且该接口有订阅限制，订阅有最大数量限制(当前为500个）<br></p> <p>需在 handlebar() 中调用VBA模型，如此才会在每一根K线上计算一次。</p></div> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#coding:gbk</span>

<span class="token comment"># 获取vba指标</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment">#主图请选择对应周期， 想要获取动态指标，则只支持5m， 1d</span>
	<span class="token comment"># 注意，取动态数据时需要调用set_universe，且该接口有订阅限制，</span>
	<span class="token comment"># 详见 http://docs.thinktrader.net/vip/pages/cc95b6/#_1-qmt行情数据基础概念 </span>
	<span class="token comment"># 关于订阅的说明</span>
	ContextInfo<span class="token punctuation">.</span>set_universe<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'300014.SZ'</span><span class="token punctuation">,</span><span class="token string">'600011.SH'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ma1 <span class="token operator">=</span> call_vba<span class="token punctuation">(</span><span class="token string">'MA.ma1'</span><span class="token punctuation">,</span><span class="token string">'300014.SZ'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
	j1 <span class="token operator">=</span> call_vba<span class="token punctuation">(</span><span class="token string">'KDJ.J'</span><span class="token punctuation">,</span><span class="token string">'300014.SZ'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
	ma2 <span class="token operator">=</span> call_vba<span class="token punctuation">(</span><span class="token string">'MA.ma1'</span><span class="token punctuation">,</span><span class="token string">'600011.SH'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
	j2 <span class="token operator">=</span> call_vba<span class="token punctuation">(</span><span class="token string">'KDJ.J'</span><span class="token punctuation">,</span><span class="token string">'600011.SH'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'300014.SZ ma'</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>ma1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'kdj j: '</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>j1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'600011.SH ma'</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>ma2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'kdj j: '</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>j2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_6-8-调用vba组合模型"><a href="#_6-8-调用vba组合模型" class="header-anchor">#</a> 6.8 调用VBA组合模型</h3> <h3 id="call-formula"><a href="#call-formula" class="header-anchor">#</a> call_formula()</h3> <p>功能： python调用组合模型，返回GruopModelInfo结构体<br>
语法：<code>call_formula(formulaName,code,period,divideType,basket,argsDict,startime=&quot;&quot;,endTime=&quot;&quot;,count =-1)</code><br></p> <p>注：使用该函数时需补充好本地 K 线或分笔数据</p> <p>参数：<br>
factorname —— string，模型名及引用变量，如 'MA.ma1'<br>
stockcode —— string，形式如 'stkcodemarket'，如 '600000.SH '<br>
period —— string，K 线周期类型，可缺省，默认为当前主图周期线型，可选值：'tick' 表示 分笔，'1d'表示日线，'1m' 表示1分钟......<br>
dividend_type —— string，除复权，可缺省，默认当前图复权方式，可选值：'’none' 表示 不复权<br>
basket —— dict，组合模型的股票池权重，形如{'SH600000':0.06,'SZ000001':0.01}<br>
argsDict —— dict，组合模型的入参，{参数名:参数值}，形如{'a':1}<br>
startTime —— string，缺失参数，组合模型运行起始时间，形如:'20200101'<br>
endTime —— string，缺失参数，组合模型运截止时间，形如:'20200101'<br>
count —— int，缺省参数，组合模型运行范围为向前count根bar</p> <p>返回： GruopModelInfo结构体。GruopModelInfo.result为当前模型的运行结果，运行
GruopModelInfo.unsubscribe()会取消组合模型的运行，GruopModelInfo随着python的析构也会调用取消组合模型运行。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    basket<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'SH600000'</span><span class="token punctuation">:</span><span class="token number">0.06</span><span class="token punctuation">,</span><span class="token string">'SZ000001'</span><span class="token punctuation">:</span><span class="token number">0.01</span><span class="token punctuation">}</span>
    argsDict<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">}</span>
    groupModelInfo<span class="token operator">=</span>call_formula<span class="token punctuation">(</span><span class="token string">'testGroupModel'</span><span class="token punctuation">,</span><span class="token string">'000300.SH'</span><span class="token punctuation">,</span>basket<span class="token punctuation">,</span>argsDict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>groupModelInfo<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupModelInfo<span class="token punctuation">.</span>unsubscribe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#取消组合模型运行</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_7-绘图函数"><a href="#_7-绘图函数" class="header-anchor">#</a> 7）  绘图函数</h2> <p>以下函数，其实就是在图表上画线或显示文字、符号，即画出自定义指标。基本原理就是给定座标，然后指定画线，还是写文字。座标的 X 轴其实就是时间戳，从左往右，最新的时间在最右边；Y轴就是当前品种的报价；指定了 X，Y ，然后告诉程序想画的线型、粗细、颜色等参数，或写什么文字即可。在绘制前需要指定绘画的位置，即副图、主图叠加 或 主图。迅投QMT中提供的画图功能有限，基本方法就是以下几个。</p> <p><img src="/xuntou_yao/assets/img/xtqmt40.79835713.png" alt=""></p> <p>写好代码后，需要先保存。然后切换到”行情“界面，单击左侧面板底部的”模型“标签，在其中双击刚刚保存的自定义指标名称，即可看到绘制的效果。</p> <p><img src="/xuntou_yao/assets/img/xtqmt41.ebc3bacf.png" alt=""></p> <h3 id="_7-1-在界面上画图contextinfo-paint"><a href="#_7-1-在界面上画图contextinfo-paint" class="header-anchor">#</a> 7.1 在界面上画图<br>ContextInfo.paint()</h3> <p>功能： 根据指定的座标，画线。
语法： ContextInfo.paint(name, data, index, drawStyle, selectcolor = 'white', limit = '')
参数：
name —— string，为这个绘画的指标起一个名称，会显示在左上角<br>
data —— number，名称后面显示的数值，可以理解为这个指标的值<br>
index —— number，显示索引位置，填 -1 表示按主图索引显示<br>
drawStyle —— number，线型，0 表示曲线 42 表示 柱状线<br>
selectcolor —— string，颜色（不填默认为白色）目前支持以下几种颜色：blue：蓝brown：棕cyan：蓝绿green：绿magenta：品红red：红white：白yellow：黄<br>
limit —— string，背景网格，'noaxis' 表示不画网格线：  'nodraw' ：不画出指标的线<br></p> <p><i>（官方文档中居然把 关键字参数的名称也写错，也是醉了。）</i></p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

    
<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取图表上，K线对应的时间戳。即 x 座标</span>
    realtimetag <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token punctuation">)</span>
    
    <span class="token comment"># 获取对应的时间上 K 线的收盘价。即 y 座标</span>
    ind_Value <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_close_price<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> realtimetag<span class="token punctuation">)</span>
    
    <span class="token comment"># 绘制指标</span>
    ContextInfo<span class="token punctuation">.</span>paint<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'收盘价'</span><span class="token punctuation">,</span>        <span class="token comment"># 指标名称 close </span>
                      data <span class="token operator">=</span> ind_Value<span class="token punctuation">,</span>      <span class="token comment"># 显示在名称后面的 值</span>
                      index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>            <span class="token comment"># 显示索引位置，-1 表示按 主图上的K线索引值</span>
                      drawStyle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment"># 线型，0 表示曲线，42 表示 柱子</span>
                      selectcolor <span class="token operator">=</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token comment"># 线的颜色 </span>
                      limit <span class="token operator">=</span> <span class="token string">'noaxis'</span>       <span class="token comment"># 画线控的控制</span>
                     <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_7-2-在图形上显示文字contextinfo-draw-text"><a href="#_7-2-在图形上显示文字contextinfo-draw-text" class="header-anchor">#</a> 7.2 在图形上显示文字<br>ContextInfo.draw_text()</h3> <p>功能： 在图形上显示文字</p> <p>语法： ContextInfo.draw_text(condition, position, text)</p> <p>参数：
condition —— 条件，为 True 时 才显示
Position —— 位置，即 Y座标价格
text —— 文字</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取图表上，K线对应的时间戳。即 x 座标</span>
    realtimetag <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token punctuation">)</span>
    
    <span class="token comment"># 获取对应的时间上 K 线的收盘价。即 y 座标</span>
    ind_Value <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_close_price<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> realtimetag<span class="token punctuation">)</span>
    
    
    <span class="token comment"># 右侧面板上选择 主图叠加，在最右的K线上方 + 1 的位置，显示文字</span>
    ContextInfo<span class="token punctuation">.</span>draw_text<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos <span class="token operator">==</span> ContextInfo<span class="token punctuation">.</span>time_tick_size <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 满足此条件才显示，即 最右边的K线上</span>
                          ind_Value<span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 显示的位置，在K线上方</span>
                          <span class="token string">&quot;显示文字。&quot;</span>    <span class="token comment"># 显示汉字，可能会出现乱码。加上一个中文句号可以改善。</span>
                         <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_7-3-在图形上显示数字contextinfo-draw-number"><a href="#_7-3-在图形上显示数字contextinfo-draw-number" class="header-anchor">#</a> 7.3 在图形上显示数字<br>ContextInfo.draw_number()</h3> <p>功能： 在图形上显示数字</p> <p>语法： <code>ContextInfo.draw_number(cond, height, number, precision)</code></p> <p>参数：
cond —— bool，条件
height —— number，显示数字的的高度位置
text —— string，显示的具体数字。数字不要超出图表太多。
precision —— 显示小数位数（取值范围 0 - 7）</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取图表上，K线对应的时间戳。即 x 座标</span>
    realtimetag <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token punctuation">)</span>
    
    <span class="token comment"># 获取对应的时间上 K 线的收盘价。即 y 座标</span>
    ind_Value <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    
    <span class="token comment"># 右侧面板上选择 主图叠加，在最右的K线上方 + 1 的位置，显示文字</span>
    ContextInfo<span class="token punctuation">.</span>draw_number<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos <span class="token operator">==</span> ContextInfo<span class="token punctuation">.</span>time_tick_size <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 满足此条件才显示，即 最右边的K线上</span>
                          ind_Value<span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 显示的位置，在K线上方</span>
                          ind_Value<span class="token operator">+</span><span class="token number">3.1415926</span><span class="token punctuation">,</span>    <span class="token comment"># 数字不要超出图表太多。</span>
                          <span class="token number">7</span>
                         <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_7-4-在两个数之间绘垂直线contextinfo-draw-vertline"><a href="#_7-4-在两个数之间绘垂直线contextinfo-draw-vertline" class="header-anchor">#</a> 7.4 在两个数之间绘垂直线<br>ContextInfo.draw_vertline()</h3> <p>功能： 在数字1和数字2之间绘垂直线</p> <p>语法： <code>ContextInfo.draw_vertline(cond, number1, number2, color = '', limit = '')</code></p> <p>参数：
cond —— bool，条件
number1 —— number，数字1
number2 —— number，数字2
color —— string，颜色（不填默认为白色）目前支持以下几种颜色：blue：蓝brown：棕cyan：蓝绿green：绿magenta：品红red：红white：白yellow：黄
limit —— string，画线控制，可取值：'noaxis'： 不影响坐标画线 'nodraw' ：不画线</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    close <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token builtin">open</span> <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    
    <span class="token comment"># 右侧面板上选择 主图叠加，在最右的K线上方 + 1 的位置，显示文字</span>
    ContextInfo<span class="token punctuation">.</span>draw_vertline<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment"># 满足此条件才显示，1 表示全都画</span>
                          close<span class="token punctuation">,</span>    <span class="token comment"># 画垂直线的起点</span>
                          <span class="token builtin">open</span><span class="token punctuation">,</span>     <span class="token comment"># 画垂直线的终点</span>
                          <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token comment"># 画线的颜色</span>
                         <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_7-5-在图形上绘制小图标contextinfo-draw-icon"><a href="#_7-5-在图形上绘制小图标contextinfo-draw-icon" class="header-anchor">#</a> 7.5 在图形上绘制小图标<br>ContextInfo.draw_icon()</h3> <p>功能： 在图形上绘制小图标</p> <p>语法： <code>ContextInfo.draw_icon(cond, height, type)</code></p> <p>参数：
cond —— bool，条件
height —— number，图标的位置
text —— number，图标的类型，可取值：1：椭圆 0：矩形</p> <p>返回： 无</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#encoding:gbk</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>

    close <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 右侧面板上选择 主图叠加，在最右的K线上方 + 1 的位置，显示文字</span>
    ContextInfo<span class="token punctuation">.</span>draw_icon<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment"># 满足此条件才显示，1 表示全都画</span>
                          close<span class="token punctuation">,</span>    <span class="token comment"># 画垂直线的起点</span>
                          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment"># 画线的颜色</span>
                         <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录：</h2> <h3 id="一、macd-红绿买卖-回测模型源码"><a href="#一、macd-红绿买卖-回测模型源码" class="header-anchor">#</a> 一、MACD 红绿买卖 回测模型源码</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
MACD 红绿买卖 回测
&quot;&quot;&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">G</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
g <span class="token operator">=</span> G<span class="token punctuation">(</span><span class="token punctuation">)</span>

g<span class="token punctuation">.</span>m5Data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
g<span class="token punctuation">.</span>StockList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;603055.SH&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;000797.SZ&quot;</span><span class="token punctuation">]</span>
g<span class="token punctuation">.</span>StockPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

account <span class="token operator">=</span> <span class="token string">&quot;620000123673&quot;</span>
SectorName <span class="token operator">=</span> <span class="token string">&quot;上证50&quot;</span> <span class="token comment"># 如 “上证50”</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n 程序 开始准备历史 数据。&quot;</span><span class="token punctuation">)</span>
    
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span>account<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>SectorName<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        g<span class="token punctuation">.</span>StockList <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_stock_list_in_sector<span class="token punctuation">(</span>SectorName<span class="token punctuation">)</span>
        
    g<span class="token punctuation">.</span>m5Data <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data_ex<span class="token punctuation">(</span>
                    <span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment"># 获取 收盘价</span>
                     g<span class="token punctuation">.</span>StockList<span class="token punctuation">,</span>         <span class="token comment"># 股票品种列表</span>
                     period    <span class="token operator">=</span> <span class="token string">'5m'</span><span class="token punctuation">,</span>    <span class="token comment"># 时间周期 5分钟</span>
                     count     <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>     <span class="token comment"># 获取 500 根历史K线的数据</span>
                     subscribe <span class="token operator">=</span> <span class="token boolean">False</span>     <span class="token comment"># 订阅品种后续的报价</span>
                    <span class="token punctuation">)</span>
              
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n 获取历史数据完成。&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> ContextInfo<span class="token punctuation">.</span>do_back_test<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n 此程序专用于 回测模式，不适用于模拟运行。&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    timetag_1 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token punctuation">)</span>
    timetag_2 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    timetag_3 <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_bar_timetag<span class="token punctuation">(</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    bar_1stime <span class="token operator">=</span> timetag_to_datetime<span class="token punctuation">(</span>timetag_1<span class="token punctuation">,</span><span class="token string">&quot;%Y%M%D%H%M%S&quot;</span><span class="token punctuation">)</span>
    bar_2stime <span class="token operator">=</span> timetag_to_datetime<span class="token punctuation">(</span>timetag_2<span class="token punctuation">,</span><span class="token string">&quot;%Y%M%D%H%M%S&quot;</span><span class="token punctuation">)</span>
    bar_3stime <span class="token operator">=</span> timetag_to_datetime<span class="token punctuation">(</span>timetag_3<span class="token punctuation">,</span><span class="token string">&quot;%Y%M%D%H%M%S&quot;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> Symbol <span class="token keyword">in</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">:</span>
        g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                              <span class="token string">&quot;可用数量&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                              <span class="token string">&quot;持股的总金额&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                              <span class="token string">&quot;盈亏比例&quot;</span><span class="token punctuation">:</span><span class="token number">0</span>
                             <span class="token punctuation">}</span>
                             
    pos_list <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span>account<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'position'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> pos <span class="token keyword">in</span> pos_list<span class="token punctuation">:</span>
        Symbol <span class="token operator">=</span> pos<span class="token punctuation">.</span>m_strInstrumentID <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> pos<span class="token punctuation">.</span>m_strExchangeID
        
        g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">.</span>m_nVolume
        g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;可用数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">.</span>m_nCanUseVolume
    
    <span class="token keyword">for</span> Symbol <span class="token keyword">in</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">:</span>
        
        macd3hist <span class="token operator">=</span> call_vba<span class="token punctuation">(</span><span class="token string">'MACD.macd1'</span><span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token string">'5m'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
        macd2hist <span class="token operator">=</span> call_vba<span class="token punctuation">(</span><span class="token string">'MACD.macd1'</span><span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token string">'5m'</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">.</span>barpos<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token keyword">and</span> 
            macd3hist <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">and</span> 
            macd2hist <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token comment"># MACD 的柱子 由绿翻红 了</span>
           <span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n 当前品种&quot;</span><span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token string">&quot;时间&quot;</span><span class="token punctuation">,</span>bar_1stime<span class="token punctuation">,</span><span class="token string">&quot;MACD柱子绿翻红了，买入&quot;</span><span class="token punctuation">)</span>
            passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">1101</span><span class="token punctuation">,</span>account<span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;MACD绿翻红&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
            
        <span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token keyword">and</span> 
            macd3hist <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span>
            macd2hist <span class="token operator">&lt;</span> <span class="token number">0</span>
           <span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n 当前品种&quot;</span><span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token string">&quot;时间&quot;</span><span class="token punctuation">,</span>bar_1stime<span class="token punctuation">,</span><span class="token string">&quot;MACD柱子红翻绿了，卖出&quot;</span><span class="token punctuation">)</span>
            passorder<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">1101</span><span class="token punctuation">,</span>account<span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;MACD红翻绿&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><h3 id="二、macd-红绿买卖-实时交易模型源码"><a href="#二、macd-红绿买卖-实时交易模型源码" class="header-anchor">#</a> 二、MACD 红绿买卖 实时交易模型源码</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:GBK</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
5m 图表上，观察 MACD 指标
MACD柱子绿翻红，买入100股
MACD柱子红翻绿，卖出100股
&quot;&quot;&quot;</span>

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> talib

<span class="token keyword">class</span> <span class="token class-name">G</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>
g <span class="token operator">=</span> G<span class="token punctuation">(</span><span class="token punctuation">)</span>

g<span class="token punctuation">.</span>m5Data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># 用于保存5分钟的K线数据</span>
g<span class="token punctuation">.</span>StockList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'601225.SH'</span><span class="token punctuation">,</span><span class="token string">'000004.SZ'</span><span class="token punctuation">]</span>
g<span class="token punctuation">.</span>StockPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># 用于保存帐户中持有股标订单</span>

account <span class="token operator">=</span><span class="token string">&quot;620000123673&quot;</span>
SectorName <span class="token operator">=</span> <span class="token string">&quot;上证50&quot;</span> <span class="token comment"># 板块名 如“上证50”</span>

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;程序开始在 实时模拟仿真模式 下运行。&quot;</span><span class="token punctuation">)</span>
    
    ContextInfo<span class="token punctuation">.</span>set_account<span class="token punctuation">(</span>account<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>SectorName<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        g<span class="token punctuation">.</span>StockList <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_stock_list_in_sector<span class="token punctuation">(</span>SectorName<span class="token punctuation">)</span>
        
    <span class="token keyword">for</span> s <span class="token keyword">in</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">:</span>
        g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                      <span class="token punctuation">}</span>
    
        g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;可用数量&quot;</span><span class="token punctuation">:</span><span class="token number">0</span>
                        <span class="token punctuation">}</span>
                        
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;初始化完成。&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handlebar</span><span class="token punctuation">(</span>ContextInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> ContextInfo<span class="token punctuation">.</span>is_last_bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
        
    Symbol <span class="token operator">=</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;开始获取历史数据.......&quot;</span><span class="token punctuation">)</span>
        g<span class="token punctuation">.</span>m5Data <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data_ex<span class="token punctuation">(</span>
                        <span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        g<span class="token punctuation">.</span>StockList<span class="token punctuation">,</span>
                        period <span class="token operator">=</span> <span class="token string">'5m'</span><span class="token punctuation">,</span>
                        count <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
                        subscribe <span class="token operator">=</span> <span class="token boolean">True</span>
                       <span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> Symbol <span class="token keyword">in</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">:</span>
            closePrice <span class="token operator">=</span> g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span>
            closePrice <span class="token operator">=</span> closePrice<span class="token punctuation">.</span>values
            macd<span class="token punctuation">,</span>signal<span class="token punctuation">,</span>hist <span class="token operator">=</span> talib<span class="token punctuation">.</span>MACD<span class="token punctuation">(</span>closePrice<span class="token punctuation">,</span>fastperiod <span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>slowperiod <span class="token operator">=</span> <span class="token number">26</span><span class="token punctuation">,</span>signalperiod <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">)</span>
            
            g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'hist'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hist
            
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;获取历史数据完成。&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># =======获取持仓数据=========================================================</span>
    PosList <span class="token operator">=</span> get_trade_detail_data<span class="token punctuation">(</span>account<span class="token punctuation">,</span><span class="token string">'stock'</span><span class="token punctuation">,</span><span class="token string">'position'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> pos <span class="token keyword">in</span> PosList<span class="token punctuation">:</span>
        Symbol <span class="token operator">=</span> pos<span class="token punctuation">.</span>m_strInstrumentID <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> pos<span class="token punctuation">.</span>m_strExchangeID <span class="token comment"># 组合成 600225.SH 这样的字符串</span>
        
        <span class="token keyword">if</span> Symbol <span class="token keyword">not</span> <span class="token keyword">in</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
            
        g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">.</span>m_nVolume
        g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;可用数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">.</span>m_nCanUseVolume

<span class="token comment">#--------刷新行情报价的数据 ---------------------------------------------------</span>
    m5Data <span class="token operator">=</span> ContextInfo<span class="token punctuation">.</span>get_market_data_ex<span class="token punctuation">(</span>
                 <span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 g<span class="token punctuation">.</span>StockList<span class="token punctuation">,</span>
                 period <span class="token operator">=</span> <span class="token string">'5m'</span><span class="token punctuation">,</span>
                 count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                 subscribe <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token punctuation">)</span>
                
    <span class="token keyword">for</span> Symbol <span class="token keyword">in</span> g<span class="token punctuation">.</span>StockList<span class="token punctuation">:</span>
    
        g5mD_stime <span class="token operator">=</span> g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        m5D_stime <span class="token operator">=</span> m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>m5D_stime<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> m5D_stime<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> g5mD_stime<span class="token punctuation">:</span> <span class="token comment"># 5m 图表上更新了一根K线</span>
                g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">,</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> m5D_stime<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> g5mD_stime<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># ------------计算 MACD 指标 ----------------------------------</span>
        closePrice <span class="token operator">=</span> g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span>
        closePrice <span class="token operator">=</span> closePrice<span class="token punctuation">.</span>values
        macd<span class="token punctuation">,</span>signal<span class="token punctuation">,</span>hist <span class="token operator">=</span> talib<span class="token punctuation">.</span>MACD<span class="token punctuation">(</span>closePrice<span class="token punctuation">,</span>fastperiod <span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>slowperiod <span class="token operator">=</span> <span class="token number">26</span><span class="token punctuation">,</span>signalperiod <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">)</span>
            
        g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'hist'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hist

<span class="token comment"># -------根据需求判断 是否 交易了---------------------------------</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> ContextInfo<span class="token punctuation">.</span>is_new_bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;持股总数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token keyword">and</span> 
            g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;hist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">and</span>
            g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;hist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> 
           <span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前品种：&quot;</span><span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token string">&quot;MACD 柱子绿翻红了，买入&quot;</span><span class="token punctuation">)</span>
            passorder<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">1101</span><span class="token punctuation">,</span>account<span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
         
        <span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>StockPos<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;可用数量&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token keyword">and</span>
            g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;hist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> 
            g<span class="token punctuation">.</span>m5Data<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;hist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span> 
           <span class="token punctuation">)</span><span class="token punctuation">:</span> 
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;当前品种：&quot;</span><span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token string">&quot;MACD 柱子红翻绿了，卖出&quot;</span><span class="token punctuation">)</span>
            passorder<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">1101</span><span class="token punctuation">,</span>account<span class="token punctuation">,</span>Symbol<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>ContextInfo<span class="token punctuation">)</span>
            
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;程序完成一次执行任务。&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/xuntou_yao/assets/js/app.a1e6da50.js" defer></script><script src="/xuntou_yao/assets/js/3.1a891015.js" defer></script><script src="/xuntou_yao/assets/js/2.a20b9854.js" defer></script>
  </body>
</html>
